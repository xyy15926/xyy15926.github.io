<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>UBeaRLy</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="UBeaRLy&#039;s Proxy"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="UBeaRLy&#039;s Proxy"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="UBeaRLy"><meta property="og:url" content="https://xyy15926.github.io/"><meta property="og:site_name" content="UBeaRLy"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://xyy15926.github.io/img/og_image.png"><meta property="article:author" content="UBeaRLy"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://xyy15926.github.io"},"headline":"UBeaRLy","image":["https://xyy15926.github.io/img/og_image.png"],"author":{"@type":"Person","name":"UBeaRLy"},"publisher":{"@type":"Organization","name":"UBeaRLy","logo":{"@type":"ImageObject","url":"https://xyy15926.github.io/img/logo.svg"}},"description":""}</script><link rel="alternate" href="/atom.xml" title="UBeaRLy" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/darcula.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-5385776267343559" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="UBeaRLy" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Visit on GitHub" href="https://github.com/xyy15926/proxy"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:37.000Z" title="3/21/2019, 5:27:37 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-02-17T03:57:08.000Z" title="2/17/2019, 11:57:08 AM">2019-02-17</time></span><span class="level-item"><a class="link-muted" href="/categories/Rust/">Rust</a></span><span class="level-item">35 minutes read (About 5224 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Rust/struct_enum.html">Rust 自定义数据类型</a></h1><div class="content"><h2 id="结构体struct"><a href="#结构体struct" class="headerlink" title="结构体struct"></a>结构体struct</h2><p>rust不允许只将特定字段标记为可变（很正常，因为结构体应当
作为一个整体考虑）</p>
<ul>
<li>定义结构体时字段不能添加<code>mut</code></li>
<li>声明结构体时，语法上也难以做到，字段不是单独声明</li>
</ul>
<blockquote>
<p>   结构体中若有字段是引用类型，需要添加生命周期</p>
</blockquote>
<h3 id="普通结构体"><a href="#普通结构体" class="headerlink" title="普通结构体"></a>普通结构体</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">stct</span></span>&#123;</span><br><span class="line">	field1: <span class="built_in">i32</span>,</span><br><span class="line">	field2: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> field1 = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> stct=&#123;</span><br><span class="line">	field1,</span><br><span class="line">	field2: <span class="built_in">String</span>::from(<span class="string">&quot;fy&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//变量字段同名时字段初始化简略写法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> struct1 = stct&#123;</span><br><span class="line">	field1: <span class="number">1</span>,</span><br><span class="line">	..struct2</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//结构体更新语法</span></span><br></pre></td></tr></table></figure>
<h3 id="元组结构体"><a href="#元组结构体" class="headerlink" title="元组结构体"></a>元组结构体</h3><p>结构体名称提供的含义，但只有字段类型没有字段名，用于命名
元组、指定类型，区别于其他相同（结构）的元组</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tuple_stct</span></span>=(<span class="built_in">i32</span>, <span class="built_in">i32</span>, <span class="built_in">i32</span>)</span><br></pre></td></tr></table></figure>
<h3 id="类单元结构体unit-like-struct"><a href="#类单元结构体unit-like-struct" class="headerlink" title="类单元结构体unit-like struct"></a>类单元结构体unit-like struct</h3><p>不定义任何字段，类似于<code>()</code>（<code>()</code>一般用于泛型中占位，表示
当前类型为空，比如<code>T</code>表示返回值泛型参数，无返回值就可以使用
<code>()</code>代替，因为Rust中类似于<code>typedef</code>用于自定义类型），常用于
在某个类型上实现trait，但不需要在 类型内存储数据时发挥作用</p>
<h2 id="枚举enum"><a href="#枚举enum" class="headerlink" title="枚举enum"></a>枚举enum</h2><p>rust枚举更像C语言中<code>enum</code>+<code>struct</code></p>
<ul>
<li><code>enum</code>：定义了新的枚举类型，取值范围有限</li>
<li><code>struct</code>：枚举成员可以关联数据类型，且可以定义方法</li>
</ul>
<h3 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">IpArr</span></span>&#123;</span><br><span class="line">	V4,</span><br><span class="line">	V6,</span><br><span class="line">&#125;</span><br><span class="line">	<span class="comment">//基础版本</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">IpArr</span></span>&#123;</span><br><span class="line">	V4(<span class="built_in">u8</span>, <span class="built_in">u8</span>, <span class="built_in">u8</span>, <span class="built_in">u8</span>&#125;,</span><br><span class="line">	V6(<span class="built_in">String</span>),</span><br><span class="line">&#125;</span><br><span class="line">	<span class="comment">//附加数据版本</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Message</span></span>&#123;</span><br><span class="line">	Quit,</span><br><span class="line">	Move&#123;x: <span class="built_in">i32</span>, y:<span class="built_in">i32</span>&#125;,</span><br><span class="line">	Write(<span class="built_in">String</span>),</span><br><span class="line">	ChangeColor(<span class="built_in">i32</span>, <span class="built_in">i32</span>, <span class="built_in">i32</span>),</span><br><span class="line">&#125;</span><br><span class="line">	<span class="comment">//含有匿名结构体版本</span></span><br></pre></td></tr></table></figure>
<h3 id="标准库中的枚举"><a href="#标准库中的枚举" class="headerlink" title="标准库中的枚举"></a>标准库中的枚举</h3><h4 id="处理null值"><a href="#处理null值" class="headerlink" title="处理null值"></a>处理<code>null</code>值</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Option</span></span>&lt;T&gt;&#123;</span><br><span class="line">	<span class="literal">Some</span>&lt;T&gt;,</span><br><span class="line">	<span class="literal">None</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Option</code>被包含在prelude中，包括其成员，rust标准库中唯一
支持创建任何类型枚举值的枚举类型。rust不允许像有效的<code>T</code>类型
数据一样处理<code>Option&lt;T&gt;</code>类型数据，要求在使用之前处理为<code>None</code>
的情况，此即能够保证在可能为空的值会被处理</p>
<h4 id="处理潜在panic"><a href="#处理潜在panic" class="headerlink" title="处理潜在panic"></a>处理潜在<code>panic</code></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Result</span></span>&lt;T, E&gt;&#123;</span><br><span class="line">	<span class="literal">Ok</span>&lt;T&gt;,</span><br><span class="line">	<span class="literal">Err</span>&lt;E&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="方法、关联函数"><a href="#方法、关联函数" class="headerlink" title="方法、关联函数"></a>方法、关联函数</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> Message&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; Message&#123;</span><br><span class="line">	&#125;</span><br><span class="line">		<span class="comment">//关联函数associated functions，没有`self`作为参数</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">fn1</span></span>(&amp;<span class="keyword">self</span>) -&gt; ret_type&#123;</span><br><span class="line">	&#125;</span><br><span class="line">		<span class="comment">//在结构体（枚举、trait对像）的上下文中定义</span></span><br><span class="line">		<span class="comment">//第一个参数总是`self`，代表调用方法的结构体实例</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">fn2</span></span>(<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; ret_type&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法-Methods"><a href="#方法-Methods" class="headerlink" title="方法 Methods"></a>方法 Methods</h3><ul>
<li><p>定义方法的好处主要在于组织性，将某类型实例能做的事均放入
<code>impl</code>块</p>
</li>
<li><p>方法签名中<code>self</code>会由rust根据<code>impl</code>关键字后的“替换”为
相应类型（运行过程中是当前实例）</p>
</li>
<li><p>方法可以获取<code>self</code>（当前实例）所有权，常用于将<code>self</code>转换
为其他实例，防止调用者转换之后仍使用原始实例</p>
</li>
<li><p>方法是rust中少数几个可以“自动引用和解引用”的地方，因为
方法中<code>self</code>类型是明确的（调用者类型也明确），rust可以
根据方法签名自动为对象添加<code>&amp;</code>、<code>&amp;mut</code>或<code>*</code>以适应方法签名，
所以rust调用方法只有<code>.</code>，没有<code>-&gt;</code></p>
</li>
</ul>
<h3 id="关联函数-Associated-Functions"><a href="#关联函数-Associated-Functions" class="headerlink" title="关联函数 Associated Functions"></a>关联函数 Associated Functions</h3><p>与结构体相关联，不作用于一个结构体实例，常被用于返回一个
结构体新实例的构造函数</p>
<h2 id="Trait"><a href="#Trait" class="headerlink" title="Trait"></a>Trait</h2><p>将方法（关联函数）签名（可以有默认实现）组合起来、定义实现
某些目的所必需的行为的集合</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Summarizable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 无默认实现</span></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">author_summary</span></span>() -&gt; <span class="built_in">String</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 有默认实现</span></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">summary</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span>&#123;</span><br><span class="line">		<span class="built_in">String</span>::from(<span class="string">&quot;Read more...&#123;&#125;&quot;</span>, <span class="keyword">self</span>.author_summary())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义trait</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Summarizable <span class="keyword">for</span> Message&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">author_summary</span></span>(&amp;<span class="keyword">self</span>)&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">summary</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//为类型实现trait，之后就可以和普通非trait方法一样调用</span></span><br></pre></td></tr></table></figure>
<h3 id="默认实现"><a href="#默认实现" class="headerlink" title="默认实现"></a>默认实现</h3><ul>
<li><p>trait中有默认实现的方法可以不重载，实现trait就可直接
调用，没有默认实现的方法则需要全部实现</p>
</li>
<li><p>默认实现重载之后不可能被调用</p>
</li>
<li><p>默认实现可以调用<strong>同trait</strong>中的其他方法，包括没有默认
实现的方法，如此trait可以实现很多功能而只需要实现少部分</p>
<ul>
<li><p>同trait：trait之间本就应该保持独立，这个是trait的
意义</p>
</li>
<li><p>因为实现trait一定要实现所有没有默认实现的方法，所以
默认实现总是“可以调用”</p>
</li>
</ul>
</li>
</ul>
<h3 id="孤儿规则-Orphan-Rule"><a href="#孤儿规则-Orphan-Rule" class="headerlink" title="孤儿规则 Orphan Rule"></a>孤儿规则 Orphan Rule</h3><p>orphan rule：父类型不存在</p>
<p>仅<strong>trait</strong>或<strong>类型</strong>位于（之一）本地crate才能实现trait，
如果没有此限制，可能出现两个crate同时对相同类型实现同一trait
，出现冲突</p>
<h3 id="Box-lt-trait-gt-Trait对像"><a href="#Box-lt-trait-gt-Trait对像" class="headerlink" title="Box&lt;trait&gt; Trait对像"></a><code>Box&lt;trait&gt;</code> Trait对像</h3><p>trait对像指向一个实现了指定trait的类型实例，Rust类型系统在
编译时会确保，任何在此上下文中使用的值会实现其trait对像的
trait，如此无需在编译时知晓所有可能类型。</p>
<h4 id="Trait对象、泛型Trait-Bound对比"><a href="#Trait对象、泛型Trait-Bound对比" class="headerlink" title="Trait对象、泛型Trait Bound对比"></a>Trait对象、泛型Trait Bound对比</h4><ul>
<li><p>trait对像在运行时替代多种具体类型</p>
<ul>
<li>编译时都是同质的<code>Box&lt;trait&gt;</code>类型</li>
<li>只关心值反映的信息而不是其具体类型，类似于动态语言中
<strong>鸭子类型</strong></li>
<li>编译器无法知晓所有可能用于trait对象的类型，因此也
不知道应该调用哪个类型的哪个方法，因此Rust必须使用
<strong>动态</strong>分发</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Draw</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">draw</span></span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Screen</span></span>&#123;</span><br><span class="line">	<span class="keyword">pub</span> components: <span class="built_in">Vec</span>&lt;<span class="built_in">Box</span>&lt;Draw&gt;&gt;,</span><br><span class="line">		<span class="comment">//`Box&lt;Draw&gt;`就是trait对像，可以代替任何实现了</span></span><br><span class="line">		<span class="comment">//`Draw`trait的值</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Screen&#123;</span><br><span class="line">	<span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">run</span></span>(&amp;<span class="keyword">self</span>)&#123;</span><br><span class="line">		<span class="keyword">for</span> component <span class="keyword">in</span> <span class="keyword">self</span>.components.iter()&#123;</span><br><span class="line">			component.draw();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Button</span></span>&#123;</span><br><span class="line">	<span class="keyword">pub</span> width: <span class="built_in">u32</span>,</span><br><span class="line">	<span class="keyword">pub</span> height: <span class="built_in">u32</span>,</span><br><span class="line">	<span class="keyword">pub</span> label: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Draw <span class="keyword">for</span> Button&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">Draw</span>&#123;</span></span><br><span class="line"><span class="function">	&#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 外部crate使用时</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> rust::gui;</span><br><span class="line"><span class="keyword">use</span> rust_gui::&#123;Screen, Button, Draw&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SelectBox</span></span>&#123;</span><br><span class="line">	width: <span class="built_in">u32</span>,</span><br><span class="line">	height: <span class="built_in">u32</span>,</span><br><span class="line">	options: <span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line">	<span class="comment">//此类型对于`Screen`是未知的，但是`components`中仍然能够</span></span><br><span class="line">	<span class="comment">//包含此类型</span></span><br><span class="line"><span class="keyword">impl</span> Draw <span class="keyword">for</span> SelectBox&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">draw</span></span>(&amp;<span class="keyword">self</span>)&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> screen = Screen&#123;</span><br><span class="line">		components: <span class="built_in">vec!</span>[</span><br><span class="line">			<span class="built_in">Box</span>::new(SelectBox&#123;</span><br><span class="line">				width: <span class="number">75</span>,</span><br><span class="line">				height: <span class="number">10</span>,</span><br><span class="line">				option: <span class="built_in">vec!</span>[</span><br><span class="line">					<span class="built_in">String</span>::from(<span class="string">&quot;yes&quot;</span>),</span><br><span class="line">					<span class="built_in">String</span>::from(<span class="string">&quot;maybe&quot;</span>),</span><br><span class="line">				],</span><br><span class="line">			&#125;),</span><br><span class="line">			<span class="built_in">Box</span>::new(Button&#123;</span><br><span class="line">				width: <span class="number">50</span>,</span><br><span class="line">				height: <span class="number">10</span>,</span><br><span class="line">				label: <span class="built_in">String</span>::from(<span class="string">&quot;OK&quot;</span>),</span><br><span class="line">			&#125;),</span><br><span class="line">		],</span><br><span class="line">	&#125;;</span><br><span class="line">	</span><br><span class="line">	screen.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>trait bound泛型类型参数结构体在编译时单态化</p>
<ul>
<li>一次只能替代一个具体类型，多个类型之间不同质</li>
<li>单态化产生的代码进行<strong>静态分发</strong></li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Screen</span></span>&lt;T: Draw&gt;&#123;</span><br><span class="line">	<span class="keyword">pub</span> components: <span class="built_in">Vec</span>&lt;T&gt;,</span><br><span class="line">		<span class="comment">//trait bound泛型参数`T`只能替代一种类型</span></span><br><span class="line">		<span class="comment">//不同的实现`Draw`trait类型不能放在同一个vector中</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Screen&lt;T&gt;</span><br><span class="line">	<span class="keyword">where</span> T: Draw&#123;</span><br><span class="line">	<span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">run</span></span>(&amp;<span class="keyword">self</span>)&#123;</span><br><span class="line">		<span class="keyword">for</span> component <span class="keyword">in</span> <span class="keyword">self</span>.components.iter()&#123;</span><br><span class="line">			component.draw();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<ul>
<li><p>鸭子类型：如果它走起来像一只鸭子，叫起来像一只鸭子，那么
  它就是一直鸭子</p>
</li>
<li><p>静态分发：编译器知晓调用何种方法</p>
</li>
<li>动态分发：编译器在编译时不知晓调用何种方法，生成在运行时
  确定调用某种方法的代码。动态分发阻止编译器有选择的内联
  方法代码，这会禁用部分优化，但获得了额外的灵活性</li>
</ul>
</blockquote>
<h4 id="对象安全"><a href="#对象安全" class="headerlink" title="对象安全"></a>对象安全</h4><p>trait对象要求对象安全，只有<strong>对象安全</strong>的trait才能组成trait
对象，这有一些复杂的规则，但是实践中只涉及</p>
<ul>
<li>返回值类型不为<code>Self</code>：如果trait中的方法返回<code>Self</code>类型，
而使用trait对象后就不再知晓具体的类型，那方法就不可能
使用已经忘却的原始具体类型（<code>Clone</code>trait不是对象安全）</li>
<li>方法没有任何泛型类型参数：具体类型实现trait时会放入具体
类型单态化，但是使用trait对象时无法得知具体类型</li>
</ul>
<h3 id="状态模式（面向对象设计）"><a href="#状态模式（面向对象设计）" class="headerlink" title="状态模式（面向对象设计）"></a>状态模式（面向对象设计）</h3><ul>
<li>值某些内部状态，其行为随着内部状态而改变</li>
<li>内部状态由一系列集成了共享功能的对象表现，每个状态对象
负责自身行为和需要转变为另一个状态时的规则</li>
<li>值对不同状态的行为、何时状态转移不知情，需求改变时无需
改变值持有的状态、值实现代码，只需更新某个状态对象代码
或者是增加更多状态对象</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Post</span></span>&#123;</span><br><span class="line">	state: <span class="built_in">Option</span>&lt;<span class="built_in">Box</span>&lt;State&gt;&gt;,</span><br><span class="line">	content: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Post&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">add_text</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, text: &amp;<span class="built_in">str</span>)&#123;</span><br><span class="line">		<span class="keyword">self</span>.content.push_str(&amp;<span class="built_in">str</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">request_review</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Some</span>(s) = <span class="keyword">self</span>.state.take()&#123;</span><br><span class="line">			<span class="comment">//`Option&lt;T&gt;.take()`返回值，并设置为`None`</span></span><br><span class="line">			<span class="keyword">self</span>.state = <span class="literal">Some</span>(s.request_review())</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">approve</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Some</span>(s) = <span class="keyword">self</span>.state.take()&#123;</span><br><span class="line">			<span class="keyword">self</span>.state = <span class="literal">Some</span>(s.approve())</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">content</span></span>(&amp;<span class="keyword">self</span>) -&gt; &amp;<span class="built_in">str</span>&#123;</span><br><span class="line">		<span class="keyword">self</span>.state.as_ref().unwrap().content(&amp;<span class="keyword">self</span>)</span><br><span class="line">			<span class="comment">//`Option&lt;T&gt;.as_ref()`返回`Option&lt;&amp;T&gt;`，因为参数</span></span><br><span class="line">			<span class="comment">//是`&amp;self`，只能获取不可变引用</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">State</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">request_review</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;State&gt;;</span><br><span class="line">		<span class="comment">//`self: Box&lt;Self&gt;`意味着这个方法调用只对`Self`</span></span><br><span class="line">		<span class="comment">//类型的`Box`指针有效，这里`Self`表示值类型，因为</span></span><br><span class="line">		<span class="comment">//值的类型到struct实现trait的时候才能确定，编译时</span></span><br><span class="line">		<span class="comment">//应该会替换成具体类型</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//这个方法会获取对象的所有权（消费）</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//返回值`Box&lt;State&gt;`是trait对象</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">approve</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;State&gt;;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">content</span></span>&lt;<span class="symbol">&#x27;a</span>&gt;(&amp;<span class="keyword">self</span>, post:&amp;<span class="symbol">&#x27;a</span> Post) -&gt; &amp;<span class="symbol">&#x27;a</span> <span class="built_in">str</span>&#123;</span><br><span class="line">		<span class="string">&quot;&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Draft</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> State <span class="keyword">for</span> Draft&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">request_review</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;State&gt;&#123;</span><br><span class="line">		<span class="built_in">Box</span>::new(PendingReview&#123;&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">approve</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;State&gt;&#123;</span><br><span class="line">		<span class="keyword">self</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PendingReview</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> State <span class="keyword">for</span> PendingReview&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">request_review</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;State&gt;&#123;</span><br><span class="line">		<span class="keyword">self</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">approve</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;State&gt;&#123;</span><br><span class="line">		<span class="built_in">Box</span>::new(Published&#123;&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Published</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> State <span class="keyword">for</span> Published&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">request_review</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;State&gt;&#123;</span><br><span class="line">		<span class="keyword">self</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">approve</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;State&gt;&#123;</span><br><span class="line">		<span class="keyword">self</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">content</span></span>&lt;<span class="symbol">&#x27;a</span>&gt;(&amp;<span class="keyword">self</span> , post:&amp;<span class="symbol">&#x27;a</span> Post) -&gt; &amp;<span class="symbol">&#x27;a</span> <span class="built_in">str</span>&#123;</span><br><span class="line">		&amp;post.content</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="高级trait"><a href="#高级trait" class="headerlink" title="高级trait"></a>高级trait</h2><h3 id="Associated-Type"><a href="#Associated-Type" class="headerlink" title="Associated Type"></a>Associated Type</h3><p>关联类型：将类型占位符和trait相关联的方式</p>
<ul>
<li>可在trait方法中使用这些占位符类型</li>
<li>实现trait时需要指定为具体类型</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Iterator</span></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">type</span> <span class="title">Item</span></span>;</span><br><span class="line">		<span class="comment">//关联类型`Item`，实现时需要指定具体类型</span></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">next</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; <span class="built_in">Option</span>&lt;Self::Item&gt;;</span><br><span class="line">		<span class="comment">//trait方法（签名）中使用关联类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关联类型可以看作时trait中“泛型”（弱化版）。只能实现一次
trait，因此关联类型也只能指定一次，保证了一定的抽象</p>
<h3 id="默认泛型类型参数"><a href="#默认泛型类型参数" class="headerlink" title="默认泛型类型参数"></a>默认泛型类型参数</h3><p>使用泛型类型参数时，可为泛型指定默认类型
<code>&lt;PlaceholderType = ConcreteType&gt;</code></p>
<ul>
<li>扩展类型而不破坏现有代码（普通trait改为泛型trait不需要
改变之前实现trait的代码）</li>
<li>在特殊情况下自定义trait及其中的方法</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::Add;</span><br><span class="line"><span class="meta">#[derive(Debug, PartialEq)]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span>&#123;</span><br><span class="line">	x: <span class="built_in">i32</span>,</span><br><span class="line">	y: <span class="built_in">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Add <span class="keyword">for</span> Point&#123;</span><br><span class="line">	<span class="comment">//`Add`是`+`运算符对应的trait</span></span><br><span class="line">	<span class="comment">//`Add`有默认类型参数，此时未指定泛型参数的具体类型，</span></span><br><span class="line">	<span class="comment">//`RHS`将是默认类型</span></span><br><span class="line">	<span class="class"><span class="keyword">type</span> <span class="title">Output</span></span> = Point;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">add</span></span>(<span class="keyword">self</span>, other: Point) -&gt; Point&#123;</span><br><span class="line">		Point&#123;</span><br><span class="line">			x: <span class="keyword">self</span>.x + other.x,</span><br><span class="line">			y: <span class="keyword">self</span>.x + other.y,</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Add</span></span>&lt;RHS=<span class="keyword">Self</span>&gt;&#123;</span><br><span class="line">	<span class="comment">//`Add`trait定义，包含有泛型参数，但是在实现该trait之前</span></span><br><span class="line">	<span class="comment">//应该必须要为泛型指定具体类型</span></span><br><span class="line">	<span class="comment">//`RHS=Self`就是*默认类型参数*语法，泛型参数`RHS`默认为</span></span><br><span class="line">	<span class="comment">//`Self`类型（`+`左值类型）</span></span><br><span class="line">	<span class="comment">//RHS：right hand side</span></span><br><span class="line">	<span class="class"><span class="keyword">type</span> <span class="title">Output</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">add</span></span>(<span class="keyword">self</span>, rhs: RHS) -&gt; <span class="keyword">Self</span>:Output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="运算符重载"><a href="#运算符重载" class="headerlink" title="运算符重载"></a>运算符重载</h3><p>Rust不允许<strong>创建</strong>自定义运算符、重载<strong>任意</strong>运算符，不过
<code>std::ops</code>中的运算符、相应的trait可以通过实现相关trait重载</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::Add;</span><br><span class="line"><span class="meta">#[derive(Debug, PartialEq)]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Millimeters</span></span>(<span class="built_in">u32</span>);</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Meters</span></span>(<span class="built_in">u32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Add&lt;Meters&gt; <span class="keyword">for</span> Millimeters&#123;</span><br><span class="line">	<span class="comment">//`Add`trait中`RHS`不是默认类型`Self`，`Add&lt;Meters&gt;`</span></span><br><span class="line">	<span class="comment">//设置`RHS`为`Meters`</span></span><br><span class="line">	<span class="comment">//此运算符重载允许`Millmeters`类型和`Meters`类型能够</span></span><br><span class="line">	<span class="comment">//直接相加</span></span><br><span class="line">	<span class="class"><span class="keyword">type</span> <span class="title">Output</span></span> = Millimeters;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">add</span></span>(<span class="keyword">self</span>, other: Meters) -&gt; Millimeters&#123;</span><br><span class="line">		Millimters(<span class="keyword">self</span>.<span class="number">0</span> + (other.<span class="number">0</span> * <span class="number">1000</span>))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="消歧义"><a href="#消歧义" class="headerlink" title="消歧义"></a>消歧义</h3><p>Rust无法避免两个trait具有相同名称的方法，也无法阻止某类型
同时实现两个这样的trait（或者是类型已经实现同名方法），此时
需要明确指定使用哪个方法</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Pilot</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">fly</span></span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Wizard</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">fly</span></span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Human</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Pilot <span class="keyword">for</span> Human&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">fly</span></span>(&amp;<span class="keyword">self</span>)&#123;</span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;this is your captain speaking&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Wizard <span class="keyword">for</span> Human&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">fly</span></span>(&amp;<span class="keyword">self</span>)&#123;</span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;up!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Human&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">fly</span></span>(&amp;<span class="keyword">self</span>)&#123;</span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;waving arms furiously!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> person = Human;</span><br><span class="line">	Pilot::fly(&amp;person);</span><br><span class="line">		<span class="comment">//`Pilot`trait中方法的消歧义写法</span></span><br><span class="line">	Wizard::fly(&amp;person);</span><br><span class="line">	person.fly();</span><br><span class="line">		<span class="comment">//默认调用直接实现在**类型**上的方法</span></span><br><span class="line">	Person::fly(&amp;person);</span><br><span class="line">		<span class="comment">//`Person`类型中方法消歧义写法，一般不使用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Fully-Qualified-Syntax"><a href="#Fully-Qualified-Syntax" class="headerlink" title="Fully Qualified Syntax"></a>Fully Qualified Syntax</h3><p>方法获取<code>self</code>参数</p>
<ul>
<li>不同类型、同方法名，Rust根据<code>self</code>类型可以判断调用何函数</li>
<li>同类型、同方法名，消歧义语法可以指定调用何函数</li>
</ul>
<p>而对于关联函数，没有<code>self</code>参数，某类型有同名的两个关联函数
时，无法使用消歧义语法指定调用何函数，需要使用完全限定语法
<code>&lt;Type as Trait&gt;::function(receiver_if_method), next_args, ...)</code></p>
<p>当然，完全限定语法可以用于所有trait方法、关联函数场合，其中
<code>recevier_if_method</code>即表示方法中<code>self</code>参数</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">trati Animal&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">baby_name</span></span>() -&gt; <span class="built_in">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dog</span></span>;</span><br><span class="line"><span class="keyword">impl</span> Dog&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">baby_name</span></span>() -&gt; <span class="built_in">String</span>&#123;</span><br><span class="line">		<span class="built_in">String</span>::from(<span class="string">&quot;Spot&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Animal <span class="keyword">for</span> Dog&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">baby_name</span></span>() -&gt; <span class="built_in">String</span>&#123;</span><br><span class="line">		<span class="built_in">String</span>::from(<span class="string">&quot;puppy&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;A baby dog is called a &#123;&#125;&quot;</span>, Dog::baby_name());</span><br><span class="line">		<span class="comment">//调用`Dog`的关联函数</span></span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;A baby dog-animal is called a &#123;&#125;&quot;</span>, &lt;Dog <span class="keyword">as</span> Animal&gt;::baby_name());</span><br><span class="line">		<span class="comment">//完全限定语法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Super-Trait"><a href="#Super-Trait" class="headerlink" title="Super Trait"></a>Super Trait</h3><p>有时某个trait可能需要使用另一个trait的功能，要求某类型实现
该trait之前实现被依赖的trait，此所需的trait就是超（父）trait</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">OutlinePrint</span></span>: fmt::Display&#123;</span><br><span class="line">	<span class="comment">//`OutlinePrint`trait依赖于`fmt::Display`trait</span></span><br><span class="line">	<span class="comment">//在实现`OutlinePrint`之前，需要实现`fmt::Display`</span></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">outline_print</span></span>(&amp;<span class="keyword">self</span>)&#123;</span><br><span class="line">		<span class="keyword">let</span> output = <span class="keyword">self</span>.to_string();</span><br><span class="line">		<span class="keyword">let</span> len = output.len();</span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="string">&quot;*&quot;</span>.repeat(len + <span class="number">4</span>));</span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;* &#123;&#125; *&quot;</span>, output);</span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="string">&quot;*&quot;</span>.repeat(len+<span class="number">4</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span>&#123;</span><br><span class="line">	x: <span class="built_in">i32</span>,</span><br><span class="line">	y: <span class="built_in">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> fmt::Display <span class="keyword">for</span> Point&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">fmt</span></span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt::Formatter) -&gt; fmt::<span class="built_in">Result</span>&#123;</span><br><span class="line">		<span class="built_in">write!</span>(f, <span class="string">&quot;(&#123;&#125;, &#123;&#125;)&quot;</span>, <span class="keyword">self</span>,x, <span class="keyword">self</span>.y)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> OutlinePrint <span class="keyword">for</span> Point&#123;&#125;</span><br><span class="line">	<span class="comment">//`OutlinePrint`中所有方法均有默认实现</span></span><br></pre></td></tr></table></figure>
<h2 id="高级类型"><a href="#高级类型" class="headerlink" title="高级类型"></a>高级类型</h2><h3 id="Newtype-Pattern"><a href="#Newtype-Pattern" class="headerlink" title="Newtype Pattern"></a>Newtype Pattern</h3><p>孤儿规则限制了只有trait、类型其中只有位于当前crate时，才能对
类型实现trait，使用newtype模式可以“绕过”该限制，即创建新的
元组结构体类型，其中只包含该类型一个成员，此时封装类型对于
crate是本地的。newtype概念源自于Haskell，此模式没有运行时
性能损失，封装类型在编译器时已经省略了</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Wrapper</span></span>(<span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt;);</span><br><span class="line"><span class="keyword">impl</span> fmt::Display <span class="keyword">for</span> Wrapper&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">fmt</span></span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt:Formatter) -&gt; fmt:<span class="built_in">Result</span>&#123;</span><br><span class="line">		<span class="built_in">write!</span>(f, <span class="string">&quot;[&#123;&#125;]&quot;</span>, <span class="keyword">self</span>.<span class="number">0</span>.join(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> w = Wrapper(<span class="built_in">vec!</span>[<span class="built_in">String</span>::from(<span class="string">&quot;hello&quot;</span>), <span class="built_in">String</span>::from(<span class="string">&quot;world&quot;</span>)]);</span><br><span class="line">	prinlnt!(<span class="string">&quot;w = &#123;&#125;&quot;</span>, w);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是Newtype模式中<code>Wrapper</code>是一个新类型，其上没有定义方法，
需要手动实现<code>self.0</code>的所有方法。或者，为<code>Wrapper</code>实现
<code>Deref</code>trait，并返回<code>self.0</code>，但是此方式下<code>Wrapper</code>会具有
所有<code>self.0</code>的所有方法，如果需要限制封装类型行为，只能自行
实现所需的方法。</p>
<h3 id="Type创建类型别名"><a href="#Type创建类型别名" class="headerlink" title="Type创建类型别名"></a><code>Type</code>创建类型别名</h3><p><code>type</code>关键字可以给予现有类型别名</p>
<ul>
<li><p><code>type</code>不是创建新、单独类型，而是创建别名，而newtype模式
则是真正创建了新类型，也因此无法像newtype模式一样进行
类型检查</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">Kilometers</span></span> = <span class="built_in">i32</span>;</span><br><span class="line">	<span class="comment">//`type`不是创建新、单独的类型，而是赋予别名，两个类型</span></span><br><span class="line">	<span class="comment">//将得到相同的对待</span></span><br><span class="line"><span class="keyword">let</span> x: <span class="built_in">i32</span> = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> y: Kilometers = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;x + y = &#123;&#125;&quot;</span>, x + y);</span><br><span class="line">	<span class="comment">//`Kilometers`类型和`i32`类型完全相同，直接进行运算</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>类型别名主要用途是避免重复</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">Thunk</span></span> = <span class="built_in">Box</span>::&lt;<span class="built_in">Fn</span>() + <span class="built_in">Send</span> + `<span class="keyword">static</span>&gt;;</span><br><span class="line"><span class="keyword">let</span> f: Thunk = <span class="built_in">Box</span>::new(|| <span class="built_in">println!</span>(<span class="string">&quot;hi&quot;</span>));</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">takes_long_type</span></span>(f: Thunk)&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">returns_long_type</span></span>() -&gt; Thunk&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Never-Type"><a href="#Never-Type" class="headerlink" title="Never Type"></a>Never Type</h3><p>Rust中有一个特殊的类型<code>!</code>，被称为empty type（never type)</p>
<ul>
<li><code>!</code>的正式说法：never type可以强转为其他任何类型</li>
<li>无法被创建</li>
<li>用于发散函数（diverging functions，从不返回的函数）的
返回值<h1 id="todo-这个和无返回值函数有何区别"><a href="#todo-这个和无返回值函数有何区别" class="headerlink" title="todo 这个和无返回值函数有何区别"></a>todo 这个和无返回值函数有何区别</h1></li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> guess: <span class="built_in">u32</span> = metch guess.trim().parse()&#123;</span><br><span class="line">	<span class="literal">Ok</span>(num) =&gt; num,</span><br><span class="line">	<span class="literal">Err</span>(_) =&gt; <span class="keyword">continue</span>,</span><br><span class="line">		<span class="comment">//`continue`的值即为`!`，`match`分支的返回值必须相同</span></span><br><span class="line">		<span class="comment">//而`!`没有值，因此确定`match`的返回值类型为`u32`</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; <span class="built_in">Option</span>&lt;T&gt;&#123;</span><br><span class="line">	<span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">unwrap</span></span>(<span class="keyword">self</span>) -&gt; T&#123;</span><br><span class="line">		<span class="comment">// `Option::unwrap`定义</span></span><br><span class="line">		<span class="keyword">match</span> <span class="keyword">self</span>&#123;</span><br><span class="line">			<span class="literal">Some</span>(val) =&gt; val, </span><br><span class="line">			<span class="literal">None</span> =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;called `Option::unwrap()` on a `None` value&quot;</span>),</span><br><span class="line">				<span class="comment">// `panic!`是`!`类型，不返回值而是终止程序</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;forever&quot;</span>);</span><br><span class="line"><span class="keyword">loop</span>&#123;</span><br><span class="line">	<span class="comment">// 循环永不结束，表达式值是`!`</span></span><br><span class="line">	<span class="comment">// 如果加上`break`就不再如此</span></span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;for ever&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Dynamically-Sized-Types"><a href="#Dynamically-Sized-Types" class="headerlink" title="Dynamically Sized Types"></a>Dynamically Sized Types</h3><p>动态大小类型：“DST”或者“uniszed type”，这些类型允许处理
在运行时才知道大小的类型。Rust需要知道特定类型值需要分配的
内存空间，同类型的值<strong>必须</strong>使用相同数量的内存，因此必须
<strong>将动态大小类型的值至于某种指针之后</strong>（此即动态大小类型的
黄金规则），并且使用某些额外的元信息存储动态信息的大小。</p>
<p><code>str</code>就是动态大小类型，<code>&amp;str</code>则是两个值：<code>str</code>的地址和长度，
这样<code>&amp;str</code>就有了一个在编译时可以知道的大小，并且<code>str</code>可以和
所有类型的指针结合<code>Box&lt;str&gt;</code>或<code>Rc&lt;str&gt;</code>。同样的，trait也是
动态大小类型，为了使用trait对象，必须将将其放入指针之后。</p>
<h4 id="Sized-trait"><a href="#Sized-trait" class="headerlink" title="Sized trait"></a><code>Sized</code> trait</h4><p>Rust自动为编译器在编译时就知道大小的类型实现<code>Sized</code> trait，
且Rust隐式的为每个泛型增加了<code>Sized</code> bound</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">generic</span></span>&lt;T&gt;(t: T)&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">generic</span></span>&lt;T: <span class="built_in">Sized</span>&gt;(t: T)&#123;</span><br><span class="line">	<span class="comment">//实际上按照此函数头处理</span></span><br><span class="line">	<span class="comment">//即默认情况下，泛型参数不能是DST</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">generic</span></span>&lt;T: ?<span class="built_in">Sized</span>&gt;(t: &amp;T)&#123;</span><br><span class="line">	<span class="comment">//`?Sized`是特殊的语法，只能用于`Sized` trait不能用于</span></span><br><span class="line">	<span class="comment">//其他trait，表示泛型`T`可能不是`Sized`的，此时参数类型</span></span><br><span class="line">	<span class="comment">//不能是`T`，必须是指针类型的</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="泛型（generic）"><a href="#泛型（generic）" class="headerlink" title="泛型（generic）"></a>泛型（generic）</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">largest</span></span>&lt;T&gt;(list: &amp;[T]) -&gt; T &#123;&#125;</span><br><span class="line"><span class="comment">//函数签名中泛型</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span>&lt;T&gt;&#123;</span><br><span class="line">	x: T,</span><br><span class="line">	y: T,</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span>&lt;T, U&gt;&#123;</span><br><span class="line">	x: T,</span><br><span class="line">	y: U,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//结构体定义中泛型</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Option</span></span>&lt;T&gt;&#123;</span><br><span class="line">	<span class="literal">Some</span>(T),</span><br><span class="line">	<span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Result</span></span>&lt;T, E&gt;&#123;</span><br><span class="line">	<span class="literal">Ok</span>(T),</span><br><span class="line">	<span class="literal">Err</span>(E),</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//枚举定义中泛型</span></span><br></pre></td></tr></table></figure>
<h3 id="方法实现中泛型"><a href="#方法实现中泛型" class="headerlink" title="方法实现中泛型"></a>方法实现中泛型</h3><ul>
<li><p><code>impl</code>后声明泛型<code>impl&lt;T&gt;</code>表示<code>Point&lt;T&gt;</code>中的<code>T</code>是泛型而
不是具体类型，是对所有的泛型结构体实现</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T&gt; Point&lt;T&gt;&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">x</span></span>(&amp;<span class="keyword">self</span>) -&gt; &amp;T&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>impl</code>后不声明泛型，则表示<code>Point&lt;T&gt;</code>中<code>T</code>为具体类型，
此时仅对<code>Point&lt;T&gt;</code><strong>类型</strong>实现方法</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> Point&lt;<span class="built_in">f32</span>&gt;&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">x</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">f32</span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//仅`Point&lt;f32&gt;`实现此方法，其他`T`类型没有</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>结构体定义中的泛型和方法签名中泛型不一定一致</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T, U&gt; Point&lt;T, U&gt;&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">mixup</span></span>&lt;V,W&gt;(<span class="keyword">self</span>, other:Point&lt;V,W&gt;) -&gt; Point&lt;T,W&gt;&#123;</span><br><span class="line">		Point&#123;</span><br><span class="line">			x: <span class="keyword">self</span>.x,</span><br><span class="line">			y: other.y,</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="trait实现中的泛型"><a href="#trait实现中的泛型" class="headerlink" title="trait实现中的泛型"></a>trait实现中的泛型</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T:Display&gt; <span class="built_in">ToString</span> <span class="keyword">for</span> T&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这个时标准库中的一个例子，使用了trait bounds</span></span><br><span class="line"><span class="comment">// 不使用trait bounds，那感觉有些恐怖。。。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>   trait定义中的没有泛型，但是其中可以包含泛型方法，同普通
    函数</p>
</blockquote>
<h3 id="泛型代码的性能"><a href="#泛型代码的性能" class="headerlink" title="泛型代码的性能"></a>泛型代码的性能</h3><p>rust在编译时将代码单态化（monomorphization）保证效率，所以
rust使用泛型代码相比具体类型没有任何性能损失</p>
<blockquote>
<p>   单态化：将泛型代码转变为实际放入的具体类型</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> integer = <span class="literal">Some</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">let</span> float = <span class="literal">Some</span>(<span class="number">5.0</span>);</span><br><span class="line"><span class="comment">//单态化</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Option_i32</span></span>&#123;</span><br><span class="line">	<span class="literal">Some</span>(<span class="built_in">i32</span>),</span><br><span class="line">	<span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Option_f64</span></span>&#123;</span><br><span class="line">	<span class="literal">Some</span>(<span class="built_in">f64</span>),</span><br><span class="line">	<span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> integer = Option_i32::<span class="literal">Some</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">let</span> float = Option_f64::<span class="literal">Some</span>(<span class="number">5.0</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Trait-Bounds"><a href="#Trait-Bounds" class="headerlink" title="Trait Bounds"></a>Trait Bounds</h3><p>指定泛型的trait bounds：限制泛型不再适合任何类型，编译器
确保其被限制为实现特定trait的类型</p>
<ul>
<li><p>指定函数泛型trait bounds限制参数类型</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">notify</span></span>&lt;T: Summarizable&gt;(item:T)&#123;&#125;</span><br><span class="line"><span class="comment">// 一个trait bound</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">some_fn</span></span>&lt;T: Display+<span class="built_in">Clone</span>, U: <span class="built_in">Debug</span>+<span class="built_in">Clone</span>&gt;(t:T, u:U) -&gt; <span class="number">32</span>&#123;&#125;</span><br><span class="line"><span class="comment">// 多个trait bounds</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">some_fn</span></span>&lt;T, U&gt;(t:T, u:U) -&gt; <span class="number">32</span></span><br><span class="line">	<span class="keyword">where</span> T:Display + <span class="built_in">Clone</span>,</span><br><span class="line">			U: <span class="built_in">Debug</span> + <span class="built_in">Clone</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// where从句写法</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>指定方法泛型trait bounds有条件的为某些类型实现</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T: Display+<span class="built_in">PartialOrd</span>&gt; Point&lt;T&gt;&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">cmp_display</span></span>(&amp;<span class="keyword">self</span>)&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="trait和泛型的比较"><a href="#trait和泛型的比较" class="headerlink" title="trait和泛型的比较"></a>trait和泛型的比较</h3><p>trait和泛型都是<strong>抽象</strong>方法</p>
<ul>
<li><p>trait从方法角度抽象</p>
<ul>
<li>定义一组公共“行为”</li>
<li>“标记（trait bounds）”特定<strong>类型（泛型）</strong></li>
</ul>
</li>
<li><p>泛型从类型的角度抽象</p>
<ul>
<li>为<strong>一组（trait bounds）</strong>类型定义“项”<code>struct</code>、<code>enum</code></li>
<li>为<strong>一组（trait bounds）</strong>类型实现函数、trait</li>
</ul>
</li>
<li><p>trait的定义中不应该出现泛型</p>
<ul>
<li>trait本意应该是定义一组“行为”，需要特定类型实现其方法
（当然有的方法有默认实现），其对应的“对象”不是类型而
是方法，与泛型用途无关</li>
<li>trait中定义泛型无意义，trait只是一个“包裹”，真正实现
的是其中的方法，如有必要，定义含有泛型参数的方法即可</li>
<li>若trait中可以使用泛型，则<strong>有可能</strong>对不同的泛型具体
类型实现“相同”（函数签名没有泛型参数）函数
（在trait中有关联类型提供略弱与泛型的功能）</li>
</ul>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:37.000Z" title="3/21/2019, 5:27:37 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-02-17T03:57:08.000Z" title="2/17/2019, 11:57:08 AM">2019-02-17</time></span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a><span> / </span><a class="link-muted" href="/categories/Database/Hadoop/">Hadoop</a></span><span class="level-item">an hour read (About 7085 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Database/Hadoop/hadoop_inset.html">Hadoop安装配置</a></h1><div class="content"><h2 id="Hadoop安装"><a href="#Hadoop安装" class="headerlink" title="Hadoop安装"></a>Hadoop安装</h2><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><ul>
<li><p>Java</p>
<ul>
<li>具体版本<a target="_blank" rel="noopener" href="http://wiki.apache.org/hadoop/HadoopJavaVersions">http://wiki.apache.org/hadoop/HadoopJavaVersions</a></li>
<li>需要配置好java环境（<code>~/.bashrc</code>）</li>
</ul>
</li>
<li><p>ssh：必须安装且保证sshd一直运行，以便使用hadoop脚本管理
远端hadoop守护进程</p>
<ul>
<li>pdsh：建议安装获得更好的ssh资源管理</li>
<li>要设置免密登陆</li>
</ul>
</li>
</ul>
<h3 id="机器环境配置"><a href="#机器环境配置" class="headerlink" title="机器环境配置"></a>机器环境配置</h3><h4 id="bashrc"><a href="#bashrc" class="headerlink" title="~/.bashrc"></a><code>~/.bashrc</code></h4><p>这里所有的设置都只是设置环境变量</p>
<ul>
<li><p>所以这里所有环境变量都可以放在<code>hadoop-env.sh</code>中</p>
</li>
<li><p>放在<code>.bashrc</code>中不是基于用户隔离的考虑</p>
<ul>
<li>因为hadoop中配置信息大部分放在<code>.xml</code>，放在这里无法
实现用户隔离</li>
<li>更多的考虑是给hive等依赖hadoop的应用提供hadoop配置</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">export HADOOP_PREFIX=/opt/hadoop</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 自定义部分</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 此处是直接解压放在`/opt`目录下</span></span><br><span class="line">export HADOOP_HOME=$HADOOP_PREFIX</span><br><span class="line">export HADOOP_COMMON_HOME=$HADOOP_PREFIX</span><br><span class="line"><span class="meta">	#</span><span class="bash"> hadoop common</span></span><br><span class="line">export HADOOP_HDFS_HOME=$HADOOP_PREFIX</span><br><span class="line"><span class="meta">	#</span><span class="bash"> hdfs</span></span><br><span class="line">export HADOOP_MAPRED_HOME=$HADOOP_PREFIX</span><br><span class="line"><span class="meta">	#</span><span class="bash"> mapreduce</span></span><br><span class="line">export HADOOP_YARN_HOME=$HADOOP_PREFIX</span><br><span class="line"><span class="meta">	#</span><span class="bash"> YARN</span></span><br><span class="line">export HADOOP_CONF_DIR=$HADOOP_PREFIX/etc/hadoop</span><br><span class="line"></span><br><span class="line">export HADOOP_COMMON_LIB_NATIVE_DIR=$HADOOP_HOME/lib/native</span><br><span class="line">export HADOOP_OPTS=&quot;$HADOOP_OPTS -Djava.library.path=$HADOOP_COMMON_LIB_NATIVE_DIR&quot;</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 这里`-Djava`间不能有空格</span></span><br><span class="line"></span><br><span class="line">export CLASSPATH=$CLASS_PATH:$HADOOP_PREFIX/lib/*</span><br><span class="line">export PATH=$PATH:$HADOOP_PREFIX/sbin:$HADOOP_PREFIX/bin</span><br></pre></td></tr></table></figure>
<h4 id="etc-hosts"><a href="#etc-hosts" class="headerlink" title="/etc/hosts"></a><code>/etc/hosts</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">192.168.31.129 hd-master</span><br><span class="line">192.168.31.130 hd-slave1</span><br><span class="line">192.168.31.131 hd-slave2</span><br><span class="line">127.0.0.1 localhost</span><br></pre></td></tr></table></figure>
<ul>
<li>这里配置的ip地址是各个主机的ip，需要自行配置</li>
<li><code>hd-master</code>、<code>hd-slave1</code>等就是主机ip-主机名映射</li>
<li><h1 id="todo-一定需要在-etc-hostname中设置各个主机名称"><a href="#todo-一定需要在-etc-hostname中设置各个主机名称" class="headerlink" title="todo?一定需要在/etc/hostname中设置各个主机名称"></a>todo?一定需要在<code>/etc/hostname</code>中设置各个主机名称</h1></li>
</ul>
<h4 id="firewalld"><a href="#firewalld" class="headerlink" title="firewalld"></a><code>firewalld</code></h4><p>必须关闭所有节点的防火墙</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl stop firewalld.service</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">disable</span> firewalld.service</span></span><br></pre></td></tr></table></figure>
<h4 id="文件夹建立"><a href="#文件夹建立" class="headerlink" title="文件夹建立"></a>文件夹建立</h4><ul>
<li>所有节点都需要建立</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir tmp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir -p hdfs/data hdfs/name</span></span><br></pre></td></tr></table></figure>
<h3 id="Hadoop配置"><a href="#Hadoop配置" class="headerlink" title="Hadoop配置"></a>Hadoop配置</h3><p>Hadoop<strong>全系列</strong>（包括hive、tez等）配置取决于以下两类配置文件</p>
<ul>
<li><p>只读默认配置文件</p>
<ul>
<li><code>core-defualt.xml</code></li>
<li><code>hdfs-default.xml</code></li>
<li><code>mapred-default.xml</code></li>
</ul>
</li>
<li><p>随站点变化的配置文件</p>
<ul>
<li><code>etc/hadoop/core-site.xml</code></li>
<li><code>etc/hadoop/hdfs-site.xml</code></li>
<li><code>etc/hadoop/mapred-site.xml</code></li>
<li><code>etc/hadoop/yarn-env.xml</code></li>
</ul>
</li>
<li><p>环境设置文件：设置随站点变化的值，从而控制<code>bin/</code>中的
hadoop脚本行为</p>
<ul>
<li><code>etc/hadoop/hadoop-env.sh</code>、</li>
<li><code>etc/hadoop/yarn-env.sh</code></li>
<li><code>etc/hadoop/mapred-env.sh</code></li>
</ul>
<p>中一般是环境变量配置，<strong>补充</strong>在shell中未设置的环境变量</p>
</li>
<li><p>注意</p>
<ul>
<li><p><code>.xml</code>配置信息可在不同应用的配置文件中<strong>继承</strong>使用，
如在tez的配置中可以使用<code>core-site.xml</code>中
<code>$&#123;fs.defaultFS&#125;</code>变量</p>
</li>
<li><p>应用会读取/执行相应的<code>*_CONF_DIR</code>目录下所有
<code>.xml</code>/<code>.sh</code>文件，所以理论上可以在<code>etc/hadoop</code>中存放
所以配置文件，因为hadoop是最底层应用，在其他所有应用
启动前把环境均已设置完毕？？？</p>
</li>
</ul>
</li>
</ul>
<p>Hadoop集群有三种运行模式</p>
<ul>
<li>Standalone Operation</li>
<li>Pseudo-Distributed Operation</li>
<li>Fully-Distributed Operation</li>
</ul>
<p>针对不同的运行模式有，hadoop有三种不同的配置方式</p>
<h4 id="Standalone-Operation"><a href="#Standalone-Operation" class="headerlink" title="Standalone Operation"></a>Standalone Operation</h4><p>hadoop被配置为以非分布模式运行的一个独立Java进程，对调试有
帮助</p>
<ul>
<li>默认为单机模式，无需配置</li>
</ul>
<h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /path/to/hadoop</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir input</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp etc/hadoop/*.xml input</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.1.jar grep input output <span class="string">&#x27;dfs[a-z.]+&#x27;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat output/*</span></span><br></pre></td></tr></table></figure>
<h4 id="Pseudo-Distributed-Operation"><a href="#Pseudo-Distributed-Operation" class="headerlink" title="Pseudo-Distributed Operation"></a>Pseudo-Distributed Operation</h4><p>在单节点（服务器）上以所谓的伪分布式模式运行，此时每个Hadoop
守护进程作为独立的Java进程运行</p>
<h5 id="core-site-xml"><a href="#core-site-xml" class="headerlink" title="core-site.xml"></a><code>core-site.xml</code></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="hdfs-site-xml"><a href="#hdfs-site-xml" class="headerlink" title="hdfs-site.xml"></a><code>hdfs-site.xml</code></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="mapred-site-xml"><a href="#mapred-site-xml" class="headerlink" title="mapred-site.xml"></a><code>mapred-site.xml</code></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configruration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.application.classpath<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>$HADOOP_HOME/share/hadoop/mapreduce/*:$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/lib/*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">preperty</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configruation</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="yarn-site-xml"><a href="#yarn-site-xml" class="headerlink" title="yarn-site.xml"></a><code>yarn-site.xml</code></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span><br><span class="line">		&lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span><br><span class="line">	&lt;/property&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;yarn.nodemanager.env-whitelist&lt;/name&gt;</span><br><span class="line">		&lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;/value&gt;</span><br><span class="line">	&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Fully-Distributed-Operation"><a href="#Fully-Distributed-Operation" class="headerlink" title="Fully-Distributed Operation"></a>Fully-Distributed Operation</h4><ul>
<li><strong>单节点配置完hadoop之后，需要将其同步到其余节点</strong></li>
</ul>
<h5 id="core-site-xml-1"><a href="#core-site-xml-1" class="headerlink" title="core-site.xml"></a><code>core-site.xml</code></h5><p>模板：<code>core-site.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hd-master:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>namenode address<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>file:///opt/hadoop/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>io.file.buffer.size<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>131702<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.hosts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.groups<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 为将用户`root`设置为超级代理，代理所有用户，如果是其他用户需要相应的将root修改为其用户名 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 是为hive的JDBCServer远程访问而设置，应该有其他情况也需要 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="hdfs-site-xml-1"><a href="#hdfs-site-xml-1" class="headerlink" title="hdfs-site.xml"></a><code>hdfs-site.xml</code></h5><p>模板：<code>hdfs-site.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hd-master:9001<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>file:///opt/hadoop/hdfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>namenode data directory<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>file:///opt/hadoop/hdfs/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>datanode data directory<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>replication number<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.webhdfs.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.directoryscan.throttle.limit.ms.per.sec<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>1000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--bug--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="yarn-site-xml-1"><a href="#yarn-site-xml-1" class="headerlink" title="yarn-site.xml"></a><code>yarn-site.xml</code></h5><ul>
<li>模板：<code>yarn-site.xml</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hd-master<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hd-master:9032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hd-master:9030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hd-master:9031<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.admin.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hd-master:9033<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hd-master:9099<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- container --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>512<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>maximum memory allocation per container<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>256<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>minimum memory allocation per container<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- container --&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- node --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.memory-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>maximium memory allocation per node<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-pmem-ratio<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>virtual memmory ratio<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- node --&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.app.mapreduce.am.resource.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>384<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.app.mapreduce.am.command-opts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>-Xms128m -Xmx256m<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.cpu-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services.mapreduce.shuffle.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.mapred.ShuffleHandler<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="mapred-site-xml-1"><a href="#mapred-site-xml-1" class="headerlink" title="mapred-site.xml"></a><code>mapred-site.xml</code></h5><ul>
<li>模板：<code>mapred-site.xml.template</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		&lt;value&gt;yarn-tez&lt;/value&gt;</span></span><br><span class="line"><span class="comment">		设置整个hadoop运行在Tez上，需要配置好Tez</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hd-master:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hd-master:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- mapreduce --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.memory.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>256<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>memory allocation for map task, which should between minimum container and maximum<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.memory.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>256<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>memory allocation for reduce task, which should between minimum container and maximum<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- mapreduce --&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- java heap size options --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.java.opts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>-Xms128m -Xmx256m<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.java.opts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>-Xms128m -Xmx256m<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- java heap size options --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h5><ul>
<li><p><code>yarn.scheduler.minimum-allocation-mb</code>：container内存
单位，也是container分配的内存最小值</p>
</li>
<li><p><code>yarn.scheduler.maximum-allocation-mb</code>：container内存
最大值，应该为最小值整数倍</p>
</li>
<li><p><code>mapreduce.map.memeory.mb</code>：map task的内存分配</p>
<ul>
<li>hadoop2x中mapreduce构建于YARN之上，资源由YARN统一管理</li>
<li>所以maptask任务的内存应设置container最小值、最大值间</li>
<li>否则分配一个单位，即最小值container</li>
</ul>
</li>
<li><p><code>mapreduce.reduce.memeory.mb</code>：reduce task的内存分配</p>
<ul>
<li>设置一般为map task的两倍</li>
</ul>
</li>
<li><p><code>*.java.opts</code>：JVM进程参数设置</p>
<ul>
<li>每个container（其中执行task）中都会运行JVM进程</li>
<li><code>-Xmx...m</code>：heap size最大值设置，所以此参数应该小于
task（map、reduce）对应的container分配内存的最大值，
如果超出会出现physical memory溢出</li>
<li><code>-Xms...m</code>：heap size最小值？#todo</li>
</ul>
</li>
<li><p><code>yarn.nodemanager.vmem-pmem-ratio</code>：虚拟内存比例</p>
<ul>
<li>以上所有配置都按照此参数放缩</li>
<li>所以在信息中会有physical memory、virtual memory区分</li>
</ul>
</li>
<li><p><code>yarn.nodemanager.resource.memory-mb</code>：节点内存设置</p>
<ul>
<li>整个节点被设置的最大内存，剩余内存共操作系统使用</li>
</ul>
</li>
<li><p><code>yarn.app.mapreduce.am.resource.mb</code>：每个Application
Manager分配的内存大小</p>
</li>
</ul>
<h4 id="主从文件"><a href="#主从文件" class="headerlink" title="主从文件"></a>主从文件</h4><h5 id="masters"><a href="#masters" class="headerlink" title="masters"></a><code>masters</code></h5><ul>
<li>设置主节点地址，根据需要设置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hd-master</span><br></pre></td></tr></table></figure>
<h5 id="slaves"><a href="#slaves" class="headerlink" title="slaves"></a><code>slaves</code></h5><ul>
<li>设置从节点地址，根据需要设置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hd-slave1</span><br><span class="line">hd-slave2</span><br></pre></td></tr></table></figure>
<h4 id="环境设置文件"><a href="#环境设置文件" class="headerlink" title="环境设置文件"></a>环境设置文件</h4><ul>
<li>这里环境设置只是起补充作用，在<code>~/.bashrc</code>已经设置的
环境变量可以不设置</li>
<li>但是在这里设置环境变量，然后把整个目录同步到其他节点，
可以保证在其余节点也能同样的设置环境变量</li>
</ul>
<h5 id="hadoop-env-sh"><a href="#hadoop-env-sh" class="headerlink" title="hadoop-env.sh"></a><code>hadoop-env.sh</code></h5><p>设置<code>JAVA_HOME</code>为Java安装根路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/opt/java/jdk</span><br></pre></td></tr></table></figure>
<h5 id="hdfs-env-sh"><a href="#hdfs-env-sh" class="headerlink" title="hdfs-env.sh"></a><code>hdfs-env.sh</code></h5><p>设置<code>JAVA_HOME</code>为Java安装根路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/opt/java/jdk</span><br></pre></td></tr></table></figure>
<h5 id="yarn-env-sh"><a href="#yarn-env-sh" class="headerlink" title="yarn-env.sh"></a><code>yarn-env.sh</code></h5><p>设置<code>JAVA_HOME</code>为Java安装根路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/opt/java/jdk</span><br><span class="line">JAVA_HEAP_MAX=Xmx3072m</span><br></pre></td></tr></table></figure>
<h4 id="初始化、启动、测试"><a href="#初始化、启动、测试" class="headerlink" title="初始化、启动、测试"></a>初始化、启动、测试</h4><h5 id="HDFS"><a href="#HDFS" class="headerlink" title="HDFS"></a>HDFS</h5><ul>
<li><p>格式化、启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hdfs namenode -format</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 格式化文件系统</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> start-dfs.sh</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 启动NameNode和DataNode</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 此时已可访问NameNode，默认http://localhost:9870/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> stop-dfs.sh</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hdfs dfsadmin -report</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 应该输出3个节点的情况</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hdfs dfs -mkdir /user</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hdfs dfs -mkdir /user/&lt;username&gt;</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 创建执行MapReduce任务所需的HDFS文件夹</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hdfs dfs -mkdir input</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hdfs dfs -put etc/hadoop/*.xml input</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 复制文件至分布式文件系统</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hadoop jar /opt/hadoop/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.7.jar grep input output <span class="string">&#x27;dfs[a-z]+&#x27;</span></span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 执行自带样例</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 样例名称取决于版本</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hdfs dfs -get output outut</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat output/*</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 检查输出文件：将所有的输出文件从分布式文件系统复制</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 至本地文件系统，并检查</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hdfs dfs -cat output/*</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 或者之间查看分布式文件系统上的输出文件</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.7.jar \</span></span><br><span class="line"><span class="bash">	-input /path/to/hdfs_file \</span></span><br><span class="line"><span class="bash">	-output /path/to/hdfs_dir \</span></span><br><span class="line"><span class="bash">	-mapper <span class="string">&quot;/bin/cat&quot;</span> \</span></span><br><span class="line"><span class="bash">	-reducer <span class="string">&quot;/user/bin/wc&quot;</span> \</span></span><br><span class="line"><span class="bash">	-file /path/to/local_file \</span></span><br><span class="line"><span class="bash">	-numReduceTasks 1</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="YARN"><a href="#YARN" class="headerlink" title="YARN"></a>YARN</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sbin/start-yarn.sh</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 启动ResourceManger守护进程、NodeManager守护进程</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 即可访问ResourceManager的web接口，默认：http://localhost:8088/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sbin/stop-yarn.sh</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 关闭守护进程</span></span><br></pre></td></tr></table></figure>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ul>
<li><p><code>hdfs namenode -format</code>甚至可以在datanode节点没有java时
成功格式化</p>
</li>
<li><p>没有关闭防火墙时，整个集群可以正常启动，甚至可以在hdfs里
正常建立文件夹，但是<strong>无法写入文件</strong>，尝试写入文件时报错</p>
</li>
</ul>
<h4 id="可能错误"><a href="#可能错误" class="headerlink" title="可能错误"></a>可能错误</h4><h5 id="节点启动不全"><a href="#节点启动不全" class="headerlink" title="节点启动不全"></a>节点启动不全</h5><ul>
<li><p>原因</p>
<ul>
<li>服务未正常关闭，节点状态不一致</li>
</ul>
</li>
<li><p>关闭服务、删除存储数据的文件夹<code>dfs/data</code>、格式化namenode</p>
</li>
</ul>
<h5 id="文件无法写入"><a href="#文件无法写入" class="headerlink" title="文件无法写入"></a>文件无法写入</h5><blockquote>
<p>   could only be replicated to 0 nodes instead of minReplication (=1).  There are 2 datanode(s) running and 2 node(s) are excluded in this operation.</p>
</blockquote>
<ul>
<li><p>原因</p>
<ul>
<li>未关闭防火墙</li>
<li>存储空间不够</li>
<li>节点状态不一致、启动不全</li>
<li>在log里面甚至可能会出现一个连接超时1000ms的ERROR</li>
</ul>
</li>
<li><p>处理</p>
<ul>
<li>关闭服务、删除存储数据的文件夹<code>dfs/data</code>、格式化
namenode<ul>
<li>这样处理会丢失数据，不能用于生产环境</li>
</ul>
</li>
<li>尝试修改节点状态信息文件<code>VERSION</code>一致<ul>
<li><code>$&#123;hadoop.tmp.dir&#125;</code></li>
<li><code>$&#123;dfs.namenode.name.dir&#125;</code></li>
<li><code>$&#123;dfs.datanode.data.dir&#125;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="Unhealthy-Node"><a href="#Unhealthy-Node" class="headerlink" title="Unhealthy Node"></a>Unhealthy Node</h5><blockquote>
<p>   1/1 local-dirs are bad: /opt/hadoop/tmp/nm-local-dir; 1/1 log-dirs are bad: /opt/hadoop/logs/userlogs</p>
</blockquote>
<ul>
<li>原因：磁盘占用超过90%</li>
</ul>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">scp -r /opt/hadoop/etc/hadoop centos2:/opt/hadoop/etc</span><br><span class="line">scp -r /opt/hadoop/etc/hadoop centos3:/opt/hadoop/etc</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 同步配置</span></span><br><span class="line"></span><br><span class="line">scp /root/.bashrc centos2:/root</span><br><span class="line">scp /root/.bashrc centos3:/root</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 同步环境</span></span><br><span class="line"></span><br><span class="line">rm -r /opt/hadoop/tmp /opt/hadoop/hdfs</span><br><span class="line">mkdir -p /opt/hadoop/tmp /opt/hadoop/hdfs</span><br><span class="line">ssh centos2 rm -r /opt/hadoop/tmp /opt/hadoop/hdfs</span><br><span class="line">ssh centos2 mkdir -p /opt/hadoop/tmp /opt/hadoop/hdfs/name /opt/hadoop/hdfs/data</span><br><span class="line">ssh centos3 rm -r /opt/hadoop/tmp /opt/hadoop/hdfs/name /opt/hadoop/data</span><br><span class="line">ssh centos3 mkdir -p /opt/hadoop/tmp /opt/hadoop/hdfs/name /opt/hadoop/hdfs/data</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 同步清除数据</span></span><br><span class="line"></span><br><span class="line">rm -r /opt/hadoop/logs/*</span><br><span class="line">ssh centos2 rm -r /opt/hadoop/logs/*</span><br><span class="line">ssh centos3 rm -r /opt/hadoop/logs/*</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 同步清除<span class="built_in">log</span></span></span><br></pre></td></tr></table></figure>
<h2 id="Hive"><a href="#Hive" class="headerlink" title="Hive"></a>Hive</h2><h3 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h3><ul>
<li>hadoop：配置完成hadoop，则相应java等也配置完成</li>
<li>关系型数据库：mysql、derby等</li>
</ul>
<h3 id="机器环境配置-1"><a href="#机器环境配置-1" class="headerlink" title="机器环境配置"></a>机器环境配置</h3><h4 id="bashrc-1"><a href="#bashrc-1" class="headerlink" title="~/.bashrc"></a><code>~/.bashrc</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export HIVE_HOME=/opt/hive</span><br><span class="line"><span class="meta">	#</span><span class="bash"> self designed</span></span><br><span class="line">export HIVE_CONF_DIR=$HIVE_HOME/conf</span><br><span class="line">export PATH=$PATH:$HIVE_HOME/bin</span><br><span class="line">export CLASSPATH=$CLASS_PATH:$HIVE_HOME/lib/*</span><br></pre></td></tr></table></figure>
<h4 id="文件夹建立-1"><a href="#文件夹建立-1" class="headerlink" title="文件夹建立"></a>文件夹建立</h4><h5 id="HDFS-1"><a href="#HDFS-1" class="headerlink" title="HDFS"></a>HDFS</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hdfs dfs -rm -r /user/hive</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hdfs dfs -mkdir -p /user/hive/warehouse /user/hive/tmp /user/hive/logs</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 这三个目录与配置文件中对应</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hdfs dfs -chmod 777 /user/hive/warehouse /user/hive/tmp /user/hive/logs</span></span><br></pre></td></tr></table></figure>
<h5 id="FS"><a href="#FS" class="headerlink" title="FS"></a>FS</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir data</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> chmod 777 data</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> hive数据存储文件夹</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir logs</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> chmod 777 logs</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> <span class="built_in">log</span>目录</span></span><br></pre></td></tr></table></figure>
<h3 id="Hive配置"><a href="#Hive配置" class="headerlink" title="Hive配置"></a>Hive配置</h3><h4 id="XML参数"><a href="#XML参数" class="headerlink" title="XML参数"></a>XML参数</h4><h5 id="conf-hive-site-xml"><a href="#conf-hive-site-xml" class="headerlink" title="conf/hive-site.xml"></a><code>conf/hive-site.xml</code></h5><ul>
<li>模板：<code>conf/hive-default.xml.template</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://hd-master:3306/metastore_db?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>org.mariadb.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">value</span>&gt;</span>hive<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>1234<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/hive/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.exec.scratchdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/hive/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">&lt;property&gt;</span></span><br><span class="line"><span class="comment">	&lt;name&gt;hive.exec.local.scratchdir&lt;/name&gt;</span></span><br><span class="line"><span class="comment">	&lt;value&gt;$&#123;system:java.io.tmpdir&#125;/$&#123;system:user.name&#125;&lt;/value&gt;</span></span><br><span class="line"><span class="comment">&lt;/property&gt;</span></span><br><span class="line"><span class="comment">&lt;property&gt;</span></span><br><span class="line"><span class="comment">	&lt;name&gt;hive.downloaded.resources.dir&lt;/name&gt;</span></span><br><span class="line"><span class="comment">	&lt;valeu&gt;$&#123;system:java.io.tmpdir&#125;/$&#123;hive.session.id&#125;_resources&lt;/value&gt;</span></span><br><span class="line"><span class="comment">&lt;/property&gt;</span></span><br><span class="line"><span class="comment">&lt;property&gt;«</span></span><br><span class="line"><span class="comment">	&lt;name&gt;hive.server2.logging.operation.log.location&lt;/name&gt;«</span></span><br><span class="line"><span class="comment">	&lt;value&gt;$&#123;system:java.io.tmpdir&#125;/$&#123;system:user.name&#125;/operation_logs&lt;/value&gt;«</span></span><br><span class="line"><span class="comment">	&lt;description&gt;Top level directory where operation logs are stored if logging functionality is enabled&lt;/description&gt;«</span></span><br><span class="line"><span class="comment">&lt;/property&gt;«</span></span><br><span class="line"><span class="comment">所有`$&#123;system.java.io.tmpdir&#125;`都要被替换为相应的`/opt/hive/tmp`，</span></span><br><span class="line"><span class="comment">可以通过设置这两个变量即可，基本是用于设置路径</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>system:java.io.tmpdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/hive/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>system:user.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>hive<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">&lt;property&gt;</span></span><br><span class="line"><span class="comment">	&lt;name&gt;hive.querylog.location&lt;/name&gt;</span></span><br><span class="line"><span class="comment">	&lt;value&gt;/user/hive/logs&lt;/value&gt;</span></span><br><span class="line"><span class="comment">	&lt;description&gt;Location of Hive run time structured log file&lt;/description&gt;</span></span><br><span class="line"><span class="comment">&lt;/property&gt;</span></span><br><span class="line"><span class="comment">这里应该不用设置，log放在本地文件系统更合适吧</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.uris<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>thrift://192.168.31.129:19083<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这个是配置metastore，如果配置此选项，每次启动hive必须先启动metastore，否则hive实可直接启动--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.logging.operation.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用JDBCServer时需要配置，否则无法自行建立log文件夹，然后报错，手动创建可行，但是每次查询都会删除文件夹，必须查一次建一次 --&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>/user</code>开头的路径一般表示hdfs中的路径，而<code>$&#123;&#125;</code>变量开头
的路径一般表示本地文件系统路径</p>
<ul>
<li>变量<code>system:java.io.tmpdir</code>、<code>system:user.name</code>在
文件中需要自己设置，这样就避免需要手动更改出现这些
变量的地方</li>
<li><code>hive.querylog.location</code>设置在本地更好，这个日志好像
只在hive启动时存在，只是查询日志，不是hive运行日志，
hive结束运行时会被删除，并不是没有生成日志、<code>$&#123;&#125;</code>表示
HDFS路径</li>
</ul>
</li>
<li><p>配置中出现的目录（HDFS、locaL）有些手动建立</p>
<ul>
<li>HDFS的目录手动建立？</li>
<li>local不用</li>
</ul>
</li>
<li><p><code>hive.metastore.uris</code>若配置，则hive会通过metastore服务
访问元信息</p>
<ul>
<li>使用hive前需要启动metastore服务</li>
<li>并且端口要和配置文件中一样，否则hive无法访问</li>
</ul>
</li>
</ul>
<h4 id="环境设置文件-1"><a href="#环境设置文件-1" class="headerlink" title="环境设置文件"></a>环境设置文件</h4><h5 id="conf-hive-env-sh"><a href="#conf-hive-env-sh" class="headerlink" title="conf/hive-env.sh"></a><code>conf/hive-env.sh</code></h5><ul>
<li>模板：<code>conf/hive-env.sh.template</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/java/jdk</span><br><span class="line">export HADOOP_HOME=/opt/hadoop</span><br><span class="line">export HIVE_CONF_DIR=/opt/hive/conf</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 以上3者若在`~/.bashrc`中设置，则无需再次设置</span></span><br><span class="line">export HIVE_AUX_JARS_PATH=/opt/hive/lib</span><br></pre></td></tr></table></figure>
<h5 id="conf-hive-exec-log4j2-properties"><a href="#conf-hive-exec-log4j2-properties" class="headerlink" title="conf/hive-exec-log4j2.properties"></a><code>conf/hive-exec-log4j2.properties</code></h5><ul>
<li><p>模板：<code>hive-exec-log4j2.properties.template</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">property.hive.log.dir=/opt/hive/logs</span><br><span class="line">	# 原为`$&#123;sys:java.io.tmpdir&#125;/$&#123;sys:user.name&#125;`</span><br><span class="line">	# 即`/tmp/root`（root用户执行）</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="conf-hive-log4j2-properties"><a href="#conf-hive-log4j2-properties" class="headerlink" title="conf/hive-log4j2.properties"></a><code>conf/hive-log4j2.properties</code></h5><ul>
<li>模板：<code>hive-log4j2.properties.template</code></li>
</ul>
<h4 id="MetaStore"><a href="#MetaStore" class="headerlink" title="MetaStore"></a>MetaStore</h4><h5 id="MariaDB"><a href="#MariaDB" class="headerlink" title="MariaDB"></a>MariaDB</h5><ul>
<li><p>安装MariaDB</p>
</li>
<li><p>修改MariaDB配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cp /user/share/mysql/my-huge.cnf /etc/my.cnf</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建用户，注意新创建用户可能无效，见mysql配置</p>
<ul>
<li>需要注意用户权限：创建数据库权限、修改表权限</li>
<li>初始化时Hive要自己创建数据库（<code>hive-site</code>中配置），
所以对权限比较严格的环境下，可能需要先行创建同名
数据库、赋权、删库</li>
</ul>
</li>
<li><p>下载<code>mariadb-java-client-x.x.x-jar</code>包，复制到<code>lib</code>中</p>
</li>
</ul>
<h5 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> schematool -initSchema -dbType mysql</span></span><br></pre></td></tr></table></figure>
<p>这个命令要在所有配置完成之后执行</p>
<h4 id="服务设置"><a href="#服务设置" class="headerlink" title="服务设置"></a>服务设置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hive --service metastore -p 19083 &amp;</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 启动metastore服务，端口要和hive中的配置相同</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 否则hive无法连接metastore服务，无法使用</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 终止metastore服务只能根据进程号`<span class="built_in">kill</span>`</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hive --service hiveserver2 --hiveconf hive.server2.thrift.port =10011 &amp;</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 启动JDBC Server</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 此时可以通过JDBC Client（如beeline）连接JDBC Server对</span></span><br><span class="line"><span class="meta">		#</span><span class="bash"> Hive中数据进行操作</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hive --service hiveserver2 --stop</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 停止JDBC Server</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 或者直接<span class="built_in">kill</span></span></span><br></pre></td></tr></table></figure>
<h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><h5 id="Hive可用性"><a href="#Hive可用性" class="headerlink" title="Hive可用性"></a>Hive可用性</h5><p>需要先启动hdfs、YARN、metastore database（mysql），如果有
设置独立metastore server，还需要在正确端口启动</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hive<span class="operator">&gt;</span>	<span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> words(id <span class="type">INT</span>, word STRING)</span><br><span class="line">		<span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> &quot; &quot;</span><br><span class="line">		lines terminated <span class="keyword">by</span> &quot;\n&quot;;</span><br><span class="line">hive<span class="operator">&gt;</span>	load data <span class="keyword">local</span> inpath &quot;/opt/hive-test.txt&quot; overwrite <span class="keyword">into</span></span><br><span class="line">		<span class="keyword">table</span> words;</span><br><span class="line">hive<span class="operator">&gt;</span>	<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> words;</span><br></pre></td></tr></table></figure>
<h5 id="JDBCServer可用性"><a href="#JDBCServer可用性" class="headerlink" title="JDBCServer可用性"></a>JDBCServer可用性</h5><ul>
<li><p>命令行连接</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> beeline -u jdbc:hive2://localhost:10011 -n hive -p 1234</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>beeline中连接</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> beeline</span></span><br><span class="line"><span class="meta">beeline&gt;</span><span class="bash"> !connect jdbc:hive2://localhost:10011</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 然后输入用户名、密码（metastore数据库用户名密码）</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="其他-1"><a href="#其他-1" class="headerlink" title="其他"></a>其他</h3><h4 id="可能错误-1"><a href="#可能错误-1" class="headerlink" title="可能错误"></a>可能错误</h4><blockquote>
<p>   Failed with exception Unable to move source file</p>
</blockquote>
<ul>
<li>linux用户权限问题，无法操作原文件</li>
<li>hdfs用户权限问题，无法写入目标文件</li>
<li>hdfs配置问题，根本无法向hdfs写入：参见hdfs问题</li>
</ul>
<blockquote>
<p>   org.apache.hive.service.cli.HiveSQLException: Couldn’t find log associated with operation handle: </p>
</blockquote>
<ul>
<li><p>原因：hiveserver2查询日志文件夹不存在</p>
</li>
<li><p>可以在hive中通过</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">set</span> hive.server2.logging.operation.log.location;</span><br></pre></td></tr></table></figure>
<p>查询日志文件夹，建立即可，默认为
<code>$&#123;system:java.io.tmpdir&#125;/$&#123;system:user.name&#125;/operation_logs</code>
，并设置权限为777</p>
<ul>
<li>好像如果不设置权限为777，每次查询文件夹被删除，每
查询一次建立一次文件夹？#todo</li>
<li>在<code>hive-sitex.xml</code>中配置允许自行创建？</li>
</ul>
</li>
</ul>
<blockquote>
<p>   User: root is not allowed to impersonate hive</p>
</blockquote>
<ul>
<li><p>原因：当前用户（不一定是root）不被允许通过代理操作
hadoop用户、用户组、主机</p>
<ul>
<li>hadoop引入安全伪装机制，不允许上层系统直接将实际用户
传递给超级代理，此代理在hadoop上执行操作，避免客户端
随意操作hadoop</li>
</ul>
</li>
<li><p>配置hadoop的<code>core-site.xml</code>，使得当前用户作为超级代理</p>
</li>
</ul>
<h2 id="Tez"><a href="#Tez" class="headerlink" title="Tez"></a>Tez</h2><h3 id="依赖-2"><a href="#依赖-2" class="headerlink" title="依赖"></a>依赖</h3><ul>
<li>hadoop</li>
</ul>
<h3 id="机器环境配置-2"><a href="#机器环境配置-2" class="headerlink" title="机器环境配置"></a>机器环境配置</h3><h4 id="bashrc-2"><a href="#bashrc-2" class="headerlink" title=".bashrc"></a><code>.bashrc</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export TEZ_HOME=/opt/tez</span><br><span class="line">export TEZ_CONF_DIR=$TEZ_HOME/conf</span><br><span class="line"></span><br><span class="line">for jar in `ls $TEZ_HOME | grep jar`; do</span><br><span class="line">	export HADOOP_CLASSPATH=$HADOOP_CLASSPATH:$TEZ_HOME/$jar</span><br><span class="line">done</span><br><span class="line">for jar in `ls $TEZ_HOME/lib`; do</span><br><span class="line">	export HADOOP_CLASSPATH=$HADOOP_CLASSPATH:$TEZ_HOME/lib/$jar</span><br><span class="line">done</span><br><span class="line"><span class="meta">	#</span><span class="bash"> this part could be replaced with line bellow</span></span><br><span class="line">export HADOOP_CLASSPATH=$HADOOP_CLASSPATH:$TEZ_HOME/*:$TEZ_HOME/lib/*</span><br><span class="line"><span class="meta">	#</span><span class="bash"> `hadoop-env.sh`中说`HADOOP_CLASSPATH`是Extra Java CLASSPATH</span></span><br><span class="line"><span class="meta">		#</span><span class="bash"> elements</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 这意味着hadoop组件只需要把其jar包加到`HADOOP_CLASSPATH`中既可</span></span><br></pre></td></tr></table></figure>
<h4 id="HDFS-2"><a href="#HDFS-2" class="headerlink" title="HDFS"></a>HDFS</h4><ul>
<li><p>上传<code>$TEZ_HOME/share/tez.tar.gz</code>至HDFS中</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hdfs dfs -mkdir /apps</span><br><span class="line">$ hdfs dfs -copyFromLocal tez.tar.gz /apps</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="HadoopOnTez"><a href="#HadoopOnTez" class="headerlink" title="HadoopOnTez"></a>HadoopOnTez</h3><p>在hadoop中配置Tez</p>
<ul>
<li><p>侵入性较强，对已有的hadoop集群全体均有影响</p>
</li>
<li><p>所有hadoop集群执行的MapReduce任务都通过tez执行</p>
<ul>
<li>这里所有的任务应该是指直接在hadoop上执行、能在
webRM上看到的任务</li>
<li>hive这样的独立组件需要独立配置</li>
</ul>
</li>
</ul>
<h4 id="XML参数-1"><a href="#XML参数-1" class="headerlink" title="XML参数"></a>XML参数</h4><h5 id="tez-site-xml"><a href="#tez-site-xml" class="headerlink" title="tez-site.xml"></a><code>tez-site.xml</code></h5><ul>
<li>模板：<code>conf/tez-default-tmplate.xml</code></li>
<li>好像还是需要复制到hadoop的配置文件夹中</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;name&gt;tez.lib.uris&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;$&#123;fs.defaultFS&#125;/apps/tez.tar.gz&lt;/value&gt;</span><br><span class="line">	&lt;!--设置tez安装包位置--&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;name&gt;tez.container.max.java.heap.fraction&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;0.2&lt;/value&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">内存不足时--&gt;</span><br></pre></td></tr></table></figure>
<h5 id="mapred-site-xml-2"><a href="#mapred-site-xml-2" class="headerlink" title="mapred-site.xml"></a><code>mapred-site.xml</code></h5><ul>
<li>修改<code>mapred-site.xml</code>文件：配置mapreduce基于<code>yarn-tez</code>，
（配置修改在hadoop部分也有）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn-tez<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="环境参数"><a href="#环境参数" class="headerlink" title="环境参数"></a>环境参数</h4><h3 id="HiveOnTez"><a href="#HiveOnTez" class="headerlink" title="HiveOnTez"></a>HiveOnTez</h3><ul>
<li><p>此模式下Hive可以在mapreduce、tez计算模型下自由切换？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">set</span> hive.execution.engine<span class="operator">=</span>tez;</span><br><span class="line">	# 切换查询引擎为tez</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">set</span> hive.execution.engine<span class="operator">=</span>mr;</span><br><span class="line">	# 切换查询引擎为mapreduce</span><br><span class="line">	# 这些命令好像没用，只能更改值，不能更改实际查询模型</span><br></pre></td></tr></table></figure>
</li>
<li><p>只有Hive会受到影响，其他基于hadoop平台的mapreduce作业
仍然使用tez计算模型</p>
</li>
</ul>
<h4 id="Hive设置"><a href="#Hive设置" class="headerlink" title="Hive设置"></a>Hive设置</h4><ul>
<li>若已经修改了<code>mapred-site.xml</code>设置全局基于tez，则无需复制
jar包，直接修改<code>hive-site.xml</code>即可</li>
</ul>
<h5 id="Jar包复制"><a href="#Jar包复制" class="headerlink" title="Jar包复制"></a>Jar包复制</h5><p>复制<code>$TEZ_HOME</code>、<code>$TEZ_HOME/lib</code>下的jar包到<code>$HIVE_HOME/lib</code>
下即可</p>
<h5 id="hive-site-xml"><a href="#hive-site-xml" class="headerlink" title="hive-site.xml"></a><code>hive-site.xml</code></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;name&gt;hive.execution.engine&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;tez&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<h3 id="其他-2"><a href="#其他-2" class="headerlink" title="其他"></a>其他</h3><h4 id="可能错误-2"><a href="#可能错误-2" class="headerlink" title="可能错误"></a>可能错误</h4><blockquote>
<p>   SLF4J: Class path contains multiple SLF4J bindings.</p>
</blockquote>
<ul>
<li>原因：包冲突的</li>
<li>解决方案：根据提示冲突包删除即可</li>
</ul>
<h2 id="Spark"><a href="#Spark" class="headerlink" title="Spark"></a>Spark</h2><h3 id="依赖-3"><a href="#依赖-3" class="headerlink" title="依赖"></a>依赖</h3><ul>
<li>java</li>
<li>scala</li>
<li>python：一般安装anaconda，需要额外配置<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PYTHON_HOME=/opt/anaconda3</span><br><span class="line">export PATH=$PYTHON_HOME/bin:$PATH</span><br></pre></td></tr></table></figure></li>
<li>相应资源管理框架，如果不以standalone模式运行</li>
</ul>
<h3 id="机器环境配置-3"><a href="#机器环境配置-3" class="headerlink" title="机器环境配置"></a>机器环境配置</h3><h4 id="bashrc-3"><a href="#bashrc-3" class="headerlink" title="~/.bashrc"></a><code>~/.bashrc</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export SPARK_HOME=/opt/spark</span><br><span class="line">export PATH=$PATH:$SPARK_HOME/bin:$SPARK_HOME/sbin</span><br><span class="line">export PYTHON_PATH=$PYTHON_PATH:$SPARK_HOME/python:$SPARK_HOME/python/lib/*</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 把`pyshark`、`py4j`模块对应的zip文件添加进路径</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 这里用的是`*`通配符应该也可以，手动添加所有zip肯定可以</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 否则无法在一般的python中对spark进行操作</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 似乎只要master节点有设置`/lib/*`添加`pyspark`、`py4j`就行</span></span><br></pre></td></tr></table></figure>
<h3 id="Standalone"><a href="#Standalone" class="headerlink" title="Standalone"></a>Standalone</h3><h4 id="环境设置文件-2"><a href="#环境设置文件-2" class="headerlink" title="环境设置文件"></a>环境设置文件</h4><h5 id="conf-spark-env-sh"><a href="#conf-spark-env-sh" class="headerlink" title="conf/spark-env.sh"></a><code>conf/spark-env.sh</code></h5><ul>
<li>模板：<code>conf/spark-env.sh.template</code></li>
</ul>
<p>这里应该有些配置可以省略、移除#todo</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/jdk</span><br><span class="line">export HADOOP_HOME=/opt/hadoop</span><br><span class="line">export hADOOP_CONF_DIR=/opt/hadoop/etc/hadoop</span><br><span class="line">export HIVE_HOME=/opt/hive</span><br><span class="line"></span><br><span class="line">export SCALA_HOME=/opt/scala</span><br><span class="line">export SCALA_LIBRARY=$SPARK_HOME/lib</span><br><span class="line"><span class="meta">	#</span><span class="bash"> `~/.bashrc`设置完成之后，前面这段应该就这个需要设置</span></span><br><span class="line"></span><br><span class="line">export SPARK_HOME=/opt/spark</span><br><span class="line">export SPARK_DIST_CLASSPATH=$(hadoop classpath)</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 这里是执行命令获取classpath</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> todo</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 这里看文档的意思，应该也是类似于`<span class="variable">$HADOOP_CLASSPATH</span>`</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 可以直接添加进`<span class="variable">$CLASSPATH</span>`而不必设置此变量</span></span><br><span class="line">export SPARK_LIBRARY_PATH=$SPARK_HOME/lib</span><br><span class="line"></span><br><span class="line">export SPARK_MASTER_HOST=hd-master</span><br><span class="line">export SPARK_MASTER_PORT=7077</span><br><span class="line">export SPARK_MASTER_WEBUI_PORT=8080</span><br><span class="line">export SPARK_WORKER_WEBUI_PORT=8081</span><br><span class="line">export SPARK_WORKER_MEMORY=1024m</span><br><span class="line"><span class="meta">	#</span><span class="bash"> spark能在一个container内执行多个task</span></span><br><span class="line">export SPARK_LOCAL_DIRS=$SPARK_HOME/data</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 需要手动创建</span></span><br><span class="line"></span><br><span class="line">export SPARK_MASTER_OPTS=</span><br><span class="line">export SPARK_WORKER_OPTS=</span><br><span class="line">export SPARK_DAEMON_JAVA_OPTS=</span><br><span class="line">export SPARK_DAEMON_MEMORY=</span><br><span class="line">export SPARK_DAEMON_JAVA_OPTS=</span><br></pre></td></tr></table></figure>
<h5 id="文件夹建立-2"><a href="#文件夹建立-2" class="headerlink" title="文件夹建立"></a>文件夹建立</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir /opt/spark/spark_data</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> <span class="keyword">for</span> `<span class="variable">$SPARK_LOCAL_DIRS</span>`</span></span><br></pre></td></tr></table></figure>
<h4 id="Spark配置"><a href="#Spark配置" class="headerlink" title="Spark配置"></a>Spark配置</h4><h5 id="conf-slaves"><a href="#conf-slaves" class="headerlink" title="conf/slaves"></a><code>conf/slaves</code></h5><p>文件不存在，则在当前主机单节点运行</p>
<ul>
<li>模板：<code>conf/slaves.template</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hd-slave1</span><br><span class="line">hd-slave2</span><br></pre></td></tr></table></figure>
<h5 id="conf-hive-site-xml-1"><a href="#conf-hive-site-xml-1" class="headerlink" title="conf/hive-site.xml"></a><code>conf/hive-site.xml</code></h5><p>这里只是配置Spark，让Spark作为“thrift客户端”能正确连上
metastore server</p>
<ul>
<li>模板：<code>/opt/hive/conf/hive-site.xml</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.uris<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>thrift://192.168.31.129:19083<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>Thrift URI for the remote metastor. Used by metastore client to connect to remote metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>10011<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--配置spark对外界thrift服务，以便可通过JDBC客户端存取spark--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--这里启动端口同hive的配置，所以两者不能默认同时启动--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.bind.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hd-master<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a>测试</h4><h5 id="启动Spark服务"><a href="#启动Spark服务" class="headerlink" title="启动Spark服务"></a>启动Spark服务</h5><p>需要启动hdfs、正确端口启动的metastore server</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> start-master.sh</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 在执行**此命令**机器上启动master实例</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> start-slaves.sh</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 在`conf/slaves`中的机器上启动worker实例</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> start-slave.sh</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 在执行**此命令**机器上启动worker实例</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> stop-master.sh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> stop-slaves.sh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> stop-slave.sh</span></span><br></pre></td></tr></table></figure>
<h5 id="启动Spark-Thrift-Server"><a href="#启动Spark-Thrift-Server" class="headerlink" title="启动Spark Thrift Server"></a>启动Spark Thrift Server</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> start-thriftserver.sh --master spark://hd-master:7077 \</span></span><br><span class="line"><span class="bash">	--hiveconf hive.server2.thrift.bind.host hd-master \</span></span><br><span class="line"><span class="bash">	--hiveconf hive.server2.thrift.port 10011</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 这里在命令行启动thrift server时动态指定host、port</span></span><br><span class="line"><span class="meta">		#</span><span class="bash"> 如果在`conf/hive-site.xml`有配置，应该不需要</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 然后使用beeline连接thrift server，同hive</span></span><br></pre></td></tr></table></figure>
<h5 id="Spark-Sql测试"><a href="#Spark-Sql测试" class="headerlink" title="Spark-Sql测试"></a>Spark-Sql测试</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ spark<span class="operator">-</span><span class="keyword">sql</span> <span class="comment">--master spark://hd-master:7077</span></span><br><span class="line">	# 在含有配置文件的节点上启动时，配置文件中已经指定`MASTER`</span><br><span class="line">		# 因此不需要指定后面配置</span><br><span class="line"></span><br><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">set</span> spark.sql.shuffle.partitions<span class="operator">=</span><span class="number">20</span>;</span><br><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> id, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> words <span class="keyword">group</span> <span class="keyword">by</span> id <span class="keyword">order</span> <span class="keyword">by</span> id;</span><br></pre></td></tr></table></figure>
<h5 id="pyspark测试"><a href="#pyspark测试" class="headerlink" title="pyspark测试"></a>pyspark测试</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ MASTER=spark://hd-master:<span class="number">7077</span> pyspark</span><br><span class="line">	<span class="comment"># 这里应该是调用`$PATH`中第一个python，如果未默认指定</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> HiveContext</span><br><span class="line">sql_ctxt = HiveContext(sc)</span><br><span class="line">	<span class="comment"># 此`sc`是pyspark启动时自带的，是`SparkContext`类型实例</span></span><br><span class="line">	<span class="comment"># 每个连接只能有一个此实例，不能再次创建此实例</span></span><br><span class="line"></span><br><span class="line">ret = sql_ctxt.sql(<span class="string">&quot;show tables&quot;</span>).collect()</span><br><span class="line">	<span class="comment"># 这里语句结尾不能加`;` </span></span><br><span class="line"></span><br><span class="line">file = sc.textFile(<span class="string">&quot;hdfs://hd-master:9000/user/root/input/capacity-scheduler.xml&quot;</span>)</span><br><span class="line">file.count()</span><br><span class="line">file.first()</span><br></pre></td></tr></table></figure>
<h5 id="Scala测试"><a href="#Scala测试" class="headerlink" title="Scala测试"></a>Scala测试</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="type">MASTER</span>=spark:<span class="comment">//hd-master:7077 spark-shell \</span></span><br><span class="line">	executor-memory <span class="number">1024</span>m \</span><br><span class="line">	--total-executor-cores <span class="number">2</span> \</span><br><span class="line">	--excutor-cores <span class="number">1</span> \</span><br><span class="line">	# 添加参数启动`spark-shell`</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.<span class="type">SQLContext</span></span><br><span class="line"><span class="keyword">val</span> sqlContext = <span class="keyword">new</span> org.apache.spark.sql.hive.<span class="type">HiveContext</span>(sc)</span><br><span class="line">sqlContext.sql(<span class="string">&quot;select * from words&quot;</span>).collect().foreach(println)</span><br><span class="line">sqlContext.sql(<span class="string">&quot;select id, word from words order by id&quot;</span>).collect().foreach(println)</span><br><span class="line"></span><br><span class="line">sqlContext.sql(<span class="string">&quot;insert into words values(7, \&quot;jd\&quot;)&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> df = sqlContext.sql(<span class="string">&quot;select * from words&quot;</span>);</span><br><span class="line">df.show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> df = spark.read.json(<span class="string">&quot;file:///opt/spark/example/src/main/resources/people.json&quot;</span>)</span><br><span class="line">df.show()</span><br></pre></td></tr></table></figure>
<h3 id="Spark-on-YARN"><a href="#Spark-on-YARN" class="headerlink" title="Spark on YARN"></a>Spark on YARN</h3><h3 id="其他-3"><a href="#其他-3" class="headerlink" title="其他"></a>其他</h3><h4 id="可能错误-3"><a href="#可能错误-3" class="headerlink" title="可能错误"></a>可能错误</h4><blockquote>
<p>   Initial job has not accepted any resources;</p>
</blockquote>
<ul>
<li><p>原因：内存不足，spark提交application时内存超过分配给
worker节点内存</p>
</li>
<li><p>说明</p>
<ul>
<li>根据结果来看，<code>pyspark</code>、<code>spark-sql</code>需要内存比
<code>spark-shell</code>少？
（设置worker内存512m，前两者可以正常运行）</li>
<li>但是前两者的内存分配和scala不同，scala应该是提交任务
、指定内存大小的方式，这也可以从web-ui中看出来，只有
spark-shell开启时才算是<em>application</em></li>
</ul>
</li>
<li><p>解决方式</p>
<ul>
<li>修改<code>conf/spark-env.sh</code>中<code>SPARK_WORKER_MEMORY</code>更大，
（spark默认提交application内存为1024m）</li>
<li>添加启动参数<code>--executor-memory XXXm</code>不超过分配值</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>ERROR KeyProviderCache:87 - Could not find uri with key [dfs.encryption.key.provider.uri] to create a keyProvider
</code></pre></blockquote>
<ul>
<li>无影响</li>
</ul>
<h2 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a>HBase</h2><h3 id="依赖-4"><a href="#依赖-4" class="headerlink" title="依赖"></a>依赖</h3><ul>
<li>java</li>
<li>hadoop</li>
<li>zookeeper：建议，否则日志不好管理</li>
</ul>
<h3 id="机器环境"><a href="#机器环境" class="headerlink" title="机器环境"></a>机器环境</h3><h4 id="bashrc-4"><a href="#bashrc-4" class="headerlink" title="~/.bashrc"></a><code>~/.bashrc</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export HBASE_HOME=/opt/hbase</span><br><span class="line">export PATH=$PAHT:$HBASE_HOME/bin</span><br><span class="line">export HADOOP_CLASSPATH=$HADOOP_CLASSPATH:$HBASE_HOME/lib/*</span><br></pre></td></tr></table></figure>
<h4 id="建立目录"><a href="#建立目录" class="headerlink" title="建立目录"></a>建立目录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir /tmp/hbase/tmpdir</span></span><br></pre></td></tr></table></figure>
<h3 id="HBase配置"><a href="#HBase配置" class="headerlink" title="HBase配置"></a>HBase配置</h3><h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><h5 id="conf-hbase-env-sh"><a href="#conf-hbase-env-sh" class="headerlink" title="conf/hbase-env.sh"></a><code>conf/hbase-env.sh</code></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export HBASE_MANAGES_ZK=false</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 不使用自带zookeeper</span></span><br></pre></td></tr></table></figure>
<h5 id="conf-zoo-cfg"><a href="#conf-zoo-cfg" class="headerlink" title="conf/zoo.cfg"></a><code>conf/zoo.cfg</code></h5><p>若设置使用独立zookeeper，需要复制zookeeper配置至HBase配置
文件夹中</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp /opt/zookeeper/conf/zoo.cfg /opt/hbase/conf</span><br></pre></td></tr></table></figure>
<h4 id="Standalone模式"><a href="#Standalone模式" class="headerlink" title="Standalone模式"></a>Standalone模式</h4><h5 id="conf-hbase-site-xml"><a href="#conf-hbase-site-xml" class="headerlink" title="conf/hbase-site.xml"></a><code>conf/hbase-site.xml</code></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>file://$&#123;HBASE_HOME&#125;/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>/tmp/zookeeper/zkdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Pseudo-Distributed模式"><a href="#Pseudo-Distributed模式" class="headerlink" title="Pseudo-Distributed模式"></a>Pseudo-Distributed模式</h4><h5 id="conf-hbase-site-xml-1"><a href="#conf-hbase-site-xml-1" class="headerlink" title="conf/hbase-site.xml"></a><code>conf/hbase-site.xml</code></h5><ul>
<li>在Standalone配置上修改</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">proeperty</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hd-master:9000/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Fully-Distributed模式"><a href="#Fully-Distributed模式" class="headerlink" title="Fully-Distributed模式"></a>Fully-Distributed模式</h4><h5 id="conf-hbase-site-xml-2"><a href="#conf-hbase-site-xml-2" class="headerlink" title="conf/hbase-site.xml"></a><code>conf/hbase-site.xml</code></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hd-master:9000/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>hd-master,hd-slave1,hd-slave2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>/tmp/zookeeper/zkdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="测试-3"><a href="#测试-3" class="headerlink" title="测试"></a>测试</h4><ul>
<li>需要首先启动HDFS、YARN</li>
<li>使用独立zookeeper还需要先行在每个节点启动zookeeper</li>
</ul>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ start-hbase.sh</span><br><span class="line"><span class="code">	# 启动HBase服务</span></span><br><span class="line"><span class="code">$ local-regionservers.sh start 2 3 4 5</span></span><br><span class="line"><span class="code">	# 启动额外的4个RegionServer</span></span><br><span class="line"><span class="code">$ hbase shell</span></span><br><span class="line"><span class="code">hbase&gt; create &#x27;test&#x27;, &#x27;cf&#x27;</span></span><br><span class="line"><span class="code">hbase&gt; list &#x27;test&#x27;</span></span><br><span class="line"><span class="code">hbase&gt; put &#x27;test&#x27;, &#x27;row7&#x27;, &#x27;cf:a&#x27;, &#x27;value7a&#x27;</span></span><br><span class="line"><span class="code">	put &#x27;test&#x27;, &#x27;row7&#x27;, &#x27;cf:b&#x27;, &#x27;value7b&#x27;</span></span><br><span class="line"><span class="code">	put &#x27;test&#x27;, &#x27;row7&#x27;, &#x27;cf:c&#x27;, &#x27;value7c&#x27;</span></span><br><span class="line"><span class="code">	put &#x27;test&#x27;, &#x27;row8&#x27;, &#x27;cf:b&#x27;, &#x27;value8b&#x27;,</span></span><br><span class="line"><span class="code">	put &#x27;test&#x27;, &#x27;row9&#x27;, &#x27;cf:c&#x27;, &#x27;value9c&#x27;</span></span><br><span class="line"><span class="code">hbase&gt; scan &#x27;test&#x27;</span></span><br><span class="line"><span class="code">hbase&gt; get &#x27;test&#x27;, &#x27;row7&#x27;</span></span><br><span class="line"><span class="code">hbase&gt; disable &#x27;test&#x27;</span></span><br><span class="line"><span class="code">hbase&gt; enable &#x27;test&#x27;</span></span><br><span class="line"><span class="code">hbaee&gt; drop &#x27;test&#x27;</span></span><br><span class="line"><span class="code">hbase&gt; quit</span></span><br></pre></td></tr></table></figure>
<h2 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h2><h3 id="依赖-5"><a href="#依赖-5" class="headerlink" title="依赖"></a>依赖</h3><ul>
<li><p>java</p>
</li>
<li><p>注意：zookeeper集群中工作超过半数才能对外提供服务，所以
一般配置服务器数量为奇数</p>
</li>
</ul>
<h3 id="机器环境-1"><a href="#机器环境-1" class="headerlink" title="机器环境"></a>机器环境</h3><h4 id="bashrc-5"><a href="#bashrc-5" class="headerlink" title="~/.bashrc"></a><code>~/.bashrc</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export ZOOKEEPER_HOME=/opt/zookeeper</span><br><span class="line">export PATH=$PATH:$ZOOKEEPER_HOME/bin</span><br><span class="line">export HADOOP_CLASSPATH=$HADOOP_CLASSPATH:$ZOOKEEPER_HOME/lib</span><br></pre></td></tr></table></figure>
<h4 id="创建文件夹"><a href="#创建文件夹" class="headerlink" title="创建文件夹"></a>创建文件夹</h4><ul>
<li>在所有节点都需要创建相应文件夹、<code>myid</code>文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /tmp/zookeeper/zkdata /tmp/zookeeper/zkdatalog</span><br><span class="line">echo 0 &gt; /tmp/zookeeper/zkdatalog/myid</span><br><span class="line"></span><br><span class="line">ssh centos2 mkdir -p /tmp/zookeeper/zkdata /tmp/zookeeper/zkdatalog</span><br><span class="line">ssh centos3 mkdir -p /tmp/zookeeper/zkdata /tmp/zookeeper/zkdatalog</span><br><span class="line">ssh centos2 &quot;echo 2 &gt; /tmp/zookeeper/zkdata/myid&quot;</span><br><span class="line">ssh centos3 &quot;echo 3 &gt; /tmp/zookeeper/zkdata/myid&quot;</span><br></pre></td></tr></table></figure>
<h3 id="Zookeeper配置"><a href="#Zookeeper配置" class="headerlink" title="Zookeeper配置"></a>Zookeeper配置</h3><h4 id="Conf"><a href="#Conf" class="headerlink" title="Conf"></a>Conf</h4><h5 id="conf-zoo-cfg-1"><a href="#conf-zoo-cfg-1" class="headerlink" title="conf/zoo.cfg"></a><code>conf/zoo.cfg</code></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line">	# The number of milliseconds of each tick</span><br><span class="line">initLimit=10</span><br><span class="line">	# The number of ticks that the initial</span><br><span class="line">	# synchronization phase can take</span><br><span class="line">syncLimit=5</span><br><span class="line">	# The number of ticks that can pass between</span><br><span class="line">	# sending a request and getting an acknowledgement</span><br><span class="line">dataDir=/tmp/zookeeper/zkdata</span><br><span class="line">dataLogDir=/tmp/zookeeper/zkdatalog</span><br><span class="line">	# the directory where the snapshot is stored.</span><br><span class="line">	# do not use /tmp for storage, /tmp here is just</span><br><span class="line">	# example sakes.</span><br><span class="line">clientPort=2181</span><br><span class="line">	# the port at which the clients will connect</span><br><span class="line"></span><br><span class="line">autopurge.snapRetainCount=3</span><br><span class="line">	# Be sure to read the maintenance section of the</span><br><span class="line">	# administrator guide before turning on autopurge.</span><br><span class="line">	# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span><br><span class="line">	# The number of snapshots to retain in dataDir</span><br><span class="line">autopurge.purgeInterval=1</span><br><span class="line">	# Purge task interval in hours</span><br><span class="line">	# Set to &quot;0&quot; to disable auto purge feature</span><br><span class="line"></span><br><span class="line">server.0=hd-master:2888:3888</span><br><span class="line">server.1=hd-slave1:2888:3888</span><br><span class="line">server.2=hd-slave2:2888:3888</span><br><span class="line">	# Determine the zookeeper servers</span><br><span class="line">	# fromation: server.NO=HOST:PORT1:PORT2</span><br><span class="line">		# PORT1: port used to communicate with leader</span><br><span class="line">		# PORT2: port used to reelect leader when current leader fail</span><br></pre></td></tr></table></figure>
<h5 id="dataDir-myid"><a href="#dataDir-myid" class="headerlink" title="$dataDir/myid"></a><code>$dataDir/myid</code></h5><ul>
<li><code>$dataDir</code>是<code>conf/zoo.cfg</code>中指定目录</li>
<li><code>myid</code>文件里就一个id，指明当前zookeeper server的id，服务
启动时读取文件确定其id，需要自行创建</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0</span><br></pre></td></tr></table></figure>
<h4 id="启动、测试、清理"><a href="#启动、测试、清理" class="headerlink" title="启动、测试、清理"></a>启动、测试、清理</h4><p>启动zookeeper</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> zkServer.sh start</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 开启zookeeper服务</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> zookeeper服务要在各个节点分别手动启动</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> zkServer.sh status</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 查看服务状态</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> zkCleanup.sh</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 清理旧的快照、日志文件</span></span><br></pre></td></tr></table></figure>
<h2 id="Flume"><a href="#Flume" class="headerlink" title="Flume"></a>Flume</h2><h3 id="依赖-6"><a href="#依赖-6" class="headerlink" title="依赖"></a>依赖</h3><ul>
<li>java</li>
</ul>
<h3 id="机器环境配置-4"><a href="#机器环境配置-4" class="headerlink" title="机器环境配置"></a>机器环境配置</h3><h4 id="bashrc-6"><a href="#bashrc-6" class="headerlink" title="~/.bashrc"></a><code>~/.bashrc</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:/opt/flume/bin</span><br></pre></td></tr></table></figure>
<h3 id="Flume配置"><a href="#Flume配置" class="headerlink" title="Flume配置"></a>Flume配置</h3><h4 id="环境设置文件-3"><a href="#环境设置文件-3" class="headerlink" title="环境设置文件"></a>环境设置文件</h4><h5 id="conf-flume-env-sh"><a href="#conf-flume-env-sh" class="headerlink" title="conf/flume-env.sh"></a><code>conf/flume-env.sh</code></h5><ul>
<li>模板：<code>conf/flume-env.sh.template</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/opt/jdk</span><br></pre></td></tr></table></figure>
<h4 id="Conf文件"><a href="#Conf文件" class="headerlink" title="Conf文件"></a>Conf文件</h4><h5 id="conf-flume-conf"><a href="#conf-flume-conf" class="headerlink" title="conf/flume.conf"></a><code>conf/flume.conf</code></h5><ul>
<li>模板：<code>conf/flume-conf.properties.template</code></li>
</ul>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">agent1.channels.ch1.type=memory</span><br><span class="line"><span class="code">	# define a memory channel called `ch1` on `agent1`</span></span><br><span class="line"><span class="code">agent1.sources.avro-source1.channels=ch1</span></span><br><span class="line"><span class="code">agent1.sources.avro-source1.type=avro</span></span><br><span class="line"><span class="code">agent1.sources.avro-source1.bind=0.0.0.0</span></span><br><span class="line"><span class="code">agent1.sources.avro-source1.prot=41414</span></span><br><span class="line"><span class="code">	# define an Avro source called `avro-source1` on `agent1` and tell it</span></span><br><span class="line"><span class="code">agent1.sink.log-sink1.channels=ch1</span></span><br><span class="line"><span class="code">agent1.sink.log-sink1.type=logger</span></span><br><span class="line"><span class="code">	# define a logger sink that simply logs all events it receives</span></span><br><span class="line"><span class="code">agent1.channels=ch1</span></span><br><span class="line"><span class="code">agent1.sources=avro-source1</span></span><br><span class="line"><span class="code">agent1.sinks=log-sink1</span></span><br><span class="line"><span class="code">	# Finally, all components have been defined, tell `agent1` which one to activate</span></span><br></pre></td></tr></table></figure>
<h4 id="启动、测试"><a href="#启动、测试" class="headerlink" title="启动、测试"></a>启动、测试</h4><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ flume-ng agent --conf /opt/flume/conf \</span><br><span class="line"><span class="code">	-f /conf/flume.conf \</span></span><br><span class="line"><span class="code">	-D flume.root.logger=DEBUG,console \</span></span><br><span class="line"><span class="code">	-n agent1</span></span><br><span class="line"><span class="code">	# the agent name specified by -n agent1` must match an agent name in `-f /conf/flume.conf`</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">$ flume-ng avro-client --conf /opt/flume/conf \</span><br><span class="line"><span class="code">	-H localhost -p 41414 \</span></span><br><span class="line"><span class="code">	-F /opt/hive-test.txt \</span></span><br><span class="line"><span class="code">	-D flume.root.logger=DEBUG, Console</span></span><br><span class="line"><span class="code">	# 测试flume</span></span><br></pre></td></tr></table></figure>
<h3 id="其他-4"><a href="#其他-4" class="headerlink" title="其他"></a>其他</h3><h2 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h2><h3 id="依赖-7"><a href="#依赖-7" class="headerlink" title="依赖"></a>依赖</h3><ul>
<li>java</li>
<li>zookeeper</li>
</ul>
<h3 id="机器环境变量"><a href="#机器环境变量" class="headerlink" title="机器环境变量"></a>机器环境变量</h3><h4 id="bashrc-7"><a href="#bashrc-7" class="headerlink" title="~/.bashrc"></a><code>~/.bashrc</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:/opt/kafka/bin</span><br><span class="line">export KAFKA_HOME=/opt/kafka</span><br></pre></td></tr></table></figure>
<h3 id="多brokers配置"><a href="#多brokers配置" class="headerlink" title="多brokers配置"></a>多brokers配置</h3><h4 id="Conf-1"><a href="#Conf-1" class="headerlink" title="Conf"></a>Conf</h4><h5 id="config-server-1-properties"><a href="#config-server-1-properties" class="headerlink" title="config/server-1.properties"></a><code>config/server-1.properties</code></h5><ul>
<li>模板：<code>config/server.properties</code></li>
<li>不同节点<code>broker.id</code>不能相同</li>
<li>可以多编写几个配置文件，在不同节点使用不同配置文件启动</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">broker.id=0</span><br><span class="line">listeners=PLAINTEXT://:9093</span><br><span class="line">zookeeper.connect=hd-master:2181, hd-slave1:2181, hd-slave2:2181</span><br></pre></td></tr></table></figure>
<h4 id="测试-4"><a href="#测试-4" class="headerlink" title="测试"></a>测试</h4><ul>
<li>启动zookeeper</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kafka-server-start.sh /opt/kafka/config/server.properties &amp;</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 开启kafka服务（broker）</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 这里是指定使用单个默认配置文件启动broker</span></span><br><span class="line"><span class="meta">		#</span><span class="bash"> 启动多个broker需要分别使用多个配置启动多次</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kafka-server-stop.sh /opt/kafka/config/server.properties</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kafka-topics.sh --create --zookeeper localhost:2181 \</span></span><br><span class="line"><span class="bash">	--replication-factor 1 \</span></span><br><span class="line"><span class="bash">	--partitions 1 \</span></span><br><span class="line"><span class="bash">	--topic test1</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 开启话题</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kafka-topics.sh --list zookeeper localhost:2181</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kafka-topics.shd --delete --zookeeper localhost:2181</span></span><br><span class="line">	--topic test1</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 关闭话题</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kafka-console-producer.sh --broker-list localhost:9092 \</span></span><br><span class="line"><span class="bash">	--topic test1</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 新终端开启producer，可以开始发送消息</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kafka-console-consumer.sh --bootstrap-server localhost:9092 \</span></span><br><span class="line"><span class="bash">	--topic test1 \</span></span><br><span class="line"><span class="bash">	--from-beginning</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kafka-console-consumer.sh --zookeeper localhost:2181 \</span></span><br><span class="line"><span class="bash">	--topic test1 \</span></span><br><span class="line"><span class="bash">	--from beginning</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 新终端开启consumer，可以开始接收信息</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 这个好像是错的</span></span><br></pre></td></tr></table></figure>
<h3 id="其他-5"><a href="#其他-5" class="headerlink" title="其他"></a>其他</h3><h2 id="Storm"><a href="#Storm" class="headerlink" title="Storm"></a>Storm</h2><h3 id="依赖-8"><a href="#依赖-8" class="headerlink" title="依赖"></a>依赖</h3><ul>
<li>java</li>
<li>zookeeper</li>
<li>python2.6+</li>
<li>ZeroMQ、JZMQ</li>
</ul>
<h3 id="机器环境配置-5"><a href="#机器环境配置-5" class="headerlink" title="机器环境配置"></a>机器环境配置</h3><h4 id="bashrc-8"><a href="#bashrc-8" class="headerlink" title="~/.bashrc"></a><code>~/.bashrc</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export STORM_HOME=/opt/storm</span><br><span class="line">export PAT=$PATH:$STORM_HOME/bin</span><br></pre></td></tr></table></figure>
<h3 id="Storm配置"><a href="#Storm配置" class="headerlink" title="Storm配置"></a>Storm配置</h3><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><h5 id="conf-storm-yaml"><a href="#conf-storm-yaml" class="headerlink" title="conf/storm.yaml"></a><code>conf/storm.yaml</code></h5><ul>
<li>模板：<code>conf/storm.yarml</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">storm.zookeeper.servers:</span><br><span class="line">	-hd-master</span><br><span class="line">	-hd-slave1</span><br><span class="line">	-hd-slave2</span><br><span class="line">storm.zookeeper.port: 2181</span><br><span class="line"></span><br><span class="line">nimbus.seeds: [hd-master]</span><br><span class="line">storm.local.dir: /tmp/storm/tmp</span><br><span class="line">nimbus.host: hd-master</span><br><span class="line">supervisor.slots.ports:</span><br><span class="line">	-6700</span><br><span class="line">	-6701</span><br><span class="line">	-6702</span><br><span class="line">	-6703</span><br></pre></td></tr></table></figure>
<h4 id="启动、测试-1"><a href="#启动、测试-1" class="headerlink" title="启动、测试"></a>启动、测试</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">storm nimbus &amp;&gt; /dev/null &amp;</span><br><span class="line">storm logviewer &amp;&gt; /dev/null &amp;</span><br><span class="line">storm ui &amp;&gt; /dev/null &amp;</span><br><span class="line"><span class="meta">	#</span><span class="bash"> master节点启动nimbus</span></span><br><span class="line"></span><br><span class="line">storm sueprvisor &amp;&gt; /dev/null &amp;</span><br><span class="line">storm logviewer &amp;&gt; /dev/nulla &amp;</span><br><span class="line"><span class="meta">	#</span><span class="bash"> worker节点启动</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">storm jar /opt/storm/example/..../storm-start.jar \</span><br><span class="line">	storm.starter.WordCountTopology</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 测试用例</span></span><br><span class="line">stom kill WordCountTopology</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://hadoop.apache.org/docs/r3.1.1">http://hadoop.apache.org/docs/r3.1.1</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:37.000Z" title="3/21/2019, 5:27:37 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-04T08:31:11.000Z" title="8/4/2021, 4:31:11 PM">2021-08-04</time></span><span class="level-item"><a class="link-muted" href="/categories/CS/">CS</a><span> / </span><a class="link-muted" href="/categories/CS/Program-Design/">Program Design</a></span><span class="level-item">2 hours read (About 13993 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/CS/Program-Design/design_pattern.html">设计模式简介</a></h1><div class="content"><p>设计默认（design pattern）</p>
<ul>
<li>软件开发过程中面临的一般问题的解决方案</li>
<li>反复使用的、多数人知晓的、经过分类编目、代码设计经验的
总结</li>
<li>利于重用代码、提高代码可读性、可靠性</li>
</ul>
<p><img src="/imgs/the_relationship_between_design_patterns.png" alt="the_relationship_between_design_patterns"></p>
<h2 id="设计模式原则"><a href="#设计模式原则" class="headerlink" title="设计模式原则"></a>设计模式原则</h2><p>设计模式主要基于以下面向对象设计原则</p>
<ul>
<li>对接口编程而不是对实现编程</li>
<li>优先使用对象组合而不是继承</li>
</ul>
<p>六大原则</p>
<ul>
<li><p>开闭原则（open close principle）</p>
<ul>
<li>对扩展开放、修改关闭。</li>
<li>程序需要扩展时，不能修改原有代码以实现热拔插效果，
易于扩展和升级</li>
</ul>
</li>
<li><p>里氏代换原则（Liskov Substitution Principle）</p>
<ul>
<li>任何基类可以出现的地方，子类一定可以出现</li>
<li>此为继承复用的基石，只有派生类了可以替换掉基类，且
软件功能不受到影响，基类才能真正被复用</li>
<li>对开闭原则的补充，实现开闭原则的关键步骤就是
抽象化，基类与子类的继承关系就是抽象化的具体实现，
LSP就是对实现抽象化的具体步骤的规范</li>
</ul>
</li>
<li><p>依赖倒转原则（Dependence Inversion Principle）</p>
<ul>
<li>针对接口编程，以来抽象而不是具体</li>
<li>开闭原则的基础</li>
</ul>
</li>
<li><p>接口隔离原则（Interface Segregation Principle)</p>
<ul>
<li>使用多个隔离的接口优于单个接口</li>
<li>降低类之间的耦合度</li>
</ul>
</li>
<li><p>迪特米法则（最小知道原则，Demeter Principle）</p>
<ul>
<li>一个尸体应尽量少与其他实体发生相互作用</li>
<li>使得系统功能模块相对独立</li>
</ul>
</li>
<li><p>合成复用原则（Composite Reuse Principle）</p>
<ul>
<li>尽量使用合成、聚合方式，而不是继承</li>
</ul>
</li>
</ul>
<h2 id="创建型模式"><a href="#创建型模式" class="headerlink" title="创建型模式"></a>创建型模式</h2><p>在创建对象的同时隐藏创建逻辑的方式，而不是直接使用<code>new</code>
运算符直接实例化对象，这使得程序在判断针对某个给定实例需要
创建哪些对象时更加灵活</p>
<h3 id="工厂模式-Factory-Pattern"><a href="#工厂模式-Factory-Pattern" class="headerlink" title="工厂模式 Factory Pattern"></a>工厂模式 Factory Pattern</h3><p>创建对象时不会对客户端暴露创建逻辑，而是通过共同的接口指向
新创建的对象</p>
<ul>
<li>意图：定义创建对象的接口，让其子类决定实例化何种工厂类，
工厂模式使其创建过程延迟到子类进行</li>
<li>解决问题：接口选择问题</li>
<li>使用场景：明确地计划不同条件下创建不同实例时</li>
<li>解决方案：子类实现工厂接口，同时返回抽象产品</li>
<li>关键：创建过程在子类中进行</li>
<li>优点<ul>
<li>只需要名称就可以创建对象</li>
<li>扩展性高，需要增加产品，只需要增加工厂类</li>
<li>屏蔽产品具体实现，调用者只关心产品接口</li>
</ul>
</li>
<li>缺点<ul>
<li>每次增加产品，都需要增加具体类和对象实现工厂，系统中
类个数增长快，增加复杂度</li>
<li>增加了系统具体类的依赖</li>
</ul>
</li>
<li>注意<ul>
<li>在任何需要生成复杂对象的地方，都可以使用工厂模式</li>
<li>但简单对象，使用工厂模式需要引入工厂类，增加系统
复杂度</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1: create interface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2: create concrete class implementing interface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&#x27;Inside Rectangle::draw() method.&quot;);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">public class Square implements Shape&#123;</span></span><br><span class="line"><span class="string">	@Override</span></span><br><span class="line"><span class="string">	public void draw()&#123;</span></span><br><span class="line"><span class="string">		System.out.println(&quot;Inside Square::draw() method.&quot;);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">public class Circle implements Shape&#123;</span></span><br><span class="line"><span class="string">	@Override</span></span><br><span class="line"><span class="string">	public void draw()&#123;</span></span><br><span class="line"><span class="string">		System.out.println(&quot;Inside Circle::draw() method.&quot;);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// step3: create factory class generating concrete classes</span></span><br><span class="line"><span class="string">// according to given info</span></span><br><span class="line"><span class="string">public class ShapeFactory&#123;</span></span><br><span class="line"><span class="string">	public Shape getShape(String shapeType)&#123;</span></span><br><span class="line"><span class="string">		if (shapeType == null)&#123;</span></span><br><span class="line"><span class="string">			return null;</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">		if (shapeType.equalsIgnoreCase(&quot;CIRCLE&quot;))&#123;</span></span><br><span class="line"><span class="string">			return new Circle();</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">		if (shapeType.equalsIgnoreCase(&quot;RECTANGLE&quot;))&#123;</span></span><br><span class="line"><span class="string">			return new Rectangle();</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">		if (shapeType.equalsIgnoreCase(&quot;SQUARE&quot;))&#123;</span></span><br><span class="line"><span class="string">			return new Square();</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">		return null;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// usage demo</span></span><br><span class="line"><span class="string">public class FactoryPatternDemo&#123;</span></span><br><span class="line"><span class="string">	public static void main(String[] args)&#123;</span></span><br><span class="line"><span class="string">		ShapeFactory shapeFactory = new ShapeFactory();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		Shape circle = shapeFactory.getShape(&quot;CIRCLE&quot;);</span></span><br><span class="line"><span class="string">		circle.draw();</span></span><br><span class="line"><span class="string">		Shape rectangle = shapeFactory.getShape(&quot;Rectangle&quot;);</span></span><br><span class="line"><span class="string">		rectangle.draw();</span></span><br><span class="line"><span class="string">		Shape square = shapeFactory.getShape(&quot;square&quot;);</span></span><br><span class="line"><span class="string">		square.draw();</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="抽象工厂模式-Abstract-Factory-Pattern"><a href="#抽象工厂模式-Abstract-Factory-Pattern" class="headerlink" title="抽象工厂模式 Abstract Factory Pattern"></a>抽象工厂模式 Abstract Factory Pattern</h3><p>围绕一个超级工厂创建其他工厂，超级工厂又称为其他工厂的工厂，
其中接口是负责创建相关对象的工厂，不需要显式指定他们的类，
每个生成的工厂都能按照工厂模式提供对象</p>
<ul>
<li>意图：提供创建一系列相关或相互依赖对象的接口，且无需指定
其具体类型</li>
<li>解决问题：端口选择问题</li>
<li>使用场景：系统的产品有多个产品族，而系统只需要消费其中
一族的产品</li>
<li>解决方案：在一个产品族中定义多个产品</li>
<li>优点：当一个产品族中多个对象被设计为一起工作时，能够保证
客户端始终只使用同一个产品族中的对象</li>
<li>缺点：产品族扩展困难，需要同时修改具体类、抽象工厂类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1: create interface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Color</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">fill</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2: create concrete class implementing interface</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// shape classes</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Inside Rectangle::draw() method.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Inside Square::draw() method.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Inside Circle::draw() method.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// color classes</span></span><br><span class="line"><span class="keyword">public</span> Red implements Color&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Inside Red::fill() method.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Green implements Color&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Inside Green::fill() method.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Blue implements Color&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Inside Blue::fill() method.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3: create abstract class to get factory classes</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractFactory</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Color <span class="title">getColor</span><span class="params">(String color)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Shape <span class="title">getShape</span><span class="params">(String shape)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4: create factory classes extending abstract factory</span></span><br><span class="line"><span class="comment">// class</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeFactory</span> <span class="keyword">extends</span> <span class="title">AbstractFactory</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Shape <span class="title">getShape</span><span class="params">(String shapeType)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (shapeType == <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (shapeType.equalsIgnoreCase(<span class="string">&quot;CIRCLE&quot;</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Circle();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (shapeType.equalsIgnoreCase(<span class="string">&quot;Rectangle&quot;</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Rectangle();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (shapeType.equalsIgnoreCase(<span class="string">&quot;square&quot;</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Square();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Color <span class="title">getColor</span><span class="params">(String Color)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorFactory</span> <span class="keyword">extends</span> <span class="title">AbstractFactory</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Shape <span class="title">getShape</span><span class="params">(String shapeType)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">getColor</span><span class="params">(String color)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (color == <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (color.equalsIgnoreCase(<span class="string">&quot;RED&quot;</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Red();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (color.equalsIgnoreCase(<span class="string">&quot;Green&quot;</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Green();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (color.equalsIgnoreCase(<span class="string">&quot;blue&quot;</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Blue();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step5: create factory producer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FactoryProducer</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AbstractFactory <span class="title">getFactory</span><span class="params">(String choice)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(choice.equalsIgnoreCase(<span class="string">&quot;SHAPE&quot;</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> ShapeFactory();</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(choice.equalsIgnoreCase(<span class="string">&quot;COLOR&quot;</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> ColorFactory();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step6: demo</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractFactoryPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// use shape cluster only</span></span><br><span class="line">		AbstractFactory shapeFactory = FactoryProducer.getFactory(<span class="string">&quot;SHPAE&quot;</span>);</span><br><span class="line">		Shape circle = shapeFactory.getShape(<span class="string">&quot;CIRCLE&quot;</span>);</span><br><span class="line">		circle.draw();</span><br><span class="line">		Shape rectangle = shapeFactory.getShape(<span class="string">&quot;RECTANGLE&quot;</span>);</span><br><span class="line">		rectangle.draw();</span><br><span class="line">		Shape square = shapeFactory.getShape(<span class="string">&quot;SQUARE&quot;</span>);</span><br><span class="line">		square.draw();</span><br><span class="line"></span><br><span class="line">		<span class="comment">//use color cluster only</span></span><br><span class="line">		AbstractFactory colorFactory = FactoryProducer.getFactory(<span class="string">&quot;color&quot;</span>);</span><br><span class="line">		Color red = colorFactory.getColor(<span class="string">&quot;RED&quot;</span>);</span><br><span class="line">		red.fill();</span><br><span class="line">		Color green = colorFactory.getColor(<span class="string">&quot;green&quot;</span>);</span><br><span class="line">		green.fill();</span><br><span class="line">		Color blue = colorFactory.getColor(<span class="string">&quot;blue&quot;</span>);</span><br><span class="line">		blue.fill();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="单例模式-Singleton-Pattern"><a href="#单例模式-Singleton-Pattern" class="headerlink" title="单例模式 Singleton Pattern"></a>单例模式 Singleton Pattern</h3><p>涉及到一个单一的类，该类负责创建自己的对象，同时确保只有单个
对象被创建，提供一种访问其唯一对象的方式，不需要实例化该类
的对象，可以直接访问</p>
<ul>
<li>意图：保证类只有一个实例，并提供一个访问其的全局访问点</li>
<li>解决问题：一个全局使用的类频繁创建与销毁</li>
<li>使用场景：控制实例数据，节省系统资源</li>
<li>解决方法：判断系统是否已有实例，若有则返回，否则创建</li>
<li>优点<ul>
<li>内存仅有一个实例，减少内存开销</li>
<li>避免对资源的多重占用（如文件读写）</li>
</ul>
</li>
<li>缺点<ul>
<li>没有接口、无法继承，与单一职责冲突</li>
<li>类应该只关心内部逻辑，而不设计外部如何实例化</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1: create singleton class</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleObject</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// create object as soon as class is loaded. It&#x27;s okay</span></span><br><span class="line">	<span class="comment">// to move creating to `getInstance()`</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SingleObject instance = <span class="keyword">new</span> SingleObject();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// private construction method, so this class won&#x27;t be</span></span><br><span class="line">	<span class="comment">// instantiated</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">SingleObject</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleObject <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> instance;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2: test demo</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// private construction method, so `new SingleObject()`</span></span><br><span class="line">		<span class="comment">// is illegal</span></span><br><span class="line">		SingleObject object = SingleObject.getInstance();</span><br><span class="line">		object.showMessage();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="建造者模式-Builder-Pattern"><a href="#建造者模式-Builder-Pattern" class="headerlink" title="建造者模式 Builder Pattern"></a>建造者模式 Builder Pattern</h3><p>使用多个简单对象一步步构建成复杂对象</p>
<ul>
<li>意图：将复杂的构建与其表示相分离，使得同样的构建过程可以
创建不同的表示</li>
<li>解决问题：对于由负责多个子对象组成复杂对象，其各个组成
部分可能随着需求而变化，而构建复杂对象的算法相对稳定</li>
<li>使用场景：基本部件不变，而其组合经常变化</li>
<li>解决方案：将变、不变分开考虑</li>
<li>优点<ul>
<li>建造者独立，容易扩展</li>
<li>便于控制细节风险
缺点</li>
<li>产品必须有共同点，范围有限制</li>
<li>如果内部变化复杂，会有很多建造类</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Item</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Packing <span class="title">packing</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">price</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Packing</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">pack</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wrapper</span> <span class="keyword">implements</span> <span class="title">Packing</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">pack</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Wrapper&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bottle</span> <span class="keyword">implements</span> <span class="title">Packing</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">pack</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Bottle&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> class Burger implements <span class="title">Item</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Packing <span class="title">packing</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Wrapper();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">float</span> <span class="title">price</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ColdDrink</span> <span class="keyword">implements</span> <span class="title">Item</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Packing <span class="title">packing</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Bottle();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">float</span> <span class="title">price</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VegBurger</span> <span class="keyword">extends</span> <span class="title">Buger</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">price</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">25.0f</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Veg Burger&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChickenBurger</span> <span class="keyword">extends</span> <span class="title">Burger</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">price</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">50.5f</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Chicken Burger&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Coke</span> <span class="keyword">extends</span> <span class="title">ColdDrink</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">price</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">30.0f</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Coke&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pepsi</span> <span class="keyword">extends</span> <span class="title">ColdDrink</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">price</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">35.0f</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Pepsi&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step5</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Meal</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Item&gt; items = <span class="keyword">new</span> ArrayList&lt;Item&gt;();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(Item item)</span></span>&#123;</span><br><span class="line">		items.add(item);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getCost</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">float</span> cost = <span class="number">0.0f</span>;</span><br><span class="line">		<span class="keyword">for</span> (Item item: items)&#123;</span><br><span class="line">			cost += item.price();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> cost;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (Item item: items)&#123;</span><br><span class="line">			System.out.print(<span class="string">&quot;Item: &quot;</span> + item.name());</span><br><span class="line">			System.out.print(<span class="string">&quot;, Packing: &quot;</span> + item.packing().pack());</span><br><span class="line">			System.out.println(<span class="string">&quot;, Price: &quot;</span> + item.price());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step6</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MealBuilder</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Meal <span class="title">prepareVegMeal</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Meal meal = <span class="keyword">new</span> Meal();</span><br><span class="line">		meal.addItem(<span class="keyword">new</span> VegBurger());</span><br><span class="line">		meal.addItem(<span class="keyword">new</span> Coke());</span><br><span class="line">		<span class="keyword">return</span> meal;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Meal <span class="title">parpareNonVegMeal</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Meal meal = <span class="keyword">new</span> Meal();</span><br><span class="line">		meal.addItem(<span class="keyword">new</span> ChickenBuger());</span><br><span class="line">		meal.addItem(<span class="keyword">new</span> Pepsi());</span><br><span class="line">		<span class="keyword">return</span> meal;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step7</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuilderPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		MealBuilder mealBuilder = <span class="keyword">new</span> MealBuilder();</span><br><span class="line"></span><br><span class="line">		Meal vegMeal = mealBuilder.prepareVegMeal();</span><br><span class="line">		System.out.println(<span class="string">&quot;Veg Meal&quot;</span>);</span><br><span class="line">		vegMeal.showItems();</span><br><span class="line">		System.out.println(<span class="string">&quot;Total Cost: &quot;</span> + vegMeal.getCost());</span><br><span class="line"></span><br><span class="line">		Meal.nonVegMeal = mealBuilder.prepareNonVegMeal();</span><br><span class="line">		System.out.println(<span class="string">&quot;\n\nNon-Veg Meal&quot;</span>);</span><br><span class="line">		nonVegMeal.showItems();</span><br><span class="line">		System.out.println(<span class="string">&quot;Total Cost: &quot;</span> + nonVegMeal.getCost());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="原型模式-Prototype-Pattern"><a href="#原型模式-Prototype-Pattern" class="headerlink" title="原型模式 Prototype Pattern"></a>原型模式 Prototype Pattern</h3><p>实现一个原型接口，用于创建重复对象，同时又能保证性能</p>
<ul>
<li>意图：用原型实例指定创建对象的种类，并通过拷贝这些原型
创建新的对象</li>
<li>解决问题：在运行时建立和删除原型</li>
<li>使用场景<ul>
<li>类的初始化代价大</li>
<li>系统应该独立其产品的创建、构成、表示</li>
<li>要实例化的类是在运行时指定</li>
<li>避免创建与产品类层次平行的工厂类</li>
<li>类的实例只能有几个不同的状态组合中的一种时，建立相应
数目的原型并克隆可能比每次用合适的状态手工实例化更
方便</li>
<li>实际上原型模式很少单独出现，一般和工厂模式一起出现，
通过clone方法创建对象返回给调用者</li>
</ul>
</li>
<li>优点<ul>
<li>性能提高，尤其是直接创建对象代价比较大
（如对象需要在高代价的数据库操作后被创建）</li>
<li>逃避构造函数的约束</li>
</ul>
</li>
<li>缺点<ul>
<li>配备克隆方法需要对类的功能全盘考虑，对已有类可能比较
难，尤其是类引用不支持串行化的间接对象</li>
</ul>
</li>
<li>注意：原型模式时通过拷贝现有对象生成新对象，要主要区分
浅拷贝和深拷贝</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1: create an abstract class implementing Cloneable</span></span><br><span class="line"><span class="comment">// interface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> <span class="keyword">implements</span> <span class="title">Cloneable</span></span>&#123;</span><br><span class="line">	<span class="comment">// Java中已经同原型模式融为一体</span></span><br><span class="line">	<span class="comment">// 实现`Cloneable`接口实现浅拷贝，深拷贝则是通过实现</span></span><br><span class="line">	<span class="comment">// `Serializable`读取二进制流</span></span><br><span class="line">	<span class="keyword">private</span> String id;</span><br><span class="line">	<span class="keyword">protected</span> String type;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> type;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Object clone = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			clone = <span class="keyword">super</span>.clone();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (CloneNotSupportedException e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> clone;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2: create a concrete class extending the abstract</span></span><br><span class="line"><span class="comment">// class</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Rectangle</span><span class="params">()</span></span>&#123;</span><br><span class="line">		tpye = <span class="string">&quot;Rectangle&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Inside Rectangle::draw() method.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">SHape</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Square</span><span class="params">()</span></span>&#123;</span><br><span class="line">		type = <span class="string">&quot;Sqaure&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Inside Square::draw() method.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Circle</span><span class="params">()</span></span>&#123;</span><br><span class="line">		type = <span class="string">&quot;Circle&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Inside Circle::draw() method.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3: creat a class to store the implements</span></span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeCache</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Hashtable&lt;String, Shape&gt; shapeMap</span><br><span class="line">		= <span class="keyword">new</span> Hashtable&lt;String, Shape&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Shape <span class="title">getShape</span><span class="params">(String shapeId)</span></span>&#123;</span><br><span class="line">		Shape cachedShape = shapeMap.get(shapeId);</span><br><span class="line">		<span class="keyword">return</span> (Shape)cachedShape.clone();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadCache</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Circle circle = <span class="keyword">new</span> Circle();</span><br><span class="line">		circle.setId(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">		shapeMap.put(circle.getId(), circle);</span><br><span class="line"></span><br><span class="line">		Square square = <span class="keyword">new</span> Square();</span><br><span class="line">		square.setId(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">		shapeMap.put(square.getId(), square);</span><br><span class="line"></span><br><span class="line">		Rectangle rectangle = <span class="keyword">new</span> Rectangle();</span><br><span class="line">		rectangle.setId(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">		shapeMap.put(rectangle.getId(), rectangle);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4: test demo</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrototypePatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		ShapeCache.loadCache();</span><br><span class="line"></span><br><span class="line">		Shape clonedShape = (Shape)ShapeCache.getShape(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;shape: &quot;</span> + clonedShape.getType());</span><br><span class="line">		Shape clonedShape2 = (Shape)ShapeCache.getShape(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;shape: &quot;</span> + clonedShape2.getType());</span><br><span class="line">		Shape clonedShape3 = (Shape)ShapeCache.getShape(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;shape: &quot;</span> + clonedShape3.getType());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="结构型模式"><a href="#结构型模式" class="headerlink" title="结构型模式"></a>结构型模式</h2><p>关注类和对象的；组合，继承的概念被用来组合接口和定义组合对象
获得新功能的方式</p>
<h3 id="适配器模式-Adaptor-Pattern"><a href="#适配器模式-Adaptor-Pattern" class="headerlink" title="适配器模式 Adaptor Pattern"></a>适配器模式 Adaptor Pattern</h3><p>不兼容的接口之间的桥梁，负责加入独立的或不兼容的接口功能</p>
<ul>
<li>意图：将一个类的接口转换为客户希望的另一个接口，使得原本
由于接口不兼容的类可以一起工作</li>
<li>解决问题：“现存对象”无法满足新环境要求</li>
<li>使用场景<ul>
<li>系统需要使用现有类，现有类不符合系统需要</li>
<li>想要建立可以重复使用的类，用于与一次彼此之间没有太大
关联的类（包括可能未来引进的类）</li>
<li>通过接口转换将一个类插入另一个类</li>
</ul>
</li>
<li>解决方法：继承或以来</li>
<li>优点<ul>
<li>可以让任何两个没有关联的类一起运行</li>
<li>提高类类的复用</li>
<li>增加了类的透明度</li>
<li>灵活性好</li>
</ul>
</li>
<li>缺点<ul>
<li>过多的使用适配器可能会导致系统凌乱，不易把握整体</li>
<li>对于单继承语言，至多只能适配一个适配器类</li>
</ul>
</li>
<li>注意事项：适配器模式用于解决正在服役的项目问题，而不是
详细设计时</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1: create interfaces</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MediaPlayer</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(String audioType, String fileName)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AdvancedMediaPlayer</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playVlc</span><span class="params">(String fileName)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playMp4</span><span class="params">(String fileName)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2:</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VlcPlayer</span> <span class="keyword">implements</span> <span class="title">AdvancedMediaPlayer</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playVlc</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Playing vlc file. Name: &quot;</span> + fileName);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playMp4</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mp4Player</span> <span class="keyword">implements</span> <span class="title">AdvancedMediaPlayer</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playVlc</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playMp4</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Playing mp4 file. Name: &quot;</span> + fileName);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3: create adapter class</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MediaAdapter</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span></span>&#123;</span><br><span class="line">	AdvancedMediaPlayer advancedMusicPlayer;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// construction method</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MediaAdapter</span><span class="params">(String audioType)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(audioType.equalsIgnoreCase(<span class="string">&quot;vlc&quot;</span>))&#123;</span><br><span class="line">			advancedMusicPlayer = <span class="keyword">new</span> VlcPlayer();</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (audioType.equalsIgnoreCase(<span class="string">&quot;mp4&quot;</span>))&#123;</span><br><span class="line">			advancedMusicPlayer = <span class="keyword">new</span> Mp4Player();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(String audioType, String fileName)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(audioType.equalsIgnoreCase(<span class="string">&quot;vlc&quot;</span>))&#123;</span><br><span class="line">			advancedMusicPlayer.playVlc(fileName);</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(audioType.equalsIgnoreCase(<span class="string">&quot;mp4&quot;</span>))&#123;</span><br><span class="line">			advancedMusciPlayer.playMp4(fileName);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4:</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudioPlayer</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span></span>&#123;</span><br><span class="line">	MediaPlayer mediaAdapter;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(String audioType, String fileName)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(audioType.equalsIgnoreCase(<span class="string">&quot;mp3&quot;</span>))&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Playing mp3 file. Name: &quot;</span> + fileName);</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(audioType.equalsIgnoreCase(<span class="string">&quot;vlc&quot;</span>) ||</span><br><span class="line">			audioType.equalsIgnoreCase(<span class="string">&quot;mp4&quot;</span>))&#123;</span><br><span class="line">			mediaAdapter = <span class="keyword">new</span> MediaAdatper(audioType);</span><br><span class="line">			mediaAdapter.play(audioType, fileName);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Invalid media. &quot;</span> +</span><br><span class="line">				audioType + <span class="string">&quot; format not supported.&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step5: test demo</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdapterPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		AudioPlayer audioPlayer = <span class="keyword">new</span> AudioPlayer();</span><br><span class="line">		audioPlayer.play(<span class="string">&quot;mp3&quot;</span>, <span class="string">&quot;beyond the horizon.mp3&quot;</span>);</span><br><span class="line">		audioPlayer.play(<span class="string">&quot;mp4&quot;</span>, <span class="string">&quot;alone.mp4&quot;</span>);</span><br><span class="line">		audioPlayer.play(<span class="string">&quot;vlc&quot;</span>, <span class="string">&quot;far far away.vlc&quot;</span>);</span><br><span class="line">		audioPlayer.play(<span class="string">&quot;avi&quot;</span>, <span class="string">&quot;mind me.avi&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="桥接模式-Bridge-Pattern"><a href="#桥接模式-Bridge-Pattern" class="headerlink" title="桥接模式 Bridge Pattern"></a>桥接模式 Bridge Pattern</h3><p>把抽象化与现实化解耦，使得二者可以独立变化，涉及一个作为桥接
的接口，使得实体类的功能能独立与接口实现类</p>
<ul>
<li>意图：将抽象部分与实现部分分离，使得其可以独立变化</li>
<li>解决问题：在有多种可能会变化的情况下，用继承会造成类爆炸
问题，扩展起来不灵活</li>
<li>使用场景：实现系统可能有多个角度分类，每种角度都可能变化</li>
<li>解决方法：把多角度分类分离出来，让其独立变化，减少其间
耦合</li>
<li>优点<ul>
<li>抽象和实现的分离</li>
<li>优秀的扩展能力</li>
<li>实现细节对客户透明</li>
</ul>
</li>
<li>缺点：照成系统的理解与设计难度，由于聚合关联关系建立在
抽象层，要求开发者针对抽象进行设计、编程</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DrawAPI</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawCircle</span><span class="params">(<span class="keyword">int</span> radius, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RecCircle</span> <span class="keyword">implements</span> <span class="title">DrawAPI</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawCircle</span><span class="params">(<span class="keyword">int</span> radius, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Drawing Circle[color: red, radius: &quot;</span></span><br><span class="line">			+ radius + <span class="string">&quot;, x: &quot;</span> + x +<span class="string">&quot;, y: &quot;</span> + y + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreenCircle</span> <span class="keyword">implements</span> <span class="title">DrawAPI</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawCircle</span><span class="params">(<span class="keyword">int</span> radius, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Drawing Circle[color: Green, radius: &quot;</span></span><br><span class="line">			+ radius + <span class="string">&quot;, x: &quot;</span> + x +<span class="string">&quot;, y: &quot;</span> + y + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> DrawAPI drawAPI;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="title">Shape</span><span class="params">(DrawAPI drawAPI)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.drawAPI = drawAPI;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> x, y, radius;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Circle</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> radius, DrawAPI drawAPI)</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(drawAPI);</span><br><span class="line">		<span class="keyword">this</span>.x = x;</span><br><span class="line">		<span class="keyword">this</span>.y = y;</span><br><span class="line">		<span class="keyword">this</span>.radius = radius;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		drawAPI.drawCircle(radius, x, y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step5: test demo</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BridgePatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Shape redCircle = <span class="keyword">new</span> Circle(<span class="number">100</span>, <span class="number">100</span>, <span class="number">10</span>, <span class="keyword">new</span> RedCircle());</span><br><span class="line">		Shape greenCircle = <span class="keyword">new</span> Circle(<span class="number">100</span>, <span class="number">100</span>, <span class="number">10</span>, <span class="keyword">new</span> GreenCircle());</span><br><span class="line">		redCircle.draw();</span><br><span class="line">		greenCircle.draw();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="过滤器（标准）模式-Filter、Criteria-Pattern"><a href="#过滤器（标准）模式-Filter、Criteria-Pattern" class="headerlink" title="过滤器（标准）模式 Filter、Criteria Pattern"></a>过滤器（标准）模式 Filter、Criteria Pattern</h3><p>使用多种不同的标准过滤一组对象，通过逻辑运算以解耦的方式将其
连接起来，结合多个标准或者单一标准</p>
<ul>
<li>意图：</li>
<li>解决问题：</li>
<li>适用场景：</li>
<li>解决方法：</li>
<li>优点</li>
<li>缺点</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1: create a class which will be impose criteria on</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line">	pirvate String maritalStatus;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, String gender, String maritalStatus)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.gender = gender;</span><br><span class="line">		<span class="keyword">this</span>.maritalStatus = maritalStatus;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> gender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getMaritalStatus</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> maritalStatus;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2: create an interface for criteria</span></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Criteria</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Person&gt; <span class="title">meetCriteria</span><span class="params">(List&lt;Person&gt; persons)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3: creat </span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CriteriaMale</span> <span class="keyword">implements</span> <span class="title">Criteria</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Person&gt; <span class="title">meetCriteria</span><span class="params">(List&lt;Person&gt; persons)</span></span>&#123;</span><br><span class="line">		List&lt;Person&gt; malePersons = <span class="keyword">new</span> ArrayList&lt;Peron&gt;();</span><br><span class="line">		<span class="keyword">for</span>(Person person : persons)&#123;</span><br><span class="line">			<span class="keyword">if</span>(person.getGender().equalsIgnoreCase(<span class="string">&quot;MALE&quot;</span>)&#123;</span><br><span class="line">				malePersons.add(Person);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> malePersons;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CriteriaFemale</span> <span class="keyword">implements</span> <span class="title">Criteria</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Person&gt; <span class="title">meetCriteria</span><span class="params">(List&lt;Person&gt; persons)</span></span>&#123;</span><br><span class="line">		List&lt;Person&gt; femalePerson = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line">		<span class="keyword">for</span>(Person person: persons)&#123;</span><br><span class="line">			<span class="keyword">if</span>(person.getGender.equalsIgnoreCase(<span class="string">&quot;Female&quot;</span>)&#123;</span><br><span class="line">				femalePersons.add(person);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> femalePersons;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CriteriaSingle</span> <span class="keyword">implements</span> <span class="title">Criteria</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Person&gt; <span class="title">meetCriteria</span><span class="params">(List&lt;Person&gt; persons)</span></span>&#123;</span><br><span class="line">		List&lt;Person&gt; singlePersons = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line">		<span class="keyword">for</span>(Person person: persons)&#123;</span><br><span class="line">			<span class="keyword">if</span>(person.getMaritalStatus().equalsIgnoreCase(<span class="string">&quot;Single&quot;</span>))&#123;</span><br><span class="line">				singlePerson.add(person);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> singlePersons;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AndCriteria</span> <span class="keyword">implements</span> <span class="title">Criteria</span></span>&#123;</span><br><span class="line">	pirvate Criteria criteria;</span><br><span class="line">	<span class="keyword">private</span> Criteria otherCriteria;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AndCriteria</span><span class="params">(Criteria criteria, Criteria otherCriteria)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.criteria = criteria;</span><br><span class="line">		<span class="keyword">this</span>.otherCriteria = otherCriteria;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Person&gt; <span class="title">meetCriteria</span><span class="params">(List&lt;Person&gt; persons)</span></span>&#123;</span><br><span class="line">		List&lt;Person&gt; firstCriteriaPersons = criteria.meetCriteria(persons);</span><br><span class="line">		<span class="keyword">return</span> otherCriteria.meetCriteria(firstCriteriaPersons);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrCriteria</span> <span class="keyword">implements</span> <span class="title">Criteria</span></span>&#123;</span><br><span class="line">	pirvate Criteria criteria;</span><br><span class="line">	<span class="keyword">private</span> Criteria otherCriteria;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Criteria</span><span class="params">(Criteria criteria, Criteria otherCriteria)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.criteria = criteria;</span><br><span class="line">		<span class="keyword">this</span>.otherCriteria = otherCriteria;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Person&gt; <span class="title">meetCriteria</span><span class="params">(List&lt;Person&gt; persons)</span></span>&#123;</span><br><span class="line">		List&lt;Person&gt; firstCriteriaItems = criteria.meetCriteria(persons);</span><br><span class="line">		List&lt;Person&gt; otherCriteriaItems = criteria.meetCriteria(persons);</span><br><span class="line">		<span class="keyword">for</span>(Person person: otherCriteriaItems)&#123;</span><br><span class="line">			<span class="keyword">if</span>(!firstCriteriaItems.contains(person))&#123;</span><br><span class="line">				firstCriteriaItems.add(person);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> firstCriteriaItems;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4: test demo</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CriteriaPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		List&lt;Person&gt; persons = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line"></span><br><span class="line">		persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;Robert&quot;</span>,<span class="string">&quot;Male&quot;</span>, <span class="string">&quot;Single&quot;</span>));</span><br><span class="line">		persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;John&quot;</span>,<span class="string">&quot;Male&quot;</span>, <span class="string">&quot;Married&quot;</span>));</span><br><span class="line">		persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;Laura&quot;</span>,<span class="string">&quot;Female&quot;</span>, <span class="string">&quot;Married&quot;</span>));</span><br><span class="line">		persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;Diana&quot;</span>,<span class="string">&quot;Female&quot;</span>, <span class="string">&quot;Single&quot;</span>));</span><br><span class="line">		persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;Mike&quot;</span>,<span class="string">&quot;Male&quot;</span>, <span class="string">&quot;Single&quot;</span>));</span><br><span class="line">		persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;Bobby&quot;</span>,<span class="string">&quot;Male&quot;</span>, <span class="string">&quot;Single&quot;</span>));</span><br><span class="line"></span><br><span class="line">		Criteria male = <span class="keyword">new</span> CriteriaMale();</span><br><span class="line">		Criteria female = <span class="keyword">new</span> CriteriaFemale();</span><br><span class="line">		Criteria single = <span class="keyword">new</span> CriteriaSingle();</span><br><span class="line">		Criteria singleMale = <span class="keyword">new</span> AndCriteria(single, male);</span><br><span class="line">		Criteria singleOrFemale = <span class="keyword">new</span> OrCriteria(single, female);</span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">&quot;Males: &quot;</span>);</span><br><span class="line">		printPersons(male.meetCriteria(persons));</span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">&quot;\nFemales: &quot;</span>);</span><br><span class="line">		printPersons(female.meetCriteria(persons));</span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">&quot;\nSingle Males: &quot;</span>);</span><br><span class="line">		printPersons(singleMale.meetCriteria(persons));</span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">&quot;\nSingle Or Females: &quot;</span>);</span><br><span class="line">		printPersons(singleOrFemale.meetCriteria(persons));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printPersons</span><span class="params">(List&lt;Person&gt; persons)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (Person person : persons) &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Person : [ Name : &quot;</span> + person.getName() </span><br><span class="line">				+<span class="string">&quot;, Gender : &quot;</span> + person.getGender() </span><br><span class="line">				+<span class="string">&quot;, Marital Status : &quot;</span> + person.getMaritalStatus()</span><br><span class="line">				+<span class="string">&quot; ]&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="组合模式-Composite-Pattern"><a href="#组合模式-Composite-Pattern" class="headerlink" title="组合模式 Composite Pattern"></a>组合模式 Composite Pattern</h3><p>把一组相似的对象当作一个单一的对象，依据树形结构来组合对象，
用来表示部分和整体层次，亦称部分整体模式</p>
<ul>
<li>意图：将对象组合成树形结构以表示“部分-整体”层次结构，
使得用户对单个对象和组合对象的使用具有一致性</li>
<li>解决问题：模糊树形结构问题中简单元素和复杂元素的概念，
客户程序可以像处理简单元素一样处理复杂元素，使得客户程序
与复杂元素的内部结构解耦</li>
<li>使用场景<ul>
<li>表示对象的“部分-整体”层次结构（树形结构）</li>
<li>希望用户忽略组合对象与单个对象的不同，统一地使用组合
结构中所有对象</li>
</ul>
</li>
<li>解决方法：树枝和叶子实现统一接口，树枝内部组合该接口</li>
<li>优点<ul>
<li>高层模块调用简单</li>
<li>节点自由度增加</li>
</ul>
</li>
<li>缺点：叶子和树枝的声明都是实现类，而不是接口，违反了依赖
倒置原则</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1: create a class containing a list of Self</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span>&#123;</span><br><span class="line">	pirvate String name;</span><br><span class="line">	pirvate String dept;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> salary<span class="string">&#x27;</span></span><br><span class="line"><span class="string">	private List&lt;Employee&gt; subordinates;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	public Employee(String name, String dept, int sal)&#123;</span></span><br><span class="line"><span class="string">		this.name = name;</span></span><br><span class="line"><span class="string">		this.dept = dept;</span></span><br><span class="line"><span class="string">		this.salary = sal;</span></span><br><span class="line"><span class="string">		subordinates = new ArrayList&lt;Employee&gt;();</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	public void add(Employee e)&#123;</span></span><br><span class="line"><span class="string">		subordinates.add(e);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	public void remove(Employee e)&#123;</span></span><br><span class="line"><span class="string">		subordinates.remove(e);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	public List&lt;Employee&gt; getSubordinates()&#123;</span></span><br><span class="line"><span class="string">		return subordinates;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	public String toString()&#123;</span></span><br><span class="line"><span class="string">		return (&quot;Employee: [Name: &quot; + name + &quot;, dept: &quot;</span></span><br><span class="line"><span class="string">			+  dept + &quot;, salary: &quot; + salary + &quot;]&quot;);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// step2: test demo</span></span><br><span class="line"><span class="string">public class CompositePatternDemo&#123;</span></span><br><span class="line"><span class="string">	public static void main(String[] args)&#123;</span></span><br><span class="line"><span class="string">		Employee CEO = new Employee(&quot;John&quot;, &quot;CEO&quot;, 30000);</span></span><br><span class="line"><span class="string">		Employee headSales = new Employee(&quot;Robert&quot;, &quot;Head Sales&quot;, 20000);</span></span><br><span class="line"><span class="string">		Employee headMarketing = new Employee(&quot;Michel&quot;, &quot;Head Marketing&quot;, 20000);</span></span><br><span class="line"><span class="string">		Employee clerk1 = new Employee(&quot;Laura&quot;, &quot;Marketing&quot;, 10000);</span></span><br><span class="line"><span class="string">		Employee clerk2 = new Employee(&quot;Bob&quot;, &quot;Marketing&quot;, 10000);</span></span><br><span class="line"><span class="string">		Employee saleExecutive1 = new Employee(&quot;Richard&quot;, &quot;Sales&quot;, 10000);</span></span><br><span class="line"><span class="string">		Employee saleExecutive2 = new Employee(&quot;Rob&quot;, &quot;Sales&quot;, 10000);</span></span><br><span class="line"><span class="string">		CEO.add(headSales);</span></span><br><span class="line"><span class="string">		CEO.add(headMarketing);</span></span><br><span class="line"><span class="string">		headSales.add(saleExecutive1)</span></span><br><span class="line"><span class="string">		headSales.add(saleExecutive2);</span></span><br><span class="line"><span class="string">		headMarketing.add(clerk1);</span></span><br><span class="line"><span class="string">		headMarketing.add(clerk2);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		System.out.println(CEO);</span></span><br><span class="line"><span class="string">		for(Employee  headEmployee: CEO.getSubordinates())&#123;</span></span><br><span class="line"><span class="string">			System.out.println(headEmployee);</span></span><br><span class="line"><span class="string">			for(Employee employee: headEmployee.getSubordinates())&#123;</span></span><br><span class="line"><span class="string">				System.out.println(employee);</span></span><br><span class="line"><span class="string">			&#125;</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>组合模式：在对象中包含其他对象，就是树，类似于叶子节点等等</p>
<h3 id="装饰器模式-Decorator-Pattern"><a href="#装饰器模式-Decorator-Pattern" class="headerlink" title="装饰器模式 Decorator Pattern"></a>装饰器模式 Decorator Pattern</h3><p>创建一个新类用于包装原始类，向其添加新功能，同时不改变其结构</p>
<ul>
<li>意图：动态的给对象添加额外的职责，比生成子类更灵活</li>
<li>解决问题：为扩展类而使用继承的方式，会为类引入静态特征，
随着扩展功能的增多，子类会膨胀</li>
<li>使用场景：不增加很多子类的情况下扩展类</li>
<li>解决方法：将具体功能职责划分，同时继承装饰者模式</li>
<li>优点：装饰类和被装饰类可以独立发展，不会相互耦合，替代
继承从而动态的扩展实现类的功能</li>
<li>缺点：多层装饰复杂</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Shape: Rectangle&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Shape: Cirlce&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeDecorator</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> Shape decoratedShape;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ShapeDecorator</span><span class="params">(Shape decoratedShape)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.decoratedShape = decoratedShape;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		decoratedShape.draw();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedShapeDecorator</span> <span class="keyword">extends</span> <span class="title">ShapeDecorator</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">RedShapeDecorator</span><span class="params">(Shape decoratedShape)</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(decoratedShape);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		decoratedShape.draw();</span><br><span class="line">		setRedBorder(decoratedShape);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setRedBorder</span><span class="params">(Shape decoratedShape)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Border Color: Red&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step5: demo</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DecoratorPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Shape circle = <span class="keyword">new</span> Circle();</span><br><span class="line">		Shape redCircle = <span class="keyword">new</span> RedShapeDecorator(<span class="keyword">new</span> Circle());</span><br><span class="line">		Shape redRectangle = <span class="keyword">new</span> RedShapeDecorator(<span class="keyword">new</span> Rectangle());</span><br><span class="line">		System.out.println(<span class="string">&quot;Circle with normal border&quot;</span>);</span><br><span class="line">		circle.draw();</span><br><span class="line">		System.out.println(<span class="string">&quot;\nCircle of red border&quot;</span>);</span><br><span class="line">		redCircle.draw();</span><br><span class="line">		System.out.println(<span class="string">&quot;\nRectangle of red border&quot;</span>);</span><br><span class="line">		redRectangle.draw();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="外观模式-Facade-Pattern"><a href="#外观模式-Facade-Pattern" class="headerlink" title="外观模式 Facade Pattern"></a>外观模式 Facade Pattern</h3><p>隐藏系统的复杂性，想客户端提供访问系统的接口，简化客户端请求
方法和对象系统类方法的委托调用</p>
<ul>
<li>意图：定义一个高级接口，使得子系统更加容易使用</li>
<li>解决问题：降低访问复杂系统内部子系统时的复杂度</li>
<li>使用场景<ul>
<li>客户端不需要知道复杂系统内部的复杂联系，系统只需要
提供“接待员”</li>
<li>定义系统的入口</li>
</ul>
</li>
<li>解决方法：客户端不与系统耦合，外观类与系统耦合</li>
<li>优点<ul>
<li>减少系统相互依赖</li>
<li>提高灵活性</li>
<li>提高安全性</li>
</ul>
</li>
<li>缺点：不符合开闭原则，修改时麻烦</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Rectangle::draw()&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Square::draw()&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Circle::draw()&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeMaker</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Shape circle;</span><br><span class="line">	<span class="keyword">private</span> Shape rectangle;</span><br><span class="line">	<span class="keyword">private</span> Shape square;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ShapeMaker</span><span class="params">()</span></span>&#123;</span><br><span class="line">		circle = <span class="keyword">new</span> Circle();</span><br><span class="line">		rectangle = <span class="keyword">new</span> Rectangle();</span><br><span class="line">		square = <span class="keyword">new</span> Square();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawCircle</span><span class="params">()</span></span>&#123;</span><br><span class="line">		circle.draw();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawRectangle</span><span class="params">()</span></span>&#123;</span><br><span class="line">		rectangle.draw();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawSquare</span><span class="params">()</span></span>&#123;</span><br><span class="line">		square.draw();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FacadePatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		ShapeMaker shapeMaker = <span class="keyword">new</span> ShapeMaker();</span><br><span class="line">		shapeMaker.drawCircle();</span><br><span class="line">		shapeMaker.drawRectangle();</span><br><span class="line">		shapeMaker.drawSquare();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="享元模式-Flyweight-Pattern"><a href="#享元模式-Flyweight-Pattern" class="headerlink" title="享元模式 Flyweight Pattern"></a>享元模式 Flyweight Pattern</h3><p>尝试重用现有的同类对象，仅在找不到匹配对象才创建新对象，
减少创建对象的数量、内存占用，提高性能</p>
<ul>
<li>意图：运用共享技术有效地支持大量细粒度的对象</li>
<li>解决问题：大量对象时，抽象出其中共同部分，相同的业务请求
时，直接返回内存中已有对象</li>
<li>使用场景<ul>
<li>系统中有大量对象，消耗大量内存</li>
<li>对象的状态大部分可以外部化</li>
<li>对象可以按照内蕴状态分组，将外蕴状态剔除后可以每组
对象只使用一个对象代替</li>
<li>系统不依赖这些对象的身份，对象是“不可分辨的”</li>
</ul>
</li>
<li>解决方法：用唯一标识码判断，如果内存中存在，则返回唯一
标识码所标识的对象</li>
<li>优点：减少对象创建、内存消耗</li>
<li>缺点：增加系统复杂度，需要分离内蕴、外蕴状态，而且外蕴
状态具有固有化相知，不应该随着内部状态变化而变化，否则会
照成系统混乱</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String color;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> x;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> y;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> radius;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Circle</span><span class="params">(String color)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.color = color;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setX</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.x = x;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> vodi <span class="title">setY</span><span class="params">(<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.y = y;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRadius</span><span class="params">(<span class="keyword">int</span> radius)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.radius = radius;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Circle: Draw() [Color: &quot;</span> + color</span><br><span class="line">			+ <span class="string">&quot;,x: &quot;</span> + x + <span class="string">&quot;,y: &quot;</span> + y + <span class="string">&quot;,radius: &quot;</span> + radius);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeFactory</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> HashMap&lt;String, Shape&gt; circleMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Shape <span class="title">getCircle</span><span class="params">(String color)</span></span>&#123;</span><br><span class="line">		Circle circle = (Circle)circleMap.get(Color);</span><br><span class="line">		<span class="keyword">if</span>(circle == <span class="keyword">null</span>)&#123;</span><br><span class="line">			circle = <span class="keyword">new</span> Circle(color);</span><br><span class="line">			circleMap.put(color, circle);</span><br><span class="line">			System.out.println(<span class="string">&quot;Creating circle of color: &quot;</span> + color);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> cirle;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyweightPatternDemo</span></span>&#123;</span><br><span class="line">	pirvate <span class="keyword">static</span> <span class="keyword">final</span> String colors[] = </span><br><span class="line">	&#123;<span class="string">&quot;Red&quot;</span>, <span class="string">&quot;Green&quot;</span>, <span class="string">&quot;Blue&quot;</span>, <span class="string">&quot;White&quot;</span>, <span class="string">&quot;Black&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; ++i)&#123;</span><br><span class="line">			Circle circle = (Circle)ShapeFactory.getCircle(getRamdonColor());</span><br><span class="line">			circle.setX(getRandomX());</span><br><span class="line">			circle.setY(getRandomY());</span><br><span class="line">			circle.setRadius(<span class="number">100</span>);</span><br><span class="line">			circle.draw();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getRandomColor</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> colors[(<span class="keyword">int</span>)(Math.random()*colors.length))];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getRandomX</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">int</span>)(Math.random()*<span class="number">100</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getRandomY</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">int</span>)(Math.random()*<span class="number">100</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="代理模式-Proxy-Pattern"><a href="#代理模式-Proxy-Pattern" class="headerlink" title="代理模式 Proxy Pattern"></a>代理模式 Proxy Pattern</h3><p>创建具有现有对象的对象，向外界提供功能接口，一个类代表另
一个类的功能，</p>
<ul>
<li>意图：为其他对象提供一种代理以控制对这个对象的访问</li>
<li>解决问题：直接访问对象会给使用者、系统结构代理问题</li>
<li>使用场景：在访问类时做一些控制</li>
<li>解决方法：增加中间层</li>
<li>优点<ul>
<li>职责清晰</li>
<li>高扩展性</li>
<li>智能化</li>
</ul>
</li>
<li>缺点<ul>
<li>在客户端和真实端之间增加了代理对象，可能降低效率</li>
<li>代理模式需要额外工作，实现可能非常复杂</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Image</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">dispaly</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line">publi <span class="class"><span class="keyword">class</span> <span class="title">RealImage</span> <span class="keyword">implements</span> <span class="title">Image</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">RealImage</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.filName = fileName;</span><br><span class="line">		loadFromDisk(fileName);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Ovrride</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Displaying &quot;</span> + fileName);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadFromDisk</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Loading &quot;</span> + fileName);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyImage</span> <span class="keyword">implements</span> <span class="title">Image</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> RealImage realImage;</span><br><span class="line">	<span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ProxyImage</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">		<span class="comment">// it won&#x27;t load image until display-method is</span></span><br><span class="line">		<span class="comment">// called</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(realImage = Null)&#123;</span><br><span class="line">			realImage = <span class="keyword">new</span> RealImage(fileName);</span><br><span class="line">		&#125;</span><br><span class="line">		realImage.display();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Image image = <span class="keyword">new</span> ProxyImage(<span class="string">&quot;test_10mb.jpg&quot;</span>);</span><br><span class="line">		image.display();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="行为型模式"><a href="#行为型模式" class="headerlink" title="行为型模式"></a>行为型模式</h2><p>特别关注对象之间的通信</p>
<h3 id="责任链模式-Chain-of-Responsibility-Pattern"><a href="#责任链模式-Chain-of-Responsibility-Pattern" class="headerlink" title="责任链模式 Chain of Responsibility Pattern"></a>责任链模式 Chain of Responsibility Pattern</h3><p>为请求创建接收者对象的链，对请求的发送者和接收者进行解耦，
通常每个接着者都包含对另一个接收者的引用</p>
<ul>
<li>意图：避免请求发送者与接收者耦合，让多个对象都有可能接受
请求，将这些对象连接成职责链，并且沿着这条链传递请求，
直到有对象处理</li>
<li>解决问题：职责链上处理者负责处理请求，客户只要将请求发送
到职责链上即可，无需关心请求的处理细节和请求的传递，所以
职责链将请求的发送者和请求的处理者解耦</li>
<li>使用场景：在处理时已过滤多次</li>
<li>解决方法：拦截的类都实现统一接口</li>
<li>优点<ul>
<li>降低耦合度</li>
<li>简化对象，发送者不需要知道链的结构</li>
<li>增强接收者的灵活性，通过改变、排序职责链内成员，允许
动态的增删责任</li>
<li>增加新的请求处理类方便</li>
</ul>
</li>
<li>缺点<ul>
<li>不能保证请求一定被接收</li>
<li>系统性能将受到影响，调试代码时不方便，可能造成循环
调用</li>
<li>不容易观察运行时特征，有碍于除错</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractLogger</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> INFO = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> DEBUG = <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> ERROR = <span class="number">3</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">	protected int level;</span></span><br><span class="line"><span class="string">	protected AbstractLogger nextLogger;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	public void setNextLogger(AbstractLogger nextLogger)&#123;</span></span><br><span class="line"><span class="string">		this.nextLogger = nextLogger;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	public void logMessage(int level, String Message)&#123;</span></span><br><span class="line"><span class="string">		if(this.level &lt;= level)&#123;</span></span><br><span class="line"><span class="string">			write(message);</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">		if(nextLogger != null)&#123;</span></span><br><span class="line"><span class="string">			nextLogger.logMessage(level, message);</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	abstract protected void write(String message);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// step2</span></span><br><span class="line"><span class="string">public class ConsoleLogger extends AbstractLogger&#123;</span></span><br><span class="line"><span class="string">	public consoleLogger(int level)&#123;</span></span><br><span class="line"><span class="string">		this.level = level;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	@Override</span></span><br><span class="line"><span class="string">	protected void write(String message)&#123;</span></span><br><span class="line"><span class="string">		System.out.println(&quot;Standard Console::Logger: &quot; + message);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">public class ErrorLogger extends AbstractLogger&#123;</span></span><br><span class="line"><span class="string">	public ErrorLogger(int level)&#123;</span></span><br><span class="line"><span class="string">		this.level = level;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	@Override</span></span><br><span class="line"><span class="string">	protected void write(String message)&#123;</span></span><br><span class="line"><span class="string">		System.out.println(&quot;Error Console::Logger: &quot; + message);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">public class FileLogger extends AbstractLogger&#123;</span></span><br><span class="line"><span class="string">	public FileLogger(int level)&#123;</span></span><br><span class="line"><span class="string">		this.level = level;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	@Override</span></span><br><span class="line"><span class="string">	protected void write(String message)&#123;</span></span><br><span class="line"><span class="string">		System.out.println(&quot;File::Logger: &quot; + message);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// step3</span></span><br><span class="line"><span class="string">public class ChainPatternDemo&#123;</span></span><br><span class="line"><span class="string">	private static AbstractLogger getChainOfLogger()&#123;</span></span><br><span class="line"><span class="string">		AbstractLogger errorLogger = new ErrorLogger(AbstractLogger.ERROR);</span></span><br><span class="line"><span class="string">		AbstractLogger fileLogger = new FileLogger(AbstractLogger.DEBUG):</span></span><br><span class="line"><span class="string">		AbstractLogger console.Logger = new ConsoleLogger(AbstractLogger.INFO0;</span></span><br><span class="line"><span class="string">		errorLogger.setNextLogger(fileLogger);</span></span><br><span class="line"><span class="string">		fileLogger.setNextLogger(consoleLogger);</span></span><br><span class="line"><span class="string">		return errorLogger;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	public static void main(String[] args)&#123;</span></span><br><span class="line"><span class="string">		AbstractLogger loggerChain = getChainLoggers();</span></span><br><span class="line"><span class="string">		loggerChain.logMessage(AbstractLogger.INFO,</span></span><br><span class="line"><span class="string">			&quot;this is an information&quot;);</span></span><br><span class="line"><span class="string">		loggerChain.logMessage(AbstractLogger.DEBUG,</span></span><br><span class="line"><span class="string">			&quot;this is a debug level infomation&quot;);</span></span><br><span class="line"><span class="string">		loggerChain.logMessage(AbstractLogger.ERROR,</span></span><br><span class="line"><span class="string">			&quot;this is an error infomation&quot;);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="命令模式-Command-Pattern"><a href="#命令模式-Command-Pattern" class="headerlink" title="命令模式 Command Pattern"></a>命令模式 Command Pattern</h3><p>请求以命令的形式包裹对象中，并传给调用对象，调用对象寻找可以
处理该命令的合适的对象，是一种数据驱动的设计模式</p>
<ul>
<li>意图：将请求封装成一个对象，用不同的请求对客户进行参数化</li>
<li>解决问题：行为请求者、实现者通常是紧耦合关系，</li>
<li>使用场景：需要对行为进行记录、撤销、重做、事务等处理时，
紧耦合关系无法抵御变化</li>
<li>解决方法：通过调用者调用接收者执行命令</li>
<li>优点<ul>
<li>降低系统耦合度</li>
<li>容易添加新命令至系统</li>
</ul>
</li>
<li>缺点：使用命令模式可能会导致系统有过多具体命令类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Order</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stock</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name = <span class="string">&quot;ABC&quot;</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> quantity = <span class="number">10</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buy</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Stock [Name: &quot;</span> + name</span><br><span class="line">			+ <span class="string">&quot;, Quantity: &quot;</span> + quantity + <span class="string">&quot;] bought&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">seel</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Stock [Name: &quot;</span> + name</span><br><span class="line">			+ <span class="string">&quot;, Quantity: &quot;</span> + quantity + <span class="string">&quot;] sold&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuyStock</span> <span class="keyword">implements</span> <span class="title">Order</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Stock abcStock;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">BuyStock</span><span class="params">(Stock abcStock)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.abcStock = abcStock;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> execute（）&#123;</span><br><span class="line">		abcStock.but();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SellStock</span> <span class="keyword">implements</span> <span class="title">Order</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Stock abcStock;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SellStock</span><span class="params">(Stock abcStock)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.abcStock = abcStock;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">pubic <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>&#123;</span><br><span class="line">		abcStock.sell();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Broker</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Order&gt; orderList = <span class="keyword">new</span> ArrayList&lt;Order&gt;();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">takeOrder</span><span class="params">(Order order)</span></span>&#123;</span><br><span class="line">		orderList.add(order);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">placeOrders</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(Order order: orderList)&#123;</span><br><span class="line">			order.execute();</span><br><span class="line">		&#125;</span><br><span class="line">		orderList.clear();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Stock abcStock = <span class="keyword">new</span> Stock();</span><br><span class="line">		BuyStock buyStockOrder = <span class="keyword">new</span> BuyStock(abcStock);</span><br><span class="line">		SellStock sellStockOrder = <span class="keyword">new</span> SellStock(abcStock);</span><br><span class="line">		Broker broker = <span class="keyword">new</span> Broker();</span><br><span class="line">		broker.takeOrder(buyStockOrder);</span><br><span class="line">		broker.takeOrder(sellStockOrder);</span><br><span class="line">		broker.placeOrders();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="解释器模式-Interpreter-Pattern"><a href="#解释器模式-Interpreter-Pattern" class="headerlink" title="解释器模式 Interpreter Pattern"></a>解释器模式 Interpreter Pattern</h3><p>实现一个表达式接口用于解释特定上下文，提供了评估语言的语法
或表达式的方式</p>
<ul>
<li>意图：定义给定语言的文法表示、解释器</li>
<li>解决问题：为固定文法构建解释句子的解释器</li>
<li>使用场景：若特定类型问题发生频率足够高，可能值得将其各
实例表述为监督语言的句子，便可构建解释器解释这些句子来
解决问题</li>
<li>解决方法；构建语法树，定义终结符、非终结符</li>
<li>优点<ul>
<li>扩展性好，灵活</li>
<li>增加了新的解释表达式的方式</li>
<li>容易实现简单文法</li>
</ul>
</li>
<li>缺点<ul>
<li>适用场景少</li>
<li>对于复杂文法维护难度大</li>
<li>解释器模式会引起类膨胀</li>
<li>解释器模式采用递归调用方法</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Expression</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">interpret</span><span class="params">(String context)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TerminalExpression</span> <span class="keyword">implements</span> <span class="title">Expression</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String data;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">TerminalExpression</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.data = data;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Overide</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">interpret</span><span class="params">(String context)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(context.contain(data))&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrExpression</span> <span class="keyword">implements</span> <span class="title">Expression</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Expression expr1 = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> Expression expr2 = <span class="keyword">null</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">OrExpression</span><span class="params">(Expression expr1, Expression expr2)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.expr1 = expr1;</span><br><span class="line">		<span class="keyword">this</span>.expr2 = expr2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">interpret</span><span class="params">(String context)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> expr1.interpret((context) || expr2.interpret(context);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AndExpression</span> <span class="keyword">implements</span> <span class="title">Expression</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Expression expr1 = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> Expression expr2 = <span class="keyword">null</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AndExpression</span><span class="params">(Expression expr1, Expression expr2)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.expr1 = expr1;</span><br><span class="line">		<span class="keyword">this</span>.expr2 = expr2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">interpret</span><span class="params">(String context)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> expr1.interpret(context) &amp;&amp; expr2.interpret(context);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterpreterPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Expression <span class="title">getMaleExpression</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Expression robert = <span class="keyword">new</span> TerminalExpression(<span class="string">&quot;Robert&quot;</span>);</span><br><span class="line">		Expression john = <span class="keyword">new</span> TerminalExpression(<span class="string">&quot;John&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> OrExpression(robert, john);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Expression <span class="title">getMarriedWomanExpression</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Expression julie = <span class="keyword">new</span> TerminalExpression(<span class="string">&quot;Julie&quot;</span>);</span><br><span class="line">		Expression married = <span class="keyword">new</span> TerminalExpression(<span class="string">&quot;Married&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> AndExpression(julie, married);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Expression isMale = getMaleExpression();</span><br><span class="line">		Expression isMarriedWoman = getMarriedWomanExpression();</span><br><span class="line">		System.out.println(<span class="string">&quot;John is male?&quot;</span> + isMale.interpret(<span class="string">&quot;John&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;Julie is a married women?&quot;</span></span><br><span class="line">			+ is MarriedWoman.interpret(<span class="string">&quot;Married Julie&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="迭代器模式-Iterator-Pattern"><a href="#迭代器模式-Iterator-Pattern" class="headerlink" title="迭代器模式 Iterator Pattern"></a>迭代器模式 Iterator Pattern</h3><p>用于访问顺序访问剂盒对象的元素，不需要知道集合对象的底层表示</p>
<ul>
<li>意图：提供方法用于顺序访问聚合对象中的各个元素，又无须
暴露该对象的内部表示</li>
<li>解决问题：不同方式遍历整个整合对象</li>
<li>使用场景：遍历聚合对象</li>
<li>解决方法：把在元素中游走的责任交给迭代器</li>
<li>优点<ul>
<li>支持以不同的方式遍历对象</li>
<li>迭代器简化了聚合类</li>
<li>增加新的聚合类、迭代器类方便</li>
</ul>
</li>
<li>缺点：会将存储数据和遍历数据的职责分离，增加新的聚合类
需要增加新的迭代器类，类数目成对增加，增加系统复杂性</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Container</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Iterator <span class="title">getIterator</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NameRepository</span> <span class="keyword">implements</span> <span class="title">Container</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> String names[] = &#123;<span class="string">&quot;Robert&quot;</span>, <span class="string">&quot;John&quot;</span>, <span class="string">&quot;Julie&quot;</span>, <span class="string">&quot;Lora&quot;</span>&#125;;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Iterator <span class="title">getIterator</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> NameIterator();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">NameIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> index;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(index &lt; names.length)&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> Object <span class="title">Next</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">this</span>.hasNext())&#123;</span><br><span class="line">				<span class="keyword">return</span> names[index++];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IteratorPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		NameReppository namesRepository = <span class="keyword">new</span> NameRepository();</span><br><span class="line">		<span class="keyword">for</span>(Iterator iter = namesRepository.getIterator(); iter.hasNext;)&#123;</span><br><span class="line">			String name = (String)iter.next();</span><br><span class="line">			System.out.println(<span class="string">&quot;Name: &quot;</span> + name);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="中介者模式-Mediator-Pattern"><a href="#中介者模式-Mediator-Pattern" class="headerlink" title="中介者模式 Mediator Pattern"></a>中介者模式 Mediator Pattern</h3><p>提供一个中介类处理不同类之间的通信，降低多个对象、类之间的
通信复杂性，支持松耦合，使代码便于维护</p>
<ul>
<li>意图：用一个中介对象封装一系列对象交互，中介使得个对象
不需要显式的相互引用，从而使其耦合松散，且可以独立地改变
它们之间地交互</li>
<li>解决问题：对象之间存在大量的关联关系，会导致系统结构很
复杂，且若一个对象发生改变，需要跟踪与之关联的对象并作出
相应处理</li>
<li>使用场景：多个类相互耦合形成网状结构</li>
<li>解决方法：将网状结构分离为星形结构</li>
<li>优点<ul>
<li>降低类的复杂度，多对多转为一对一</li>
<li>各个类之间解耦</li>
<li>符合迪米特原则</li>
</ul>
</li>
<li>缺点：中介者可能会很庞大、难以维护</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatRoom</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showMessage</span><span class="params">(User user, String message)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="keyword">new</span> Date().toString()</span><br><span class="line">			+ <span class="string">&quot;[&quot;</span> + use.getName() + <span class="string">&quot;]&quot;</span> + message);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">		ChatRoom.showMessage(<span class="keyword">this</span>, message);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MediatorPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		User robert = <span class="keyword">new</span> User(<span class="string">&quot;Robert&quot;</span>);</span><br><span class="line">		User john = <span class="keyword">new</span> User(<span class="string">&quot;John&quot;</span>);</span><br><span class="line">		robert.sendMessage(<span class="string">&quot;Hi! John&quot;</span>);</span><br><span class="line">		john.SendMessage(<span class="string">&quot;Hello! Robert.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="备忘录模式-Memento-Pattern"><a href="#备忘录模式-Memento-Pattern" class="headerlink" title="备忘录模式 Memento Pattern"></a>备忘录模式 Memento Pattern</h3><p>保存对象地某个状态以便在适当的时候恢复对象</p>
<ul>
<li>意图：在不破坏封装性地前提下，捕获对象的内部状态并保存
于对象外</li>
<li>解决问题：同意图</li>
<li>使用场景：需要记录对象的内部状态，允许用户取消不确定或
错误的操作</li>
<li>解决方法：通过备忘录类专门存储对象状态</li>
<li>优点<ul>
<li>给用户提供了可以恢复状态的机制</li>
<li>实现信息的封装，用户无需关心状态保存细节</li>
</ul>
</li>
<li>缺点：消耗资源，如果类成员变量过多会占用比较大的资源</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Memento</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String state;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Memento</span><span class="params">(String state)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.state = state;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getState</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Originator</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String state;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(String state)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.state = state;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getState</span><span class="params">()</span></span>&#123;</span><br><span class="line">		reutrn state;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Memento <span class="title">saveStateToMemento</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Memento(state);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> vodi <span class="title">getStateFromMemento</span><span class="params">(Memento memento)</span></span>&#123;</span><br><span class="line">		state = memento.getState();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CareTaker</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Memento&gt; mementoList = <span class="keyword">new</span> ArrayList&lt;Memento&gt;();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Memento state)</span></span>&#123;</span><br><span class="line">		mementoList.add(state);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Memento <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mementoList.get(index);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MementoPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Originator originator = <span class="keyword">new</span> Originator();</span><br><span class="line">		CareTaker careTaker = <span class="keyword">new</span> CareTaker();</span><br><span class="line">		originator.setState(<span class="string">&quot;State #1&quot;</span>);</span><br><span class="line">		originator.setState(<span class="string">&quot;State #2&quot;</span>);</span><br><span class="line">		careTaker.add(originator.saveStateToMemento());</span><br><span class="line">		originator.setState(<span class="string">&quot;State #3&quot;</span>);</span><br><span class="line">		careTaker.add(Originator.saveStateToMemento());</span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">&quot;Current State: &quot;</span> + originator.getState());</span><br><span class="line">		origiator.getStateFromMemento(careTaker.get(<span class="number">0</span>));</span><br><span class="line">		System.out.println(<span class="string">&quot;First saved State: &quot;</span> + originator.getState());</span><br><span class="line">		originator.getStateFromMemento(CareTaker.get(<span class="number">1</span>));</span><br><span class="line">		System.out.println(<span class="string">&quot;Second saved State: &quot;</span> + originator.getState());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="观察者模式-Observer-Pattern"><a href="#观察者模式-Observer-Pattern" class="headerlink" title="观察者模式 Observer Pattern"></a>观察者模式 Observer Pattern</h3><ul>
<li>意图：定义对象间的一种一对多的依赖关系，档一个对象状态
发生改变时，所以依赖他的对象都得到通知并被自动更新</li>
<li>解决问题：一个对象状态改变给其他对象通知的问题，需要考虑
易用性和低耦合，同时保证高度协作</li>
<li>使用场景：同问题</li>
<li>解决方法：使用面向对象技术将依赖关系弱化</li>
<li>优点<ul>
<li>观察者和被观察者是抽象耦合的</li>
<li>建立一套触发机制</li>
</ul>
</li>
<li>缺点<ul>
<li>如果被观察者有很多观察者，通过所有观察者耗费时间长</li>
<li>观察者和被观察之间如果有循环依赖，观察目标可能会触发
循环调用，导致系统崩溃</li>
<li>没有机制让观察者知道所观察的目标是如何发生变化成，
仅仅是知道观察目标发生了变化</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArryaList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Subject</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Observer&gt; observers</span><br><span class="line">		= <span class="keyword">new</span> ArrayList&lt;Observer&gt;();</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> state;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getState</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.state = state;</span><br><span class="line">		notifyAllObservers();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attach</span><span class="params">(Observer observer)</span></span>&#123;</span><br><span class="line">		observers.add(observer);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyAllObservers</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(Observer observer: observers)&#123;</span><br><span class="line">			observer.update();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> Subject subject;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryObserver</span> <span class="keyword">extends</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">BinaryObserver</span><span class="params">(Subject subject)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.subject = subject;</span><br><span class="line">		<span class="keyword">this</span>.subject.attach(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Binary String: &quot;</span></span><br><span class="line">			+ Interger.toBinaryString(subject.getState()));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OctalObserver</span> <span class="keyword">extends</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">OctalObserver</span><span class="params">(Subject subject)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.subject = subject;</span><br><span class="line">		<span class="keyword">this</span>.subject.attach(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Octal String: &quot;</span></span><br><span class="line">			+ Integer.toOctalString(subject.getState()));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HexaObserver</span> <span class="keyword">extends</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">HexaObserver</span><span class="params">(Subject subject)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.subject = subject;</span><br><span class="line">		<span class="keyword">this</span>.subject.attach(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Hex String: &quot;</span></span><br><span class="line">			+ Integer.toHexString(subject.getState()).toUpperCase());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObserverPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Subject subject = <span class="keyword">new</span> Subject();</span><br><span class="line">		<span class="keyword">new</span> HexaObserver(subject);</span><br><span class="line">		<span class="keyword">new</span> OctalObserver(subject);</span><br><span class="line">		<span class="keyword">new</span> BinaryObserver(subject);</span><br><span class="line">		System.out.println(<span class="string">&quot;First state change: 15&quot;</span>);</span><br><span class="line">		subject.setState(<span class="number">15</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;Second state change: 10&quot;</span>);</span><br><span class="line">		subject.setState(<span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="状态模式-State-Pattern"><a href="#状态模式-State-Pattern" class="headerlink" title="状态模式 State Pattern"></a>状态模式 State Pattern</h3><p>创建表示各种状态的对象和一个行为随着状态改变而改变的context
对象</p>
<ul>
<li>意图：允许在对象的内部状态改变时改变它的行为，看起来好像
修改了其所属的类</li>
<li>解决问题：对象的行为依赖其状态（属性），并且可以根据其
状态改变而改变其相关行为</li>
<li>使用场景：代码中包含大量与对象状态相关的条件语句</li>
<li>解决方法：将各种具体状态类抽象出来</li>
<li>优点<ul>
<li>封装了转换规则</li>
<li>枚举了可能状态，在枚举之前需要确定状态种类</li>
<li>将所有与某个状态有关的行为放在一个类中，只需要改变
对象状态就可以改变对象行为，可以方便地增加新状态</li>
<li>允许状态转换逻辑与状态对象合成一体</li>
<li>可以让多个环境对象共享一个状态对象，减少系统中对象
数量</li>
</ul>
</li>
<li>缺点<ul>
<li>增加系统类和对象地个数</li>
<li>结构与实现都较为复杂，使用不当将导致结构和代码的混乱</li>
<li>对“开闭原则”支持不太好，增加新的状态类需要修改复杂
状态转换的源代码，修改某状态类的行为也需要修改对应类
的源代码</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">State</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAction</span><span class="params">(Context context)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartState</span> <span class="keyword">implements</span> <span class="title">State</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAction</span><span class="params">(Context context)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Player is in start state&quot;</span>);</span><br><span class="line">		context.setState();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Start State&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StopState</span> <span class="keyword">implements</span> <span class="title">State</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAction</span><span class="params">(Context context)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Player is in the stop state&quot;</span>);</span><br><span class="line">		context.setState(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Stop State&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> State state;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Context</span><span class="params">()</span></span>&#123;</span><br><span class="line">		state = <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.state = state;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StatePatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Context context = <span class="keyword">new</span> Context();</span><br><span class="line">		StartState startState = <span class="keyword">new</span> StartState();</span><br><span class="line">		startState.doAction(context);</span><br><span class="line">		System.out.println(context.getState().toString());</span><br><span class="line">		StopState stopState = <span class="keyword">new</span> StopState();</span><br><span class="line">		stopState.doAction(context);</span><br><span class="line">		System.out.println(context.getState().toString());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="空对象模式-Null-Object-Pattern"><a href="#空对象模式-Null-Object-Pattern" class="headerlink" title="空对象模式 Null Object Pattern"></a>空对象模式 Null Object Pattern</h3><p>创建一个指定各种要执行的操作的抽象类和扩展该类的实体类、一个
未做人实现的空对象类，空对象类将用于需要检查空值的地方取代
NULL对象实例的检查，也可以在数据不可用时提供默认的行为</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractCustomer</span></span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> String name;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">isNil</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealCustomer</span> <span class="keyword">extends</span> <span class="title">AbstractCustomer</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">RealCustomer</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isNil</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NullCustomer</span> <span class="keyword">extends</span> <span class="title">AbstractCustomer</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Not Available in Customer Database&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isNil</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">CustomerFactory</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] names = &#123;<span class="string">&quot;Rob&quot;</span>, <span class="string">&quot;Joe&quot;</span>, <span class="string">&quot;Julie&quot;</span>&#125;;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AbstractCustomer <span class="title">getCustomer</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; names.length; i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(names[i].equalsIgnoreCase(name))&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">new</span> RealCustomer(name);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> NullCustomer();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NullPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		AbstractCustomer customer1 = CustomerFactory.getCustomer(<span class="string">&quot;Rob&quot;</span>);</span><br><span class="line">		AbstractCustomer customer2 = CustomerFactory.getCustomer(<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">		AbstractCustomer customer3 = CustomerFactory.getCustomer(<span class="string">&quot;Julie&quot;</span>);</span><br><span class="line">		AbstractCustomer customer4 = CustomerFactory.getCustomer(<span class="string">&quot;Laura&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;Customers&quot;</span>);</span><br><span class="line">		System.out.println(customer1.getName());</span><br><span class="line">		System.out.println(customer2.getName());</span><br><span class="line">		System.out.println(customer3.getName());</span><br><span class="line">		System.out.println(customer4.getName());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="策略模式-Strategy-Pattern"><a href="#策略模式-Strategy-Pattern" class="headerlink" title="策略模式 Strategy Pattern"></a>策略模式 Strategy Pattern</h3><p>创建表示各种策略的对象和一个随着策略对象改变的context对象，
类的行为、算法可以在运行时更改</p>
<ul>
<li>意图：定义一系列算法并封装，使其可以相互替换</li>
<li>解决问题：有多种相似算法的情况下，使用<code>if...else</code>难以
维护</li>
<li>使用场景：系统中有许多类，只能通过其直接行为区分</li>
<li>解决方法：将算法封装成多个类，任意替换</li>
<li>优点<ul>
<li>算法可以自由切换</li>
<li>避免使用多重条件判断</li>
<li>扩展性良好</li>
</ul>
</li>
<li>缺点<ul>
<li>策略类增多</li>
<li>所有策略类都需要对外暴露</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Strategy</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doOperation</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperationAdd</span> <span class="keyword">implements</span> <span class="title">Strategy</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doOperation</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> num1 + num2;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperationSubstract</span> <span class="keyword">implements</span> <span class="title">Strategy</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doOperation</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> num1 - num2;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperationMultiply</span> <span class="title">impliments</span> <span class="title">Strategy</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doOperation</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> num1 * num2;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Strategy strategy;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Context</span><span class="params">(Strategy strategy)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.strategy = strategy;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">executeStrategy</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> strategy.doOperation(num1, num2);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StrategyPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Context context = <span class="keyword">new</span> Context(<span class="keyword">new</span> OperationAdd());</span><br><span class="line">		System.out.println(<span class="string">&quot;10 + 5 = &quot;</span> + context.executeStrategy(<span class="number">10</span>, <span class="number">5</span>));</span><br><span class="line">		context = <span class="keyword">new</span> Context(<span class="keyword">new</span> OperationSubstract());</span><br><span class="line">		System.out.println(<span class="string">&quot;10 - 5 = &quot;</span> + context.executeStrategy(<span class="number">10</span>, <span class="number">5</span>));</span><br><span class="line">		context = <span class="keyword">new</span> Context(<span class="keyword">new</span> OperationMultiply());</span><br><span class="line">		System.out.println(<span class="string">&quot;10 * 5 = &quot;</span> + context.executeStrategy(<span class="number">10</span>, <span class="number">5</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="模板模式-Template-Pattern"><a href="#模板模式-Template-Pattern" class="headerlink" title="模板模式 Template Pattern"></a>模板模式 Template Pattern</h3><p>一个抽象类公开定义执行它的方式（模板），其子类可以按需要重写
的方法实现，但将以抽象类中定义的方式调用</p>
<ul>
<li>意图：定义一个操作中算法的骨架，将一些步骤延迟到子类中，
使得子类可以不改变算法的接口即可重定义算法的某些步骤</li>
<li>解决问题：一些方法通用，却在每个子类中重写该方法</li>
<li>使用场景：有通用的方法</li>
<li>解决方法：将通用算法抽象出来</li>
<li>优点<ul>
<li>封装不变部分，扩展可变部分</li>
<li>提取公共代码，便于维护</li>
<li>行为由父类控制，子类实现</li>
</ul>
</li>
<li>缺点：每个不同的实现都需要子类实现，类的个数增加</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initializa</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">startPlay</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">endPlay</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>&#123;</span><br><span class="line">		initialize();</span><br><span class="line">		startPlay();</span><br><span class="line">		endPlay();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cricket</span> <span class="keyword">extends</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">endPlay</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Syste.out.println(<span class="string">&quot;Cricket Game Finished&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Cricket Game Initialized! Start playing.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">startPlay</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Cricket Game Stared. Enjoy the game!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Football</span> <span class="keyword">extends</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">endPlay</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Syste.out.println(<span class="string">&quot;Football Game Finished&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Football Game Initialized! Start playing.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">startPlay</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Football Game Stared. Enjoy the game!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TemplatePatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Game game = <span class="keyword">new</span> Cricket();</span><br><span class="line">		game.play();</span><br><span class="line">		System.out.println();</span><br><span class="line">		game = <span class="keyword">new</span> Football();</span><br><span class="line">		game.play();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="访问者模式-Visitor-Pattern"><a href="#访问者模式-Visitor-Pattern" class="headerlink" title="访问者模式 Visitor Pattern"></a>访问者模式 Visitor Pattern</h3><p>使用一个访问者类，其改变元素类的执行算法</p>
<ul>
<li>意图：将数据结构与数据操作分离</li>
<li>解决问题：稳定的数据结构和易变的操作耦合问题</li>
<li>使用场景：需要对数据结构进行很多不同且不相关的操作，且要
避免让这些操作“污染”数据结构类</li>
<li>解决方法：在数据结构类中增加对外提供接待访问者的接口</li>
<li>优点<ul>
<li>符合单一职责原则</li>
<li>优秀的扩展性、灵活性</li>
</ul>
</li>
<li>缺点<ul>
<li>具体元素对访问者公布细节，违反迪米特原则</li>
<li>具体元素变更困难</li>
<li>违反依赖倒置原则，依赖具体类而不是抽象类</li>
<li>依赖递归，如果数据结构嵌套层次太深可能有问题</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ComputerPart</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVsistor)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Keyboard</span> <span class="keyword">implements</span> <span class="title">ComputerPart</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisiter)</span></span>&#123;</span><br><span class="line">		computerPartVisitor.visit(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Monitor</span> <span class="keyword">implements</span> <span class="title">ComputerPart</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisitor)</span></span>&#123;</span><br><span class="line">		computerPartVisitor.visit(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mouse</span> <span class="keyword">implements</span> <span class="title">ComputerPart</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisitor)</span></span>&#123;</span><br><span class="line">		computerPartVisitor.visit(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span> <span class="keyword">implements</span> <span class="title">ComputerPart</span></span>&#123;</span><br><span class="line">	ComputerPart[] parts;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Computer</span><span class="params">()</span></span>&#123;</span><br><span class="line">		parts = <span class="keyword">new</span> ComputerPart[]&#123;<span class="keyword">new</span> Mouse(), <span class="keyword">new</span> Keyboard(), <span class="keyword">new</span> Monitor()&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisitor)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(ComputerPart part: parts)&#123;</span><br><span class="line">			part.accept(computerPartVisitor);</span><br><span class="line">		&#125;</span><br><span class="line">		computerPartVisitor.visit(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> interface <span class="title">ComputerPartVisitor</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Computer computer)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Mouse mouse)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Keyboard keyboard)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Monitor monitor)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComputerDisplayVisitor</span> <span class="keyword">implements</span> <span class="title">ComputerPartVisitor</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Computer computer)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Display Computer&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Mouse mouse)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Displaying Mouse.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Keyboard keyboard)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Displaying Keyboard.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Monitor monitor)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Displaying Monitor.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step5</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VisitorPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Computer computer = <span class="keyword">new</span> Computer();</span><br><span class="line">		computer.accept(<span class="keyword">new</span> ComputerPartDisplayVisitor());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="J2EE模式"><a href="#J2EE模式" class="headerlink" title="J2EE模式"></a>J2EE模式</h2><p>特别关注表示层，由Sun Java Center鉴定</p>
<h3 id="MVC模式-MVC-Pattern"><a href="#MVC模式-MVC-Pattern" class="headerlink" title="MVC模式 MVC Pattern"></a>MVC模式 MVC Pattern</h3><p>Model-View-Controller模式，用于应用程序的分层开发</p>
<ul>
<li>Model（模型）：存取数据的对象，可以带有逻辑，在数据变化
时更新控制器</li>
<li>View（视图）：模型包含的数据可视化</li>
<li>Controller（控制器）：作用与模型、视图上，控制数据流向
模型对象，并在数据变化时更新视图，使视图与模型分离</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String rollNo;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getRollNo</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> rollNo;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRollNo</span><span class="params">(String rollNo)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.rollNo = rollNo;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentView</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printStudentDetails</span><span class="params">(String studentName, String studentRollNo)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Student: &quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;Name: &quot;</span> + studentName);</span><br><span class="line">		System.out.println(<span class="string">&quot;Roll No: &quot;</span> + studentRollNo);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentController</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Student model;</span><br><span class="line">	<span class="keyword">private</span> StudentView view;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StudentController</span><span class="params">(Student model, StudentView view)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.model = model;</span><br><span class="line">		<span class="keyword">this</span>.view = view;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudentName</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		model.setName(name);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getStudentName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> model.getName();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudentRollNo</span><span class="params">(String rollNo)</span></span>&#123;</span><br><span class="line">		model.setRollNo(rollNo);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getStudentRollNo</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> model.getRollNo();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateView</span><span class="params">()</span></span>&#123;</span><br><span class="line">		view.printStudentDetails(model.getName(), model.getRollNo());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MVCPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Student model = retriveStudentFromDatabase();</span><br><span class="line">		StudentView view = <span class="keyword">new</span> StudentView();</span><br><span class="line">		StudentController controller = <span class="keyword">new</span> StudentController(model, view);</span><br><span class="line">		controller.updateView();</span><br><span class="line">		controller.setStudentName(<span class="string">&quot;John&quot;</span>);</span><br><span class="line">		controller.updateView();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Student <span class="title">retriveStudentFromDataBase</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Student student = <span class="keyword">new</span> Student();</span><br><span class="line">		student.setName(<span class="string">&quot;Robert&quot;</span>);</span><br><span class="line">		student.setRollNo(<span class="string">&quot;10&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> student;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="业务代表模式-Business-Delegate-Pattern"><a href="#业务代表模式-Business-Delegate-Pattern" class="headerlink" title="业务代表模式 Business Delegate Pattern"></a>业务代表模式 Business Delegate Pattern</h3><p>用于对表示层和业务层解耦，基本上是用来减少通信或对表示层代码
中的业务层代码的远程查询功能，业务层包括以下实体</p>
<ul>
<li>Client（客户端）</li>
<li>Business Delegate（业务代表）：为客户端提实体提供的入口
类，提供了对业务服务方法的访问</li>
<li>LookUp Service（查询服务）：获取相关的业务实现，提供业务
对象对业务代表对象的访问</li>
<li>Business Service（业务服务）：业务服务接口，实现其的具体
类提供了实际的业务实现逻辑</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BusinessService</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doProcessing</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EJBService</span> <span class="keyword">implements</span> <span class="title">BusinessService</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doProcessing</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Processing task by invoking EJB Service&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JMSService</span> <span class="keyword">implements</span> <span class="title">BusinessService</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doProcessing</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Processing task by invoking JMS Service&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BusinessLookUp</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> BusinessService <span class="title">getBusinessService</span><span class="params">(String serviceType)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(serviceType.equalsIgnoreCase(<span class="string">&quot;EJB&quot;</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> EJBService();</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="function">returen new <span class="title">JMSService</span><span class="params">()</span></span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BusinessDelegate</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> BusinessLookUp lookupService = <span class="keyword">new</span> BusinessLookUp();</span><br><span class="line">	<span class="keyword">private</span> BusinessService businessService;</span><br><span class="line">	<span class="keyword">private</span> String serviceType;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setServiceType</span><span class="params">(String serviceType)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.serviceType = serviceType;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">		businessService = lookupService.getBusinessService(serviceTpye);</span><br><span class="line">		businessService.doProcessing();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step5</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span></span>&#123;</span><br><span class="line">	BusinessDelegate businessService;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Client</span><span class="params">(BusinessDelegate businessService)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.businessServie = businessService;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">		businessService.doTask();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step6</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BusinessDelegatePatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		BusinessDelegate businessDelegate = <span class="keyword">new</span> BusinessDelegate();</span><br><span class="line">		businessDelegate.setServiceType(<span class="string">&quot;EJB&quot;</span>);</span><br><span class="line">		Client client = <span class="keyword">new</span> Client(businessDelegate);</span><br><span class="line">		cliend.doTask();</span><br><span class="line">		businessDelegate.setServiceType(<span class="string">&quot;JMS&quot;</span>);</span><br><span class="line">		client.doTask();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="组合实体模式-Composite-Entity-Pattern"><a href="#组合实体模式-Composite-Entity-Pattern" class="headerlink" title="组合实体模式 Composite Entity Pattern"></a>组合实体模式 Composite Entity Pattern</h3><p>一个组合实体是一个EJB实体bean，代表对象的图解，更新一个组合
实体时，内部依赖对象beans会自动更新，因为其是由EJB实体bean
管理的，组合实体bean参与者包括</p>
<ul>
<li>Composite Entity（组合实体）：主要的实体bean，可以是
粗粒的，或者包含一个粗粒度对象，用于持续生命周期</li>
<li>Coarse-Grained Object（粗粒度对象）：包含依赖对象，有
自己的生命周期，也能管理依赖对象的生命周期</li>
<li>Dependent Object（依赖对象）：持续生命周期依赖于粗粒度
对象的对象</li>
<li>Strategies（策略）：如何实现组合实体</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DependentObject1</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String data;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.data = data;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getData</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> data;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DependentObject2</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String data;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.data = data;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getData</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> data;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CoarseGrainedObject</span></span>&#123;</span><br><span class="line">	DependentObject1 do1 = <span class="keyword">new</span> DependentObject1();</span><br><span class="line">	DependentObject2 do2 = <span class="keyword">new</span> DependentObject2();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data1, String data2)</span></span>&#123;</span><br><span class="line">		do1.setData(data1);</span><br><span class="line">		do2.setData(data2);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String[] getData()&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> String[] &#123;do1.getData(), do2.getData()&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompositeEntity</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> CoarseGrainedObject cgo = <span class="keyword">new</span> CaorseGraiendObject();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data1, String data2)</span></span>&#123;</span><br><span class="line">		cgo.setData(data1, data2);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String[] getData()&#123;</span><br><span class="line">		<span class="keyword">return</span> cgo.getData();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> CompositeEntity compositeEntity = <span class="keyword">new</span> CompositeEntity();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printData</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(String str: compositeEntity.getData())&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Data: &quot;</span> + str);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data1, data2)</span></span>&#123;</span><br><span class="line">		compositeEntity.setData(data1, data2);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step5</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompositeEntityPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Client client = <span class="keyword">new</span> Client();</span><br><span class="line">		client.setData(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;data&quot;</span>);</span><br><span class="line">		client.printData();</span><br><span class="line">		client.setData(second test<span class="string">&quot;, &quot;</span>data2<span class="string">&quot;);</span></span><br><span class="line"><span class="string">		client.printData();</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="数据访问对象模式-Data-Access-Object-Pattern"><a href="#数据访问对象模式-Data-Access-Object-Pattern" class="headerlink" title="数据访问对象模式 Data Access Object Pattern"></a>数据访问对象模式 Data Access Object Pattern</h3><p>用于把低级的数据访问API、操作从高级的业务服务中分离出来</p>
<ul>
<li>Data Access Object Interface（数据访问对象接口）：定义
在模型对象上要执行的标准操作</li>
<li>Data Access Object concrete class（数据访问对象实体类）
：实现上述接口，负责从数据源（数据库、xml等）获取数据</li>
<li>Model/Value Object（模型/数值对象）：简单的POJO，包含
<code>get/set</code>方法存储使用DAO类检索到的数据</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> rollNo;</span><br><span class="line">	Student(String name, <span class="keyword">int</span> rollNo)&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.rollNo = rollNo;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRollNo</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> rollNo;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRollNo</span><span class="params">(<span class="keyword">int</span> rollNo)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.rollNo = rollNo;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentDao</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getAllStudents</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Student <span class="title">getStudent</span><span class="params">(<span class="keyword">int</span> rollNo)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateStudent</span><span class="params">(Student student)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteStudent</span><span class="params">(Student student)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentDaoImpl</span> <span class="keyword">implements</span> <span class="title">StudentDao</span></span>&#123;</span><br><span class="line">	List&lt;Student&gt; students;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StudentDaoImpl</span><span class="params">()</span></span>&#123;</span><br><span class="line">		students = <span class="keyword">new</span> ArrayList&lt;Student&gt;();</span><br><span class="line">		Student student1 = <span class="keyword">new</span> Student(<span class="string">&quot;Roberts&quot;</span>, <span class="number">0</span>);</span><br><span class="line">		Student student2 = <span class="keyword">new</span> Student(<span class="string">&quot;John&quot;</span>, <span class="number">1</span>);</span><br><span class="line">		students.add(student1);</span><br><span class="line">		students.add(student2);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteStudent</span><span class="params">(Student student)</span></span>&#123;</span><br><span class="line">		students.remove(student.getRollNo());</span><br><span class="line">		System.out.println(<span class="string">&quot;Student: Roll No &quot;</span></span><br><span class="line">			+ student.getRollNo()</span><br><span class="line">			+ <span class="string">&quot;, deleted from database&quot;</span></span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getAllStudents</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> students;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Student <span class="title">getStudent</span><span class="params">(<span class="keyword">int</span> rollNo)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> students.get(rollNo);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateStudent</span><span class="params">(Student student)</span></span>&#123;</span><br><span class="line">		students.get(student.getRollNo()).setName(student.getName());</span><br><span class="line">		System.out.println(<span class="string">&quot;Student: Roll No &quot;</span></span><br><span class="line">			+ student.getRollNo()</span><br><span class="line">			+ <span class="string">&quot;, updated in the database&quot;</span></span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaoPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		StudentDao studentDao = <span class="keyword">new</span> StudentDaoImpl();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(Student student: studentDao:getAllStudents())&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Student: [RollNo: &quot;</span></span><br><span class="line">				+ student.getRollNo()</span><br><span class="line">				+ <span class="string">&quot;, Name: &quot;</span></span><br><span class="line">				+ student.getName()</span><br><span class="line">				+ <span class="string">&quot; ]&quot;</span></span><br><span class="line">			);</span><br><span class="line">		&#125;</span><br><span class="line">		Student student = studentDao.getAllStudents().get(<span class="number">0</span>);</span><br><span class="line">		student.setName(<span class="string">&quot;Micheal&quot;</span>);</span><br><span class="line">		studentDao.updateStudent(student);</span><br><span class="line">		studentDao.getStudent(<span class="number">0</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;Student: [RollNo: &quot;</span></span><br><span class="line">			+ student.getRollNo()</span><br><span class="line">			+ <span class="string">&quot;, Name: &quot;</span></span><br><span class="line">			+ student.getName()</span><br><span class="line">			+ <span class="string">&quot;]&quot;</span></span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="前端控制器模式-Front-Controller-Pattern"><a href="#前端控制器模式-Front-Controller-Pattern" class="headerlink" title="前端控制器模式 Front Controller Pattern"></a>前端控制器模式 Front Controller Pattern</h3><p>用于提供一个集中请求处理机制，所有的请求都将由单一的处理程序
处理，该处理程序可以做认证、授权、记录日志、跟踪请求，然后把
请求传给相应的处理程序，包含以下部分</p>
<ul>
<li>Front Controller（前端控制器）：处理应用程序所有类型请求
的单个处理程序</li>
<li>Dispatcher（调度器）：前端控制器调用，用于调度请求到相应
的具体处理程序</li>
<li>View（视图）：为请求而创建的对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">Homeview</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Displaying Home Page&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentView</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Displaying Student Page&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dispatcher</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> StudentView studentView;</span><br><span class="line">	<span class="keyword">private</span> HomeView homeView;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Dispatcher</span><span class="params">()</span></span>&#123;</span><br><span class="line">		studentView = <span class="keyword">new</span> StudentView();</span><br><span class="line">		homeView = <span class="keyword">new</span> HomeView();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatch</span><span class="params">(String request)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(request.equalsIgnoreCase(<span class="string">&quot;StudENT&quot;</span>))&#123;</span><br><span class="line">			studentView.show();</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			homeView.show();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FrontController</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Dispatcher dispatcher;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">FrontController</span><span class="params">()</span></span>&#123;</span><br><span class="line">		dispatcher = <span class="keyword">new</span> Dispatcher();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isAuthenticUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;User is authenticated successfully.&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">trackRequest</span><span class="params">(String request)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Page requested: &quot;</span> + request);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatchRequest</span><span class="params">(String request)</span></span>&#123;</span><br><span class="line">		trackReqeust(reqeust);</span><br><span class="line">		<span class="keyword">if</span>(isAuthenticUser())&#123;</span><br><span class="line">			dispatcher.dispatch(request);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FrontControllerPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		FrontController frontController = <span class="keyword">new</span> FrontController();</span><br><span class="line">		frontController.dispatchRequest(<span class="string">&quot;HOMe&quot;</span>);</span><br><span class="line">		frontController.dispatchRequest(<span class="string">&quot;STUDENT&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="拦截过滤器模式-Intercepting-Filter-Pattern"><a href="#拦截过滤器模式-Intercepting-Filter-Pattern" class="headerlink" title="拦截过滤器模式 Intercepting Filter Pattern"></a>拦截过滤器模式 Intercepting Filter Pattern</h3><p>用于应用程序的请求或相应做一些预处理、后处理，定义过滤器，
并将其应用在请求上后再传递给实际目标应用程序，过滤器可以做
认证、授权、记录日志、跟踪请求</p>
<ul>
<li>Filter（过滤器）：在处理程序执行请求之前或之后执行某些
任务</li>
<li>Filter Chain（过滤器链）：带有多个过滤器，并按定义的顺序
执行这些过滤器</li>
<li>Target：请求处理程序</li>
<li>Filter Manager（过滤管理器）：管理过滤器和过滤器链</li>
<li>Client（客户端）：向Target对象发送请求的对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(String request)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthenticationFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(String request)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Authenticating request: &quot;</span> + request);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DebugFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(String request)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;request log: &quot;</span> + request);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Target</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(String request）&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">		System.out.println(<span class="string">&quot;Executing request: &quot;</span> + request)</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FilterChain</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Filter&gt; filters = <span class="keyword">new</span> ArrayList&lt;Filter&gt;();</span><br><span class="line">	<span class="keyword">private</span> Target target;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFilter</span><span class="params">(Filter filter)</span></span>&#123;</span><br><span class="line">		filters.add(filter);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(String request)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(Filter filter: filters)&#123;</span><br><span class="line">			filter.execute(reqeust);</span><br><span class="line">		&#125;</span><br><span class="line">		target.execute(request);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> vodi <span class="title">setTarget</span><span class="params">(Target target)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.target = target;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step5</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FilterManager</span></span>&#123;</span><br><span class="line">	FilterChain filterChain;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">FilterManager</span><span class="params">(Target target)</span></span>&#123;</span><br><span class="line">		filterChain = <span class="keyword">new</span> FilterChain();</span><br><span class="line">		filterChain.setTarget(target);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilter</span><span class="params">(Filter filter)</span></span>&#123;</span><br><span class="line">		filterChain.addFilter(filter);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">filterRequest</span><span class="params">(String request)</span></span>&#123;</span><br><span class="line">		filterChain.execute(request);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step6</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span></span>&#123;</span><br><span class="line">	FilterManager filterManager;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilterManager</span><span class="params">(FilterManager filterManager)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.filterManager = filterManager;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendRequests</span><span class="params">(String request)</span></span>&#123;</span><br><span class="line">		filterManager.filterRequest(request);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step7</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterceptingFilterDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		FilterManager filterManager = <span class="keyword">new</span> FilterManager(<span class="keyword">new</span> Target());</span><br><span class="line">		filterManager.setFilter(<span class="keyword">new</span> AuthenticationFilter());</span><br><span class="line">		filterManager.setFilter(<span class="keyword">new</span> DebugFilter());</span><br><span class="line">		Client client = <span class="keyword">new</span> Client();</span><br><span class="line">		client.setFilterManager(filterManager);</span><br><span class="line">		client.sendRequest(<span class="string">&quot;HOME&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="服务定位器模式-Service-Locator-Pattern"><a href="#服务定位器模式-Service-Locator-Pattern" class="headerlink" title="服务定位器模式 Service Locator Pattern"></a>服务定位器模式 Service Locator Pattern</h3><p>用于使用JNDI查询定位各种服务时，充分利用缓存技术减小为服务
查询JNDI的代价，首次请求服务时，服务定位器在JNDI中查找服务，
并缓存供之后查询相同服务的请求使用</p>
<ul>
<li>Service（服务）：实际处理请求的服务，其引用可以在JNDI
服务器中查到</li>
<li>Context：JNDI带有要查找的服务的引用</li>
<li>Service Locator（服务定位器）：通过JNDI查找和缓存服务来
获取服务的单点接触</li>
<li>Cache（缓存）：缓存服务引用以便复用</li>
<li>Client（客户端）：通过ServiceLocator调用服务对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Serivce</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Service1</span> <span class="keyword">implements</span> <span class="title">Service</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Executing Service1&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Service1&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Service2</span> <span class="keyword">implements</span> <span class="title">Service</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Executing Service2&quot;</span>):</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Service2&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitialContext</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">lookup</span><span class="params">(String jndiName)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(jndiName.equalsIgnoreCase(<span class="string">&quot;SERVICE1&quot;</span>)&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Looking up and creating a new Service1 object&quot;</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Service1();</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(jndiName.equalsIgnoreCase(<span class="string">&quot;service2&quot;</span>)&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Looking up and creating a new Service2 object.&quot;</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Service2();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.uitl.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cache</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Service&gt; services;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Cache</span><span class="params">()</span></span>&#123;</span><br><span class="line">		services = <span class="keyword">new</span> ArrayList&lt;Service&gt;();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Service <span class="title">getService</span><span class="params">(String serviceName)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(Service service: services)&#123;</span><br><span class="line">			<span class="keyword">if</span>(service.getName().equalsIgnoreCase(serviceName))&#123;</span><br><span class="line">				System.out.println(<span class="string">&quot;Returning cached &quot;</span></span><br><span class="line">					+ serviceName</span><br><span class="line">					+ <span class="string">&quot; object&quot;</span></span><br><span class="line">				);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addService</span><span class="params">(Service newService)</span></span>&#123;</span><br><span class="line">		<span class="keyword">boolean</span> exists = <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">for</span>(Service service: services)&#123;</span><br><span class="line">			<span class="keyword">if</span>(service.getName().equalsIgnoreCase(newService.getName()))&#123;</span><br><span class="line">				exists = <span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!exist)&#123;</span><br><span class="line">			services.add(newService);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step5</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceLocator</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Cache cache;</span><br><span class="line">	<span class="keyword">static</span>&#123;</span><br><span class="line">		cache = <span class="keyword">new</span> Cache();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Service <span class="title">getService</span><span class="params">(String jndiName)</span></span>&#123;</span><br><span class="line">		Service service = cache.getService(jndiName);</span><br><span class="line">		<span class="keyword">if</span>(service != <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> service;</span><br><span class="line">		&#125;</span><br><span class="line">		InitialContext context = <span class="keyword">new</span> InitialContext();</span><br><span class="line">		Service service1 = (Service)context.lookup(jndiName);</span><br><span class="line">		cache.addService(service1);</span><br><span class="line">		<span class="keyword">return</span> service1;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step6</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceLocatorPatternDemo</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Service service = ServiceLocator.getService(<span class="string">&quot;Service1&quot;</span>);</span><br><span class="line">		service.execute();</span><br><span class="line">		service = ServiceLocator.getService(<span class="string">&quot;Service2&quot;</span>);</span><br><span class="line">		service.execute();</span><br><span class="line">		service = ServiceLocator.getService(<span class="string">&quot;Service1&quot;</span>);</span><br><span class="line">		service.execute();</span><br><span class="line">		service = ServiceLocator.getService(<span class="string">&quot;Service1&quot;</span>);</span><br><span class="line">		service.execute();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="传输对象模式-Tranfer-Object-Pattern"><a href="#传输对象模式-Tranfer-Object-Pattern" class="headerlink" title="传输对象模式 Tranfer Object Pattern"></a>传输对象模式 Tranfer Object Pattern</h3><p>用于从客户端向服务器一次性传递带有多个属性的数据。传输对象
（数值对象）是具有<code>getter/setter</code>方法的简单POJO类，可
序列化，因此可以通过网络传输，没有任何行为。服务器端业务类
通常从数据库读取数据填充POJO，并发送到客户端或按值传递；
客户端可以自行创建传输对象并传送给服务器，以便一次性更新
数据库中的数值</p>
<ul>
<li>Business Object（业务对象）：为传输对象填充数据的业务
服务</li>
<li>Transfer Object（传输对象）：简单的POJO，只有设置/获取
属性的方法</li>
<li>Client（客户端）：可以发送请求或发送传输对象到业务对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentVO</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> rollNo;</span><br><span class="line">	StudentVo(String name, <span class="keyword">int</span> rollNo)&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.rollNo = rollNo;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		thi.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRollNo</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> rollNo;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRollNo</span><span class="params">(<span class="keyword">int</span> rollNo)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.rollNo = rollNo;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// step2</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentBO</span></span>&#123;</span><br><span class="line">	List&lt;StudentVO&gt; students;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StudentBO</span><span class="params">()</span></span>&#123;</span><br><span class="line">		students = <span class="keyword">new</span> ArrayList&lt;StudentVO&gt;();</span><br><span class="line">		studentVO student1 = <span class="keyword">new</span> StudentVO(<span class="string">&quot;Robert&quot;</span>, <span class="number">0</span>);</span><br><span class="line">		studentVO student2 = <span class="keyword">new</span> StudentVO(<span class="string">&quot;John&quot;</span>, <span class="number">1</span>);</span><br><span class="line">		student1.add(student1);</span><br><span class="line">		student2.add(student2);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteStudent</span><span class="params">(StudentVO student)</span></span>&#123;</span><br><span class="line">		students.remove(student.getRollNo());</span><br><span class="line">		System.out.println(<span class="string">&quot;Student: Roll No &quot;</span></span><br><span class="line">			+ student.getRollNo()</span><br><span class="line">			+ <span class="string">&quot;, deleted from database.&quot;</span></span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;StudentVO&gt; <span class="title">getAllStudents</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> students;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> StudentVO <span class="title">getStudent</span><span class="params">(<span class="keyword">int</span> rollNo)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> students.get(rollNo);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateStudent</span><span class="params">(StudentVO student)</span></span>&#123;</span><br><span class="line">		students.get(studentNo()).setName(student.getName());</span><br><span class="line">		System.out.println(<span class="string">&quot;Student: Roll No &quot;</span></span><br><span class="line">			+ student.getRollNo()</span><br><span class="line">			+ <span class="string">&quot;, updated in the database.&quot;</span></span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// public class TransferObjectPatternDemo&#123;</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		StudentBO studentBusinessObject = <span class="keyword">new</span> StudentBO();</span><br><span class="line">		<span class="keyword">for</span>(StudentVO student: studentBusinessObject.getAllStudent())&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Student: [Roll No: &quot;</span></span><br><span class="line">				+ student.getRollNo()</span><br><span class="line">				+ <span class="string">&quot;, Name: &quot;</span></span><br><span class="line">				+ student.getName()</span><br><span class="line">				+ <span class="string">&quot;]&quot;</span></span><br><span class="line">			);</span><br><span class="line">		&#125;</span><br><span class="line">		studentVO student = studentBusinessObject.getAllStudents().get(<span class="number">0</span>);</span><br><span class="line">		student.setName(<span class="string">&quot;Micheal&quot;</span>);</span><br><span class="line">		studentBusinessObject.updateStudent(student);</span><br><span class="line">		student = studentBusinessObject.getStudent(<span class="number">0</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;Student: [Roll No: &quot;</span></span><br><span class="line">			+ student.getRollNo()</span><br><span class="line">			+ <span class="string">&quot;, Name: &quot;</span></span><br><span class="line">			+ student.getName()</span><br><span class="line">			+ <span class="string">&quot;]&quot;</span></span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:15.000Z" title="3/21/2019, 5:27:15 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-03-14T09:29:47.000Z" title="3/14/2019, 5:29:47 PM">2019-03-14</time></span><span class="level-item"><a class="link-muted" href="/categories/Algorithm/">Algorithm</a></span><span class="level-item">8 minutes read (About 1263 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Algorithm/data_structure_abstract.html">Abstract Data Type</a></h1><div class="content"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><blockquote>
<ul>
<li><em>data</em>：数据，对客观事物的符号表示，在计算机科学中，指
  所以能输入计算机中、并被计算机处理的符号总称</li>
<li><em>data element</em>：数据元素，数据基本单位，在计算机中通常
  作为整体考虑</li>
<li><em>data item</em>：数据项，数据元素的组成部分</li>
<li><em>data object</em>：数据对象，性质相同的数据元素的集合，数据
  的子集</li>
</ul>
</blockquote>
<h3 id="Data-Structure"><a href="#Data-Structure" class="headerlink" title="Data Structure"></a><em>Data Structure</em></h3><p>数据结构：相互直接存在<strong>一种或多种特定</strong>关系的数据元素的集合</p>
<ul>
<li>使用基本类型不断组合形成的<strong>层次结构</strong></li>
<li>某种意义上，数据结构可以看作是<strong>一组具有相同结构的值</strong></li>
</ul>
<script type="math/tex; mode=display">
Data_Structure = (D, S)</script><blockquote>
<ul>
<li>$D$：数据元素有限集</li>
<li>$S$：结构/关系有限集，数据元素之间相互之间的<strong>逻辑关系</strong></li>
</ul>
</blockquote>
<ul>
<li><p>集合：结构中数据元素<strong>只有同属一个集合</strong>的关系</p>
</li>
<li><p>线性结构：结构中数据元素之间存在<strong>一对一</strong>关系</p>
<ul>
<li>存在唯一一个被称为“第一个”的数据元素</li>
<li>存在唯一一个被称为“最后一个”的数据元素</li>
<li>除第一个外，每个数据元素均只有一个前驱</li>
<li>除最后一个外，每个数据元素均只有一个后继</li>
</ul>
</li>
<li><p>树型结构：结构中数据元素存在<strong>一对多</strong>关系</p>
</li>
<li><p>图状/网状结构：结构中数据元素存在<strong>多对多</strong>的关系</p>
</li>
</ul>
<h3 id="关系表示"><a href="#关系表示" class="headerlink" title="关系表示"></a>关系表示</h3><blockquote>
<ul>
<li>逻辑结构：数据结构中描述的逻辑关系</li>
<li>物理/存储结构：数据结构在计算机中的表示（映像）</li>
</ul>
</blockquote>
<p>数据元素之间关系在计算机中映像/表示方法/存储结构</p>
<ul>
<li><p>顺序映像：借助元素在存储器中的<strong>相对位置</strong>表示数据元素
之间的逻辑关系</p>
<ul>
<li>需要使用<strong>地址连续的存储单元依次存储</strong>数据元素</li>
<li>所以需要静态分配空间，即给可能数据对象<strong>预分配</strong>空间
，空间不够时只能重新分配</li>
<li>由此得到<strong>顺序存储结构</strong></li>
</ul>
</li>
<li><p>非顺序/链式映像：借助<strong>指示元素</strong>存储地址的指针表示数据
元素之间的逻辑关系</p>
<ul>
<li>可以使用任意存储单元存储数据元素，另外存储一个指示
其直接后继的信息</li>
<li>常用动态分配空间，即在需要创建数据对象时给其分配空间</li>
<li>也可以静态分配空间，使用地址连续的存储单元存储数据
对象，此时指示元素可以是序号</li>
<li>由此得到<strong>链式存储结构</strong></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><em>node</em>：节点，数据元素信息、直接后继元素信息的存储映像</li>
<li>数据域：存储元素信息的域</li>
<li>指针域：存储直接后继位置的域</li>
</ul>
</blockquote>
<h3 id="Data-Type"><a href="#Data-Type" class="headerlink" title="Data Type"></a><em>Data Type</em></h3><p>数据类型：<strong>值的集合</strong>和定义在值集上的<strong>一组操作</strong>的总称</p>
<blockquote>
<ul>
<li><em>atomic data type</em>：原子类型，值不可分解</li>
<li><em>fixed-aggregate data type</em>：固定聚合类型，值由确定数目
  的成分按某种结构组成</li>
<li><em>variable-aggregate data type</em>：可变聚合类型，值的成分
  数目不确定</li>
<li>结构类型：固定、可变聚合类型的统称，值由若干成分按某种
  结构组成，可分解，其成分可以是结构或非结构<blockquote>
<ul>
<li>结构类型可以看作是由一种数据结构和定义在其上的一组
 操作组成</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<ul>
<li>在计算机中，每个处理核心（硬件、软件）都提供了一组原子
类型或结构类型</li>
<li>从硬件角度，引入数据类型是作为<strong>解释计算机内存中信息</strong>
含义的手段</li>
<li>对使用者而言，实现了信息的隐蔽</li>
</ul>
<h4 id="Abtract-Data-Type"><a href="#Abtract-Data-Type" class="headerlink" title="Abtract Data Type"></a><em>Abtract Data Type</em></h4><p><em>ADT</em>：抽象数据类型，一个<strong>数学模型</strong>已经定义在该模型上的
一组操作</p>
<script type="math/tex; mode=display">
Data_Type = (D, S, P)</script><blockquote>
<ul>
<li>$D$：数据对象</li>
<li>$S$：D上的关系集</li>
<li>$P$：对D的基本操作集</li>
</ul>
</blockquote>
<ul>
<li><strong>根据其行为而不是其内部表示</strong>定义类型</li>
<li>实质上与数据类型是同一个概念，“抽象”的意义在于数据类型的
数学抽象特性<ul>
<li>或者说抽象数据类型范畴更广，包括自定义数据类型</li>
</ul>
</li>
<li>抽象层次越高，含有该抽象数据类型的程序复用程度越高</li>
</ul>
<h4 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h4><ul>
<li><p><em>ADT</em>是面向对象编程的核心</p>
</li>
<li><p>将对象行为和其实现相分离，这也是面向对象编程的基本
技术</p>
<ul>
<li><em>simplicity</em>：简单性，隐藏细节方便理解</li>
<li><em>flexibility</em>：灵活性，类通过对外行为被定义，可以
自由改变内部实现</li>
<li><em>security</em>：安全性，扮演防火墙，确保实现、用户彼此
分离</li>
</ul>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:15.000Z" title="3/21/2019, 5:27:15 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-02-28T07:12:54.000Z" title="2/28/2019, 3:12:54 PM">2019-02-28</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a></span><span class="level-item">22 minutes read (About 3353 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/config.html">Python安装配置</a></h1><div class="content"><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><h3 id="Python3包管理安装"><a href="#Python3包管理安装" class="headerlink" title="Python3包管理安装"></a>Python3包管理安装</h3><ul>
<li>CentOS7依赖缺失<ul>
<li><code>zlib-devel</code></li>
<li><code>bzip2-devel</code></li>
<li><code>readline-devel</code></li>
<li><code>openssl-devel</code></li>
<li><code>sqlite(3)-devel</code></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>根据包用途、名称可以确认对应的应用，缺少就是相应
  <code>-devel(-dev)</code></li>
</ul>
</blockquote>
<h3 id="Python-Implementation"><a href="#Python-Implementation" class="headerlink" title="Python Implementation"></a>Python Implementation</h3><p>名称中flag体现该发行版中python特性</p>
<ul>
<li><p><code>-d</code>：with pydebug</p>
</li>
<li><p><code>-m</code>：with pymalloc</p>
</li>
<li><p><code>-u</code>：with wide unicode</p>
</li>
</ul>
<blockquote>
<ul>
<li>pymalloc是specialized object allocator<blockquote>
<ul>
<li>比系统自带的allocator快，且对python项目典型内存
 分配模式有更少的开销</li>
<li>使用c的<code>malloc</code>函数获得更大的内存池</li>
</ul>
</blockquote>
</li>
<li><p>原文：Pymalloc, a specialized object allocator written
  by Vladimir Marangozov, was a feature added to Python2.1.
  Pymalloc is intended to be faster than the system
  malloc() and to have less memory overhead for allocation
  patterns typical of Python programs. The allocator uses
  C’s malloc() function to get large pools of memory and
  then fulfills smaller memory requests from these pools.J</p>
<p> 注意：有时也有可能只是hard link</p>
</li>
</ul>
</blockquote>
<h2 id="Python配置"><a href="#Python配置" class="headerlink" title="Python配置"></a>Python配置</h2><h3 id="Python相关环境变量"><a href="#Python相关环境变量" class="headerlink" title="Python相关环境变量"></a>Python相关环境变量</h3><ul>
<li><code>PYTHONPATH</code>：python库查找路径</li>
<li><code>PYTHONSTARTUP</code>：python自动执行脚本</li>
</ul>
<h3 id="自动补全"><a href="#自动补全" class="headerlink" title="自动补全"></a>自动补全</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> readline</span><br><span class="line"><span class="keyword">import</span> rlcompleter</span><br><span class="line">	<span class="comment"># 为自动补全`rlcompleter`不能省略</span></span><br><span class="line"><span class="keyword">import</span> atexit</span><br><span class="line">readline.parse_and_bind(<span class="string">&quot;tab:complete&quot;</span>)</span><br><span class="line">	<span class="comment"># 绑定`&lt;tab&gt;`为自动补全</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	readline.read_history(<span class="string">&quot;/path/to/python_history&quot;</span>)</span><br><span class="line">		<span class="comment"># 读取上次存储的python历史</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line">atexit.register(</span><br><span class="line">	readline.write_history_file,</span><br><span class="line">	<span class="string">&quot;/path/to/python_history&quot;</span></span><br><span class="line">)</span><br><span class="line">	<span class="comment"># 将函数注册为推出python环境时执行</span></span><br><span class="line">	<span class="comment"># 将python历史输入存储在的自定以文件中</span></span><br><span class="line">	<span class="comment"># 这部分存储、读取历史其实不必要</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> readline, rlcompleter</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>每次</strong>在python解释器中<strong>执行</strong>生效</p>
</li>
<li><p>保存为文件<code>python_startup.py</code>，将添加到环境变量
<code>PYTHONSTARTUP</code>中，每次开启python自动执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> .bashrc</span></span><br><span class="line">export PYTHONSTARTUP=pythonstartup.py</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 这个不能像*PATH一样添加多个文件，只能由一个文件</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Pip"><a href="#Pip" class="headerlink" title="Pip"></a>Pip</h2><p>python包、依赖管理工具</p>
<ul>
<li><p>pip包都是源码包 </p>
<ul>
<li>需要在安装时编译，因此可能在安装时因为系统原因出错</li>
<li>现在有了<code>wheels</code>也可以安装二进制包</li>
</ul>
</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li>编译安装python一般包括<code>pip</code>、<code>setuptools</code></li>
<li>系统自带python无<code>pip</code>时，可用<code>apt</code>、<code>yum</code>等工具可以直接安装</li>
<li>虚拟python环境，无般法使用系统包管理工具安装pip，则只能
下载<code>pip</code>包使用<code>setuptools</code>安装</li>
</ul>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>配置文件：<code>~/.config/pip/pip.conf</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = https:?//pypi.tuna.tsinghua.edu.cn/simple/</span><br><span class="line">	# pypi源地址</span><br><span class="line">format = columns</span><br><span class="line">	# pip list输出格式（legacy，columns）</span><br></pre></td></tr></table></figure>
<h3 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h3><p>pip通过纯文本文件（一般命名为<code>requirements.txt</code>）来记录、
管理python项目依赖</p>
<ul>
<li><code>$ pip freeze</code>：按照<code>package_name=version</code>的格式输出
已安装包
<code>$ pip install -r</code>：可按照指定文件（默认<code>requirements.txt</code>）
安装依赖</li>
</ul>
<h2 id="Virtualenv-Venv"><a href="#Virtualenv-Venv" class="headerlink" title="Virtualenv/Venv"></a>Virtualenv/Venv</h2><p>虚拟python环境管理器，使用<code>pip</code>直接安装</p>
<ul>
<li>将多个项目的python依赖隔离开，避免多个项目的包依赖、
python版本冲突</li>
<li>包依赖可以安装在项目处，避免需要全局安装python包的权限
要求、影响</li>
</ul>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><p><code>$ virtualenv venv-dir</code>复制python至创建虚拟环境的文件夹中，
<code>$ source venv-dir/bin/activate</code>即激活虚拟环境，修改系统环境
变量，把python、相关的python包指向当前虚拟环境夹</p>
<h3 id="Virtualenv使用"><a href="#Virtualenv使用" class="headerlink" title="Virtualenv使用"></a>Virtualenv使用</h3><h2 id="Pyenv"><a href="#Pyenv" class="headerlink" title="Pyenv"></a>Pyenv</h2><p>python版本管理器，包括各种python发行版</p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>不需要事先安装python</p>
<ul>
<li><p>从github获取pyenv：<a href="git://github.com/yyuu/pyenv.git">git://github.com/yyuu/pyenv.git</a></p>
</li>
<li><p>将以下配置写入用户配置文件（建议是<code>.bashrc</code>)，也可以在
shell里面直接执行以暂时使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PYENV_ROOT=&quot;$HOME/pyenv路径&quot;</span><br><span class="line">export PATH=&quot;$PYENV_ROOT/bin:$PATH&quot;</span><br><span class="line">eval &quot;$(pyenv init -)&quot;</span><br></pre></td></tr></table></figure>
<p>以上配置可参见<code>home_config/bashrc_addon</code>，以项目详情为准</p>
</li>
</ul>
<h3 id="Pyenv安装Python发行版问题"><a href="#Pyenv安装Python发行版问题" class="headerlink" title="Pyenv安装Python发行版问题"></a>Pyenv安装Python发行版问题</h3><p>使用pyenv安装python时一般是从<code>PYTHON_BUILD_MIRROR_URL</code>表示
的地址下载安装文件（或者说整个系统都是从这个地址下载），缺省
是<a target="_blank" rel="noopener" href="http://pypi.python.org">http://pypi.python.org</a>，但国内很慢</p>
<pre><code>#todo
</code></pre><ul>
<li>设置这个环境变量为国内的镜像站，如
<a target="_blank" rel="noopener" href="http://mirrors.sohu.com/python">http://mirrors.sohu.com/python</a>，但这个好像没用</li>
<li>在镜像站点下载安装包，放在<code>pyenv/cache</code>文件夹下（没有就
新建）</li>
</ul>
<p>pyenv安装python时和使用一般安装应用一样，只是安装prefix不是
<code>/usr/bin/</code>之类的地方，而是pyenv安装目录，因此pyenv编译安装
python也需要先安装依赖</p>
<h3 id="实现原理-1"><a href="#实现原理-1" class="headerlink" title="实现原理"></a>实现原理</h3><h4 id="修改-PATH环境变量"><a href="#修改-PATH环境变量" class="headerlink" title="修改$PATH环境变量"></a>修改<code>$PATH</code>环境变量</h4><ul>
<li>用户配置文件将<code>PYENV_ROOT/bin</code>放至<code>$PATH</code>首位</li>
<li>初始化pyenv时会将<code>PYENV_ROOT/shims</code>放至$PATH首位</li>
</ul>
<p><code>shims</code>、<code>bin</code>放在最前，优先使用pyenv中安装的命令</p>
<ul>
<li><p><code>bin</code>中包含的是pyenv自身命令（还有其他可执行文件，但是
无法直接执行?）</p>
</li>
<li><p><code>shims</code>则包含的是<strong>所有</strong>已经安装python组件</p>
<ul>
<li><p>包括python、可以执行python包、无法直接执行的python包</p>
</li>
<li><p>这些组件是内容相同的脚本文件，仅名称是pyenv所有安装
的python包</p>
<ul>
<li>用于截取python相关的命令</li>
<li>并根据设置python发行版做出相应的反应</li>
<li>因此命令行调用安装过的python包，pyenv会给提示
即使不是安装在当前python环境中</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>因此一般将命令放在<code>.profile</code>文件中，这样每次登陆都会设置好
pyenv放在<code>.bashrc</code>中会设置两次（没有太大关系）</p>
<h4 id="使用指定Python发行版"><a href="#使用指定Python发行版" class="headerlink" title="使用指定Python发行版"></a>使用指定Python发行版</h4><ul>
<li><p><code>$ pyenv local py-version</code>指定是在文件夹下生成
<code>.python-version</code>文件，写明python版本</p>
</li>
<li><p>所有的python相关的命令都被shims中的脚本文件截取</p>
</li>
</ul>
<p>pyenv应该是逐层向上查找<code>.python-version</code>文件，查找到文件则
按照相应的python发行版进行执行，否则按global版本</p>
<h2 id="Conda"><a href="#Conda" class="headerlink" title="Conda"></a>Conda</h2><p>通用包管理器</p>
<ul>
<li><p>管理任何语言、类型的软件</p>
<ul>
<li><p>conda默认可以从<a target="_blank" rel="noopener" href="http://repo.continuum.io">http://repo.continuum.io</a>安装<strong>已经
编译好</strong>二进制包</p>
</li>
<li><p>conda包和pip包只是<strong>部分</strong>重合，有些已安装conda包
甚至无法被pip侦测到（非python脚本包）</p>
</li>
<li><p>python本身也作为conda包被管理</p>
</li>
</ul>
</li>
<li><p>创建、管理虚拟python环境（包括python版本）</p>
</li>
</ul>
<h3 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h3><ul>
<li><p>conda在Miniconda，Anaconda发行版中默认安装</p>
<ul>
<li><p>Miniconda是只包括conda的发行版，没有Anaconda中默认
包含的包丰富</p>
</li>
<li><p>在其他的发行版中可以直接使用pip安装，但是这样安装的
conda功能不全，可能无法管理包</p>
</li>
</ul>
</li>
<li><p>Miniconda、Anaconda安装可以自行设置安装位置，无需介怀</p>
</li>
</ul>
<h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><p>conda配置文件为<code>$HOME/.condarc</code>，其中可以设置包括源在内
    配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">channels:</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line">  - defaults</span><br><span class="line">show_channel_urls: true</span><br></pre></td></tr></table></figure>
<h4 id="添加国内源"><a href="#添加国内源" class="headerlink" title="添加国内源"></a>添加国内源</h4><p>conda源和pypi源不同（以下为清华源配置，当然可以直接修改
配置文件）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda config --<span class="built_in">set</span> show_channel_urls yes</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>conda源不是pypi源，不能混用</li>
</ul>
</blockquote>
<h4 id="Win平台设置"><a href="#Win平台设置" class="headerlink" title="Win平台设置"></a>Win平台设置</h4><ul>
<li><p>添加菜单项</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 可用于恢复菜单项</span></span><br><span class="line">$ <span class="built_in">cd</span> /path/to/conda_root</span><br><span class="line">$ python .\Lib\_nsis.py mkmenus</span><br></pre></td></tr></table></figure>
</li>
<li><p>VSCode是通过查找、执行<code>activate.bat</code>激活虚拟环境</p>
<ul>
<li>所以若虚拟环境中未安装<code>conda</code>（无<code>activate.bat</code>）
则虚拟环境无法自动激活</li>
</ul>
</li>
</ul>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> conda create [--<span class="built_in">clone</span> ori_env] -n env [packages[packages]]</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 创建虚拟环境</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> python也是conda包，可指定`python=x.x`</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda remove -n env --all</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 删除虚拟环境</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda info -e</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda env list</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 列出虚拟环境</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda info</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 列出conda配置</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda activate env</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 激活env环境</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda deactivate</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 退出当前环境</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda list -n env</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 列出env环境/当前环境安装conda包</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda search package</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 搜索包</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda install [-n env] packages</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> env环境/当前环境安装conda包</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda update [-n env] packages</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> env环境/当前环境升级conda包</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda remove [-n env] packages</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> env环境/当前环境移除包</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>使用conda而不是pip安装包更合适，方便管理</li>
</ul>
</blockquote>
<ul>
<li>创建新环境时，默认不安装任何包，包括<code>pip</code>，此时切换到
虚拟环境后，<code>pip</code>等命令都是默认环境的命令</li>
</ul>
<h2 id="Pipenv"><a href="#Pipenv" class="headerlink" title="Pipenv"></a>Pipenv</h2><p>pip、virtualenv、Pipfile（版本控制）功能的综合，事实上就
依赖于pip、virtualenv（功能封装）</p>
<ul>
<li><code>$ pipenv sync/install</code>替代<code>$ pip install</code></li>
<li><code>$ pipenv shell</code>替代<code>$ activate</code></li>
<li><code>$ pipenv run</code>甚至可以不用激活虚拟环境运行某些命令</li>
<li><code>Pipfile</code>控制dev、release包管理，<code>Pipfile.lock</code>锁定包依赖</li>
</ul>
<h3 id="安装-3"><a href="#安装-3" class="headerlink" title="安装"></a>安装</h3><ul>
<li>使用pip直接安装</li>
<li>系统安装源里有pipenv，也可以用系统包管理工具安装</li>
</ul>
<h3 id="实现原理-2"><a href="#实现原理-2" class="headerlink" title="实现原理"></a>实现原理</h3><h4 id="Python版本"><a href="#Python版本" class="headerlink" title="Python版本"></a>Python版本</h4><p>pipenv和virtualenv一样指定python版本也需要已经安装该python
版本</p>
<ul>
<li><p><code>$PATH</code>中的路径无法寻找到相应的python版本就需要手动
指定</p>
</li>
<li><p>不是有版本转换，将当前已安装版本通过类似2to3的“中
间层”转换为目标版本</p>
</li>
</ul>
<h4 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h4><p>pipenv会在<code>~/.local/share/virtualenv</code>文件夹下为所有的虚拟
python环境生成文件夹</p>
<ul>
<li><p>文件夹名字应该是“虚拟环境文件夹名称-文件夹全路径hash”</p>
</li>
<li><p>包括已安装的python包和python解释器</p>
</li>
<li><p>结构和virtualenv的内容类似，但virtualenv是放在项目目录下</p>
</li>
<li><p><code>$ python shell</code>启动虚拟环境就是以上文件夹路径放在
<code>$PATH</code>最前</p>
</li>
</ul>
<h4 id="依赖管理-1"><a href="#依赖管理-1" class="headerlink" title="依赖管理"></a>依赖管理</h4><p>pipenv通过Pipfile管理依赖（环境）</p>
<ul>
<li><p>默认安装：<code>$ pipenv install pkg</code></p>
<ul>
<li><p>作为默认包依赖安装pkg，并记录于<code>Pipfile</code>文件
<code>[packages]</code>条目下</p>
</li>
<li><p>相应的<code>$ pipenv install</code>则会根据<code>Pipfile</code>文件
<code>[packages]</code>条目安装默认环境包依赖</p>
</li>
</ul>
</li>
<li><p>开发环境安装：<code>$ pipenv install --dev pkg</code></p>
<ul>
<li><p>作为开发环境包依赖安装pkg，并记录于<code>Pipfile</code>
文件<code>[dev-packages]</code>条目下</p>
</li>
<li><p>相应的<code>$ pipenv intall --dev</code>则会根据<code>Pipfile</code>
文件中<code>[dev-packages]</code>安装开发环境包依赖</p>
</li>
</ul>
</li>
</ul>
<h4 id="Pipfile和Pipfile-lock"><a href="#Pipfile和Pipfile-lock" class="headerlink" title="Pipfile和Pipfile.lock"></a>Pipfile和Pipfile.lock</h4><ul>
<li><code>Pipfile</code>中是包依赖<strong>可用（install时用户指定）</strong>版本</li>
<li><code>Pipfile.lock</code>则是包依赖<strong>具体</strong>版本<ul>
<li>是pipenv安装包依赖时具体安装的版本，由安装时包源的
决定</li>
<li><code>Pipfile.lock</code>中甚至还有存储包的hash值保证版本一致</li>
<li><code>Pipfile</code>是用户要求，<code>Pipfile.lock</code>是实际情况</li>
</ul>
</li>
</ul>
<p>因此</p>
<ul>
<li><p><code>$ pipenv install/sync</code>优先依照<code>Pipfile.lock</code>安装具体
版本包，即使有更新版本的包也满足<code>Pipfile</code>的要求</p>
</li>
<li><p><code>Pipfile</code>和<code>Pipfile.lock</code>是同时更新、内容“相同”，
而不是手动锁定且手动更新<code>Pipfile</code>，再安装包时会默认更新
<code>Pipfile.lock</code></p>
</li>
</ul>
<h3 id="Pipenv用法"><a href="#Pipenv用法" class="headerlink" title="Pipenv用法"></a>Pipenv用法</h3><p>详情<a target="_blank" rel="noopener" href="https://docs.pipenv.org">https://docs.pipenv.org</a></p>
<h4 id="创建新环境"><a href="#创建新环境" class="headerlink" title="创建新环境"></a>创建新环境</h4><p>具体查看<code>$pipenv --help</code>，只是记住<code>$pipenv --site-packages</code>
表示虚拟环境可以共享系统python包</p>
<h4 id="默认环境和开发环境切换"><a href="#默认环境和开发环境切换" class="headerlink" title="默认环境和开发环境切换"></a>默认环境和开发环境切换</h4><p>pipenv没有像git那样的切换功能</p>
<ul>
<li>默认环境“切换”为dev环境：<code>$ pipenv install --dev</code></li>
<li>dev环境“切换”为默认环境：<code>$ pipenv uninstall --all-dev</code></li>
</ul>
<h4 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h4><p><code>$ pipenv sync</code></p>
<p>官方是说从<code>Pipfile.lock</code>读取包依赖安装，但是手动修改<code>Pipfile</code>
后<code>$ pipenv sync</code>也会先更新<code>Pipfile.lock</code>，然后安装包依赖，
感觉上和<code>$ pipenv install</code>差不多</p>
<h3 id="Pipenv特性"><a href="#Pipenv特性" class="headerlink" title="Pipenv特性"></a>Pipenv特性</h3><h4 id="和Pyenv的配合"><a href="#和Pyenv的配合" class="headerlink" title="和Pyenv的配合"></a>和Pyenv的配合</h4><p>pipenv可以找到pyenv已安装的python发行版，且不是通过<code>$PATH</code>
中<code>shims</code>获得实际路径</p>
<ul>
<li><p>pipenv能够找到pyenv实际安装python发行版的路径versions，
而不是脚本目录<code>shims</code></p>
</li>
<li><p>pipenv能自行找到pyenv安装的python发行版，即使其当时没有
被设置为local或global</p>
<ul>
<li><p>pyenv已安装Anaconda3和3.6并指定local为3.6的情况下
<code>$ pipenv --three</code>生成的虚拟python使用Anaconda3</p>
</li>
<li><p>后系统全局安装python34，无local下<code>pipenv --three</code>
仍然是使用Aanconda3</p>
</li>
<li><p>后注释pyenv的初始化命令重新登陆，<code>pipenv --three</code>就
使用python34</p>
</li>
</ul>
</li>
</ul>
<p>目前还是无法确定pipenv如何选择python解释器，但是根据以上测试
和github上的feature介绍可以确定的是和pyenv命令有关</p>
<p>pipenv和pyenv一起使用可以出现一些很蠢的用法，比如：pyenv指定
的local发行版中安装pipenv，然后用这pipenv可以将目录设置为
另外版本虚拟python环境（已经系统安装或者是pyenv安装）</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>除了以上的包管理、配置工具，系统包管理工具也可以看作是python
的包管理工具</p>
<ul>
<li>事实上conda就可以看作是pip和系统包管理工具的交集</li>
<li>系统python初始没有pip一般通过系统包管理工具安装</li>
</ul>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>优先级：pip &gt; conda &gt; 系统包管理工具</p>
<ul>
<li>纯python库优先使用pip安装，需要额外编译的库使用conda</li>
<li>conda源和系统源都有的二进制包，优先conda，版本比较新</li>
</ul>
<h4 id="2018-04-06经验"><a href="#2018-04-06经验" class="headerlink" title="2018/04/06经验"></a>2018/04/06经验</h4><p>最后最合适的多版本管理是安装pipenv</p>
<ul>
<li><p>系统一般自带python2.7，所以用系统包管理工具安装一个
python3</p>
</li>
<li><p>使用新安装的python3安装pipenv，因为系统自带的python2.7
安装的很多包版过低</p>
</li>
<li><p>最后如果对python版本要求非常严格</p>
<ul>
<li>还可以再使用pyenv安装其他版本</li>
<li>然后仅手动启用pyenv用于指示pipenv使用目标python版本</li>
</ul>
</li>
</ul>
<h4 id="2019-02-20经验"><a href="#2019-02-20经验" class="headerlink" title="2019/02/20经验"></a>2019/02/20经验</h4><p>直接全局（如<code>/opt/miniconda</code>）安装Miniconda也是很好的选择</p>
<ul>
<li>由conda管理虚拟环境，虚拟环境创建在用户目录下，登陆时
激活</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:15.000Z" title="3/21/2019, 5:27:15 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-02T08:02:58.000Z" title="8/2/2021, 4:02:58 PM">2021-08-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/Twists/">Twists</a></span><span class="level-item">2 minutes read (About 256 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/Twists/twists.html">Python注意事项</a></h1><div class="content"><h2 id="Python原生数据结构"><a href="#Python原生数据结构" class="headerlink" title="Python原生数据结构"></a>Python原生数据结构</h2><h3 id="list"><a href="#list" class="headerlink" title="list"></a><code>list</code></h3><ul>
<li><p>方法</p>
<ul>
<li><code>==</code>：<code>list</code> 的 <code>==</code> 是逐值比较</li>
<li><code>__contains__</code>：方法中使用 <code>==</code> 比较元素<ul>
<li><code>in</code> 判断列表包含时也是逐值比较</li>
</ul>
</li>
</ul>
</li>
<li><p>迭代技巧</p>
<ul>
<li>需要修改列表元素时尽量不直接迭代列表，考虑<ul>
<li>新建列表存储元素值</li>
<li>迭代列表下标</li>
</ul>
</li>
<li>迭代过程会更改列表元素数量时<ul>
<li>使用 <code>.pop</code> 方法</li>
<li>确定迭代数量</li>
</ul>
</li>
</ul>
</li>
<li><p>运算注意</p>
<ul>
<li><code>.append</code>：直接修改原列表，不返回</li>
<li><code>.extend</code>：直接修改原列表，不返回</li>
<li><code>__add__</code>：返回新列表</li>
</ul>
</li>
</ul>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><ul>
<li>勿使用列表、字典等指针类型作为默认参数，否则函数重入结果很可能出现问题<ul>
<li>原因：函数体中任何对参数的修改都会被保留</li>
<li>替代方式：<code>None</code> + 函数体内判断</li>
</ul>
</li>
</ul>
<h3 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h3><ul>
<li>需要多次迭代时，应该将迭代器转换为可重复迭代数据结构，如：列表<ul>
<li>迭代器值会被消耗</li>
</ul>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:15.000Z" title="3/21/2019, 5:27:15 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-02-17T03:57:08.000Z" title="2/17/2019, 11:57:08 AM">2019-02-17</time></span><span class="level-item"><a class="link-muted" href="/categories/Rust/">Rust</a></span><span class="level-item">a minute read (About 119 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Rust/command_line.html">Rust 程序设计笔记</a></h1><div class="content"><h2 id="参数、环境变量"><a href="#参数、环境变量" class="headerlink" title="参数、环境变量"></a>参数、环境变量</h2><ul>
<li><p><code>std::env::args()</code>：返回所有参数的一个迭代器，第一参数
是可执行文件，包含任何无效<code>unicode</code>字符将<code>panic!</code>，</p>
<p>   args: Vec<String> = std::env::args().collect()</p>
</li>
<li><p><code>std::env::var(&quot;env_var&quot;)</code>：获取设置的环境变量值，返回
一个Result</p>
<ul>
<li>环境变量设置时返回包含其的Ok成员</li>
<li>未设置时返回Err成员</li>
</ul>
<p>设置“环境变量”并执行程序：<code>$&gt;ENV_NAME=val cargo run</code></p>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:15.000Z" title="3/21/2019, 5:27:15 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-07-19T01:18:54.000Z" title="7/19/2021, 9:18:54 AM">2021-07-19</time></span><span class="level-item"><a class="link-muted" href="/categories/Daily-Life/">Daily Life</a><span> / </span><a class="link-muted" href="/categories/Daily-Life/Maxism/">Maxism</a></span><span class="level-item">17 minutes read (About 2587 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Daily-Life/Maxism/marxism.html">马恩的社会主义观</a></h1><div class="content"><ul>
<li>生产资料：社会所有制、公有制</li>
<li>经济运行方式：消灭商品货币关系，实行有组织的计划生产</li>
<li>分配方式：实行按劳分配</li>
<li>阶级与国家：消灭了阶级和阶级差别，消灭了作为阶级统治工具的国家</li>
</ul>
<p>对于斯大林和现实中国的社会主义观与马列的社会注意观之间的差异，
做出符合现实与逻辑的、一以贯之的解释</p>
<ul>
<li>既是理论对我们提出的挑战，</li>
<li>也是社会建设的实践要求剋人
因此这个问题的回答，或者说正确解决这个矛盾，就具有重要的理论
意义和实践意义</li>
</ul>
<p>在资本主义社会和共产主义社会之间，有一个从前者转变为后者
的个命转变时期，同这个时期相适应的也有一个政治上的过渡时期，
这个时期的国家，只能是国产阶级的革命专政</p>
<h2 id="社会主义初级阶段"><a href="#社会主义初级阶段" class="headerlink" title="社会主义初级阶段"></a>社会主义初级阶段</h2><ul>
<li>社会性质，已经是社会主义了</li>
<li>还处于社会主义社会初级阶段，还没有根本摆脱贫穷落后的不发达状态</li>
<li>实际上处于马克思讲的从资本主义社会向社会主义社会过渡时期，
是过渡时期中的一个比较初级的阶段</li>
</ul>
<h2 id="重新定位社会主义初级阶段的意义"><a href="#重新定位社会主义初级阶段的意义" class="headerlink" title="重新定位社会主义初级阶段的意义"></a>重新定位社会主义初级阶段的意义</h2><ul>
<li>可以消除现实与马列理论间的诸多矛盾，端正被扭曲的马克思主义
理论与社会主义形象</li>
<li>在实践中脚踏实地，从当代中国现实国情触发，探索具有中国特色
的通向社会主义的道路，更好的沿着社会主义方向前进</li>
</ul>
<h2 id="邓小平"><a href="#邓小平" class="headerlink" title="邓小平"></a>邓小平</h2><ul>
<li>社会主义初级阶段最根本任务就是发展生产力，社会主义的优越性
归根结底就是体现在他的生产力比资本主义发展得更快一些、更高
一些，</li>
<li>改革都是为了一个目的，就是扫除发展社会生产力障碍</li>
<li>对内搞活了经济，是活了社会主义，没有伤害社会主义的本质，因为
从政治上讲，我们的国家机器是社会主义性质得， 有能力保障
社会主义制度，从经济上讲，我国的社会主义经济在工业、农业、
商业和其他方面已经建立相当坚实的基础</li>
<li>社会主义的目的就是要全国人民共同富裕，不是两极分化。如果我们
的政策导致了两级分化，我们就失败了；如果产生了什么新的资产
阶级，那么我们就整的走了邪路了</li>
<li>公有制占主体，共同富裕，是我们必须坚持的社会主义根本原则</li>
</ul>
<p>概括</p>
<ul>
<li>要发展生产力</li>
<li>要坚持公有制和按劳分配为主体</li>
<li>走共同富裕道路，防止出现两极分化</li>
<li>坚持四项基本原则</li>
<li>市场与计划都是手段，利用资本主义发展社会主义</li>
<li>用三个有利于的标准衡量改革开放的成就</li>
</ul>
<h2 id="社会主义本质"><a href="#社会主义本质" class="headerlink" title="社会主义本质"></a>社会主义本质</h2><p>解放生产力，发展生产力，消灭剥削，消除两极分化，最终达到共同富裕</p>
<ul>
<li>在高于特征的层次上，在目标和目的的层次上揭示了社会主义
的内在要求</li>
<li>突出生产力的基础地位，是对社会主义的具有时代特征的新认识</li>
<li>突出了社会主义的目的共同富裕</li>
<li>在动态中描述了社会主义的本质</li>
</ul>
<h2 id="社会主义的根本任务：发展生产力"><a href="#社会主义的根本任务：发展生产力" class="headerlink" title="社会主义的根本任务：发展生产力"></a>社会主义的根本任务：发展生产力</h2><ul>
<li>理论上：发展生产力是马克思主义的基本原则</li>
<li>实践上：是解决社会主义初级阶段主要矛盾的要求</li>
<li>前途上：是巩固社会主义制度、增强社会主义吸引力，
向共产主义过渡的根本途径</li>
</ul>
<h2 id="生产力与社会主义关系"><a href="#生产力与社会主义关系" class="headerlink" title="生产力与社会主义关系"></a>生产力与社会主义关系</h2><ul>
<li><p>阶级斗争和社会革命并不同工业发达程度、生产力发展水平成正比，
经验的研究似乎是，它只在大工业的发展时期的一定阶段才有可能</p>
</li>
<li><p>共产主义个命将在一切文明国家里同时发生，就这些文明国家而言，
由于资本主义发展不均衡，生产力发展水平也是有区别的</p>
</li>
<li><p>革命的发生、完成要区别开来，受资本主义大生产和世界市场的
存在，发生革命的先后次序，并不单纯取决于一国的生产力发展水平</p>
</li>
<li><p>开始革命，走上社会主义道路，可以不经过资本主义充分发展的阶段，
但是完成革命，实现社会主义乃至共产主义，则非有生产力的巨大
发展不可</p>
</li>
<li><p>人类社会发展规律不可改变，资本主义虽然不能避免，但是资本
主义制度可以避免，可以缩短，过渡阶段就是对资本主义阶段的补课
，对经济文化落后国家，问题是如何发展、利用、节制资本主义</p>
</li>
</ul>
<h2 id="毛思中的社会主义理论"><a href="#毛思中的社会主义理论" class="headerlink" title="毛思中的社会主义理论"></a>毛思中的社会主义理论</h2><ul>
<li>在一个经济文化比较落后的国家，在新民主主义革命胜利后，如何
过渡到社会主义</li>
<li>在社会主义改造完成之后，如何进行社会主义建设</li>
</ul>
<h2 id="准备过渡—-gt-开始过渡"><a href="#准备过渡—-gt-开始过渡" class="headerlink" title="准备过渡—-&gt;开始过渡"></a>准备过渡—-&gt;开始过渡</h2><ul>
<li><p>已经开始执行社会主义革命的任务</p>
<ul>
<li>没收官僚资本，建立社会主义性质的国营经济<ul>
<li>只有没收了占比80%的官僚资本，才能对20%的民族资本
采取和平的方式，逐步进行社会主义改造</li>
</ul>
</li>
<li>开始引导私人资本主义经济走国家资本主义的道路<ul>
<li>赎买：为了便于过渡到社会主义，保持极大的生产
组织是很重要的</li>
<li>民族资产阶级有两面性，是内部矛盾
为什么接受</li>
<li>社会主义力量增长，政权在手中</li>
<li>社会主义性质经济基本控制了国家经济命脉，在国民
经济中处于领导地位和作用</li>
<li>制定了适宜的政策、方法
为什么愿意</li>
<li>政治上，民族资产阶级拥护国家、宪法、共同纲领</li>
<li>经济上，民族资产阶级原因接受国家资本主义、国家的
引导和监督，民族资本的存在对于加速国民经济的恢复
发展有重要作用</li>
<li>历史上，不愿看到同一战线破裂</li>
<li>可以让工人阶级学会如何管理工商业，经营、组织生产</li>
</ul>
</li>
<li>引导个体农民走上了互助合作社的道路</li>
</ul>
</li>
<li><p>新民主主义社会是一个具有过渡性质的社会</p>
</li>
<li><p>这个革命的性质是社会主义革命</p>
<ul>
<li>革命的性质是由社会的主要矛盾决定的</li>
</ul>
</li>
</ul>
<h2 id="过渡时期总路线"><a href="#过渡时期总路线" class="headerlink" title="过渡时期总路线"></a>过渡时期总路线</h2><ul>
<li>主体：国家工业化<ul>
<li>主体？</li>
<li>工业化时生产力发展水平的重要标致</li>
<li>近代中国的两大任务：民族独立和人民解放，国家繁荣富强</li>
</ul>
</li>
<li>两翼：农业、手工业和资本主义工商业的改造</li>
<li>工业化和社会主义改造并举的路线</li>
</ul>
<h2 id="工业化道路"><a href="#工业化道路" class="headerlink" title="工业化道路"></a>工业化道路</h2><ul>
<li><p>资本主义工业化道路走不通</p>
<ul>
<li>民族资本主义脆弱</li>
<li>不满足条件<ul>
<li>有大量人身自由，但丧失了生产资料的无产者存在</li>
<li>大量货币集中在少数人手里</li>
</ul>
</li>
</ul>
</li>
<li><p>社会主义</p>
<ul>
<li>国营经济力量比较强大</li>
<li>民族资本主义经济弱小，不能成为主义依靠力量</li>
<li>对个体农业的社会主义改造，是实现国家工业化的必要条件</li>
<li>国际环境促使中国选择了社会主义</li>
</ul>
</li>
</ul>
<h2 id="国家资本主义"><a href="#国家资本主义" class="headerlink" title="国家资本主义"></a>国家资本主义</h2><p>改造资本主义工商业的过渡形式，不是独立经济形态，性质随国家
性质而转移</p>
<ul>
<li>资本主义制度：资产阶级政府直接产于国家经济生活，通过国有化
或国家预算建设新的企业等办法，使国民经济某些部门、企业转移到
国家手里</li>
<li>社会主义制度：能够加以限制、规定活动范围的资本主义，同国家
联系着</li>
</ul>
<p>三种形式</p>
<ul>
<li>初级：国营经济与资本主义经济在企业外部发生不固定联系</li>
<li>中极：国营经济和资本主义经济在企业外部发生固定联系<ul>
<li>以上仍然资本主义性质，追逐理论最大化</li>
<li>但是和国营经济的密切联系，在一定程度上被纳入国家计划
轨道，限制了剥削</li>
</ul>
</li>
<li>高级：国营经济和资本主义经济在企业内部联系合作、并居于领导
地位，即公私合营经济，包括单个企业和全行业<ul>
<li>社会主义控制企业流通过程、生产过程</li>
<li>私人资本具有资本性质，但是已经失去了独立地位</li>
</ul>
</li>
</ul>
<h2 id="农村社会主义"><a href="#农村社会主义" class="headerlink" title="农村社会主义"></a>农村社会主义</h2><p>农民工体经济：生产资料归农民私有，与个人劳动相结合的半自然经济
或小商品经济</p>
<ul>
<li>生产资料私有—&gt;发展个体经济的积极性—&gt;自发的资本主倾向</li>
<li>以自身劳动去基础，不存在剥削—&gt;互助合作积极性—&gt;
被引导走向社会主义</li>
</ul>
<p>农业合作化</p>
<ul>
<li>限制生产力法渐</li>
<li>分散性、盲目性同国营经济、工业化目标冲突</li>
<li>小农经济不稳定，必然导致农村不稳定</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:15.000Z" title="3/21/2019, 5:27:15 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-02T03:06:34.000Z" title="8/2/2021, 11:06:34 AM">2021-08-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Web/">Web</a><span> / </span><a class="link-muted" href="/categories/Web/Proxy/">Proxy</a></span><span class="level-item">6 minutes read (About 841 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Web/Proxy/pac.html">PAC（Proxy Auto-Config）</a></h1><div class="content"><hr>
<p>pac事实上是一个js脚本，定义如何根据浏览器器访问url不同，
自动选取适当proxy</p>
<h2 id="主函数"><a href="#主函数" class="headerlink" title="主函数"></a>主函数</h2><pre><code>str = function FindProxyForUrl(url, host)&#123;
&#125;
</code></pre><ul>
<li>参数<ul>
<li><code>url</code>：浏览器访问的完整url地址，如：
<code>http://bing.com</code></li>
<li><code>host</code>：url中的host部分<code>bing.com</code></li>
</ul>
</li>
<li><p>返回值：字符串变量，表示应该使用何种”代理“，可以是
以下元素，或者是使用<code>;</code>分隔的多个组合，此时浏览器依次
尝试
（“据说”每隔30min，浏览器就会尝试之前失败的“代理元素”）</p>
<ul>
<li><code>DIRECT</code>：不使用代理，直接连接</li>
<li><code>PORXY host:post</code>：使用指定http代理@host:post</li>
<li><code>SOCKS host:post</code>：使用指定socks代理</li>
<li><code>SOCKS5 host:post</code>：使用指定的socks5代理</li>
</ul>
</li>
</ul>
<p>浏览器在访问每个url时都会调用该函数</p>
<h2 id="可用预定义JS函数"><a href="#可用预定义JS函数" class="headerlink" title="可用预定义JS函数"></a>可用预定义JS函数</h2><h3 id="host、domain、url相关js函数"><a href="#host、domain、url相关js函数" class="headerlink" title="host、domain、url相关js函数"></a>host、domain、url相关js函数</h3><ul>
<li><p><code>bool = isPlainHostName(host)</code>：<code>host</code>不包含域名返回
<code>true</code></p>
<p>   true = isPlainHostName(“www”)
   false = isPlainHostName(“baidu.com”)</p>
</li>
<li><p><code>bool = dnsDomainIs(host, domain)</code>：<code>host</code>和<code>domain</code>相
匹配返回<code>true</code></p>
<p>   true = dnsDomain(“www.google.com”, “.google.com”)
   false = dnsDomain(“www.apple.com”, “.google.com”)</p>
</li>
<li><p><code>bool = localHostOrDomainIs(host,domain)</code> ：<code>host</code>和
<code>domain</code>匹配、<code>host</code>不包含<code>domain</code>返回<code>true</code>（按照函数名
理解）</p>
<p>   true = localHostOrDomainIs(“www.google.com”, “www.google.com”)
   true = localHostOrDomainIs(“www”, “www.google.com”)
   false = localHostOrDomainIs(“www.apple.com”, “www.google.com”)</p>
</li>
<li><p><code>bool = isResolvable(host)</code>：成功解析<code>host</code>返回<code>true</code></p>
</li>
<li><p><code>bool = isInNet(host, pattern, mask)</code>：<code>host</code>处于
<code>pattern</code>指定网段/地址返回<code>true</code>， <code>host</code>如果不是<code>ip</code>
形式，将解析成<code>ip</code>地址后处理；<code>mask</code>指定匹配部分，<code>mask</code>
就是和子网掩码类似</p>
<p>   isinnet(“192.168.3.4”, “192.168.0.0”, “255.255.0.0”) -&gt; true
   isinnet(“192.168.3.4”, “192.168.0.0”, “255.255.255.255”) -&gt; false</p>
</li>
<li><p><code>str = myipaddress()</code>：字符串形式返回本机地址</p>
</li>
<li><p><code>int = dnsdomainlevels(host)</code>：返回<code>host</code>中域名层级数</p>
<p>   0 = dnsdomainlevels(“www”)
   2 = dnsdomainlevels(“www.google.com”)</p>
</li>
<li><p><code>bool = shexpmatch(str, shexp)</code>：<code>str</code>符合<code>shexp</code>
正则表达式返回<code>true</code></p>
<p>   shexpmatch(“www.apple.com/downloads/macosx/index.html”, “<em>/macosx/</em>“) -&gt; true.
   shexpmatch(“www.apple.com/downloads/support/index.html”, “<em>/macosx/</em>“) -&gt; false.</p>
</li>
</ul>
<h3 id="时间相关JS函数"><a href="#时间相关JS函数" class="headerlink" title="时间相关JS函数"></a>时间相关JS函数</h3><ul>
<li><p><code>bool = weekdayrange(wd1, wd2, gmt)</code>：时间处于指定时间段
返回<code>true</code></p>
<p>   weekdayrange(“mon”, “fri”) 星期一到星期五(当地时区)为true
   weekdayrange(“mon”, “fri”, “gmt”) 从格林威治标准时间星期一到星期五为true
   weekdayrange(“sat”) 当地时间星期六为true
   weekdayrange(“sat”, “gmt”) 格林威治标准时间星期六为true
   weekdayrange(“fri”, “mon”) 从星期五到下星期一为true(顺序很重要)</p>
</li>
<li><p><code>bool = daterange(..)</code>：时间处于指定时间段返回<code>true</code>
（包括首尾日期）</p>
<p>   daterange(1) 当地时区每月第一天为true
   daterange(1, “gmt”) gmt时间每月的第一天为true
   daterange(1, 15) 当地时区每月1号到15号为true
   daterange(24, “dec”) 在当地时区每年12月24号为true
   daterange(24, “dec”, 1995) 在当地时区1995年12月24号为true
   daterange(“jan”, “mar”) 当地时区每年第一季度(1月到3月)为true
   daterange(1, “jun”, 15, “aug”) 当地时区每年6月1号到8月15号为true
   daterange(1, “jun”, 15, 1995, “aug”, 1995) 当地时区1995年6月1号到8月15号为true
   daterange(“oct”, 1995, “mar”, 1996) 当地时区1995年10月到1996年3月为true
   daterange(1995) 当地时区1995年为true
   daterange(1995, 1997) 当地时区1995年初到1997年底为true</p>
</li>
<li><p><code>bool = timerange(..)</code>：时间处于指定时间段返回<code>true</code></p>
<p>   timerange(12)中午12点到下午1点之间为true
   timerange(12, 13)同上例
   timerange(12, “gmt”)在gmt时间中午12点到下午1点之间为true
   timerange(9, 17)上午9点到下午5点之间为true
   timerange(8, 30, 17, 00)上午8点30分到下午5点之间为true.
   timerange(0, 0, 0, 0, 0, 30)午夜0点到其后的30秒内为true</p>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:15.000Z" title="3/21/2019, 5:27:15 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-02T03:07:12.000Z" title="8/2/2021, 11:07:12 AM">2021-08-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Web/">Web</a><span> / </span><a class="link-muted" href="/categories/Web/Proxy/">Proxy</a></span><span class="level-item">a few seconds read (About 73 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Web/Proxy/web_proxy.html">Web 代理</a></h1><div class="content"><h2 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h2><ul>
<li>正向代理：模拟client的代理</li>
<li>反向代理：模拟server的代理，通常带有负载均衡，通常不处理
用户数据，也有可能处理静态数据（图片，静态页面等），典型
就是nginx服务器</li>
</ul>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/37/">Previous</a></div><div class="pagination-next"><a href="/page/39/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/37/">37</a></li><li><a class="pagination-link is-current" href="/page/38/">38</a></li><li><a class="pagination-link" href="/page/39/">39</a></li><li><a class="pagination-link" href="/page/40/">40</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithm/"><span class="level-start"><span class="level-item">Algorithm</span></span><span class="level-end"><span class="level-item tag">36</span></span></a><ul><li><a class="level is-mobile" href="/categories/Algorithm/Data-Structure/"><span class="level-start"><span class="level-item">Data Structure</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Heuristic/"><span class="level-start"><span class="level-item">Heuristic</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Issue/"><span class="level-start"><span class="level-item">Issue</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Problem/"><span class="level-start"><span class="level-item">Problem</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Specification/"><span class="level-start"><span class="level-item">Specification</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/C-C/"><span class="level-start"><span class="level-item">C/C++</span></span><span class="level-end"><span class="level-item tag">34</span></span></a><ul><li><a class="level is-mobile" href="/categories/C-C/Cppref/"><span class="level-start"><span class="level-item">Cppref</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/Cstd/"><span class="level-start"><span class="level-item">Cstd</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/MPI/"><span class="level-start"><span class="level-item">MPI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/STL/"><span class="level-start"><span class="level-item">STL</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/CS/"><span class="level-start"><span class="level-item">CS</span></span><span class="level-end"><span class="level-item tag">14</span></span></a><ul><li><a class="level is-mobile" href="/categories/CS/Character/"><span class="level-start"><span class="level-item">Character</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Parallel/"><span class="level-start"><span class="level-item">Parallel</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Program-Design/"><span class="level-start"><span class="level-item">Program Design</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Storage/"><span class="level-start"><span class="level-item">Storage</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Daily-Life/"><span class="level-start"><span class="level-item">Daily Life</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/Daily-Life/Maxism/"><span class="level-start"><span class="level-item">Maxism</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">27</span></span></a><ul><li><a class="level is-mobile" href="/categories/Database/Hadoop/"><span class="level-start"><span class="level-item">Hadoop</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/SQL-DB/"><span class="level-start"><span class="level-item">SQL DB</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/Spark/"><span class="level-start"><span class="level-item">Spark</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/Java/Scala/"><span class="level-start"><span class="level-item">Scala</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">42</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Bash-Programming/"><span class="level-start"><span class="level-item">Bash Programming</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Configuration/"><span class="level-start"><span class="level-item">Configuration</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/File-System/"><span class="level-start"><span class="level-item">File System</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/IPC/"><span class="level-start"><span class="level-item">IPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Process-Schedual/"><span class="level-start"><span class="level-item">Process Schedual</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Shell/"><span class="level-start"><span class="level-item">Shell</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Tool/"><span class="level-start"><span class="level-item">Tool</span></span><span class="level-end"><span class="level-item tag">14</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Tool/Vi/"><span class="level-start"><span class="level-item">Vi</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Model/"><span class="level-start"><span class="level-item">ML Model</span></span><span class="level-end"><span class="level-item tag">21</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Model/Linear-Model/"><span class="level-start"><span class="level-item">Linear Model</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Model-Component/"><span class="level-start"><span class="level-item">Model Component</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Nolinear-Model/"><span class="level-start"><span class="level-item">Nolinear Model</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Unsupervised-Model/"><span class="level-start"><span class="level-item">Unsupervised Model</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/"><span class="level-start"><span class="level-item">ML Specification</span></span><span class="level-end"><span class="level-item tag">17</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/Click-Through-Rate/"><span class="level-start"><span class="level-item">Click Through Rate</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/Click-Through-Rate/Recommandation-System/"><span class="level-start"><span class="level-item">Recommandation System</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/Computer-Vision/"><span class="level-start"><span class="level-item">Computer Vision</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Specification/FinTech/"><span class="level-start"><span class="level-item">FinTech</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/FinTech/Risk-Control/"><span class="level-start"><span class="level-item">Risk Control</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/Graph-Analysis/"><span class="level-start"><span class="level-item">Graph Analysis</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Specification/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Technique/"><span class="level-start"><span class="level-item">ML Technique</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Technique/Feature-Engineering/"><span class="level-start"><span class="level-item">Feature Engineering</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Technique/Neural-Network/"><span class="level-start"><span class="level-item">Neural Network</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Theory/"><span class="level-start"><span class="level-item">ML Theory</span></span><span class="level-end"><span class="level-item tag">11</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Theory/Loss/"><span class="level-start"><span class="level-item">Loss</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Theory/Model-Enhencement/"><span class="level-start"><span class="level-item">Model Enhencement</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Theory/Optimization/"><span class="level-start"><span class="level-item">Optimization</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Algebra/"><span class="level-start"><span class="level-item">Math Algebra</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Algebra/Linear-Algebra/"><span class="level-start"><span class="level-item">Linear Algebra</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Algebra/Universal-Algebra/"><span class="level-start"><span class="level-item">Universal Algebra</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Analysis/"><span class="level-start"><span class="level-item">Math Analysis</span></span><span class="level-end"><span class="level-item tag">23</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Analysis/Fourier-Analysis/"><span class="level-start"><span class="level-item">Fourier Analysis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Functional-Analysis/"><span class="level-start"><span class="level-item">Functional Analysis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Optimization/"><span class="level-start"><span class="level-item">Optimization</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Real-Analysis/"><span class="level-start"><span class="level-item">Real Analysis</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Mixin/"><span class="level-start"><span class="level-item">Math Mixin</span></span><span class="level-end"><span class="level-item tag">18</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Mixin/Statistics/"><span class="level-start"><span class="level-item">Statistics</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Mixin/Time-Series/"><span class="level-start"><span class="level-item">Time Series</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Probability/"><span class="level-start"><span class="level-item">Probability</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">89</span></span></a><ul><li><a class="level is-mobile" href="/categories/Python/Cookbook/"><span class="level-start"><span class="level-item">Cookbook</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Jupyter/"><span class="level-start"><span class="level-item">Jupyter</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Keras/"><span class="level-start"><span class="level-item">Keras</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Matplotlib/"><span class="level-start"><span class="level-item">Matplotlib</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Numpy/"><span class="level-start"><span class="level-item">Numpy</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Pandas/"><span class="level-start"><span class="level-item">Pandas</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Py3Ref/"><span class="level-start"><span class="level-item">Py3Ref</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Py3std/"><span class="level-start"><span class="level-item">Py3std</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Pywin32/"><span class="level-start"><span class="level-item">Pywin32</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Readme/"><span class="level-start"><span class="level-item">Readme</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/TensorFlow/"><span class="level-start"><span class="level-item">TensorFlow</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Twists/"><span class="level-start"><span class="level-item">Twists</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/RLang/"><span class="level-start"><span class="level-item">RLang</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Rust/"><span class="level-start"><span class="level-item">Rust</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Set/"><span class="level-start"><span class="level-item">Set</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/"><span class="level-start"><span class="level-item">Tool</span></span><span class="level-end"><span class="level-item tag">13</span></span></a><ul><li><a class="level is-mobile" href="/categories/Tool/Editor/"><span class="level-start"><span class="level-item">Editor</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Markup-Language/"><span class="level-start"><span class="level-item">Markup Language</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Web-Browser/"><span class="level-start"><span class="level-item">Web Browser</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Windows/"><span class="level-start"><span class="level-item">Windows</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Web/"><span class="level-start"><span class="level-item">Web</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/Web/CSS/"><span class="level-start"><span class="level-item">CSS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/NPM/"><span class="level-start"><span class="level-item">NPM</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/Proxy/"><span class="level-start"><span class="level-item">Proxy</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/Thrift/"><span class="level-start"><span class="level-item">Thrift</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="UBeaRLy"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">UBeaRLy</p><p class="is-size-6 is-block">Protector of Proxy</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Earth, Solar System</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">392</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">93</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">522</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/xyy15926" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/xyy15926"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-04T15:07:54.896Z">2021-08-04</time></p><p class="title"><a href="/uncategorized/README.html"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T07:46:51.000Z">2021-08-03</time></p><p class="title"><a href="/Web/NPM/hexo_config.html">Hexo 建站</a></p><p class="categories"><a href="/categories/Web/">Web</a> / <a href="/categories/Web/NPM/">NPM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T02:32:45.000Z">2021-08-03</time></p><p class="title"><a href="/Web/NPM/config.html">NPM 总述</a></p><p class="categories"><a href="/categories/Web/">Web</a> / <a href="/categories/Web/NPM/">NPM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-02T08:11:11.000Z">2021-08-02</time></p><p class="title"><a href="/Python/Py3std/internet_data.html">互联网数据</a></p><p class="categories"><a href="/categories/Python/">Python</a> / <a href="/categories/Python/Py3std/">Py3std</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-29T13:55:00.000Z">2021-07-29</time></p><p class="title"><a href="/Linux/Shell/sh_apps.html">Shell 应用程序</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Shell/">Shell</a></p></div></article></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5385776267343559" data-ad-slot="6995841235" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="UBeaRLy" height="28"></a><p class="is-size-7"><span>&copy; 2021 UBeaRLy</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/xyy15926/proxy"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>