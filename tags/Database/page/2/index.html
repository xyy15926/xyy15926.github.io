<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: Database - UBeaRLy</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="UBeaRLy&#039;s Proxy"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="UBeaRLy&#039;s Proxy"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="UBeaRLy"><meta property="og:url" content="https://xyy15926.github.io/"><meta property="og:site_name" content="UBeaRLy"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://xyy15926.github.io/img/og_image.png"><meta property="article:author" content="UBeaRLy"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://xyy15926.github.io"},"headline":"UBeaRLy","image":["https://xyy15926.github.io/img/og_image.png"],"author":{"@type":"Person","name":"UBeaRLy"},"publisher":{"@type":"Organization","name":"UBeaRLy","logo":{"@type":"ImageObject","url":"https://xyy15926.github.io/img/logo.svg"}},"description":""}</script><link rel="alternate" href="/atom.xml" title="UBeaRLy" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/darcula.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><script data-ad-client="pub-5385776267343559" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="follow_it-verification-code" content="SVBypAPPHxjjr7Y4hHfn"><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="UBeaRLy" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Visit on GitHub" href="https://github.com/xyy15926/proxy"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">Database</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-07-09T16:48:33.000Z" title="7/10/2019, 12:48:33 AM">2019-07-10</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-07-09T16:48:33.000Z" title="7/10/2019, 12:48:33 AM">2019-07-10</time></span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a><span> / </span><a class="link-muted" href="/categories/Database/SQL-DB/">SQL DB</a></span><span class="level-item">6 minutes read (About 859 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Database/SQL-DB/sql_grammer.html">SQL语法</a></h1><div class="content"><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>			<span class="operator">&lt;</span>field<span class="operator">&gt;</span>, <span class="keyword">DISTINCT</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">INTO</span>			<span class="operator">&lt;</span>new_tbl<span class="operator">&gt;</span> [<span class="keyword">IN</span> <span class="operator">&lt;</span>other_db<span class="operator">&gt;</span>]</span><br><span class="line"><span class="keyword">FROM</span>			<span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">WHERE</span>			<span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>OP<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span><span class="operator">/</span><span class="operator">&lt;</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span>		<span class="operator">&lt;</span>field<span class="operator">&gt;</span> [<span class="keyword">ASC</span><span class="operator">/</span><span class="keyword">DESC</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>		<span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>[<span class="operator">&lt;</span>field<span class="operator">&gt;</span>]</span><br><span class="line"><span class="keyword">VALUES</span>			(<span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span>);</span><br><span class="line"></span><br><span class="line">UPDATE			<span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">SET</span>				<span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">=</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">WHERE</span>			<span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>OP<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span><span class="operator">/</span><span class="operator">&lt;</span>field<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">FROM</span>			<span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">WHERE</span>			<span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>OP<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span><span class="operator">/</span><span class="operator">&lt;</span>field<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="数据库、表、索引、视图"><a href="#数据库、表、索引、视图" class="headerlink" title="数据库、表、索引、视图"></a>数据库、表、索引、视图</h3><h4 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE <span class="operator">&lt;</span>db_name<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>(</span><br><span class="line">	<span class="operator">&lt;</span>field<span class="operator">&gt;</span>		<span class="operator">&lt;</span>dtype<span class="operator">&gt;</span>,</span><br><span class="line">	<span class="operator">&lt;</span>field<span class="operator">&gt;</span>		<span class="operator">&lt;</span>dtype<span class="operator">&gt;</span>		<span class="operator">&lt;</span>CSTRT<span class="operator">&gt;</span>,					<span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line">	<span class="operator">&lt;</span>CSTRT<span class="operator">&gt;</span>		(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,),								<span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line">	<span class="keyword">CONSTRAINT</span> [<span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>] <span class="operator">&lt;</span>cstrt<span class="operator">&gt;</span> (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)		<span class="operator">!</span><span class="comment">-- common</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX <span class="operator">&lt;</span>index_name<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ON</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span> (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>);</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 创建视图</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> <span class="operator">&lt;</span>view_name<span class="operator">&gt;</span> <span class="keyword">AS</span></span><br><span class="line"><span class="operator">&lt;</span>select_expr<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h5 id="自增字段"><a href="#自增字段" class="headerlink" title="自增字段"></a>自增字段</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">IDENTITY</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> AUTO_INCREMENT</span><br><span class="line"><span class="operator">!</span><span class="comment">-- ORACLE：创建自增序列，调用`.nextval`方法获取下个自增值</span></span><br><span class="line"><span class="keyword">CREATE</span> SEQUENCE <span class="operator">&lt;</span>seq<span class="operator">&gt;</span></span><br><span class="line">MINVALUE <span class="operator">&lt;</span>min<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">WITH</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span></span><br><span class="line">INCREMENT <span class="keyword">BY</span> <span class="operator">&lt;</span>step<span class="operator">&gt;</span></span><br><span class="line">CACHE <span class="operator">&lt;</span>cache<span class="operator">&gt;</span>				<span class="operator">!</span><span class="comment">-- 提高性能</span></span><br></pre></td></tr></table></figure>
<h4 id="丢弃"><a href="#丢弃" class="headerlink" title="丢弃"></a>丢弃</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 丢弃索引</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>.<span class="operator">&lt;</span>index_name<span class="operator">&gt;</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- ORACLE</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX <span class="operator">&lt;</span>index_name<span class="operator">&gt;</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX <span class="operator">&lt;</span>index_name<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 丢弃表/数据</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>;</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 丢弃数据库</span></span><br><span class="line"><span class="keyword">DROP</span> DATABASE <span class="operator">&lt;</span>db_name<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 丢弃视图</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> <span class="operator">&lt;</span><span class="keyword">view</span><span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 添加列</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 删除列</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 修改类型</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h3><h4 id="TOP"><a href="#TOP" class="headerlink" title="TOP"></a><em>TOP</em></h4><ul>
<li>MSSQL：<code>SELECT TOP &lt;num&gt;/&lt;num&gt; PERCENT *</code></li>
<li>MYSQL：<code>LIMIT &lt;num&gt;</code></li>
<li>ORACLE：<code>WHERE ROWNUM &lt;= &lt;num&gt;</code></li>
</ul>
<h4 id="Alias"><a href="#Alias" class="headerlink" title="Alias"></a><em>Alias</em></h4><ul>
<li><code>AS</code>：指定行、列别名</li>
</ul>
<h4 id="Join"><a href="#Join" class="headerlink" title="Join"></a><em>Join</em></h4><ul>
<li><code>[INNER] JOIN</code></li>
<li><code>LEFT JOIN</code></li>
<li><code>RIGHT JOIN</code></li>
<li><code>FULL JOIN</code></li>
</ul>
<h4 id="Union"><a href="#Union" class="headerlink" title="Union"></a><em>Union</em></h4><ul>
<li><code>UNION</code>：合并<code>SELECT</code>结果集<ul>
<li>要求结果集中列数量、类型必须相同</li>
</ul>
</li>
</ul>
<h4 id="NULL"><a href="#NULL" class="headerlink" title="NULL"></a><em>NULL</em></h4><ul>
<li><code>IS [NOT] NULL</code>：比较是否为<code>NULL</code>值</li>
</ul>
<blockquote>
<ul>
<li>比较符无法测试<code>NULL</code>值</li>
</ul>
</blockquote>
<h3 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h3><h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><ul>
<li><code>=</code>：有些方言可以使用<code>==</code></li>
<li><code>&lt;&gt;</code>：有些方言可以使用<code>!=</code></li>
<li><code>&gt;</code></li>
<li><code>&lt;</code></li>
<li><code>&gt;=</code></li>
<li><code>&lt;=</code></li>
<li><code>BETWEEN &lt;value&gt; AND &lt;value&gt;</code></li>
<li><code>[NOT] IN (&lt;value&gt;)</code></li>
<li><code>[NOT] LIKE &lt;pattern&gt;</code><ul>
<li><code>%</code>：匹配0个、多个字符</li>
<li><code>_</code>：匹配一个字符</li>
<li><code>[&lt;char&gt;]</code>：字符列中任意字符</li>
<li><code>^[&lt;char&gt;]/[!&lt;char&gt;]</code>：非字符列中任意字符</li>
</ul>
</li>
</ul>
<h4 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h4><ul>
<li><code>AND</code></li>
<li><code>OR</code></li>
</ul>
<h4 id="符号-1"><a href="#符号-1" class="headerlink" title="符号"></a>符号</h4><ul>
<li><code>&#39;</code>：SQL中使用单引号包括文本值<ul>
<li>大部分方言也支持<code>&quot;</code>双引号</li>
</ul>
</li>
</ul>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><h4 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h4><div class="table-container">
<table>
<thead>
<tr>
<th>TEXT类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CHAR([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>VARCHAR([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>TINYTEXT</code></td>
<td></td>
</tr>
<tr>
<td><code>LONGTEXT</code></td>
<td></td>
</tr>
<tr>
<td><code>MEDIUMITEXT</code></td>
<td></td>
</tr>
<tr>
<td><code>BLOB</code></td>
<td></td>
</tr>
<tr>
<td><code>MEDIUMBLOB</code></td>
<td></td>
</tr>
<tr>
<td><code>LONGBLOB</code></td>
<td></td>
</tr>
<tr>
<td><code>ENUM(&lt;val_list&gt;)</code></td>
<td></td>
</tr>
<tr>
<td><code>SET</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>NUMBER类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>TINYINT([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>SMALLINT([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>MEDIUMINT([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>INT([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>BIGINT([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>FLOAT([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>DOUBLE([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>DECIMAL([&lt;size&gt;])</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>DATE类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DATE()</code></td>
<td></td>
</tr>
<tr>
<td><code>DATETIME()</code></td>
<td></td>
</tr>
<tr>
<td><code>TIMSTAMP()</code></td>
<td></td>
</tr>
<tr>
<td><code>TIME()</code></td>
<td></td>
</tr>
<tr>
<td><code>YEAR()</code></td>
</tr>
</tbody>
</table>
</div>
<h4 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h4><div class="table-container">
<table>
<thead>
<tr>
<th>ASCII类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CHAR([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>VARCHAR([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>TEXT</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>UNICODE类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CHAR([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>VARCHAR([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>text</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>BINARY类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bit</code></td>
<td></td>
</tr>
<tr>
<td><code>binary([&lt;n&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>varbinary([&lt;n&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>image</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>NUMBER类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>TINYINT</code></td>
<td></td>
</tr>
<tr>
<td><code>SMALLINT</code></td>
<td></td>
</tr>
<tr>
<td><code>MEDIUMINT</code></td>
<td></td>
</tr>
<tr>
<td><code>INT</code></td>
<td></td>
</tr>
<tr>
<td><code>BIGINT</code></td>
<td></td>
</tr>
<tr>
<td><code>DECIMAL(p, s)</code></td>
<td></td>
</tr>
<tr>
<td><code>FLOAT([&lt;n&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>REAL</code></td>
<td></td>
</tr>
<tr>
<td><code>SMALLMONEY</code></td>
<td></td>
</tr>
<tr>
<td><code>MONEY</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>DATE类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DATETIME</code></td>
<td></td>
</tr>
<tr>
<td><code>DATETIME2</code></td>
<td></td>
</tr>
<tr>
<td><code>SMALLDATETIME</code></td>
<td></td>
</tr>
<tr>
<td><code>DATE</code></td>
<td></td>
</tr>
<tr>
<td><code>TIME</code></td>
<td></td>
</tr>
<tr>
<td><code>DATETIMEOFFSET</code></td>
<td></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h3><ul>
<li><p>建表时添加约束</p>
<ul>
<li>MSSQL、ORACLE：可直接在字段声明后添加约束</li>
<li>MySQL：需独立指定约束</li>
</ul>
</li>
<li><p>向已有表添加约束</p>
<ul>
<li>可以添加匿名、具名约束</li>
<li>MSSQL、ORACLE：有<code>COLUMN</code>关键字</li>
</ul>
</li>
<li><p>删除约束</p>
<ul>
<li>MySQL：使用约束关键字指定</li>
<li>MSSQL、ORACLE：使用<code>CONSTRAINT</code>关键字指定</li>
</ul>
</li>
</ul>
<h4 id="NOT-NULL"><a href="#NOT-NULL" class="headerlink" title="NOT NULL"></a><code>NOT NULL</code></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>
<h4 id="DEFAULT"><a href="#DEFAULT" class="headerlink" title="DEFAULT"></a><code>DEFAULT</code></h4><p><code>DEFAULT</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 建表</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">DEFAULT</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 已有表添加</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 删除</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br></pre></td></tr></table></figure>
<h4 id="UNIQUE"><a href="#UNIQUE" class="headerlink" title="UNIQUE"></a><code>UNIQUE</code></h4><p><code>UNIQUE</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 建表</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> [<span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>] <span class="keyword">UNIQUE</span> (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">UNIQUE</span> [KEY] [<span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>] (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">UNIQUE</span></span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 已有表添加</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">UNIQUE</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span> <span class="keyword">UNIQUE</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,);</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 删除</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABlE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="PRIMARY-KEY"><a href="#PRIMARY-KEY" class="headerlink" title="PRIMARY KEY"></a><code>PRIMARY KEY</code></h4><p><code>PRIMARY KEY</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 建表</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> [<span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>] <span class="keyword">PRIMARY</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MYSQL</span></span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">PRIMARY</span> KEY</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 已有表添加</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span> <span class="keyword">PRIMARY</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,);</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 删除</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="FOREIGN-KEY"><a href="#FOREIGN-KEY" class="headerlink" title="FOREIGN KEY"></a><code>FOREIGN KEY</code></h4><p><code>FOREIGN KEY</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 建表</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> [<span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>] <span class="keyword">FOREIGN</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="keyword">REFERENCES</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MYSQL</span></span><br><span class="line"><span class="keyword">FOREIGN</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="keyword">REFERENCES</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">FOREIGN</span> KEY</span><br><span class="line"><span class="keyword">REFERENCES</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 已有表添加</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="keyword">REFERENCES</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span> <span class="keyword">FOREIGN</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="keyword">REFERENCES</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>);</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 删除</span></span><br><span class="line"><span class="operator">!</span><span class="operator">-</span>  MySQL</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="CHECK"><a href="#CHECK" class="headerlink" title="CHECK"></a><code>CHECK</code></h4><p><code>CHECK</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 建表</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> [<span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>] <span class="keyword">CHECK</span>(<span class="operator">&lt;</span><span class="keyword">condition</span><span class="operator">&gt;</span>)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">CHECK</span> (<span class="keyword">condition</span>)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">CHECK</span>(<span class="operator">&lt;</span><span class="keyword">condition</span><span class="operator">&gt;</span>)</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 已有表添加</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CHECK</span> (<span class="keyword">condition</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span> <span class="keyword">CHECK</span> (<span class="keyword">condition</span>);</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 删除</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CHECK</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="内建函数"><a href="#内建函数" class="headerlink" title="内建函数"></a>内建函数</h2><h3 id="Date"><a href="#Date" class="headerlink" title="Date"></a><em>Date</em></h3><ul>
<li><p>MySQL</p>
<ul>
<li><code>NOW()</code></li>
<li><code>CURDATE()</code></li>
<li><code>CURTIME()</code></li>
<li><code>DATE()</code></li>
<li><code>EXTRACT()</code></li>
<li><code>DATE_ADD()</code></li>
<li><code>DATE_SUB()</code></li>
<li><code>DATE_DIFF()</code></li>
<li><code>DATE_FORMAT()</code></li>
</ul>
</li>
<li><p>MSSQL</p>
<ul>
<li><code>GETDATE()</code></li>
<li><code>DATEPART()</code></li>
<li><code>DATEADD()</code></li>
<li><code>DATEDIFF()</code></li>
<li><code>CONVERT()</code></li>
</ul>
</li>
</ul>
<h3 id="NULL-1"><a href="#NULL-1" class="headerlink" title="NULL"></a><em>NULL</em></h3><ul>
<li><p>MSSQL</p>
<ul>
<li><code>ISNULL(&lt;field&gt;, &lt;replacement&gt;)</code></li>
</ul>
</li>
<li><p>ORACLE</p>
<ul>
<li><code>NVL(&lt;field&gt;, &lt;repalcement&gt;)</code></li>
</ul>
</li>
<li><p>MySQL</p>
<ul>
<li><code>IFNULL(&lt;field&gt;, &lt;replacement&gt;)</code></li>
<li><code>COALESCE(&lt;field&gt;, &lt;replacement&gt;)</code></li>
</ul>
</li>
</ul>
<h3 id="Aggregate聚集函数"><a href="#Aggregate聚集函数" class="headerlink" title="Aggregate聚集函数"></a><em>Aggregate</em>聚集函数</h3><h3 id="Scalar"><a href="#Scalar" class="headerlink" title="Scalar"></a><em>Scalar</em></h3></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-07-09T16:48:32.000Z" title="7/10/2019, 12:48:32 AM">2019-07-10</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-07-16T09:16:06.000Z" title="7/16/2021, 5:16:06 PM">2021-07-16</time></span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a><span> / </span><a class="link-muted" href="/categories/Database/Hadoop/">Hadoop</a></span><span class="level-item">11 minutes read (About 1679 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Database/Hadoop/hive.html">Hive</a></h1><div class="content"><h2 id="Hive简介"><a href="#Hive简介" class="headerlink" title="Hive简介"></a>Hive简介</h2><p>Hive是Hadoop平台上的数据仓库，面向结构化数据分析</p>
<ul>
<li><p>将<strong>结构化</strong>数据文件映射为一张<strong>数据库表</strong></p>
</li>
<li><p>提供完整的SQL查询功能，所用语言称为HiveQL</p>
<ul>
<li>Hive将HiveQL转换为MapReduce作业，在hadoop平台运行</li>
<li>Hive相当于一个在hadoop平台上的SQL Shell</li>
<li>方便用户使用HiveQL快速实现简单数据分析、统计，而不必
开发专用MapReduce程序，学习成本低</li>
</ul>
</li>
<li><p>相较于传统关系数据库，Hive具有如下特点</p>
<p>||Hive|传统关系型数据库|
|———|———|———-|
|数据存储|HDFS分布式文件系统|服务器本地文件系统|
|查询处理|MapReduce计算模型|自行设计的查询处理模型|
|应用场景|海量数据分析处理|高性能查询，实时性好|
|数据更新|不支持对具体数据行修改，只能覆盖、追加|支持|
|事务处理|不支持|支持|
|索引支持|不支持，一般需要对数据进行全部扫描|支持，多种索引|
|扩展能力|基于Hadoop平台，存储、计算强大的扩展能力|扩展性较差|
|数据加载|Writing Time Schema：数据加载时无需进行模式检查，在读取数据时对数据以一定模式进行解释|Reading Time Schema：要求数据必须符合数据库表结构|</p>
</li>
</ul>
<h3 id="Hive服务端组件"><a href="#Hive服务端组件" class="headerlink" title="Hive服务端组件"></a>Hive服务端组件</h3><h4 id="Driver"><a href="#Driver" class="headerlink" title="Driver"></a>Driver</h4><p>负责将用户的编写的HiveQL查询语句进行解析、编译、优化、生成
执行计划，然后调用底层MapReduce计算模型执行，包括</p>
<ul>
<li>Compiler：编译器</li>
<li>Optimizer：优化器</li>
<li>Executor：执行器</li>
</ul>
<h4 id="MetaStore"><a href="#MetaStore" class="headerlink" title="MetaStore"></a>MetaStore</h4><p>元信息管理器，对Hive正确运行举足轻重</p>
<ul>
<li><p>MetaStore实际上就是Thrift服务</p>
<ul>
<li>MetaStore客户端（hive、spark shell等）和服务端通过
thrift协议进行通信</li>
<li>客户端通过连接metastore服务，实现对元数据的存取</li>
<li>通过Thrift获取元数据，屏蔽了访问MetaStore Database
所需的驱动、url、用户名、密码等细节</li>
</ul>
</li>
<li><p>负责存储元数据在关系型数据库（称为MetaStore Database）</p>
<ul>
<li>元数据包括Hive创建的database、table等元信息</li>
<li>支持的关系型数据库<ul>
<li>Derby：Apache旗下Java数据库</li>
<li>MySQL</li>
</ul>
</li>
</ul>
</li>
<li><p>MetaStore服务可以独立运行，可以让多个客户端同时连接、
甚至安装到远程服务器集群，保持Hive运行的健壮性</p>
</li>
</ul>
<h5 id="Embedded-Metastore-Server-Database-Derby"><a href="#Embedded-Metastore-Server-Database-Derby" class="headerlink" title="Embedded Metastore Server(Database Derby)"></a>Embedded Metastore Server(Database Derby)</h5><p>内嵌模式：使用内嵌的Derby数据库存储元数据</p>
<ul>
<li>不需要额外起Metastore服务</li>
<li>一次只能一个客户端连接，使用做实验，不适合生产环境</li>
<li>Derby默认会在调用hive命令所在目录的<code>metastore_db</code>文件中
持久化元数据</li>
</ul>
<p><img src="/imgs/embeded_metastore_database.png" alt="embeded_metastore_database"></p>
<h5 id="Local-Metastore-Server"><a href="#Local-Metastore-Server" class="headerlink" title="Local Metastore Server"></a>Local Metastore Server</h5><p>本地元存储</p>
<ul>
<li><p>采用外部数据库，支持</p>
<ul>
<li>MySQL</li>
<li>Postgres</li>
<li>Orcale</li>
<li>MSSQL</li>
</ul>
</li>
<li><p>数据库独立于hive部署，hive服务使用JDBC访问元数据，多个
服务可以同时进行</p>
</li>
<li><p>本地元存储不需要单独起metastore服务，用的是跟hive在同一
进程metastore服务</p>
</li>
</ul>
<p><img src="/imgs/local_metastore_server.png" alt="local_metastore_server"></p>
<h5 id="Remote-Metastore-Server"><a href="#Remote-Metastore-Server" class="headerlink" title="Remote Metastore Server"></a>Remote Metastore Server</h5><p>远程元存储</p>
<ul>
<li><p>类似于本地元存储，只是需要单独启动metastore服务，和hive
运行在不同的进程（甚至主机）中</p>
</li>
<li><p>需要在每个客户端配置文件配置连接到该metastore服务</p>
<ul>
<li>hive通过thrift访问metastore</li>
</ul>
</li>
<li><p>此模式可以控制到数据库的连接</p>
</li>
</ul>
<p><img src="/imgs/remote_metastore_server.png" alt="remote_metastore_server"></p>
<h4 id="hiveserver2"><a href="#hiveserver2" class="headerlink" title="hiveserver2"></a>hiveserver2</h4><p>基于的Thrift RPC实现</p>
<ul>
<li><p>远程客户端可以通过hiveserver2执行对hive的查询并返回结果</p>
<ul>
<li>支持多客户端并发、身份验证</li>
</ul>
</li>
<li><p>可以使用JDBC、ODBC、Thrift连接hiveserver2（Thrift Server
特性）</p>
</li>
<li><p>hiveserver2也能访问元数据，不依赖于metastore服务</p>
</li>
</ul>
<h3 id="Hive客户端组件"><a href="#Hive客户端组件" class="headerlink" title="Hive客户端组件"></a>Hive客户端组件</h3><h4 id="CLI"><a href="#CLI" class="headerlink" title="CLI"></a>CLI</h4><p>Command Line Interface</p>
<ul>
<li>允许用户交互式的使用Hive</li>
</ul>
<h4 id="THrift-Client-beeline"><a href="#THrift-Client-beeline" class="headerlink" title="THrift Client/beeline"></a>THrift Client/beeline</h4><p>基于Thrift的JDBC Client</p>
<ul>
<li>包括JDBC/ODBC驱动程序</li>
</ul>
<h4 id="WEB-GUI"><a href="#WEB-GUI" class="headerlink" title="WEB GUI"></a>WEB GUI</h4><p>允许用户通过WEB GUI图形界面访问Hive</p>
<ul>
<li>需要首先启动Hive Web Interface服务</li>
</ul>
<h2 id="Hive查询处理"><a href="#Hive查询处理" class="headerlink" title="Hive查询处理"></a>Hive查询处理</h2><h3 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h3><ol>
<li>用户提交HQL至Driver</li>
<li>Driver把查询交给Compiler，Compiler使用MetaStore中元信息
检查、编译</li>
<li>查询经过Optimizer优化交由Executor Engine执行，转换为
MapReduce作业后调用MapReduce执行</li>
<li>MapReduce存取HDFS，对数据进行处理，查询结果返回Driver</li>
</ol>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><ul>
<li><p>基础数据类型</p>
<ul>
<li>Integer</li>
<li>Float</li>
<li>Double</li>
<li>String</li>
</ul>
</li>
<li><p>复杂数据类型：通过嵌套表达复杂类型</p>
<ul>
<li>Map</li>
<li>List</li>
<li>Struct</li>
</ul>
</li>
<li><p>还允许用户自定以类型、函数扩展系统</p>
</li>
</ul>
<h3 id="数据存储模型"><a href="#数据存储模型" class="headerlink" title="数据存储模型"></a>数据存储模型</h3><p>使用传统数据库：Table、Row、Column、Partition等概念，易于
理解</p>
<h4 id="Database"><a href="#Database" class="headerlink" title="Database"></a>Database</h4><p>相当于关系型数据库中的Namespace</p>
<ul>
<li>将不同用户数据隔离到不同的数据库、模式中</li>
</ul>
<h4 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h4><p>表格</p>
<ul>
<li><p>逻辑上由存储的数据、描述数据格式的相关元数据组成</p>
<ul>
<li>表格数据存放在分布式文件系统（HDFS）中</li>
<li>元数据存储在MetaStore服务指定关系型数据库中</li>
</ul>
</li>
<li><p>创建表格、加载数据之前，表格在HDFS中就是一个目录，
表格分为两种类型</p>
<ul>
<li>托管表：数据文件存放在Hive数据仓库中，即HDFS中的一个
目录，是Hive数据文件默认存放路径</li>
<li>外部表：数据文件<strong>可以</strong>存放在其他文件系统中</li>
</ul>
</li>
</ul>
<h4 id="Partition"><a href="#Partition" class="headerlink" title="Partition"></a>Partition</h4><p>根据“分区列”的值，对表格数据进行粗略划分的极值</p>
<ul>
<li><p>存储上：是Hive中表格主目录的子目录，名字即为定义的分区列
名字</p>
</li>
<li><p>逻辑上：分区不是表中的实际字段，是虚拟列</p>
<ul>
<li>根据虚拟列（可能包含多个实际字段）划分、存储表格数据</li>
<li>同一虚拟列中字段通常应该经常一起被查询，这样在需要
存取部分数据字段时，可以只扫描部分表</li>
</ul>
</li>
</ul>
<h4 id="Bucket"><a href="#Bucket" class="headerlink" title="Bucket"></a>Bucket</h4><p>Table、Partition都是目录级别的数据拆分，指定Bucket的表格，
数据文件将按照规律拆分成多个文件</p>
<ul>
<li><p>每个桶就是table、partition目录中的文件</p>
</li>
<li><p>一般使用Hash函数实现数据分桶，创建表时，需要指定桶数量、
分桶操作依据的列</p>
</li>
<li><p>用户执行Sample查询时，Hive可以使用分桶信息，有效的Prune
Data，如：对每个目录下单个桶文件进行查询</p>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-05-25T11:55:48.000Z" title="5/25/2019, 7:55:48 PM">2019-05-25</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-02T09:30:14.000Z" title="8/2/2021, 5:30:14 PM">2021-08-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a></span><span class="level-item">23 minutes read (About 3403 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Database/optimizer_physical.html">物理查询优化</a></h1><div class="content"><h2 id="查询代价估算"><a href="#查询代价估算" class="headerlink" title="查询代价估算"></a>查询代价估算</h2><h3 id="代价模型"><a href="#代价模型" class="headerlink" title="代价模型"></a>代价模型</h3><p>代价估计模型：基于CPU代价、IO代价</p>
<script type="math/tex; mode=display">\begin{align*}
总代价 &= IO代价 + CPU代价 \\
COST &= P * CPUTimePerPage + W * T
\end{align*}</script><blockquote>
<ul>
<li>$P$：计划访问的页面数</li>
<li>$CPUTimePerPage$：读取每个页面的时间花费</li>
<li>$T$：访问的元组数，索引扫描应包括索引读取花费<blockquote>
<ul>
<li>反映CPU代价，因为访问页面上的元组需要解析元组结构，
 消耗CPU</li>
</ul>
</blockquote>
</li>
<li>$W$：<em>selectivity</em>，选择率/权重因子，表明IO、CPU的相关性</li>
</ul>
</blockquote>
<h3 id="Selectivity"><a href="#Selectivity" class="headerlink" title="Selectivity"></a><em>Selectivity</em></h3><p>选择率：在关系R中，满足<strong>条件</strong><code>A &lt;cond_op&gt; a</code>的元组数R和
所有元组数N的比值</p>
<ul>
<li>在CBO中占有重要地位</li>
<li>其精确程度直接影响最优计划的选择</li>
</ul>
<h4 id="估计方法"><a href="#估计方法" class="headerlink" title="估计方法"></a>估计方法</h4><ul>
<li><p><em>Non-Parametric Method</em>：非参方法，使用ad-hoc数据结构、
直方图维护属性值分布</p>
</li>
<li><p><em>Parametric Method</em>：参数方法，使用预先估计的分布函数
逼近真实分布</p>
</li>
<li><p><em>Curve Fitting</em>：曲线拟合法，使用多项式函数、最小标准差
逼近属性值分布</p>
</li>
<li><p><em>Sampling</em>：抽样法，从数据库中抽取部分元组，针对样本进行
查询，收集统计数据</p>
<ul>
<li>需要足够多样本被测试才能达到足够精度</li>
</ul>
</li>
<li><p>综合法</p>
</li>
</ul>
<h2 id="单表扫描算法"><a href="#单表扫描算法" class="headerlink" title="单表扫描算法"></a>单表扫描算法</h2><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><h2 id="两表联接算法"><a href="#两表联接算法" class="headerlink" title="两表联接算法"></a>两表联接算法</h2><h1 id="todo"><a href="#todo" class="headerlink" title="todo"></a>todo</h1><h3 id="Nested-Loop"><a href="#Nested-Loop" class="headerlink" title="Nested Loop"></a><em>Nested Loop</em></h3><p>嵌套循环联接算法：扫描外表，读取记录根据<code>join</code>字段上的
<strong>索引</strong>去内表中查询</p>
<ul>
<li>适合场景<ul>
<li>外表记录较少（&lt;1w）</li>
<li>内表已经创建索引、性能较好</li>
<li>inner、left outer、left semi、left antisemi join</li>
</ul>
</li>
</ul>
<h4 id="嵌套循环联接算法"><a href="#嵌套循环联接算法" class="headerlink" title="嵌套循环联接算法"></a>嵌套循环联接算法</h4><ul>
<li>搜索时扫描整个表、索引</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> each row R1 in the outer table:</span><br><span class="line">	<span class="keyword">for</span> each row R2 in the inner table:</span><br><span class="line">		<span class="keyword">if</span> R1 join with R2:</span><br><span class="line">			<span class="keyword">return</span> (R1, R2)</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>外部循环逐行消耗外部输入表，当其数据量很大时可以并行扫描
  内表</li>
<li>内表被外表驱动：内部循环为每个外部行执行，在内表中搜索
  匹配行</li>
</ul>
</blockquote>
<h4 id="基于块嵌套循环联接算法"><a href="#基于块嵌套循环联接算法" class="headerlink" title="基于块嵌套循环联接算法"></a>基于块嵌套循环联接算法</h4><ul>
<li>每次IO申请以“块”为单位尽量读入多个页面</li>
<li>改进获取元组的方式</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> each chunk c1 of t1</span><br><span class="line">	<span class="keyword">if</span> c1 <span class="keyword">not</span> in memory:</span><br><span class="line">		read chunk c1 to memory</span><br><span class="line">	<span class="keyword">for</span> each row r1 in chunk c1:</span><br><span class="line">		<span class="keyword">for</span> each chunk c2 of t2:</span><br><span class="line">			<span class="keyword">if</span> c2 <span class="keyword">not</span> in memory:</span><br><span class="line">				read chunk c2 into memory</span><br><span class="line">			<span class="keyword">for</span> each row r2 in c2:</span><br><span class="line">				<span class="keyword">if</span> r1 join with r2:</span><br><span class="line">					<span class="keyword">return</span>(R1, R2)</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>内存循环最后一个块使用后作为下次循环循环使用的第一个块
  可以节省一次IO</li>
</ul>
</blockquote>
<h4 id="索引嵌套循环联接算法"><a href="#索引嵌套循环联接算法" class="headerlink" title="索引嵌套循环联接算法"></a>索引嵌套循环联接算法</h4><ul>
<li>索引嵌套循环连结：在内表中搜索时使用索引，可以加快联接
速度</li>
<li>临时索引嵌套循环连结：为查询临时生成索引作为查询计划的
一部分，查询完成后立刻将索引破坏</li>
</ul>
<h3 id="Sort-Merge-Join"><a href="#Sort-Merge-Join" class="headerlink" title="(Sort)Merge Join"></a><em>(Sort)Merge Join</em></h3><p>排序归并联接算法</p>
<ul>
<li>适合场景<ul>
<li>联接字段已经排序，如B+树索引</li>
<li>inner、left outer、left semi、left anti semi、
right outer、right semi、right anti semi join、union</li>
<li>等值、非等值联接，除<code>!=/&lt;&gt;</code></li>
</ul>
</li>
</ul>
<h4 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h4><ul>
<li><p>确保两个关联表都是按照关联字段进行排序</p>
<ul>
<li>若关联字段已经有排序一致的可用索引，可以利用索引直接
进行merge join操作</li>
<li>否则先对关联字段进行排序，表过大无法一次载入内存时
需要分块载入</li>
</ul>
</li>
<li><p>从每个表分别取记录开始匹配（升序）</p>
<ul>
<li>若符合关联条件，放入结果集</li>
<li>否则丢关联字段较小记录，取对应表中下条记录继续
匹配，直到整个循环结束</li>
<li>对于多对join，通常需要使用临时表进行操作<h1 id="todo-1"><a href="#todo-1" class="headerlink" title="todo"></a>todo</h1></li>
</ul>
</li>
</ul>
<h3 id="Hash-Join"><a href="#Hash-Join" class="headerlink" title="Hash Join"></a><em>Hash Join</em></h3><p>哈希联接：利用Hash Match联接</p>
<ul>
<li><p>HJ处理代价非常高，是服务器内存、CPU头号杀手，需要对数据
进行分区时，还会造成大量异步磁盘I/O，避免大数据的HJ，
尽量转化为高效的SMJ、NLJ</p>
<ul>
<li>表结构设计：冗余字段</li>
<li>索引调整设计</li>
<li>SQL优化</li>
<li>冗余表：静态表存储统计结果</li>
</ul>
</li>
<li><p>类似任何hash算法，内存小、数据偏斜严重时，散列冲突会比较
严重，此时应该考虑使用NIJ</p>
</li>
<li><p>适合场景</p>
<ul>
<li>两表数据量相差非常大</li>
<li>对CPU消耗明显，需要CPU资源充足</li>
<li>只适合（不）等值查询</li>
</ul>
</li>
</ul>
<h4 id="In-Memory-Hash-Join"><a href="#In-Memory-Hash-Join" class="headerlink" title="In-Memory Hash Join"></a><em>In-Memory Hash Join</em></h4><p><img src="/imgs/db_hash_join.png" alt="db_hash_join"></p>
<h5 id="build阶段"><a href="#build阶段" class="headerlink" title="build阶段"></a><em>build</em>阶段</h5><p>以操作涉及字段为hash key构造hash表</p>
<ul>
<li><p>从构造输入表中取记录，使用hash函数生成hash值</p>
</li>
<li><p>hash值对应hash表中的buckets，若一个hash值对应多个桶，
则使用链表将联接桶</p>
</li>
<li><p>构造输入表处理完毕之后，其中记录都被桶关联</p>
</li>
</ul>
<blockquote>
<ul>
<li>build表构建的hash表需要频繁访问，最好能全部加载在内存中
  ，因此尽量选择小表，避免使用GHJ</li>
</ul>
</blockquote>
<h5 id="probe阶段"><a href="#probe阶段" class="headerlink" title="probe阶段"></a><em>probe</em>阶段</h5><ul>
<li><p>从探测输入中取记录，使用同样hash函数生成hash值</p>
</li>
<li><p>根据hash值，在构造阶段构造的hash表中搜索对应桶</p>
</li>
</ul>
<blockquote>
<ul>
<li>为避免冲突，bucket可能会联接到其他bucket，探测操作
  会搜索整个冲突链上的buckets查找匹配记录</li>
</ul>
</blockquote>
<h5 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h5><p>以下操作内部实现其实都是hash join，只是对应算符不同而已</p>
<ul>
<li><p>join操作</p>
<ul>
<li>使用join字段计算hash值</li>
<li>使用<strong>顶端输入</strong>构造hash表，<strong>底端输入</strong>进行探测</li>
<li>按照联接类型规定的模式输出（不）匹配项</li>
<li>若多个联接使用相同的联接列，这些操作将分组为一个
哈希组</li>
</ul>
</li>
<li><p>grouby操作、unique操作</p>
<ul>
<li>使用groupby字段、所有select字段计算hash值</li>
<li>使用输入构造hash表，删除重复项、计算聚合表达式</li>
<li>扫描hash表输出所有项</li>
</ul>
</li>
<li><p>union操作、需要去除重复记录操作</p>
<ul>
<li>所有select字段计算hash值</li>
<li>第一个输入构建hash表，删除重复项</li>
<li>第二个输入进行探测<ul>
<li>若第二个输入没有重复项，直接返回没有匹配的项，
扫描hash表返回所有项</li>
<li>若第二个输入有重复项，则应该需要继续构建hash表，
最后统一输出整个hash表</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Grace-Hash-Join"><a href="#Grace-Hash-Join" class="headerlink" title="Grace Hash Join"></a><em>Grace Hash Join</em></h4><p><em>grace hash join</em>：磁盘分块HJ</p>
<ul>
<li><p>将两表按照相同hash函数分配至不同分片中</p>
<ul>
<li>在磁盘上为各分片、表建立相应文件</li>
<li>对表输入计算哈希值，根据哈希值写入分片、表对应文件</li>
</ul>
</li>
<li><p>再对不同分片进行普通<em>in-memory hash join</em></p>
<ul>
<li>若分片依然不能全部加载至内存，可以继续使用
<em>grace hash join</em></li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">grace_hash_join</span>(t1, t2):</span><br><span class="line">	<span class="comment">// Grace Hash Join实现</span></span><br><span class="line">	<span class="comment">// 输入：待join表t1、t2</span></span><br><span class="line">	<span class="keyword">for</span> row in t1:</span><br><span class="line">		hash_val = <span class="built_in">hash_func</span>(row)</span><br><span class="line">		N = hash_val % PART_COUNT</span><br><span class="line">		write row to file t1_N</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> row in t2:</span><br><span class="line">		hash_val = <span class="built_in">hash_func</span>(row)</span><br><span class="line">		N = hash_val % PART_COUNT</span><br><span class="line">		write row to file t2_N</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i in <span class="built_in">range</span>(<span class="number">0</span>, PART_COUNT):</span><br><span class="line">		<span class="built_in">join</span>(t1_i, t2_i)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>分片数量<code>PART_COUNT</code>决定磁盘IO效率</p>
<ul>
<li>分片数量过小：无法起到分治效果，分片仍然需要进行
<em>grace hash join</em>，降低效率</li>
<li>分片数量过大：磁盘是块设备，每次刷盘刷一定数量块才
高效，频繁刷盘不经济</li>
<li>即分片数量在保证刷盘经济的情况下，越大越好，这需要
优化器根据表统计信息确定</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li>有磁盘I/O代价，会降低效率</li>
<li>适合参与join表非常大，无法同时载入内存中</li>
</ul>
</li>
</ul>
<h4 id="Hybrid-Hash-Join"><a href="#Hybrid-Hash-Join" class="headerlink" title="Hybrid Hash Join"></a><em>Hybrid Hash Join</em></h4><p><em>hybrid hash join</em>：GHJ基础上结合IMHJ的改进</p>
<ul>
<li>对build表分片过程中，尽量多把完整分片保留在内存中</li>
<li>对probe表分片时，对应分片可以直接进行probe操作</li>
</ul>
<blockquote>
<ul>
<li><em>hybrid hash join</em>有时也被直接视为<em>grace hash join</em>，
  不做区分</li>
</ul>
</blockquote>
<h3 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h3><ul>
<li><p>资源消耗</p>
<ul>
<li>HJ：CPU计算、内存（磁盘）中创建临时hash表</li>
<li>SMJ：磁盘I/O（扫描表、索引）</li>
<li>NLJ：磁盘I/O</li>
</ul>
</li>
<li><p>性能</p>
<ul>
<li><p>通常情况：HJ &gt; NPJ &lt;&gt; SMJ</p>
<ul>
<li>全表扫描比索引范围扫描再进行表访问更可取时，SMJ
优于NPJ？？？</li>
<li>而表特别小、特别大时，全表扫描优于索引范围扫描</li>
</ul>
</li>
<li><p>但若关联字段已排序，SMJ性能最优</p>
</li>
</ul>
</li>
<li><p>首条搜索结果</p>
<ul>
<li>NPJ能快速返回首条搜索结果</li>
<li>HJ、SMJ返回首条结果较慢</li>
</ul>
</li>
</ul>
<h2 id="多表联接算法"><a href="#多表联接算法" class="headerlink" title="多表联接算法"></a>多表联接算法</h2><p>多表联接算法：找到最优连接顺序（执行路径）</p>
<ul>
<li><p>表联接顺序对于查询结果没有影响，但是对资源消耗、性能影响
巨大</p>
</li>
<li><p>随着需要联接表数目增加，可能的联接排列非常多，基本不能
对所有可能穷举分析</p>
<ul>
<li><em>left-deep tree</em>/<em>linear (processing)tree</em>：$n!$</li>
<li><em>bushy tree</em>：$\frac {2(n-1)!} {(n-1)!}$
（包括left-deep tree、right-deep tree）</li>
</ul>
<p><img src="/imgs/left_deep_tree_bushy_tree.png" alt="left_deep_tree_bushy_tree"></p>
</li>
<li><p>事实上查询优化器不会穷尽搜索所有可能联接排列，而是使用
启发式算法进行搜索</p>
</li>
</ul>
<h3 id="Dynamic-Programming"><a href="#Dynamic-Programming" class="headerlink" title="Dynamic Programming"></a><em>Dynamic Programming</em></h3><p>动态规划算法：依次求解各数量表最优联接顺序，直到求出最终结果</p>
<ol>
<li><p>构造第一层关系：每个关系的最优路径就是关系的最优单表扫描
方式</p>
</li>
<li><p>迭代依次构造之后n-1层关系联接最优解</p>
<ul>
<li>左深联接树方式：将第k-1层每个关系同第1层关系联接</li>
<li>紧密树联接方式：将第m(m &gt; 2)层每个关系同第k-m层关系
联接</li>
</ul>
<p><img src="/imgs/left_deep_tree_bushy_tree.png" alt="left_deep_tree_bushy_tree"></p>
</li>
</ol>
<h3 id="Heuristic-Algorithm"><a href="#Heuristic-Algorithm" class="headerlink" title="Heuristic Algorithm"></a><em>Heuristic Algorithm</em></h3><h3 id="Greedy-Algorithm"><a href="#Greedy-Algorithm" class="headerlink" title="Greedy Algorithm"></a><em>Greedy Algorithm</em></h3><p>贪心算法：认为每次连接表的连接方式都是最优的，即从未联接表中
选择使得下次联接代价最小者</p>
<ul>
<li><p>多表排序一般为</p>
<ul>
<li>常量表最前</li>
<li>其他表按可访问元组数量升序排序</li>
</ul>
</li>
<li><p>贪心算法得到的联接方式都是最优的</p>
<ul>
<li>则每次联接主要求解要联接表对象的最佳访问方式</li>
<li>即每次代价估计的重点在于单表扫描的代价</li>
</ul>
</li>
<li><p>求解结束后，局部最优查询计划生成</p>
<ul>
<li>得到左深树</li>
<li>最初始表位于最左下端叶子节点处</li>
</ul>
</li>
</ul>
<h3 id="System-R"><a href="#System-R" class="headerlink" title="System R"></a><em>System R</em></h3><p><em>System R</em>：对动态规划算法的改进</p>
<ul>
<li>保留子树查询最优、次优查询计划，用于上层查询计划生成，
使得查询计划整体较优</li>
</ul>
<h3 id="Genetic-Algorithm"><a href="#Genetic-Algorithm" class="headerlink" title="Genetic Algorithm"></a><em>Genetic Algorithm</em></h3><p>遗传算法：模拟自然界生物进化过程，采用人工进化的方式对目标
空间进行搜索</p>
<ul>
<li>本质是高效、并行、全局搜索方法</li>
<li>能在搜索过程中自动获取、积累有关搜索空间的知识，并自适应
的控制搜索过程以求的最佳解</li>
</ul>
<h4 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h4><ul>
<li>将问题域中可能解看作是染色体，将其编码为符号串的形式</li>
<li>对染色体群体反复进行基于遗传学的操作：选择、交叉、变异</li>
<li>根据预定目标适应度函数对每个个体进行评价，不断得到更优
群体，从中全局并行搜索得到优化群体中最优个体</li>
</ul>
<h4 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h4><ul>
<li><em>population</em>：群体，GA的遗传搜索空间</li>
<li><em>individual</em>：个体，搜索空间中可能解</li>
<li><em>chromosome</em>：染色体，个体特征代表<ul>
<li>由若干段基因组成</li>
<li>GA中基本操作对象</li>
</ul>
</li>
<li><em>gene</em>：基因<ul>
<li>染色体片段</li>
</ul>
</li>
<li><em>fitness</em>：适应度，个体对环境的适应程度</li>
</ul>
<h4 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h4><ul>
<li><p><em>selection</em>：选择，根据个体适应度在群体中按照一定概率
选择个体作为父本</p>
<ul>
<li>适应度大个体被选择概率高</li>
<li>体现了适者生存、优胜劣汰的进化规则</li>
</ul>
</li>
<li><p><em>crossover</em>：交叉，将父本个体按照一定概率随机交换基因
形成新个体</p>
</li>
<li><p><em>mutate</em>：变异，按照一定概率随机改变某个体基因值</p>
</li>
</ul>
<h4 id="涉及问题"><a href="#涉及问题" class="headerlink" title="涉及问题"></a>涉及问题</h4><ul>
<li><p>串编码方式</p>
<ul>
<li>把问题的各种参数用二进串进行编码构成子串</li>
<li>把子串拼接成染色体<blockquote>
<ul>
<li>串长度、编码方式对算法收敛影响极大</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><p>适应度/对象函数确定</p>
<ul>
<li>一般可以把问题模型函数作为对象函数</li>
</ul>
</li>
<li><p>GA超参设置</p>
<ul>
<li>群体大小$n$：过小难以求出最优解，过大难收敛，一般取
$n = 30 ~ 160$</li>
<li>交叉概率$P_c$：太小难以前向搜索，太大容易破坏高适应
值结构，一般取$P_c = 0.25 ~ 0.75$</li>
<li>变异概率$P_m$：太小难以产生新结构，太大则变为单纯
随机搜索，一般取$P_m = 0.01 ~ 0.2$</li>
</ul>
</li>
</ul>
<h4 id="算法-1"><a href="#算法-1" class="headerlink" title="算法"></a>算法</h4><ol>
<li>随机初始化种群</li>
<li>估初始种群：为种群每个个体计算适应值、排序</li>
<li>若没有达到预定演化数，则继续，否则结束算法</li>
<li>选择父体<ul>
<li>杂交：得到新个体</li>
<li>变异：对新个体变异</li>
</ul>
</li>
<li>计算新个体适应值，把适应值排名插入种群，淘汰最后个体</li>
<li>重复3</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-05-09T17:01:26.000Z" title="5/10/2019, 1:01:26 AM">2019-05-10</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-05-09T17:01:26.000Z" title="5/10/2019, 1:01:26 AM">2019-05-10</time></span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a><span> / </span><a class="link-muted" href="/categories/Database/SQL-DB/">SQL DB</a></span><span class="level-item">17 minutes read (About 2484 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Database/SQL-DB/psql.html">Postgre SQL笔记</a></h1><div class="content"><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>交互式客户端：<code>postgresql</code></li>
<li>服务器：<code>postgres-server</code></li>
<li>额外功能：<code>postgresql-contrib</code></li>
<li>开发工具：<code>postgresql-devel</code></li>
</ul>
<h3 id="OpenSuSe"><a href="#OpenSuSe" class="headerlink" title="OpenSuSe"></a>OpenSuSe</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo zypper <span class="keyword">in</span> postgresql postgresql-server \</span></span><br><span class="line"><span class="bash">	postgresql-contrib postgresql-devel</span></span><br></pre></td></tr></table></figure>
<h3 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install postgresql postgresql-server \</span></span><br><span class="line"><span class="bash">	postgresql-contrib postgresql-devel</span></span><br></pre></td></tr></table></figure>
<h4 id="其他版本"><a href="#其他版本" class="headerlink" title="其他版本"></a>其他版本</h4><ul>
<li><p>从中选择合适版本下载：<a target="_blank" rel="noopener" href="https://yum.postgresql.org/repopackages.php">Postgres Yum repositories</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-7-x86_64/pgdg-centos96-9.6-3.noarch.rpm</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装下载的RPM（依赖EPEL repo）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install pgdg-centos96-9.6-3.noarch.rpm</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>更新Yum、安装指定PG版本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo yum update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install postgresql96-sever postgresql96-contrib</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<ul>
<li>安装的PG带有版本后缀，初始化、启动时注意</li>
</ul>
</blockquote>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ul>
<li><p>postgres安装完成后，默认创建Linux用户</p>
<ul>
<li>用户密码为空，要为其设置密码以切换到其<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo passwd postgres</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> su - postgres</span></span><br></pre></td></tr></table></figure></li>
<li>用户目录默认是<code>/var/lib/pgsql</code></li>
<li>很多命令可以切换到用户<code>postgres</code>直接执行</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>初始化数据库簇后，默认创建数据库角色<code>postgres</code>、数据库
  <code>postgres</code></li>
</ul>
</blockquote>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><ul>
<li><p>创建新PostgreSQL数据库簇</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo postgresql-setup initdb</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 或</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo inidb -D /var/lib/pgsql/data</span></span><br></pre></td></tr></table></figure>
<ul>
<li>默认数据库存储路径为<code>/var/lib/pgsql/data</code></li>
</ul>
</li>
<li><p>开启PG密码认证：修改<em>host-based authentication</em>设置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> /var/lib/pgsql/data/pg_hba.conf</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> TYPE		DATABASE	USER	ADDRESS			MEHTOD</span></span><br><span class="line">host		all			all		127.0.0.1/32	md5</span><br><span class="line">host		all			all		::1/128			md5</span><br></pre></td></tr></table></figure>
<ul>
<li>替换默认<code>ident</code>为<code>md5</code>开启密码认证</li>
<li>修改之后需要重启PG</li>
</ul>
</li>
<li><p>修改<code>postgres</code>用户密码，以可以通过密码作为<code>postgres</code>连接
数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> su - postgres</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> psql -d template1 -c <span class="string">&quot;ALTER USER postgres with password &#x27;&lt;passwd&gt;&#x27;&quot;</span></span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 也可以在数据库prompt中执行</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="启动数据库"><a href="#启动数据库" class="headerlink" title="启动数据库"></a>启动数据库</h3><ul>
<li><p>作为服务：<code>start</code>、<code>enable</code>PG</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start postgresql</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> postgresql</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>作为普通程序启动：<code>pg_ctl</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> su - postgres</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pg_ctl start -D /var/lib/pgsql/data</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Roles"><a href="#Roles" class="headerlink" title="Roles"></a><em>Roles</em></h2><p>PG使用概念<em>roles</em>处理认证、权限问题</p>
<ul>
<li><p>角色相较于区分明显的用户、组概念更加灵活</p>
</li>
<li><p><code>create user</code>和<code>create role</code>几乎完全相同</p>
<ul>
<li><code>create user</code>：创建角色默认带<code>LOGIN</code>属性</li>
<li><code>create role</code>：创建角色默认不带<code>LOGIN</code>属性</li>
</ul>
</li>
</ul>
<h3 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h3><ul>
<li><code>SUPERUSER</code>/<code>NOSUPERUSER</code>：数据库超级用户</li>
<li><code>CREATEDB</code>/<code>NOCREATEDB</code>：创建数据库</li>
<li><code>CREATEUSER</code>/<code>NOCREATEUSER</code></li>
<li><code>CREATEROLE</code>/<code>NOCREATEROLE</code>：创建、删除普通用户角色</li>
<li><code>INHERIT</code>/<code>INHERIT</code>：角色可以继承所属用户组权限</li>
<li><code>LOGIN</code>/<code>NONLOGIN</code>：作连接数据库初始角色名</li>
<li><code>REPLICATION</code>/<code>NOREPLICATION</code>：流复制时用到</li>
<li><code>CONNECTION LIMIT connlimit</code></li>
<li>[<code>ENCRYPTED</code>/<code>UNENCRYPTED</code>]<code>PASSWORD &#39;&lt;passwd&gt;&#39;</code></li>
<li><code>VALID UNTIL &#39;&lt;timestamp&gt;&#39;</code></li>
<li><code>IN ROLE &lt;role_name&gt;[, ...]</code>：角色所属用户组</li>
<li><code>IN GROUP &lt;role_name&gt;[, ...]</code></li>
<li><code>ROLE &lt;role_name&gt;[, ...]</code></li>
<li><code>ADMIN &lt;role_name&gt;[, ...]</code></li>
<li><code>USER &lt;role_name&gt;[, ...]</code></li>
<li><code>SYSID uid</code></li>
</ul>
<h4 id="角色赋权"><a href="#角色赋权" class="headerlink" title="角色赋权"></a>角色赋权</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">psql&gt;</span><span class="bash"> create role/user &lt;name&gt; [[with] &lt;option&gt; [...]];</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 创建角色时直接赋权</span></span><br><span class="line"><span class="meta">psql&gt;</span><span class="bash"> alter role/user &lt;name&gt; [[with] &lt;option&gt; [...]];</span></span><br><span class="line"><span class="meta">psql&gt;</span><span class="bash"> grant connect on database &lt;db_name&gt; to &lt;name&gt;;</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 修改已创建角色权限</span></span><br></pre></td></tr></table></figure>
<h4 id="组赋权"><a href="#组赋权" class="headerlink" title="组赋权"></a>组赋权</h4><ul>
<li>把多个角色归为组，通过给组赋权、撤销权限实现权限管理</li>
<li>PG中角色赋权是通过<code>inherit</code>方式实现的</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">psql&gt;</span><span class="bash"> create role father login createdb createrole;</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 创建组角色、赋权</span></span><br><span class="line"><span class="meta">psql&gt;</span><span class="bash"> create role son1 inherit;</span></span><br><span class="line"><span class="meta">psql&gt;</span><span class="bash"> grant father to son1;</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 创建有`inherit`权限的用户、赋权</span></span><br><span class="line"><span class="meta">psql&gt;</span><span class="bash"> create role son2 inherit <span class="keyword">in</span> role father;</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 创建用户时直接赋组权</span></span><br></pre></td></tr></table></figure>
<h3 id="认证方式"><a href="#认证方式" class="headerlink" title="认证方式"></a>认证方式</h3><h4 id="Peer-Authentication"><a href="#Peer-Authentication" class="headerlink" title="Peer Authentication"></a>Peer Authentication</h4><p><code>peer</code>：从内核中获取操作系统中用户名，作为数据库角色名连接</p>
<ul>
<li>默认连接同名数据库</li>
<li>信任Linux用户身份（认证），不询问密码<ul>
<li>即使<code>-W</code>强制输入密码，也不会检查密码正确性</li>
</ul>
</li>
<li>只有<code>local</code>连接支持此方法</li>
</ul>
<h4 id="Trust-Authentication"><a href="#Trust-Authentication" class="headerlink" title="Trust Authentication"></a>Trust Authentication</h4><p><code>trust</code>：允许任何数据库角色名的连接</p>
<ul>
<li><p>信任任何连接、不询问密码</p>
<ul>
<li>只应该在操作系统层面上能提供足够保护下情况下使用<ul>
<li>文件系统权限：限制对Linux域套接字文件的访问</li>
</ul>
</li>
<li>适合单用户、本地连接</li>
</ul>
</li>
<li><p>数据库、用户权限限制仍然存在</p>
</li>
</ul>
<h4 id="Ident-Authentication"><a href="#Ident-Authentication" class="headerlink" title="Ident Authentication"></a>Ident Authentication</h4><p><code>ident</code>：从ident服务器中获取操作系统中用户名，用于连接数据库</p>
<ul>
<li><p>仅在<code>TCP/IP</code>连接情况下支持</p>
<ul>
<li>若被指定给<code>local</code>连接，将使用<code>peer</code>认证</li>
</ul>
</li>
<li><p>数据库服务器向客户端ident服务器询问“连接数据库的”用户，
据此判断连</p>
<ul>
<li>此流程依赖于客户端完整性，若客户端机器不可信，则
攻击者可以在113端口执行任何程序返回任何用户名</li>
<li>故此认证方法只适合封闭网络，所以客户端机器都被严格
控制</li>
<li>有些ident服务器开启非标准选项导致返回的加密用户名，
此选项应该关闭</li>
</ul>
<blockquote>
<ul>
<li>基本每个类Unix操作系统都带有ident服务器，用于监听
 113端口TCP</li>
</ul>
</blockquote>
</li>
</ul>
<h5 id="涉及配置"><a href="#涉及配置" class="headerlink" title="涉及配置"></a>涉及配置</h5><ul>
<li><code>map</code>：运行系统、数据库用户名之间映射</li>
</ul>
<h4 id="Password-Authentication"><a href="#Password-Authentication" class="headerlink" title="Password Authentication"></a>Password Authentication</h4><p>Password认证：基于密码的认证方式</p>
<blockquote>
<ul>
<li><code>password</code>：明文传输密码验证</li>
<li><code>md5</code>：MD5-hashed传输密码o</li>
</ul>
</blockquote>
<ul>
<li><p><code>md5</code>可以避免密码嗅探攻击</p>
</li>
<li><p><code>password</code>总应该尽量避免使用</p>
<ul>
<li>启用<code>db_user_namespace</code>特性时无法使用<code>md5</code></li>
<li>SSL加密连接下<code>password</code>也能安全使用</li>
</ul>
</li>
<li><p>每个数据库的密码存储在<code>pg_authid</code>系统表中</p>
<ul>
<li>若用户没有设置密码，则存储的密码为<code>null</code>，密码验证
也总是失败</li>
<li>使用<code>create user</code>、<code>alter role</code>等SQL语句修改密码</li>
</ul>
</li>
</ul>
<h4 id="GSSAPI-Authentication"><a href="#GSSAPI-Authentication" class="headerlink" title="GSSAPI Authentication"></a>GSSAPI Authentication</h4><p>GSSAPI：定义在<em>RFC 2743</em>中的安全认证产业界标准协议</p>
<ul>
<li>GSSAPI为支持其的系统自动提供认证<ul>
<li>认证本身是安全的，但是通过数据库连接的数据默认没有
加密，除非使用SSL</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>PG中GSSAPI需要编译时启用支持</li>
</ul>
</blockquote>
<h4 id="SSPI-Authentication"><a href="#SSPI-Authentication" class="headerlink" title="SSPI Authentication"></a>SSPI Authentication</h4><p><code>negotiate</code>：windows的安全认证技术</p>
<ul>
<li>PG将尽可能使用<em>Kerberos</em>，并自动回滚为<em>NTLM</em></li>
<li>仅服务器、客户端均在windows下或GSSAPI可用的情况下才能
工作</li>
</ul>
<blockquote>
<ul>
<li>使用Kerberos情况下，SSPI、GSSAPI工作方式相同</li>
</ul>
</blockquote>
<h5 id="涉及配置-1"><a href="#涉及配置-1" class="headerlink" title="涉及配置"></a>涉及配置</h5><ul>
<li><code>include_realm</code></li>
<li><code>map</code></li>
<li><code>krb_realm</code></li>
</ul>
<h4 id="Kerberos-Authentication"><a href="#Kerberos-Authentication" class="headerlink" title="Kerberos Authentication"></a>Kerberos Authentication</h4><p>Kerberos：适合公共网络上分布式计算的产业界标准安全认证系统</p>
<ul>
<li>Kerberos提供不加密的语句、数据安全认证，若需要加密则使用
SSL</li>
<li>PG支持Kerberos第5版，需要在build时开启Kerberos支持</li>
</ul>
<h5 id="涉及配置-2"><a href="#涉及配置-2" class="headerlink" title="涉及配置"></a>涉及配置</h5><ul>
<li><code>map</code></li>
<li><code>include_realm</code></li>
<li><code>krb_realm</code></li>
<li><code>krb_server_hostname</code></li>
</ul>
<h4 id="LDAP-Authentication"><a href="#LDAP-Authentication" class="headerlink" title="LDAP Authentication"></a>LDAP Authentication</h4><p>LDAP：类似<code>password</code>，只是使用<em>LDAP</em>作为密码认证方法</p>
<h5 id="涉及配置-3"><a href="#涉及配置-3" class="headerlink" title="涉及配置"></a>涉及配置</h5><ul>
<li><code>ldapserver</code></li>
<li><code>ldapport</code></li>
<li><code>ldaptls</code></li>
<li><code>ldapprefix</code></li>
<li><code>ldapsuffix</code></li>
<li><code>ldapbasedn</code></li>
<li><code>ldapbinddn</code></li>
<li><code>ldapbindpasswd</code></li>
<li><code>ldapsearchattribute</code></li>
</ul>
<h4 id="RADIUS-Authentication"><a href="#RADIUS-Authentication" class="headerlink" title="RADIUS Authentication"></a>RADIUS Authentication</h4><p>RADIUS：类似<code>password</code>，只是使用<em>RADIUS</em>作为密码认证方法</p>
<h5 id="涉及配置-4"><a href="#涉及配置-4" class="headerlink" title="涉及配置"></a>涉及配置</h5><ul>
<li><code>radiusserver</code></li>
<li><code>radiussecret</code></li>
<li><code>radiusport</code></li>
<li><code>radiusidentifier</code></li>
</ul>
<h4 id="Certificate-Authentication"><a href="#Certificate-Authentication" class="headerlink" title="Certificate Authentication"></a>Certificate Authentication</h4><p>Certificate：使用SSL客户多证书进行认证</p>
<ul>
<li>所以只在SSL连接中可用</li>
<li>服务器要求客户端提供有效证书，不会向客户端传递密码prompt<ul>
<li><code>cn</code>属性（<em>common name</em>）将回和目标数据库的用户名
比较</li>
<li>可通过名称映射允许<code>cn</code>属性和数据库用户名不同</li>
</ul>
</li>
</ul>
<h5 id="涉及配置-5"><a href="#涉及配置-5" class="headerlink" title="涉及配置"></a>涉及配置</h5><ul>
<li><code>map</code>：允许系统、数据库用户名之间映射</li>
</ul>
<h4 id="PAM-Authentication"><a href="#PAM-Authentication" class="headerlink" title="PAM Authentication"></a>PAM Authentication</h4><p>PAM：类似<code>password</code>，只是使用
<em>PAM(Pluggable Anthentication Modules)</em>作为密码认证机制</p>
<h5 id="涉及配置-6"><a href="#涉及配置-6" class="headerlink" title="涉及配置"></a>涉及配置</h5><ul>
<li><code>parmservice</code>：PAM服务名<ul>
<li>默认<code>postgresql</code></li>
</ul>
</li>
</ul>
<h2 id="pg-ctl"><a href="#pg-ctl" class="headerlink" title="pg_ctl"></a><code>pg_ctl</code></h2><p><code>pg_ctl</code>：用于控制PostgreSQL服务器的工具，此工具基本需要在
postgres用户下才能使用</p>
<ul>
<li>查看状态：<code>$ pg_ctl status -D /var/lib/pgsql/data</code></li>
</ul>
<h2 id="psql"><a href="#psql" class="headerlink" title="psql"></a><code>psql</code></h2><h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3><h4 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> psql [-h &lt;host&gt;] [-p &lt;port&gt;] [-U &lt;user_name&gt;] [[-d] &lt;db_name&gt;]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><code>-h</code>：缺省为<code>local</code>类型连接本地数据库<blockquote>
<ul>
<li><code>local</code>、<code>host</code>连接类型对应不同认证方式</li>
<li><code>-h localhost</code>和缺省对应不同<code>hba.conf</code>条目</li>
</ul>
</blockquote>
</li>
<li><code>-p</code>：缺省端口<code>5432</code></li>
<li><code>-U/--user_name=</code>：缺省linux用户名</li>
<li><code>[-d]/--database=</code>：当前linux用户名</li>
<li><code>-W</code>：密码，<code>peer</code>、<code>trust</code>模式下无价值</li>
</ul>
</blockquote>
<h4 id="Shell命令"><a href="#Shell命令" class="headerlink" title="Shell命令"></a>Shell命令</h4><ul>
<li><p>postgres不仅仅提供psql交互环境作为shell命令，还提供可以
直接在shell中运行的数据库命令</p>
<ul>
<li>当然前提是当前linux登陆用户在数据库中存在、有权限</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ createdb &lt;db_name&gt; [-O &lt;user_name&gt;]</span><br><span class="line">	# 创建数据库，设置所有权为`user_name`</span><br><span class="line">$ dropdb &lt;db_name&gt;</span><br><span class="line">	# 删除数据库</span><br></pre></td></tr></table></figure>
<h3 id="元命令"><a href="#元命令" class="headerlink" title="元命令"></a>元命令</h3><p>元命令：反斜杠命令，<code>\</code>开头，由psql自己处理</p>
<ul>
<li><p><code>\</code>后：跟命令动词、参数，其间使用空白字符分割</p>
</li>
<li><p>冒号<code>:</code>：不在引号中的冒号开头的参数会被当作psql变量</p>
</li>
<li><p>反点号：参数内容被当作命令传给shell，
输出（除去换行符）作为参数值</p>
</li>
<li><p>单引号<code>&#39;</code>：参数包含空白时需用单引号包o，其中包含的参数
的内容会进行类C的替换</p>
<ul>
<li><code>\n</code>（换行）、<code>\digits</code>（八进制）</li>
<li>包含单引号需要使用反斜杠转义</li>
</ul>
</li>
<li><p>双引号<code>\”&lt;\code&gt;</p>
<ul>
<li>遵循SQL语法规则，双引号保护字符不被强制转换为
小写，且允许其中使用空白</li>
<li>双引号内的双引号使用双双引号<code>&quot;&quot;</code>转义</li>
</ul>
</li>
</ul>
<h4 id="帮助"><a href="#帮助" class="headerlink" title="帮助"></a>帮助</h4><ul>
<li><p><code>\?</code></p>
<ul>
<li><code>[&lt;commands&gt;]</code>：元命令帮助</li>
<li><code>&lt;options&gt;</code>：psql命令行选项帮助</li>
<li><code>&lt;variables&gt;</code>：特殊变量帮助</li>
</ul>
</li>
<li><p><code>\h [&lt;clauses&gt;]</code>：SQL命令语法帮助（<code>*</code>表示全部）</p>
</li>
</ul>
<h4 id="展示信息"><a href="#展示信息" class="headerlink" title="展示信息"></a>展示信息</h4><ul>
<li><code>\du</code>：查看用户权限</li>
<li><code>\c &lt;db_name&gt; &lt;name&gt;</code>：以身份<code>name</code>访问数据库<code>db_name</code></li>
<li><code>\l[ist]</code>：查看数据库</li>
<li><code>\dt</code>：展示当前数据库中表</li>
</ul>
<h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><ul>
<li><code>\set foo bar</code>：设置变量<ul>
<li>可以像php设置“变量 变量”：<code>\set :foo bar</code></li>
</ul>
</li>
<li><code>\unset foo</code>：重置变量</li>
</ul>
<h2 id="数据库变量"><a href="#数据库变量" class="headerlink" title="数据库变量"></a>数据库变量</h2><h3 id="内部变量"><a href="#内部变量" class="headerlink" title="内部变量"></a>内部变量</h3><h4 id="特殊变量"><a href="#特殊变量" class="headerlink" title="特殊变量"></a>特殊变量</h4><p>特殊变量：一些选项设置，在运行时可通过改变变量的值、应用的
表现状态改变其，不推荐改变这些变量的用途</p>
<ul>
<li><code>AUTOCOMMIT</code>：缺省为<code>on</code>，每个SQL命令完成后自行提交，此时
需要输出<code>BEGIN</code>、<code>START TRANSACTION</code>命令推迟提交</li>
<li><code>DBNAMW</code>：当前所连接数据库</li>
<li><code>ENCODING</code>：客户端字符集编码</li>
</ul>
<blockquote>
<ul>
<li>详情查询手册</li>
</ul>
</blockquote>
<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><ul>
<li><p><code>PGDATA</code>：指定数据库簇（存放数据）目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"><span class="built_in">export</span> PGDATA=/var/lib/pgsql/data</span></span><br></pre></td></tr></table></figure>
<ul>
<li>默认<code>/var/lib/pgsql/data</code></li>
<li><code>-D</code>命令行参数指定</li>
</ul>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-04-09T18:35:42.000Z" title="4/10/2019, 2:35:42 AM">2019-04-10</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-02T09:30:55.000Z" title="8/2/2021, 5:30:55 PM">2021-08-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a><span> / </span><a class="link-muted" href="/categories/Database/Spark/">Spark</a></span><span class="level-item">15 minutes read (About 2177 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Database/Spark/spark_joinreorder.html">SparkSQL2.4中启用CBO时JoinReorder分析</a></h1><div class="content"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><h3 id="Spark-Join方式"><a href="#Spark-Join方式" class="headerlink" title="Spark Join方式"></a>Spark Join方式</h3><p>SparkSQL目前支持三种join方式</p>
<ul>
<li><p><em>broadcast hash join</em>：将小表广播分发到大表所在的结点上
，并行在各节点上进行hash join</p>
<ul>
<li>仅适合内表非常小的场合</li>
</ul>
</li>
<li><p><em>shuffle hash join</em>：按照join key分区，每个结点独立并行
进行hash join</p>
<ul>
<li>类似分布式GHJ，不同块位于不同结点</li>
</ul>
</li>
<li><p><em>sort merge join</em>：按照join key分区，在各节点独立并行<em>SMJ</em></p>
<ul>
<li>spark当前shuffle算法使用<em>sort-based shuffle</em>算法</li>
<li>理论上shuffle过后各分区数据已经排序完毕，无需再次
sort，效率很高</li>
</ul>
</li>
</ul>
<h3 id="Join类型"><a href="#Join类型" class="headerlink" title="Join类型"></a>Join类型</h3><p>SparkSQL支持的Join类型可以分为以下两类</p>
<ul>
<li><p>顺序结果无关Join</p>
<ul>
<li><em>inner join</em></li>
<li><em>(full)outer join</em></li>
</ul>
</li>
<li><p>顺序结果相关Join</p>
<ul>
<li><em>left(outer) join</em></li>
<li><em>right(outer) join</em></li>
<li><em>left semi join</em></li>
<li><em>right semi join</em></li>
</ul>
</li>
</ul>
<p>考虑到JoinReorder的结果</p>
<ul>
<li><p>仅支持连接重排序的连接类型只可能是<em>inner join</em>
<em>outer join</em></p>
</li>
<li><p>而<em>outer join</em>重排序虽然不影响结果，但是处理不方便，所以
联接重排序一般仅限于<em>inner join</em>？？？</p>
<ul>
<li>有些情况下RBO可以将外联接等价转换为内联接</li>
<li>SparkSQL2.4中支持的连接重排序仅限于内连接</li>
</ul>
</li>
</ul>
<h3 id="Cost-Based-Opitimization-Optimizer"><a href="#Cost-Based-Opitimization-Optimizer" class="headerlink" title="Cost-Based Opitimization/Optimizer"></a><em>Cost-Based Opitimization/Optimizer</em></h3><p><em>CBO</em>：基于成本的优化（器）</p>
<ul>
<li><p>根据SQL的执行成本制定、优化查询作业执行计划，生成可能
的执行计划中代价最小的计划</p>
<ul>
<li>数据表统计数据<ul>
<li>基/势</li>
<li>唯一值数量</li>
<li>空值数量</li>
<li>平均、最大长度</li>
</ul>
</li>
<li>SQL执行路径I/O</li>
<li>网络资源</li>
<li>CPU使用情况</li>
</ul>
</li>
<li><p>在SparkSQL Hash Join中可以用于</p>
<ul>
<li>选择正确hash建表方</li>
<li>选择正确join类型：广播hash、全洗牌hash</li>
<li>join reorder：调整多路join顺序</li>
</ul>
</li>
<li><p>CBO本身需要耗费一定资源，需要平衡CBO和查询计划优化程度</p>
<ul>
<li>数据表的数据统计资源耗费</li>
<li>优化查询计划即时资源耗费</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>CBO是相较于<em>Rule-Based Optimization</em>的概念</li>
</ul>
</blockquote>
<h4 id="CBO中的独特概念"><a href="#CBO中的独特概念" class="headerlink" title="CBO中的独特概念"></a>CBO中的独特概念</h4><ul>
<li><p><em>cardinality</em>：集的势，结果集的行数</p>
<ul>
<li>表示SQL执行成本值</li>
<li>SQL执行返回的结果集包含的行数越多，成本越大</li>
</ul>
</li>
<li><p><em>selectivity</em>：可选择率，施加指定谓语条件后返回结果集的
记录数占未施加任何谓语条件的原始结果记录数的比率</p>
<ul>
<li>值越小，说明可选择性越好</li>
<li>值越大，说明可选择性越差，成本值越大</li>
</ul>
</li>
</ul>
<h2 id="Join-Reorder"><a href="#Join-Reorder" class="headerlink" title="Join Reorder"></a><em>Join Reorder</em></h2><p>Join Reorder：基于CBO的多表连接顺序重排</p>
<ul>
<li><p>用统计信息预估的基修正join顺序</p>
</li>
<li><p>主要涉及到以下两个方面</p>
<ul>
<li>查询代价估算</li>
<li>多表连接顺序搜索算法</li>
</ul>
</li>
</ul>
<h3 id="查询代价估计"><a href="#查询代价估计" class="headerlink" title="查询代价估计"></a>查询代价估计</h3><h4 id="代价模型"><a href="#代价模型" class="headerlink" title="代价模型"></a>代价模型</h4><ul>
<li><p>单个join操作成本</p>
<script type="math/tex; mode=display">
cost = weight * cardinality + (1 - weight)*size</script><blockquote>
<ul>
<li>carinality：对应CPU成本</li>
<li>size：对应IO成本</li>
</ul>
</blockquote>
</li>
<li><p>join树的成本是所有中间join成本总和</p>
</li>
</ul>
<h4 id="Filter-Selectivity估计"><a href="#Filter-Selectivity估计" class="headerlink" title="Filter Selectivity估计"></a><em>Filter Selectivity</em>估计</h4><p>过滤选择率：估计应用谓词表达式过滤的选择率</p>
<h5 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h5><ul>
<li><p><code>AND</code>：左侧过滤条件选择率、右侧过滤条件选择率之积</p>
<script type="math/tex; mode=display">
fs(a AND b) = fs(a) * fs(b)</script></li>
<li><p><code>OR</code>：左侧、右侧过滤条件选择率之和，减去其乘积</p>
<script type="math/tex; mode=display">
fs(a OR b) = fs(a) + fs(b) - fs(a) * fs(b)</script></li>
<li><p><code>NOT</code>：1减去原始过滤条件选择率</p>
<script type="math/tex; mode=display">
fs(NOT a) = 1.0 - fs(a)</script></li>
</ul>
<h5 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h5><ul>
<li><p><code>=</code>：等于条件</p>
<ul>
<li>若常数取值在当前列取值范围之外，则过滤选择率为0</li>
<li>否则根据柱状图、均匀分布得到过滤选择率</li>
</ul>
</li>
<li><p><code>&lt;</code>：小于条件</p>
<ul>
<li>若常数取值小于当前列最小值，则过滤选择率为0</li>
<li>否则根据柱状图、均匀分数得到过滤选择率</li>
</ul>
</li>
</ul>
<h4 id="Join-Carinality估计"><a href="#Join-Carinality估计" class="headerlink" title="Join Carinality估计"></a><em>Join Carinality</em>估计</h4><p>联接基：估计联接操作结果的基</p>
<ul>
<li><p><em>inner</em>：其他基估计值可由inner join计算</p>
<script type="math/tex; mode=display">
num(A IJ B) = \frac {num(A) * num(B)}
   {max(distinct(A.k), distinct(B.k))}</script><blockquote>
<ul>
<li><code>num(A)</code>：join操作前表A的有效记录数</li>
<li><code>distinct(A.k)</code>：表A中列k唯一值数量</li>
</ul>
</blockquote>
</li>
<li><p><em>left-outer</em>：取inner join、左表中基较大者</p>
<script type="math/tex; mode=display">
num(A LOJ B) = max(num(A IJ B), num(A))</script></li>
<li><p><em>right-outer</em>：取inner join、右表中基较大者</p>
<script type="math/tex; mode=display">
num(A ROJ B) = max(num(A IJ B), num(B))</script></li>
<li><p><em>full-outer</em></p>
<script type="math/tex; mode=display">
num(A FOJ B) = num(A ROJ B) + num(A ROJ B) - num(A IJ B)</script></li>
</ul>
<h3 id="多表连接顺序搜索算法"><a href="#多表连接顺序搜索算法" class="headerlink" title="多表连接顺序搜索算法"></a>多表连接顺序搜索算法</h3><p>SparkSQL2.4中使用动态规划算法对可能联接顺序进行搜索，从中
选择最优的联接顺序作为执行计划</p>
<ul>
<li><p>最优子结构：一旦前k个表联接顺序确定，则联接前中间表和
第k+1个表方案和前k个表的联接顺序无关</p>
</li>
<li><p>动态规划表：从单表代价开始，逐层向上计算各层多表联接代价
，直到求得所有表联接最小代价</p>
</li>
<li><p>减少搜索空间启发式想法：尽可能优先有谓词限制的内连接、
中间表</p>
</li>
</ul>
<h4 id="评价"><a href="#评价" class="headerlink" title="评价"></a>评价</h4><ul>
<li>优势：动态规划算法能够求得整个搜索空间中最优解</li>
<li>缺陷：当联接表数量增加时，算法需要搜索的空间增加的非常快
，计算最优联接顺序代价很高</li>
</ul>
<h2 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h2><h3 id="代价模型-1"><a href="#代价模型-1" class="headerlink" title="代价模型"></a>代价模型</h3><p>Postgres的查询代价估计模型基于CPU开销、IO开销，另外还增加
了<strong>启动代价</strong></p>
<script type="math/tex; mode=display">
总代价 = 启动代价 + IO代价 + CPU代价</script><h3 id="动态规划算法"><a href="#动态规划算法" class="headerlink" title="动态规划算法"></a>动态规划算法</h3><p>类似SparkSQL2.4多表连接算法（假设联接n个表）</p>
<ol>
<li><p>构造第一层关系：每个关系的最优路径就是关系的最优单表扫描
方式</p>
</li>
<li><p>迭代依次构造之后n-1层关系联接最优解</p>
<ul>
<li>左深联接树方式：将第k-1层每个关系同第1层关系联接</li>
<li>紧密树联接方式：将第m(m &gt; 2)层每个关系同第k-m层关系
联接</li>
</ul>
<p><img src="/imgs/left_deep_tree_bushy_tree.png" alt="left_deep_tree_bushy_tree"></p>
</li>
</ol>
<h3 id="遗传算法"><a href="#遗传算法" class="headerlink" title="遗传算法"></a>遗传算法</h3><p>遗传算法：模拟自然界生物进化过程，采用人工进化的方式对目标
空间进行搜索</p>
<ul>
<li>本质是高效、并行、全局搜索方法</li>
<li>能在搜索过程中自动获取、积累有关搜索空间的知识，并自适应
的控制搜索过程以求的最佳解</li>
</ul>
<h4 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h4><ul>
<li>将问题域中可能解看作是染色体，将其编码为符号串的形式</li>
<li>对染色体群体反复进行基于遗传学的操作：选择、交叉、变异</li>
<li>根据预定目标适应度函数对每个个体进行评价，不断得到更优
群体，从中全局并行搜索得到优化群体中最优个体</li>
</ul>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="代价模型-2"><a href="#代价模型-2" class="headerlink" title="代价模型"></a>代价模型</h3><script type="math/tex; mode=display">
总代价 = IO代价 + CPU代价</script><ul>
<li>因为多表联接顺序采用贪心算法，多个表已经按照一定规则排序
（可访问元组数量升序排序）</li>
<li>所以MySQL认为，找到每个表的最小花费就是最终联接最小代价</li>
</ul>
<h3 id="贪心算法"><a href="#贪心算法" class="headerlink" title="贪心算法"></a>贪心算法</h3><p>贪心算法：认为每次连接表的连接方式都是最优的，即从未联接表中
选择使得下次联接代价最小者</p>
<ul>
<li><p>多表排序一般为</p>
<ul>
<li>常量表最前</li>
<li>其他表按可访问元组数量升序排序</li>
</ul>
</li>
<li><p>贪心算法得到的联接方式都是最优的</p>
<ul>
<li>则每次联接主要求解要联接表对象的最佳访问方式</li>
<li>即每次代价估计的重点在于单表扫描的代价</li>
</ul>
</li>
<li><p>求解结束后，局部最优查询计划生成</p>
<ul>
<li>得到左深树</li>
<li>最初始表位于最左下端叶子节点处</li>
</ul>
</li>
</ul>
<h2 id="优化方案"><a href="#优化方案" class="headerlink" title="优化方案"></a>优化方案</h2><p>以下分别从查询代价估计、多表连接顺序搜索算法给出方案</p>
<h3 id="查询代价估计-1"><a href="#查询代价估计-1" class="headerlink" title="查询代价估计"></a>查询代价估计</h3><ul>
<li><p>考虑在现有代价模型上增加网络通信开销</p>
<script type="math/tex; mode=display">
cost = \alpha * cardinality + \beta * size + \gamma netcost</script></li>
<li><p>在现有直方图估计选择率基础上，增加选择率估计方法</p>
<ul>
<li><p><em>Parametric Method</em>：参数方法，使用预先估计分布函数
逼近真实分布</p>
</li>
<li><p><em>Curve Fitting</em>：曲线拟合法，使用多项式函数、最小
标准差逼近属性值分布</p>
</li>
</ul>
</li>
</ul>
<h3 id="多表连接顺序搜索算法-1"><a href="#多表连接顺序搜索算法-1" class="headerlink" title="多表连接顺序搜索算法"></a>多表连接顺序搜索算法</h3><p>考虑到动态规划算法随着联接表数量增加时，计算代价过于庞大，
可以考虑引入其他算法优化多表连接顺序</p>
<ul>
<li>遗传算法</li>
<li>退火算法</li>
<li>贪心算法</li>
</ul>
<ul>
<li>遗传算法</li>
<li>退火算法</li>
<li>贪心算法</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-04-09T15:04:11.000Z" title="4/9/2019, 11:04:11 PM">2019-04-09</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-04-09T15:04:11.000Z" title="4/9/2019, 11:04:11 PM">2019-04-09</time></span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a></span><span class="level-item">12 minutes read (About 1758 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Database/optimizer.html">DBMS 查询优化</a></h1><div class="content"><h2 id="查询优化技术"><a href="#查询优化技术" class="headerlink" title="查询优化技术"></a>查询优化技术</h2><p>查询优化技术：求解给定查询语句的高效执行计划过程</p>
<ul>
<li>目标：在数据库查询优化引擎生成执行策略的过程中，尽量减小
查询总开销</li>
<li><p>SQL层面上的局部优化，区别于数据库调优的全局优化</p>
</li>
<li><p>广义数据库查询优化</p>
<ul>
<li>查询重用技术</li>
<li>查询重写规则</li>
<li>查询算法优化技术</li>
<li>并行查询优化技术</li>
<li>分布式查询优化技术</li>
</ul>
</li>
<li><p>狭义数据库查询优化</p>
<ul>
<li>查询重写规则：代数/逻辑优化，RBO</li>
<li>查询算法优化技术：非代数/物理优化，CBO</li>
</ul>
</li>
</ul>
<h3 id="代数-逻辑优化"><a href="#代数-逻辑优化" class="headerlink" title="代数/逻辑优化"></a>代数/逻辑优化</h3><p>代数/逻辑优化：依据关系代数的等价变换做逻辑变换</p>
<ul>
<li>语法级：查询语句层、基于语法进行优化</li>
<li>代数级：使用形式逻辑、关系代数原理进行优化</li>
<li>语义级：根据完整性约束，对查询语句进行语义理解，推知可
优化操作</li>
</ul>
<h3 id="非代数-物理优化"><a href="#非代数-物理优化" class="headerlink" title="非代数/物理优化"></a>非代数/物理优化</h3><p>非代数/物理优化：根据数据读取、表连接方式、排序等技术对查询
进行优化</p>
<ul>
<li>物理级：物理优化技术，基于代价估计模型，比较得出各执行
方式中代价最小者<ul>
<li>查询算法优化：运用基于代价估算的多表连接算法求解最小
花费计算</li>
</ul>
</li>
</ul>
<h2 id="查询重用技术"><a href="#查询重用技术" class="headerlink" title="查询重用技术"></a>查询重用技术</h2><p>查询重用：尽可能利用先前执行的结果，以节约全过程时间、减少
资源消耗</p>
<ul>
<li>查询结果的重用：分配缓冲块存放SQL语句、最后结果集</li>
<li>查询计划的重用：缓存查询语句执行计划、相应语法树结构</li>
<li>优势：节约CPU、IO消耗</li>
<li>弊端<ul>
<li>结果集很大回消耗放大内存资源</li>
<li>同样SQL不同用户获取的结果集可能不完全相同</li>
</ul>
</li>
</ul>
<h2 id="查询重写规则"><a href="#查询重写规则" class="headerlink" title="查询重写规则"></a>查询重写规则</h2><p>查询重写：查询语句的等价转换</p>
<ul>
<li>基于关系代数，关系代数的等价变换规则为查询重写提供了理论
支持</li>
<li>查询重写后，查询优化器可能生成多个连接路径，可以从候选者
中择优</li>
</ul>
<h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><ul>
<li>将查询转换为等价、效率更高的形式<ul>
<li>低效率谓词转换为高效率谓词</li>
<li>消除重复条件</li>
</ul>
</li>
<li>将查询重写为等价、简单、不受表顺序限制的形式，为
<strong>物理查询阶段提供更多选择</strong></li>
</ul>
<h3 id="优化方向"><a href="#优化方向" class="headerlink" title="优化方向"></a>优化方向</h3><ul>
<li>过程性查询转换为描述性查询：视图重写</li>
<li>复杂查询尽可能转换为多表连接查询：嵌套子查询、外连接、
嵌套连接等</li>
<li>低效率谓词转换为高效率谓词：等价谓词重写</li>
<li>利用（不）等式性质简化<code>where</code>、<code>having</code>、<code>on</code>条件</li>
</ul>
<h2 id="查询算法优化技术"><a href="#查询算法优化技术" class="headerlink" title="查询算法优化技术"></a>查询算法优化技术</h2><h1 id="todo"><a href="#todo" class="headerlink" title="todo"></a>todo</h1><h3 id="Rule-Based-Optimizer"><a href="#Rule-Based-Optimizer" class="headerlink" title="Rule-Based Optimizer"></a><em>Rule-Based Optimizer</em></h3><p>RBO：基于规则的优化器</p>
<ul>
<li><p>对AST/LP进行遍历，模式匹配能够满足特定规则的结点，进行
等价转换，得到等价的另一棵树</p>
<ul>
<li>剪枝：删除一些无用计算</li>
<li>合并：合并多个计算步骤</li>
</ul>
</li>
<li><p>经验式、启发式的固定<em>transformation</em>，手动设置（硬编码）
在数据库中规则决定SQL执行计划</p>
</li>
</ul>
<h4 id="经典优化规则"><a href="#经典优化规则" class="headerlink" title="经典优化规则"></a>经典优化规则</h4><ul>
<li><p><em>predicate pushdown</em>：谓词下推</p>
<p><img src="/imgs/sql_optimization_predicate_pushdown.png" alt="sql_optimization_predicate_pushdown"></p>
</li>
<li><p><em>constant folding</em>：常量累加</p>
<p><img src="/imgs/sql_optimization_constant_folding.png" alt="sql_optimization_constant_folding"></p>
</li>
<li><p><em>column pruning</em>：列值裁剪</p>
<p><img src="/imgs/sql_optimization_column_pruning.png" alt="sql_optimization_column_pruning"></p>
</li>
<li><p><em>combine limits</em>：Limits合并</p>
</li>
<li><p>inner join只访问单表：降为semi join</p>
</li>
</ul>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li><p>操作简单、能快速确定连接方式</p>
</li>
<li><p>规则虽然有效但不敏感</p>
<ul>
<li>数据分布发生变化时，RBO是不感知的</li>
</ul>
</li>
<li><p>基于RBO生成的执行计划不能确保是最优的</p>
<ul>
<li>启发式规则只能排除一些明显不好的存取路径</li>
</ul>
</li>
</ul>
<h3 id="Cost-Base-Optimizer"><a href="#Cost-Base-Optimizer" class="headerlink" title="Cost-Base Optimizer"></a><em>Cost-Base Optimizer</em></h3><p>CBO：基于成本的优化器</p>
<ul>
<li><p>根据SQL的执行成本制定、优化查询作业执行计划，生成可能
的执行计划中代价最小的计划</p>
<ul>
<li>数据表统计数据<ul>
<li>基/势</li>
<li>唯一值数量</li>
<li>空值数量</li>
<li>平均、最大长度</li>
</ul>
</li>
<li>SQL执行路径I/O</li>
<li>网络资源</li>
<li>CPU使用情况</li>
</ul>
</li>
<li><p>以上执行信息获取方式取决于不同平台、数据库</p>
<ul>
<li>执行SQL前抽样分析数据</li>
<li>每次执行SQL都会记录统计信息</li>
</ul>
</li>
<li><p>特殊概念</p>
<ul>
<li><p><em>cardinality</em>：集的势，结果集的行数</p>
<ul>
<li>表示SQL执行成本值</li>
<li>SQL执行返回的结果集包含的行数越多，成本越大</li>
</ul>
</li>
<li><p><em>selectivity</em>：可选择率，施加指定谓语条件后返回
结果集的记录数占未施加任何谓语条件的原始结果集记录数
的比率</p>
<ul>
<li>值越小，说明可选择性越好</li>
<li>值越大，说明可选择性越差，成本值越大</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="常见优化规则"><a href="#常见优化规则" class="headerlink" title="常见优化规则"></a>常见优化规则</h4><ul>
<li>hash-join<ul>
<li>选择正确hash建表方</li>
<li>选择正确join类型：广播hash、全洗牌hash</li>
<li>join reorder：调整多路join顺序<ul>
<li>尽量减小中间shuffle数据集大小，达到最优输出</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h4><ul>
<li>对各种可能情况进行量化比较，可以得到花费最小的情况</li>
<li>CBO本身需要耗费一定资源，需要平衡CBO和查询计划优化程度<ul>
<li>数据表的数据统计资源耗费</li>
<li>优化查询计划即时资源耗费，如果组合情况比较多则花费
判断时间较多</li>
</ul>
</li>
</ul>
<h2 id="并行查询优化技术"><a href="#并行查询优化技术" class="headerlink" title="并行查询优化技术"></a>并行查询优化技术</h2><p>并行数据库系统中查询优化的目标：寻找具有最小响应时间的查询
执行计划</p>
<ul>
<li><p>具有最小执行代价的计划不一定具有最快相应时间，需要考虑
把查询工作分解为可以并行运行的子工作</p>
</li>
<li><p>查询能否并行取决于</p>
<ul>
<li>系统中可用资源</li>
<li>CPU数目</li>
<li>运算中特定代数运算符</li>
</ul>
</li>
<li><p>查询并行可以分为</p>
<ul>
<li><p>操作内并行：将同一操作如单表扫描、两表连接、排序操作
等分解为多个独立子操作</p>
</li>
<li><p>操作间并行：一条SQL查询语句分解为多个子操作</p>
</li>
</ul>
</li>
</ul>
<h2 id="分布式查询优化技术"><a href="#分布式查询优化技术" class="headerlink" title="分布式查询优化技术"></a>分布式查询优化技术</h2><p>分布式数据库系统：查询策略优化、局部处理优化是查询优化重点</p>
<ul>
<li><p>查询策略优化：主要是数据传输策略优化</p>
<ul>
<li>主要考虑因素：数据的通信开销</li>
<li>主要目标：以减少传输次数、数据量</li>
</ul>
</li>
<li><p>局部处理优化：传统单结点数据库的查询优化技术</p>
</li>
<li><p>代价估计模型：总代价 = IO代价 + CPU代价 + 通信代价</p>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-04-09T06:46:49.000Z" title="4/9/2019, 2:46:49 PM">2019-04-09</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-02T09:28:44.000Z" title="8/2/2021, 5:28:44 PM">2021-08-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a></span><span class="level-item">3 minutes read (About 432 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Database/parser.html">Database Parser</a></h1><div class="content"><h2 id="Parser综述"><a href="#Parser综述" class="headerlink" title="Parser综述"></a><em>Parser</em>综述</h2><p><em>Parser</em>：分析器，将SQL语句切分为token，根据一定语义规则解析
成AST</p>
<h1 id="todo"><a href="#todo" class="headerlink" title="todo"></a>todo</h1><h3 id="查询计划-树"><a href="#查询计划-树" class="headerlink" title="查询计划/树"></a>查询计划/树</h3><p><img src="/imgs/sql_parser_ast.png" alt="sql_parser_ast"></p>
<p>查询计划：由一系列内部操作符组成，操作符按照一定运算关系构成
查询的一个执行方案</p>
<ul>
<li><p>形式上：二叉树</p>
<ul>
<li>树叶是每个单表对象</li>
<li>两个树叶的父节点是连接操作符连接后的中间结果</li>
<li>每个结点即临时“关系”</li>
</ul>
</li>
<li><p>查询的基本操作：选择、投影、连接</p>
<ul>
<li>选择、投影的优化规则适用于<em>select-projection-join</em>
操作和非SPY（SPY+Groupby）操作</li>
<li>连接操作包括两表连接、多表连接</li>
</ul>
</li>
</ul>
<h3 id="结点类型"><a href="#结点类型" class="headerlink" title="结点类型"></a>结点类型</h3><ul>
<li><p>单表结点：从物理存储到内存解析称逻辑字段的过程</p>
<ul>
<li>考虑数据获取方式<ul>
<li>直接IO获取</li>
<li>索引获取</li>
<li>通过索引定位数据位置后再经过IO获取相应数据块</li>
</ul>
</li>
</ul>
</li>
<li><p>两表结点：内存中元组进行连接的过程</p>
<ul>
<li>完成用户语义的局部逻辑操作，完成用户全部语义需要配合
多表连接顺序的操作</li>
<li>不同连接算法导致连接效率不同</li>
<li>考虑两表<ul>
<li>连接方式</li>
<li>代价</li>
<li>连接路径</li>
</ul>
</li>
</ul>
</li>
<li><p>多表中间结点：多个表按照“最优”顺序连接过程</p>
<ul>
<li>考虑代价最小的“执行计划”的多表连接顺序</li>
</ul>
</li>
</ul>
<h3 id="Schema-Catalog"><a href="#Schema-Catalog" class="headerlink" title="Schema Catalog"></a><em>Schema Catalog</em></h3><p>元数据信息：表的模式信息</p>
<ul>
<li>表的基本定义：表名、列名、数据类型</li>
<li>表的数据格式：json、text、parquet、压缩格式</li>
<li>表的物理位置</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:37.000Z" title="3/21/2019, 5:27:37 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-07-16T09:12:40.000Z" title="7/16/2021, 5:12:40 PM">2021-07-16</time></span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a><span> / </span><a class="link-muted" href="/categories/Database/Hadoop/">Hadoop</a></span><span class="level-item">12 minutes read (About 1790 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Database/Hadoop/hbase.html">HBase</a></h1><div class="content"><h2 id="HBase简介"><a href="#HBase简介" class="headerlink" title="HBase简介"></a>HBase简介</h2><p>HBase是高可靠、高性能、面向列、可伸缩的分布式数据库系统</p>
<ul>
<li><p>利用HBase技术可以在廉价硬件上搭建大规模非结构化数据管理
集群</p>
</li>
<li><p>HBase借鉴Google Bigtable技术实现的开源软件</p>
<p>||HBase|Bigtable|
|——-|——-|——-|
|存储系统|HDFS|GFS|
|数据处理|Hadoop MapReduce|MapReduce|
|协同服务|Zookeeper|Chubby|
|RDBMS数据导入|Sqoop|-|</p>
</li>
<li><p>HBase访问接口</p>
<ul>
<li>Native Java API：常用、高效的访问方式</li>
<li>HBase Shell：HBase命令行工具，适合用于管理HBase</li>
<li>Thrift Gateway：利用Thrift序列化技术，支持C++、PHP、
Python多种语言异构系统访问HBase表数据</li>
<li>REST Gateway：支持REST风格的Http API访问HBase</li>
<li>Pig：支持Pig Latin语言操作HBase中数据<ul>
<li>最终被转换为MapReduce Job处理HBase表数据</li>
<li>适合做数据统计</li>
</ul>
</li>
<li>Hive：支持用户使用HiveQL访问HBase</li>
</ul>
</li>
<li><p>可以在HBase系统上运行MapReduce作业，实现数据批处理
<img src="/imgs/hbase_mapreduce.png" alt="hbase_mapreduce"></p>
</li>
</ul>
<h2 id="HBase数据结构"><a href="#HBase数据结构" class="headerlink" title="HBase数据结构"></a>HBase数据结构</h2><p><img src="/imgs/hbase_storage_structure.png" alt="hbase_storage_structure"></p>
<h3 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h3><p>HBase的表格，类似关系型数据库中的表格，但有所不同</p>
<h4 id="特殊Table"><a href="#特殊Table" class="headerlink" title="特殊Table"></a>特殊Table</h4><p>HBase中有两张特殊的Table</p>
<ul>
<li><code>.META.</code>：记录用户表Region信息，自身可以有多个region</li>
<li><code>-ROOT-</code>：记录<code>.META.</code>表Region信息的，自身只能有一个
region</li>
</ul>
<h3 id="Row-Key"><a href="#Row-Key" class="headerlink" title="Row Key"></a>Row Key</h3><p>行键，Table行主键，Table记录按照此排序</p>
<h3 id="Column、Column-Family"><a href="#Column、Column-Family" class="headerlink" title="Column、Column Family"></a>Column、Column Family</h3><ul>
<li>Table在水平方向由一个或多个列簇组成</li>
<li>一个列簇可以由任意多个Column组成</li>
<li>列簇支持动态扩展，无需预先定义列数量、类型</li>
<li>所有列均义二进制格式存储，用户需要自行进行类型转换</li>
</ul>
<h3 id="Timestamp"><a href="#Timestamp" class="headerlink" title="Timestamp"></a>Timestamp</h3><p>时间戳：每次数据操作对应的时间戳，可视为是数据的版本号</p>
<h3 id="Region"><a href="#Region" class="headerlink" title="Region"></a>Region</h3><p>Table记录数不断增加而变大后，逐渐分裂出的多个split</p>
<ul>
<li>每个region由<code>[startkey, endkey)</code>表示</li>
<li>不同region被Master分配给相应RegionServer进行管理（存储）</li>
</ul>
<h2 id="HBase系统架构"><a href="#HBase系统架构" class="headerlink" title="HBase系统架构"></a>HBase系统架构</h2><p><img src="/imgs/hbase_structure.png" alt="hbase_structure"></p>
<h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3><ul>
<li>HBase Client使用HBase RPC机制同HMaster、HRegionServer
进行通信<ul>
<li>对于管理类操作，通过RPC机制访问HMaster</li>
<li>对于读写操作，通过RPC机制访问HRegionServer</li>
</ul>
</li>
</ul>
<h3 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h3><ul>
<li><p>Zookeeper Quorum中记录<code>-ROOT</code>表的位置</p>
<ul>
<li>客户端访问数据之前首先访问zookeeper</li>
<li>然访问<code>-ROOT-</code>表</li>
<li>然后访问<code>.META.</code>表</li>
<li>最后根据用户数据位置，访问具体数据</li>
</ul>
</li>
<li><p>Zookeeper Quorum中存储有HMaster地址</p>
</li>
<li><p>HRegionServer把自己义Ephemeral方式注册到Zookeeper中，
使得HMaster可以随时感知各个HRegionServer健康状态</p>
</li>
<li><p>引入Zookeeper，避免了HMaster单点失败问题</p>
<ul>
<li>HBase中可以启动多个HMaster</li>
<li>通过Zookeeper的Master Election机制保证总有一个Master
运行</li>
</ul>
</li>
</ul>
<h3 id="HMaster"><a href="#HMaster" class="headerlink" title="HMaster"></a>HMaster</h3><p>HMaster在功能上主要负责Table、Region管理工作</p>
<ul>
<li>管理用户对Table增、删、查、找操作？？？</li>
<li>管理HRegionServer负载均衡，调整Region分布</li>
<li>在Region分裂后，负责新Region分配</li>
<li>在HRegionServer停机后，负责失效HRegionServer上region迁移</li>
</ul>
<h3 id="HRegionServer"><a href="#HRegionServer" class="headerlink" title="HRegionServer"></a>HRegionServer</h3><p>HRegionServer负责响应用户I/O请求，向HDFS文件系统写数据，是
HBase中最核心的模块</p>
<p><img src="/imgs/hbase_hregion_server_structure.png" alt="hbase_hregion_server_structure"></p>
<h4 id="HRegion"><a href="#HRegion" class="headerlink" title="HRegion"></a>HRegion</h4><p>HRegionServer内部管理一系列HRegion对象</p>
<ul>
<li>HRegion对象对应Table中一个Region</li>
<li>HRegion由多个HStore组成</li>
</ul>
<h4 id="HStore"><a href="#HStore" class="headerlink" title="HStore"></a>HStore</h4><p>每个HStore对应Table中一个列簇的存储，是HBase存储核心模块</p>
<ul>
<li><p>由此可以看出列簇就是一个集中存储单元</p>
<ul>
<li>因此最好将具备共同IO特性的列放在同一个列簇中，可以
提高IO效率</li>
</ul>
</li>
<li><p>HStore由两部分构成</p>
<ul>
<li>MemStore</li>
<li>StoreFile：底层实现是HFile，是对HFile的轻量级包装</li>
</ul>
</li>
</ul>
<h5 id="MemStore"><a href="#MemStore" class="headerlink" title="MemStore"></a>MemStore</h5><p>Sorted memory buffer，用户写入数据首先放入MemStore中，满了
后Flush成一个StoreFile</p>
<h5 id="StoreFile"><a href="#StoreFile" class="headerlink" title="StoreFile"></a>StoreFile</h5><ul>
<li><p>文件数量增长到一定阈值时会触发Compact合并操作，将多个
StoreFile合并成一个StoreFile</p>
<ul>
<li>合并过程中会进行版本合并、数据删除</li>
<li>即HBase其实只有增加数据，所有更新、删除操作都是后续
Compact过程中进行的</li>
<li>这使得用户写操作只要进入内存就可以立即返回，保证
HBase IO高性能</li>
</ul>
</li>
<li><p>Compact操作会逐步形成越来越大的StoreFile，超过阈值之后
会触发Split操作</p>
<ul>
<li>当前Region分裂成2个Region</li>
<li>父Region下线</li>
<li>新分裂出的2个子Region会被HMaster分配到相应的
HRegionServer上，实现负载均衡</li>
</ul>
</li>
</ul>
<h4 id="HLog"><a href="#HLog" class="headerlink" title="HLog"></a>HLog</h4><p>每个<strong>HRegionServer</strong>中都有一个HLog对象，避免因为分布式系统
中节点宕机导致的MemStore中内存数据丢失</p>
<ul>
<li><p>HLog是实现<code>WriteAheadLog</code>的类</p>
</li>
<li><p>HLog作用</p>
<ul>
<li>每次用户写入MemStore时，也会写入一份数据至HLog文件中</li>
<li>HLog定时删除已持久化到StoreFile中的数据</li>
</ul>
</li>
<li><p>HRegion意外终止后，HMaster会通过zookeeper感知到</p>
<ul>
<li>HMaster首先处理遗留的HLog文件，将其中不同Region的Log
数据进行拆分，分别放到相应Region目录下</li>
<li>然后将失效Region重新分配</li>
<li>领取到Region的HRegionServer在Load Region过程中，会
发现有历史HLog需要处理，会Replay HLog中的数据到
MemStore中，然后flush到StoreFile中，完成数据恢复</li>
</ul>
</li>
</ul>
<h2 id="HBase存储"><a href="#HBase存储" class="headerlink" title="HBase存储"></a>HBase存储</h2><p>HBase中所有数据存储在HDFS中</p>
<h3 id="HFile"><a href="#HFile" class="headerlink" title="HFile"></a>HFile</h3><p>HFile是Hadoop二进制格式文件，实现HBase中<em>Key-Value</em>数据存储</p>
<ul>
<li>HFile是不定长的，长度固定的只有：Trailer、FileInfo</li>
</ul>
<p><img src="/imgs/hbase_hfile_storage_formation.png" alt="hbase_hfile_storage_formation"></p>
<h4 id="Trailer"><a href="#Trailer" class="headerlink" title="Trailer"></a>Trailer</h4><p>含有指针指向其他数据块起点</p>
<h4 id="FileInfo"><a href="#FileInfo" class="headerlink" title="FileInfo"></a>FileInfo</h4><p>记录文件的一些元信息，如</p>
<ul>
<li>AVG_KEY_LEN</li>
<li>AVG_VALUE_LEN</li>
<li>LAST_KEY</li>
<li>COMPARATOR</li>
<li>MAX_SEQ_ID_KEY</li>
</ul>
<h4 id="Data-Index"><a href="#Data-Index" class="headerlink" title="Data Index"></a>Data Index</h4><p>记录每个Data块起始点</p>
<h4 id="Meta-Index"><a href="#Meta-Index" class="headerlink" title="Meta Index"></a>Meta Index</h4><p>记录每个Meta块起始点</p>
<h4 id="Data-Block"><a href="#Data-Block" class="headerlink" title="Data Block"></a>Data Block</h4><p>Data Block是HBase IO基本单元</p>
<ul>
<li><p>为了提高效率，HRegionServer中实现了基于LRU的Block Cache
机制</p>
</li>
<li><p>Data块大小可以在创建Table时通过参数指定</p>
<ul>
<li>较大的块有利于顺序Scan</li>
<li>较小的块有利于随机查询</li>
</ul>
</li>
<li><p>Data块除了开头的Magic信息外，就是一个个<code>&lt;key, value&gt;</code>
键值对拼接而成</p>
</li>
<li><p>Magic内容就是一些随机数字，防止数据损坏</p>
</li>
<li><p>每个键值对就是简单的byte array，但是包含很多项，且有固定
结构
<img src="/imgs/hbase_hfile_datablock_kv.png" alt="hbase_hfile_datablock_kv"></p>
<ul>
<li>开头是两个固定长度的数值，分别表示key、value长度</li>
<li>然后是key部分<ul>
<li>固定长度数值表示RowKey长度</li>
<li>RowKey</li>
<li>固定长度数值表示Column Family的长度</li>
<li>Column Family</li>
<li>Qualifier</li>
<li>固定长度数值表示：Timestamp、KeyType（Put/Delete）</li>
</ul>
</li>
<li>Value部分就是二进制数据</li>
</ul>
</li>
</ul>
<h3 id="HLogFile"><a href="#HLogFile" class="headerlink" title="HLogFile"></a>HLogFile</h3><p>HBase中Write Ahead Log存储格式，本质上是Hadoop Sequence File</p>
<ul>
<li><p>Sequence File的Key是HLogKey对象，记录了写入数据的归属信息</p>
<ul>
<li>table</li>
<li>region</li>
<li>squecence number：起始值为0，或最近一次存入文件系统
中的squence number</li>
<li>timestamp：写入时间</li>
</ul>
</li>
<li><p>Squence File的Value是KeyValue对象，即对应HFile中KeyValue</p>
</li>
</ul>
<p>e</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:37.000Z" title="3/21/2019, 5:27:37 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-04T08:18:27.000Z" title="8/4/2021, 4:18:27 PM">2021-08-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a><span> / </span><a class="link-muted" href="/categories/Database/Hadoop/">Hadoop</a></span><span class="level-item">15 minutes read (About 2247 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Database/Hadoop/hdp_family.html">Hadoop概述</a></h1><div class="content"><ul>
<li><em>Hadoop</em>（核心）：<em>HDFS</em>和<em>MapReduce/YARN</em></li>
<li><em>Hadoop家族</em>：建立在<em>Hadoop</em>基础上的一系列开源工具</li>
</ul>
<p><img src="hadoop_relations.jpg" alt="hadoop_relations"></p>
<h2 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h2><p><em>Hadoop</em>时<em>Apache</em>的一个分布式计算、java语言实现的开源框架，
实现在大量计算机组成的集群中对海量数据进行分布式计算。相比于
依赖硬件的可靠性，<em>Hadoop</em>被设计为可以检测、处理应用层面的
failures，能够提供构建于电脑集群上的可靠服务。</p>
<p><em>Hadoop</em>：<em>Apache</em>的分布式计算开源框架，提供分布式文件系统
<em>HDFS</em>、<em>MapReduce/YARN</em>分布式计算的软件架构</p>
<h3 id="Hadoop-Common"><a href="#Hadoop-Common" class="headerlink" title="Hadoop Common"></a>Hadoop Common</h3><p>支持其它<em>Hadoop</em>模块的公用组件</p>
<h3 id="Hadoop-Distributed-File-System-HDFS"><a href="#Hadoop-Distributed-File-System-HDFS" class="headerlink" title="Hadoop Distributed File System(HDFS)"></a>Hadoop Distributed File System(HDFS)</h3><p>虚拟文件系统，让整个系统表面上看起来是一个空间，实际上是很多
服务器的磁盘构成的</p>
<h3 id="Hadoop-YARN"><a href="#Hadoop-YARN" class="headerlink" title="Hadoop YARN"></a>Hadoop YARN</h3><p>Yet Another Resource Negotiator，通用任务、集群资源分配框架
，面向<em>Hadoop</em>的编程模型</p>
<ul>
<li><p>YARN将classic/MapReduce1中Jobtracker职能划分为多个独立
实体，改善了其面临的扩展瓶颈问题</p>
</li>
<li><p>YARN比MapReduce更具一般性，MapReduce只是YARN应用的一种
形式，可以运行Spark、Storm等其他通用计算框架</p>
</li>
<li><p>YARN精妙的设计可以让不同的YARN应用在同一个集群上共存，
如一个MapReduce应用可以同时作为MPI应用运行，提高可管理性
和集群利用率</p>
</li>
</ul>
<h3 id="Hadoop-MapReduce"><a href="#Hadoop-MapReduce" class="headerlink" title="Hadoop MapReduce"></a>Hadoop MapReduce</h3><p><em>YARN</em>基础上的大数据集并行处理系统（框架）</p>
<ul>
<li><p>包括两个阶段</p>
<ul>
<li><em>Map</em>：映射</li>
<li><em>Reduce</em>：归一</li>
</ul>
</li>
<li><p>在分布式系统上进行计算操作基本都是由Map、Reduce概念步骤
组成</p>
<ul>
<li>分布式系统，不像一般的数据库、文件系统，无法从上至下
、从头到尾进行求和等操作</li>
<li>需要由分散的节点不断向一个点聚拢的计算过程</li>
</ul>
</li>
<li><p>不适合实时性要求的应用，只适合大数据离线处理</p>
</li>
</ul>
<h2 id="Apache下Hadoop相关项目"><a href="#Apache下Hadoop相关项目" class="headerlink" title="Apache下Hadoop相关项目"></a>Apache下<em>Hadoop</em>相关项目</h2><h3 id="高频"><a href="#高频" class="headerlink" title="高频"></a>高频</h3><h4 id="Ambari"><a href="#Ambari" class="headerlink" title="Ambari"></a>Ambari</h4><p>用于部署（供应）、管理、监控<em>Hadoop</em>集群的Web工具</p>
<ul>
<li><p>支持<em>HDFS</em>、<em>MapReduce</em>、<em>Hive</em>、<em>HCatalog</em>、<em>HBase</em>、
<em>Oozie</em>、<em>ZooKeeper</em>、<em>Pig</em>、<em>Sqoop</em></p>
</li>
<li><p>提供dashboard用于查看集群健康程度，如：热度图</p>
</li>
<li><p>能够直观的查看<em>MapReduce</em>、<em>Pig</em>、<em>Hive</em>应用特点，提供
易用的方式考察其执行情况</p>
</li>
</ul>
<h4 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a><em>HBase</em></h4><p><em>Hadoop</em>项目子项目，高可靠、高性能、面向列、可伸缩的分布式
存储系统</p>
<ul>
<li><p>该技术源于<em>Fay Chang</em>撰写的<em>Google</em>论文《Bigtable：一个
结构化数据的分布式存储系统》，类似于<em>Bigtable</em>在Google
文件系统上提供的分布式数据存储一样，<em>HBase</em>在<em>Hadoop</em>的
基础上提供了类似于<em>Bigtable</em>的能力</p>
</li>
<li><p>适合非结构化数据存储</p>
</li>
<li><p>可用于在廉价PC Server上搭建大规模结构化存储集群，是
<em>NoSQL</em>数据库的两个首选项目（<em>MongoDB</em>）</p>
</li>
</ul>
<h4 id="Hive"><a href="#Hive" class="headerlink" title="Hive"></a><em>Hive</em></h4><p>基于<em>Hadoop</em>的数据仓库工具</p>
<ul>
<li><p>在<em>Hive</em>中建立表，将表映射为结构化数据文件</p>
</li>
<li><p>可以通过类SQL语句直接查询数据实现简单的<em>MapReduce</em>统计，
而不必开发专门的<em>MapReduce</em>应用</p>
<ul>
<li><em>Hive</em>会将SQL语句转换为<em>MapReduce</em>任务查询<em>Hadoop</em></li>
<li>速度很慢</li>
<li>适合数据仓库的统计分析</li>
<li>支持SQL语法有限</li>
</ul>
</li>
</ul>
<h4 id="Pig"><a href="#Pig" class="headerlink" title="Pig"></a><em>Pig</em></h4><p>基于<em>Hadoop</em>的大规模数据<strong>高层</strong>分析工具（类似于<em>Hive</em>）</p>
<ul>
<li><p>提供SQL-Like语言<code>PigLatin</code></p>
<ul>
<li><p>其编译器会把类SQL的数据分析请求，转换为一系列经过
优化处理的<em>MapReduce</em>运算</p>
</li>
<li><p>是一种过程语言，和<em>Hive</em>中的类SQL语句相比，更适合写
脚本，而<em>Hive</em>的类SQL语句适合直接在命令行执行</p>
</li>
</ul>
</li>
</ul>
<h4 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a><em>Zookeeper</em></h4><p><em>Hadoop</em>正式子项目，针对大型分布式应用设计的分布式、开源协调
系统</p>
<ul>
<li><p>提供功能：配置维护、名字服务、分布式同步、组服务</p>
</li>
<li><p>封装好复杂、易出错的关键服务，提供简单易用、功能稳定、
性能高效的接口（系统），解决分布式应用中经常遇到的数据
管理问题，简化分布式应用协调及管理难度，提供高性能分布式
服务</p>
</li>
<li><p>通常为<em>HBase</em>提供节点间的协调，部署<em>HDFS</em>的<em>HA</em>模式时是
必须的</p>
</li>
</ul>
<h4 id="Spark"><a href="#Spark" class="headerlink" title="Spark"></a><em>Spark</em></h4><p>基于内存计算的开源集群计算系统，目的是让数据分析更加快速</p>
<h3 id="低频"><a href="#低频" class="headerlink" title="低频"></a>低频</h3><h4 id="Mahout"><a href="#Mahout" class="headerlink" title="Mahout"></a><em>Mahout</em></h4><p>基于<em>Hadoop</em>的机器学习、数据挖掘的分布式框架</p>
<ul>
<li><p>使用<em>MapReduce</em>实现了部分数据挖掘算法，解决了并行挖掘问题</p>
<ul>
<li>包括聚类、分类、推荐过滤、频繁子项挖掘</li>
</ul>
</li>
<li><p>通过使用<em>Hadoop</em>库，<em>Mahout</em>可以有效扩展至云端</p>
</li>
</ul>
<h4 id="Cassandra"><a href="#Cassandra" class="headerlink" title="Cassandra"></a><em>Cassandra</em></h4><p>开源分布式<em>NoSQL</em>数据库系统，最初由<em>Facebook</em>开发，用于存储
简单格式数据，集<em>Google BigTable</em>数据模型和<em>Amazon Dynamo</em>
的完全分布式架构于一身</p>
<h4 id="Avro"><a href="#Avro" class="headerlink" title="Avro"></a><em>Avro</em></h4><p>数据序列化系统，设计用于支持数据密集型、大批量数据交换应用，
是新的数据序列化格式、传输工具，将逐步取代<em>Hadoop</em>原有的
<code>IPC</code>机制</p>
<h4 id="Chukwa"><a href="#Chukwa" class="headerlink" title="Chukwa"></a><em>Chukwa</em></h4><p>用于监控大型分布式系统的开源数据收集系统，可以将各种类型的
数据收集成适合Hadoop处理的文件，保存在<em>HDFS</em>中供<em>MapReduce</em>
操作</p>
<h4 id="Tez"><a href="#Tez" class="headerlink" title="Tez"></a><em>Tez</em></h4><p>基于<em>YARN</em>的泛用数据流编程平台</p>
<ul>
<li>提供强力、灵活的引擎用于执行任何<em>DAG</em>任务，为批处理和
交互用例处理数据</li>
</ul>
<p><em>Tez</em>正逐渐被<em>Hive</em>、<em>Pig</em>等<em>Hadoop</em>生态框架采用，甚至被一些
商业公司用于替代<em>MapReduce</em>作为底层执行引擎</p>
<h2 id="其他Hadoop相关项目"><a href="#其他Hadoop相关项目" class="headerlink" title="其他Hadoop相关项目"></a>其他Hadoop相关项目</h2><h3 id="高频-1"><a href="#高频-1" class="headerlink" title="高频"></a>高频</h3><h4 id="Sqoop"><a href="#Sqoop" class="headerlink" title="Sqoop"></a><em>Sqoop</em></h4><p>用于将<em>Hadoop</em>和关系型数据库中数据相互转移的开源工具</p>
<ul>
<li><p>可以将关系型数据库（<em>MySQL</em>、<em>Oracle</em>、<em>Postgres</em>）中
数据转移至<em>Hadoop</em>的<em>HDFS</em>中</p>
</li>
<li><p>也可以将<em>HDFS</em>的数据转移进关系型数据库中 </p>
</li>
</ul>
<h4 id="Impala"><a href="#Impala" class="headerlink" title="Impala"></a><em>Impala</em></h4><p>由<em>Cloudera</em>发布的实时查询开源项目</p>
<ul>
<li><p>模仿<em>Google Dremel</em></p>
</li>
<li><p>称比基于<em>MapReduce</em>的<em>Hive SQL</em>查询速度提升3~30倍，更加
灵活易用</p>
</li>
</ul>
<h4 id="Phoenix"><a href="#Phoenix" class="headerlink" title="Phoenix"></a><em>Phoenix</em></h4><p><em>apache</em>顶级项目，在<em>HBase</em>上构建了一层关系型数据库，可以用
SQL查询<em>HBase</em>数据库，且速度比<em>Impala</em>更快，还支持包括
二级索引在内的丰富特性，借鉴了很多关系型数据库优化查询方法</p>
<h4 id="Oozie"><a href="#Oozie" class="headerlink" title="Oozie"></a><em>Oozie</em></h4><p>工作流引擎服务器，用于管理、协调运行在<em>Hadoop</em>平台
（<em>HDFS</em>、<em>Pig</em>、<em>MapReduce</em>）的任务</p>
<h4 id="Cloudera-Hue"><a href="#Cloudera-Hue" class="headerlink" title="Cloudera Hue"></a><em>Cloudera Hue</em></h4><p>基于<em>Web</em>的监控、管理系统，实现对<em>HDFS</em>、<em>MapReduce/YARN</em>、
<em>HBase</em>、<em>Hive</em>、<em>Pig</em>的<em>Web</em>化操作和管理</p>
<h3 id="低频-1"><a href="#低频-1" class="headerlink" title="低频"></a>低频</h3><h4 id="Hama"><a href="#Hama" class="headerlink" title="Hama"></a><em>Hama</em></h4><p>基于<em>HDFS</em>的<em>BSP(Bulk Synchronous Parallel)</em>并行
计算框架，可以用包括图、矩阵、网络算法在内的大规模、
大数据计算</p>
<h4 id="Flume"><a href="#Flume" class="headerlink" title="Flume"></a><em>Flume</em></h4><p>分布的、可靠的、高可用的海量日志聚合系统，可用于日志数据
收集、处理、传输</p>
<h4 id="Giraph"><a href="#Giraph" class="headerlink" title="Giraph"></a><em>Giraph</em></h4><p>基于Hadoop的可伸缩的分布式迭代图处理系统，灵感来自于<em>BSP</em>和
<em>Google Pregel</em></p>
<h4 id="Crunch"><a href="#Crunch" class="headerlink" title="Crunch"></a><em>Crunch</em></h4><p>基于<em>Google FlumeJava</em>库编写的<em>Java</em>库，用于创建<em>MapReduce</em>
流水线（程序）</p>
<ul>
<li><p>类似于<em>Hive</em>、<em>Pig</em>，提供了用于实现如连接数据、执行聚合
、排序记录等常见任务的模式库</p>
<ul>
<li><p>但是<em>Crunch</em>不强制所有输入遵循同一数据类型</p>
</li>
<li><p>其使用一种定制的类型系统，非常灵活，能直接处理复杂
数据类型，如：时间序列、<em>HDF5</em>文件、<em>HBase</em>、序列化
对象（<em>protocol buffer</em>、<em>Avro</em>记录）</p>
</li>
</ul>
</li>
<li><p>尝试简化<em>MapReduce</em>的思考方式</p>
<ul>
<li><p><em>MapReduce</em>有很多优点，但是对很多问题，并不是合适的
抽象级别</p>
</li>
<li><p>出于性能考虑，需要将逻辑上独立的操作（数据过滤、投影
、变换）组合为一个物理上的<em>MapReduce</em>操作</p>
</li>
</ul>
</li>
</ul>
<h4 id="Whirr"><a href="#Whirr" class="headerlink" title="Whirr"></a><em>Whirr</em></h4><p>运行于云服务的类库（包括<em>Hadoop</em>），提供高度互补性</p>
<ul>
<li>相对中立</li>
<li>支持<em>AmazonEC2</em>和<em>Rackspace</em>的服务</li>
</ul>
<h4 id="Bigtop"><a href="#Bigtop" class="headerlink" title="Bigtop"></a><em>Bigtop</em></h4><p>对<em>Hadoop</em>及其周边生态打包、分发、测试的工具</p>
<h4 id="HCatalog"><a href="#HCatalog" class="headerlink" title="HCatalog"></a><em>HCatalog</em></h4><p>基于<em>Hadoop</em>的数据表、存储管理，实现中央的元数据、模式管理，
跨越<em>Hadoop</em>和<em>RDBMS</em>，利用<em>Pig</em>、<em>Hive</em>提供关系视图</p>
<h4 id="Llama"><a href="#Llama" class="headerlink" title="Llama"></a><em>Llama</em></h4><p>让外部服务器从<em>YARN</em>获取资源的框架</p>
<h3 id="非CDH组件"><a href="#非CDH组件" class="headerlink" title="非CDH组件"></a>非<em>CDH</em>组件</h3><h4 id="Fuse"><a href="#Fuse" class="headerlink" title="Fuse"></a><em>Fuse</em></h4><p>让<em>HDFS</em>系统看起来像普通文件系统</p>
<h4 id="Hadoop-Streamin"><a href="#Hadoop-Streamin" class="headerlink" title="Hadoop Streamin"></a><em>Hadoop Streamin</em></h4><p><em>MapReduce</em>代码其他语言支持，包括：<em>C/C++</em>、<em>Perl</em>、<em>Python</em>
、<em>Bash</em>等</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:37.000Z" title="3/21/2019, 5:27:37 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-02-17T03:57:08.000Z" title="2/17/2019, 11:57:08 AM">2019-02-17</time></span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a><span> / </span><a class="link-muted" href="/categories/Database/SQL-DB/">SQL DB</a></span><span class="level-item">a minute read (About 143 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Database/SQL-DB/mssql_puzzles.html">MSSQL Puzzles</a></h1><div class="content"><h2 id="访问其他数据库服务器"><a href="#访问其他数据库服务器" class="headerlink" title="访问其他数据库服务器"></a>访问其他数据库服务器</h2><p>SQL默认阻止对组件<code>Ad Hoc Distributed Queries</code>的<em>STATEMENT</em>
<code>OpenRowSet/OpenDatasource</code>的访问，需要使用<code>sp_configure</code>
启用<code>Ad Hoc Distributed Queries</code></p>
<ul>
<li><p>开启<code>Ad Hoc Distributed Queries</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exec</span> sp_configure <span class="string">&#x27;show advanced options&#x27;</span>,<span class="number">1</span></span><br><span class="line">reconfigure</span><br><span class="line"><span class="keyword">exec</span> sp_configure <span class="string">&#x27;Ad Hoc Distributed Queries&#x27;</span>,<span class="number">1</span></span><br><span class="line">reconfigure</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exec</span> sp_configure <span class="string">&#x27;Ad Hoc Distributed Queries&#x27;</span>,<span class="number">0</span></span><br><span class="line">reconfigure</span><br><span class="line"><span class="keyword">exec</span> sp_configure <span class="string">&#x27;show advanced options&#x27;</span>,<span class="number">0</span></span><br><span class="line">reconfigure</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="特殊语法"><a href="#特殊语法" class="headerlink" title="特殊语法"></a>特殊语法</h2><h3 id="数据导入"><a href="#数据导入" class="headerlink" title="数据导入"></a>数据导入</h3><ul>
<li><p>mssql中换行符设置为<code>\n</code>表示的是<code>\r\n</code>，即永远无法单独
指定<code>\n</code>或者<code>\r</code>，尽量使用ASCII码<code>0xXX</code>表示</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> bulk <span class="keyword">insert</span> tbl_name <span class="keyword">from</span> <span class="operator">/</span>path<span class="operator">/</span><span class="keyword">to</span><span class="operator">/</span>file <span class="keyword">with</span> (FILEDTERMINATOR<span class="operator">=</span>&quot;|&quot;, ROWTERMINATOR<span class="operator">=</span>&quot;0x0a&quot;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/tags/Database/">Previous</a></div><div class="pagination-next"><a href="/tags/Database/page/3/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/tags/Database/">1</a></li><li><a class="pagination-link is-current" href="/tags/Database/page/2/">2</a></li><li><a class="pagination-link" href="/tags/Database/page/3/">3</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithm/"><span class="level-start"><span class="level-item">Algorithm</span></span><span class="level-end"><span class="level-item tag">36</span></span></a><ul><li><a class="level is-mobile" href="/categories/Algorithm/Data-Structure/"><span class="level-start"><span class="level-item">Data Structure</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Heuristic/"><span class="level-start"><span class="level-item">Heuristic</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Issue/"><span class="level-start"><span class="level-item">Issue</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Problem/"><span class="level-start"><span class="level-item">Problem</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Specification/"><span class="level-start"><span class="level-item">Specification</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/C-C/"><span class="level-start"><span class="level-item">C/C++</span></span><span class="level-end"><span class="level-item tag">34</span></span></a><ul><li><a class="level is-mobile" href="/categories/C-C/Cppref/"><span class="level-start"><span class="level-item">Cppref</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/Cstd/"><span class="level-start"><span class="level-item">Cstd</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/MPI/"><span class="level-start"><span class="level-item">MPI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/STL/"><span class="level-start"><span class="level-item">STL</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/CS/"><span class="level-start"><span class="level-item">CS</span></span><span class="level-end"><span class="level-item tag">14</span></span></a><ul><li><a class="level is-mobile" href="/categories/CS/Character/"><span class="level-start"><span class="level-item">Character</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Parallel/"><span class="level-start"><span class="level-item">Parallel</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Program-Design/"><span class="level-start"><span class="level-item">Program Design</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Storage/"><span class="level-start"><span class="level-item">Storage</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Daily-Life/"><span class="level-start"><span class="level-item">Daily Life</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/Daily-Life/Maxism/"><span class="level-start"><span class="level-item">Maxism</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">27</span></span></a><ul><li><a class="level is-mobile" href="/categories/Database/Hadoop/"><span class="level-start"><span class="level-item">Hadoop</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/SQL-DB/"><span class="level-start"><span class="level-item">SQL DB</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/Spark/"><span class="level-start"><span class="level-item">Spark</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/Java/Scala/"><span class="level-start"><span class="level-item">Scala</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">42</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Bash-Programming/"><span class="level-start"><span class="level-item">Bash Programming</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Configuration/"><span class="level-start"><span class="level-item">Configuration</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/File-System/"><span class="level-start"><span class="level-item">File System</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/IPC/"><span class="level-start"><span class="level-item">IPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Process-Schedual/"><span class="level-start"><span class="level-item">Process Schedual</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Shell/"><span class="level-start"><span class="level-item">Shell</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Tool/"><span class="level-start"><span class="level-item">Tool</span></span><span class="level-end"><span class="level-item tag">14</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Tool/Vi/"><span class="level-start"><span class="level-item">Vi</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Model/"><span class="level-start"><span class="level-item">ML Model</span></span><span class="level-end"><span class="level-item tag">21</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Model/Linear-Model/"><span class="level-start"><span class="level-item">Linear Model</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Model-Component/"><span class="level-start"><span class="level-item">Model Component</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Nolinear-Model/"><span class="level-start"><span class="level-item">Nolinear Model</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Unsupervised-Model/"><span class="level-start"><span class="level-item">Unsupervised Model</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/"><span class="level-start"><span class="level-item">ML Specification</span></span><span class="level-end"><span class="level-item tag">17</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/Click-Through-Rate/"><span class="level-start"><span class="level-item">Click Through Rate</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/Click-Through-Rate/Recommandation-System/"><span class="level-start"><span class="level-item">Recommandation System</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/Computer-Vision/"><span class="level-start"><span class="level-item">Computer Vision</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Specification/FinTech/"><span class="level-start"><span class="level-item">FinTech</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/FinTech/Risk-Control/"><span class="level-start"><span class="level-item">Risk Control</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/Graph-Analysis/"><span class="level-start"><span class="level-item">Graph Analysis</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Specification/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Technique/"><span class="level-start"><span class="level-item">ML Technique</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Technique/Feature-Engineering/"><span class="level-start"><span class="level-item">Feature Engineering</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Technique/Neural-Network/"><span class="level-start"><span class="level-item">Neural Network</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Theory/"><span class="level-start"><span class="level-item">ML Theory</span></span><span class="level-end"><span class="level-item tag">11</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Theory/Loss/"><span class="level-start"><span class="level-item">Loss</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Theory/Model-Enhencement/"><span class="level-start"><span class="level-item">Model Enhencement</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Theory/Optimization/"><span class="level-start"><span class="level-item">Optimization</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Algebra/"><span class="level-start"><span class="level-item">Math Algebra</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Algebra/Linear-Algebra/"><span class="level-start"><span class="level-item">Linear Algebra</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Algebra/Universal-Algebra/"><span class="level-start"><span class="level-item">Universal Algebra</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Analysis/"><span class="level-start"><span class="level-item">Math Analysis</span></span><span class="level-end"><span class="level-item tag">23</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Analysis/Fourier-Analysis/"><span class="level-start"><span class="level-item">Fourier Analysis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Functional-Analysis/"><span class="level-start"><span class="level-item">Functional Analysis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Optimization/"><span class="level-start"><span class="level-item">Optimization</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Real-Analysis/"><span class="level-start"><span class="level-item">Real Analysis</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Mixin/"><span class="level-start"><span class="level-item">Math Mixin</span></span><span class="level-end"><span class="level-item tag">18</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Mixin/Statistics/"><span class="level-start"><span class="level-item">Statistics</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Mixin/Time-Series/"><span class="level-start"><span class="level-item">Time Series</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Probability/"><span class="level-start"><span class="level-item">Probability</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">89</span></span></a><ul><li><a class="level is-mobile" href="/categories/Python/Cookbook/"><span class="level-start"><span class="level-item">Cookbook</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Jupyter/"><span class="level-start"><span class="level-item">Jupyter</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Keras/"><span class="level-start"><span class="level-item">Keras</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Matplotlib/"><span class="level-start"><span class="level-item">Matplotlib</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Numpy/"><span class="level-start"><span class="level-item">Numpy</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Pandas/"><span class="level-start"><span class="level-item">Pandas</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Py3Ref/"><span class="level-start"><span class="level-item">Py3Ref</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Py3std/"><span class="level-start"><span class="level-item">Py3std</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Pywin32/"><span class="level-start"><span class="level-item">Pywin32</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Readme/"><span class="level-start"><span class="level-item">Readme</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/TensorFlow/"><span class="level-start"><span class="level-item">TensorFlow</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Twists/"><span class="level-start"><span class="level-item">Twists</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/RLang/"><span class="level-start"><span class="level-item">RLang</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Rust/"><span class="level-start"><span class="level-item">Rust</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Set/"><span class="level-start"><span class="level-item">Set</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/"><span class="level-start"><span class="level-item">Tool</span></span><span class="level-end"><span class="level-item tag">13</span></span></a><ul><li><a class="level is-mobile" href="/categories/Tool/Editor/"><span class="level-start"><span class="level-item">Editor</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Markup-Language/"><span class="level-start"><span class="level-item">Markup Language</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Web-Browser/"><span class="level-start"><span class="level-item">Web Browser</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Windows/"><span class="level-start"><span class="level-item">Windows</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Web/"><span class="level-start"><span class="level-item">Web</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/Web/CSS/"><span class="level-start"><span class="level-item">CSS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/NPM/"><span class="level-start"><span class="level-item">NPM</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/Proxy/"><span class="level-start"><span class="level-item">Proxy</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/Thrift/"><span class="level-start"><span class="level-item">Thrift</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="UBeaRLy"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">UBeaRLy</p><p class="is-size-6 is-block">Protector of Proxy</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Earth, Solar System</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">392</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">93</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">522</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/xyy15926" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/xyy15926"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-04T15:07:54.896Z">2021-08-04</time></p><p class="title"><a href="/uncategorized/README.html"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T07:46:51.000Z">2021-08-03</time></p><p class="title"><a href="/Web/NPM/hexo_config.html">Hexo 建站</a></p><p class="categories"><a href="/categories/Web/">Web</a> / <a href="/categories/Web/NPM/">NPM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T02:32:45.000Z">2021-08-03</time></p><p class="title"><a href="/Web/NPM/config.html">NPM 总述</a></p><p class="categories"><a href="/categories/Web/">Web</a> / <a href="/categories/Web/NPM/">NPM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-02T08:11:11.000Z">2021-08-02</time></p><p class="title"><a href="/Python/Py3std/internet_data.html">互联网数据</a></p><p class="categories"><a href="/categories/Python/">Python</a> / <a href="/categories/Python/Py3std/">Py3std</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-29T13:55:00.000Z">2021-07-29</time></p><p class="title"><a href="/Linux/Shell/sh_apps.html">Shell 应用程序</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Shell/">Shell</a></p></div></article></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="pub-5385776267343559" data-ad-slot="6995841235" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="https://api.follow.it/subscription-form/WWxwMVBsOUtoNTdMSlJ4Z1lWVnRISERsd2t6ek9MeVpEUWs0YldlZGxUdXlKdDNmMEZVV1hWaFZFYWFSNmFKL25penZodWx3UzRiaVkxcnREWCtOYUJhZWhNbWpzaUdyc1hPangycUh5RTVjRXFnZnFGdVdSTzZvVzJBcTJHKzl8aXpDK1ROWWl4N080YkFEK3QvbEVWNEJuQjFqdWdxODZQcGNoM1NqbERXST0=/8" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="UBeaRLy" height="28"></a><p class="is-size-7"><span>&copy; 2021 UBeaRLy</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/xyy15926/proxy"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>