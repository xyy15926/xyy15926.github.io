<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: Routine - UBeaRLy</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="UBeaRLy&#039;s Proxy"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="UBeaRLy&#039;s Proxy"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="UBeaRLy"><meta property="og:url" content="https://xyy15926.github.io/"><meta property="og:site_name" content="UBeaRLy"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://xyy15926.github.io/img/og_image.png"><meta property="article:author" content="UBeaRLy"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://xyy15926.github.io"},"headline":"UBeaRLy","image":["https://xyy15926.github.io/img/og_image.png"],"author":{"@type":"Person","name":"UBeaRLy"},"publisher":{"@type":"Organization","name":"UBeaRLy","logo":{"@type":"ImageObject","url":"https://xyy15926.github.io/img/logo.svg"}},"description":""}</script><link rel="alternate" href="/atom.xml" title="UBeaRLy" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/darcula.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-5385776267343559" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="UBeaRLy" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Visit on GitHub" href="https://github.com/xyy15926/proxy"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">Routine</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-03-11T02:12:42.000Z" title="3/11/2021, 10:12:42 AM">2021-03-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-03-11T02:12:42.000Z" title="3/11/2021, 10:12:42 AM">2021-03-11</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/Numpy/">Numpy</a></span><span class="level-item">35 minutes read (About 5293 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/Numpy/ndarray_routines.html">NDArray Routine</a></h1><div class="content"><h2 id="Array-Manipulation"><a href="#Array-Manipulation" class="headerlink" title="Array Manipulation"></a>Array Manipulation</h2><h3 id="Shape-Only"><a href="#Shape-Only" class="headerlink" title="Shape Only"></a>Shape Only</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>reshape(a,newshape[,order])</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>resize(a,new_shape)</code></td>
<td>大小可不同，重复<code>a</code>补不足</td>
<td><code>0</code>补不足</td>
</tr>
<tr>
<td><code>ravel(a[,order])</code></td>
<td>展平视图</td>
<td></td>
</tr>
<tr>
<td><code>.flatten([order])</code></td>
<td>无</td>
<td>展平副本</td>
</tr>
<tr>
<td><code>shape(a)</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>size(a)</code></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h3 id="Order-Alteration"><a href="#Order-Alteration" class="headerlink" title="Order Alteration"></a>Order Alteration</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>transpose(a[,axes])</code></td>
<td>调整轴顺序，缺省逆序即转置</td>
<td></td>
</tr>
<tr>
<td><code>moveaxis(a,source,destination)</code></td>
<td>移动数组轴到新位置</td>
<td>无</td>
</tr>
<tr>
<td><code>rollaxis(a,axis[,start])</code></td>
<td>将指定后向插入至指定位置（缺省0）</td>
<td>无</td>
</tr>
<tr>
<td><code>swapaxes(a,axis1,axis2)</code></td>
<td>交换轴</td>
<td></td>
</tr>
<tr>
<td><code>flip(m[,axis])</code></td>
<td>沿指定轴反向，缺省所有轴</td>
<td>无</td>
</tr>
<tr>
<td><code>fliplr(m)</code></td>
<td>左右反向（沿第2轴）</td>
<td>无</td>
</tr>
<tr>
<td><code>flipud(m)</code></td>
<td>上下反向（沿第1轴）</td>
<td>无</td>
</tr>
<tr>
<td><code>roll(a,shift[,axis])</code></td>
<td>沿轴滚动<code>shift</code></td>
<td>无</td>
</tr>
<tr>
<td><code>rot90(m[,k,axes])</code></td>
<td>在<code>axes</code>指定的平面中旋转<code>k</code>次90度</td>
<td>无</td>
</tr>
<tr>
<td><code>lib.stride_tricks.as_strided(x[,shape,...])</code></td>
<td>利用给定shape、stride在<code>x</code>上创建视图</td>
</tr>
</tbody>
</table>
</div>
<h3 id="维数改变"><a href="#维数改变" class="headerlink" title="维数改变"></a>维数改变</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>atleast_1d(*arys)</code></td>
<td>prepend维度直至维度至少维数至少1</td>
<td>无</td>
</tr>
<tr>
<td><code>atleast_2d(*arys)</code></td>
<td></td>
<td>无</td>
</tr>
<tr>
<td><code>atleatt_3d(*arys)</code></td>
<td></td>
<td>无</td>
</tr>
<tr>
<td><code>broadcast(*arys)</code></td>
<td>广播、打包输入对应元素的元组迭代器，类似<code>zip</code></td>
<td>无</td>
</tr>
<tr>
<td><code>broadcast_to(array,shape[,subok])</code></td>
<td>广播为指定shape</td>
<td>无</td>
</tr>
<tr>
<td><code>boradcast_arrays(*args,**kwargs)</code></td>
<td>输入的广播结果列表</td>
<td>无</td>
</tr>
<tr>
<td><code>expand_dims(a,axis)</code></td>
<td>在指定位置插入新轴</td>
<td>无</td>
</tr>
<tr>
<td><code>squeeze(a[,axis])</code></td>
<td>删除大小为1维度</td>
</tr>
</tbody>
</table>
</div>
<h3 id="插入、删除元素"><a href="#插入、删除元素" class="headerlink" title="插入、删除元素"></a>插入、删除元素</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>delete(arr,obj[,axis])</code></td>
<td>删除<code>obj</code>指定部分，缺省按展平数组删除</td>
</tr>
<tr>
<td><code>insert(arr,obj,values[,axis])</code></td>
<td>缺省按展平数组插入</td>
</tr>
<tr>
<td><code>append(arr,values[,axis])</code></td>
<td>缺省<code>arr</code>、<code>values</code>展平再添加</td>
</tr>
<tr>
<td><code>trim_zeros(filt[,trim])</code></td>
<td>trim前导、尾随0，缺省两边</td>
</tr>
</tbody>
</table>
</div>
<h3 id="改变类型"><a href="#改变类型" class="headerlink" title="改变类型"></a>改变类型</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>asarray(a[,dtype,order])</code></td>
<td>转换为数组</td>
<td>无</td>
</tr>
<tr>
<td><code>asarray_chkfinite(a[,dtype,order])</code></td>
<td>检查<code>NaN</code>、<code>inf</code></td>
<td>无</td>
</tr>
<tr>
<td><code>asanyarray(a[,dtype,order])</code></td>
<td>转换为数组，数组子类则不变</td>
<td>无</td>
</tr>
<tr>
<td><code>ascalar(a)</code></td>
<td>将大小为1的数组转换为等效标量</td>
</tr>
<tr>
<td><code>require(a[,dtype,requirements])</code></td>
<td>创建满足要求<code>ndarray.flags</code>数组</td>
<td>无</td>
</tr>
<tr>
<td><code>asfortranarray(a[,dtype])</code></td>
<td>转换为Fortran-contiguous风格内存布局</td>
<td>无</td>
</tr>
<tr>
<td><code>ascontiguousarray(a[,dtype])</code></td>
<td>转换为C-contiguous风格内存布局</td>
<td>无</td>
</tr>
<tr>
<td><code>asmatrix(data[,dtype])</code></td>
<td></td>
<td>无</td>
</tr>
<tr>
<td><code>asfarray(a[,dtype])</code></td>
<td>转换为浮点类型</td>
<td>无</td>
</tr>
<tr>
<td><code>.astype(dtype[,order,casting,...])</code></td>
<td>无</td>
<td>转换为指定类型</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<ul>
<li>numpy中数组不是仅有C、Fortran风格内存布局，对数组的形态
  变换会导致内存布局不为任何风格内存布局</li>
</ul>
</blockquote>
<h3 id="组合数组"><a href="#组合数组" class="headerlink" title="组合数组"></a>组合数组</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>concatenate((a1,a2,...)[,axis,out])</code></td>
<td>沿现有轴连接数组</td>
</tr>
<tr>
<td><code>stack(arrays[,axis,out])</code></td>
<td>创建给定（新）轴堆叠数组</td>
</tr>
<tr>
<td><code>row_stack(tup)/vstack(tup)</code></td>
<td>沿第1（竖直）轴堆叠</td>
</tr>
<tr>
<td><code>column_stack(tup)/hstack(tup)</code></td>
<td>沿第2（水平）轴堆叠</td>
</tr>
<tr>
<td><code>dstack(tup)</code></td>
<td>沿第3轴堆叠</td>
</tr>
<tr>
<td><code>block(arrays)</code></td>
<td>按照<code>arrays</code>中给定数组块、位置组装</td>
</tr>
</tbody>
</table>
</div>
<h3 id="拆分数组"><a href="#拆分数组" class="headerlink" title="拆分数组"></a>拆分数组</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>split(ary,indices_or_sections[,axis])</code></td>
<td>沿轴拆分成视图</td>
</tr>
<tr>
<td><code>array_split(ary,indices_or_sections[,axis])</code></td>
<td>同<code>split</code>，但可处理不整除拆分</td>
</tr>
<tr>
<td><code>vsplit(ary,indices_or_sections)</code></td>
<td>沿第1（竖直）轴拆分</td>
</tr>
<tr>
<td><code>hsplit(ary,indices_or_sections)</code></td>
<td>沿第2（水平）轴拆分</td>
</tr>
<tr>
<td><code>dsplit(ary,indices_or_sections)</code></td>
<td>沿第3轴拆分</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Padding"><a href="#Padding" class="headerlink" title="Padding"></a>Padding</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Function</th>
<th>Desc</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pad(array,pad_width[,mode])</code></td>
</tr>
</tbody>
</table>
</div>
<h2 id="Index-Routine"><a href="#Index-Routine" class="headerlink" title="Index Routine"></a>Index Routine</h2><ul>
<li><p>结果数组shape考虑逻辑链</p>
<ul>
<li>确定输出数组的维数<code>ndim</code></li>
<li>确定参数数组原维度轴位置、补1轴位置，参数维度轴对齐</li>
<li>修正各维度大小<ul>
<li>沿轴操作：保持不变</li>
<li>沿轴采样：采样数目</li>
<li>沿轴concate：维度相加</li>
<li>沿轴聚集：删除维度</li>
<li>沿轴切片聚集：删除其余维度</li>
</ul>
</li>
</ul>
</li>
<li><p>numpy中（多维）索引往往使用整数高级索引的方式返回</p>
<ul>
<li><code>np.ndarray</code>数组：首维度各分量分别表示各维度的高级
索引</li>
<li>list、tuple：各元素分别为各维度的高级索引</li>
</ul>
</li>
</ul>
<h3 id="数组无关切片、高级索引"><a href="#数组无关切片、高级索引" class="headerlink" title="数组无关切片、高级索引"></a>数组无关切片、高级索引</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>返回值类型</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>s_[]</code></td>
<td>支持多维切片生成，类<code>slice()</code></td>
<td>切片、元组</td>
</tr>
<tr>
<td><code>index_exp[]</code></td>
<td>同<code>s_</code>，但总返回元组</td>
<td>元组</td>
</tr>
<tr>
<td><code>r_[]</code></td>
<td>沿第1轴concate切片、数组、标量</td>
<td>数组</td>
</tr>
<tr>
<td><code>c_[]</code></td>
<td>沿第-1轴concate切片、数组、标量（1维则被视为列向量）</td>
<td>数组</td>
</tr>
<tr>
<td><code>ravel_multi_index(multi_index,dims[,mode,order])</code></td>
<td>计算高级索引<code>multi_index</code>在<code>dims</code>数组展平后的位置</td>
<td>数组</td>
</tr>
<tr>
<td><code>unravel_index(indices,shape[,order])</code></td>
<td><code>ravel_multi_index</code>逆向</td>
<td>元组</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p><code>np.r_[]</code>、<code>np.c_[]</code>除可concate切片方便生成数组，还可以
传递两个参数修改行为</p>
<ul>
<li><p><code>r</code>/<code>c</code>字符被设置时，返回矩阵</p>
<ul>
<li>1维数组，<code>r</code>被设置时返回1 <em> N矩阵，<code>c</code>被设置时
返回N </em> 1矩阵</li>
<li>2维数组，<code>r</code>、<code>c</code>被设置时，结果矩阵相同</li>
</ul>
</li>
<li><p><code>&lt;axis&gt;[,&lt;ndim&gt;,&lt;ori_pos&gt;]</code>三个整形，决定shape</p>
<p>|参数|说明|<code>np.r_[]</code>缺省值|<code>np.c_[]</code>缺省值|
|——-|——-|——-|——-|
|<code>&lt;axis&gt;</code>|concate执行轴|<code>0</code>|<code>-1</code>|
|<code>&lt;ndim&gt;</code>|目标维数，仅在其大于结果维数时才生效|<code>1</code>|<code>2</code>|
|<code>&lt;ori_pos&gt;</code>|原数据轴所在的位置|<code>-1</code>，即prepend全<code>1</code>轴|<code>0</code>，即postpend全<code>1</code>轴|</p>
</li>
<li><p>相同参数时，两者结果相同，可根据不同数组设置合适的
参数相互实现</p>
<ul>
<li><code>np.r_[]</code>可视为参数缺省为<code>0,1,-1</code></li>
<li><code>np.c_[]</code>可视为参数缺省为<code>-1,2,0</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><code>np.r_</code>、<code>np.c_</code>分别是<code>np.lib.index_tricks.RClass</code>、
  <code>np.lib.index_tricks.CClass</code>实例</li>
<li><code>np.s_</code>、<code>np.index_exp</code>均是
  <code>np.lib.index_tricks.IndexExpression</code>实例，仅初始化参数
  不同</li>
</ul>
</blockquote>
<h3 id="网格"><a href="#网格" class="headerlink" title="网格"></a>网格</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>返回值类型</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ix_(*args)</code></td>
<td>以<code>args</code>为基点创建开网格（仅设置基点、维度）</td>
<td>元组</td>
</tr>
<tr>
<td><code>meshgrid(*xi,**kwargs)</code></td>
<td>以<code>xi</code>作为基点创建稠密网格（所有网格点高级索引）</td>
<td>列表</td>
</tr>
<tr>
<td><code>mgrid[]</code></td>
<td>根据切片创建稠密网格</td>
<td>数组</td>
</tr>
<tr>
<td><code>ogrid[]</code></td>
<td>根据切片创建开网格</td>
<td>列表</td>
</tr>
<tr>
<td><code>indices(dimensions[,dtype,sparse])</code></td>
<td>以<code>dimensions</code>作为各维度长创建网格</td>
<td>数组、元组</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>开网格广播即可得到稠密网格</li>
</ul>
<h3 id="值相关索引"><a href="#值相关索引" class="headerlink" title="值相关索引"></a>值相关索引</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>nonzero(a)</code></td>
<td>非0元素整形高级索引</td>
<td></td>
</tr>
<tr>
<td><code>where(condition,[x,y])</code></td>
<td><code>condition</code>对应整形高级索引，给出<code>x,y</code>时则从中抽取元素</td>
<td>无</td>
</tr>
<tr>
<td><code>flatnonzero(a)</code></td>
<td>展平非0位置</td>
<td>无</td>
</tr>
</tbody>
</table>
</div>
<h3 id="特殊位置索引"><a href="#特殊位置索引" class="headerlink" title="特殊位置索引"></a>特殊位置索引</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>diag_indices(n[,ndim])</code></td>
<td><code>ndim</code>维长为<code>n</code>数组对角索引</td>
</tr>
<tr>
<td><code>diag_indices_from(arr)</code></td>
<td>获取<code>arr</code>对角索引</td>
</tr>
<tr>
<td><code>mask_indices(n,mask_func[,k])</code></td>
<td>根据<code>mask_func</code>获取n * n数组索引</td>
</tr>
<tr>
<td><code>tril_indices(n[,k,m])</code></td>
<td>n * m的下三角索引</td>
</tr>
<tr>
<td><code>triu_indices(n[,k,m])</code></td>
<td>n * m的上三角索引</td>
</tr>
<tr>
<td><code>tril_indices_from(arr[,k])</code></td>
<td><code>arr</code>的下三角索引</td>
</tr>
<tr>
<td><code>triu_indices_from(arr[,k])</code></td>
<td><code>arr</code>的下三角索引</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><code>np.ndindex(*args) == np.broadcast(*np.indices(*args))</code></li>
</ul>
<h3 id="Searching-索引"><a href="#Searching-索引" class="headerlink" title="Searching 索引"></a>Searching 索引</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>argwhere(a)</code></td>
<td>非0点坐标数组</td>
<td>无</td>
</tr>
<tr>
<td><code>argmax(a[,axis,out])</code></td>
<td>展平后位置，存在<code>NaN</code>则返回<code>0</code></td>
<td></td>
</tr>
<tr>
<td><code>argmin(a[,axis])</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>nanargmax(a[,axis])</code></td>
<td>忽略<code>NaN</code></td>
</tr>
<tr>
<td><code>nanargmin(a[,axis])</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>searchsorted(a,v[,side,sorter])</code></td>
<td>应插入（保持有序）位置</td>
</tr>
</tbody>
</table>
</div>
<h2 id="Value-Manipulation"><a href="#Value-Manipulation" class="headerlink" title="Value Manipulation"></a>Value Manipulation</h2><h3 id="Value-Extraction"><a href="#Value-Extraction" class="headerlink" title="Value Extraction"></a>Value Extraction</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>take(a,indices[,axis,out,mode])</code></td>
<td>按<code>indices</code>沿给定轴获取超平面（缺省将数组展平）</td>
<td></td>
</tr>
<tr>
<td><code>take_along_axis(arr,indices,axis)</code></td>
<td>将<code>arr</code>、<code>indices</code>沿<code>axis</code>匹配，选取元素</td>
<td>无</td>
</tr>
<tr>
<td><code>compress(condition,a[,axis,out])</code></td>
<td>按bool数组<code>condition</code>沿给定轴<code>axis</code>选取超平面（缺省将数组展平）</td>
<td></td>
</tr>
<tr>
<td><code>extract(condition,arr)</code></td>
<td>在展平数组上抽取元素</td>
<td>无</td>
</tr>
<tr>
<td><code>choose(a,choices[,out,mode])</code></td>
<td>根据<code>a</code>广播后元素值选择<code>choices</code>中数组填充对应位置</td>
<td></td>
</tr>
<tr>
<td><code>select(condlist,choicelist[,default])</code></td>
<td><code>condlist</code>中首个真值对应的<code>choicelist</code>数组填充对应位置</td>
<td>无</td>
</tr>
<tr>
<td><code>diag(v[,k])</code></td>
<td>从2维<code>v</code>抽取对角、或以1维<code>v</code>作为对角</td>
<td>无</td>
</tr>
<tr>
<td><code>diagonal(a[,offset,axis1,axis2])</code></td>
<td>返回给定对象</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p><code>take</code>：沿给定轴从数组中获取元素</p>
<ul>
<li><code>axis</code>为<code>None</code>时，按展平后获取<code>indices</code>指定元素，
非<code>None</code>时<ul>
<li>函数行为同高级索引</li>
<li>指定<code>axis</code>可以简化通过高级索引获取指定轴的元素</li>
</ul>
</li>
<li>基本元素为数组在该轴的切片</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Ni, Nk = a.shape[:axis], a.shape[axis+<span class="number">1</span>:]</span><br><span class="line">Nj = indices.shape</span><br><span class="line"><span class="keyword">for</span> ii <span class="keyword">in</span> np.ndindex(Ni):</span><br><span class="line">	<span class="keyword">for</span> jj <span class="keyword">in</span> np.ndindex(Nj):</span><br><span class="line">		<span class="keyword">for</span> kk <span class="keyword">in</span> np.ndindex(Nk):</span><br><span class="line">			out[ii+jj+kk] = a[ii+(indices[jj],)+kk]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>take_along_axis</code>：匹配给定轴方向的1维索引、数据切片，
获取元素</p>
<ul>
<li>基本元素为单个元素<ul>
<li>将<code>indices</code>和<code>arr</code>对齐，除给定维度外，其余维度
大小均须相同</li>
<li>其余维度给定下，按照<code>indices</code>在超平面上给出的
位置获取对应的元素</li>
<li>即<code>take</code>以超平面为单位获取整个超平面的元素，而
<code>take_along_axis</code>按元素为单位，沿给定轴方向调整
元素顺序</li>
</ul>
</li>
<li><code>np.argsort</code>、<code>np.argpartition</code>等函数能够返回适合此
函数的索引</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">N1, M, Nk = arr.shape[:axis], arr.shape[axis], arr.shape[axis+<span class="number">1</span>:]</span><br><span class="line">J = indices.shape[axis]</span><br><span class="line">out = np.empty(Ni + (J,) + Nk)</span><br><span class="line"><span class="keyword">for</span> ii <span class="keyword">in</span> np.ndindex(Ni):</span><br><span class="line">	<span class="keyword">for</span> kk <span class="keyword">in</span> np.ndindex(Nk):</span><br><span class="line">		a_1d = arr[ii + np.s_[:,] + kk]</span><br><span class="line">		indices_1d = indices[ii + np.s_[:,] +kk]</span><br><span class="line">		out_1d = out[ii + np.s_[:,] + kk]</span><br><span class="line">		out_1d = a_1d[indices_1d[j]]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>np.choose</code></p>
<ul>
<li><code>choices</code>：数组序列，其中数组和<code>a</code>需广播兼容<ul>
<li>若本身为数组，则其最外层被视为序列</li>
</ul>
</li>
<li>逻辑<ul>
<li><code>a</code>、<code>choices</code>中数组共同广播</li>
<li>广播结果的shape即为结果shape，其中<code>a</code>取值为<code>n</code>
处用数组<code>choices[n]</code>填充</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.choose(a,choices) == np.array([choices[a[I]][I] <span class="keyword">for</span> I <span class="keyword">in</span> np.ndindex(a.shape)])</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>np.select</code></p>
<ul>
<li>使用各位置<code>condlist</code>首个真值出现的位序值构建<code>a</code>，则
等价于<code>np.choose(a,choicelist)</code>
（不考虑缺省值）</li>
</ul>
</li>
<li><p><code>np.extract</code></p>
<ul>
<li>等价于<code>np.compress(np.ravel(condition), np.ravel(arr))</code></li>
<li>若<code>condition</code>为bool数组，也等价于<code>arr[condition]</code></li>
</ul>
</li>
</ul>
<h3 id="Value-Modification"><a href="#Value-Modification" class="headerlink" title="Value Modification"></a>Value Modification</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>place(arr,mask,vals)</code></td>
<td>按照<code>mask</code>循环使用<code>vals</code>中值替换<code>arr</code>中元素</td>
<td>无</td>
</tr>
<tr>
<td><code>put(a,ind,v[,mode])</code></td>
<td>同<code>place</code>，但根据展平索引<code>ind</code>替换</td>
<td></td>
</tr>
<tr>
<td><code>put_along_axis(arr,indices,values,axis)</code></td>
<td>匹配<code>indices</code>和<code>arr</code>沿<code>axis</code>分量，替换值</td>
<td>无</td>
</tr>
<tr>
<td><code>copyto(dst,src[,casting,where])</code></td>
<td>根据bool数组<code>where</code>替换<code>dst</code>中元素</td>
<td>无</td>
</tr>
<tr>
<td><code>putmask(a,mask,values)</code></td>
<td>同<code>copyto</code></td>
<td>无</td>
</tr>
<tr>
<td><code>fill_diagonal(a,val[,wrap])</code></td>
<td>用<code>val</code>填充<code>a</code>的主对角</td>
<td>无</td>
</tr>
<tr>
<td><code>clip(a,a_min,a_max[,out=None,**kwargs])</code></td>
<td>裁剪值</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<ul>
<li><code>where</code>、<code>mask</code>、<code>condition</code>缺省为、等价为bool数组</li>
<li><code>np.clip</code>是<em>ufunc</em></li>
</ul>
</blockquote>
<h3 id="Sorting"><a href="#Sorting" class="headerlink" title="Sorting"></a>Sorting</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sort(a[,axis,kind,order,])</code></td>
<td></td>
<td>在位排序</td>
</tr>
<tr>
<td><code>lexsort(keys[,axis])</code></td>
<td>根据<code>keys</code>中多组键沿<code>axis</code>轴排序（靠后优先级高）</td>
<td>无</td>
</tr>
<tr>
<td><code>msort(a)</code></td>
<td>沿第1轴排序</td>
<td>无</td>
</tr>
<tr>
<td><code>argsort(a[,axis,kind,order])</code></td>
<td>沿<code>axis</code>方向间接排序</td>
<td></td>
</tr>
<tr>
<td><code>sort_complex(a)</code></td>
<td>先实、后虚排序</td>
<td></td>
</tr>
<tr>
<td><code>partition(a,kth[,axis,kind,order])</code></td>
<td>以第<code>kth</code>大小数划分</td>
</tr>
<tr>
<td><code>argpartition(a,kth[,axis,kind,order])</code></td>
<td>间接分段</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><code>lexsort</code>：按照<code>axis</code>方向、以<code>keys</code>中数组顺序作为权重
进行间接排序<ul>
<li><code>keys</code>：数组序列或2维以上数组<ul>
<li>数组最高维视为序列</li>
<li><code>keys</code>为数组时，最高维被省略</li>
<li>多个数组视为权重不同的排序依据，靠后优先级高</li>
</ul>
</li>
<li><code>axis</code>：排序所沿轴方向，缺省为<code>-1</code>，沿最低维轴排序<ul>
<li>可视为按<code>keys</code>中数组逆序优先级，取用各数组沿轴
方向的间接排序结果</li>
<li>即对每个第1轴、<code>axis</code>构成平面，优先考虑第1轴末尾
<code>axis</code>方向数组进行排序，再依次考虑前序</li>
</ul>
</li>
<li><code>lexsort</code>、<code>argsort</code>排序方向相同时，<code>lexsort</code>结果中
最后子数组和<code>argsort</code>结果应差别不大
（排序方向相同而不是<code>axis</code>参数取值相同）</li>
</ul>
</li>
</ul>
<h2 id="Logical-Test"><a href="#Logical-Test" class="headerlink" title="Logical Test"></a>Logical Test</h2><h3 id="真值测试"><a href="#真值测试" class="headerlink" title="真值测试"></a>真值测试</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>all(a[,axis,out,keepdims])</code></td>
<td>给定轴方向所有元素为真</td>
<td></td>
</tr>
<tr>
<td><code>any(a[,axis,out,keepdims])</code></td>
<td>给定轴方向存在元素为真</td>
</tr>
</tbody>
</table>
</div>
<h3 id="数组内容"><a href="#数组内容" class="headerlink" title="数组内容"></a>数组内容</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>isfinite(x,/[,out,where,casting,order,...])</code></td>
<td>逐元素是否有限</td>
</tr>
<tr>
<td><code>isinf(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>isnan(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>isnat(x,/[,out,where,casting,order,...])</code></td>
<td>逐元素是否<code>NaT</code></td>
</tr>
<tr>
<td><code>isneginf(x,/[,out])</code></td>
<td></td>
</tr>
<tr>
<td><code>isposinf(x,/[,out])</code></td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<ul>
<li><code>isneginf</code>、<code>isposinf</code>行为类似<em>ufunc</em>，但不是</li>
</ul>
</blockquote>
<h3 id="类型测试"><a href="#类型测试" class="headerlink" title="类型测试"></a>类型测试</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iscomplex(x)</code></td>
<td></td>
</tr>
<tr>
<td><code>iscomplexobj(x)</code></td>
<td>复数类型或复数值</td>
</tr>
<tr>
<td><code>isfortran(a)</code></td>
<td>Fortran contiguous</td>
</tr>
<tr>
<td><code>isreal(x)</code></td>
<td></td>
</tr>
<tr>
<td><code>isrealobj(x)</code></td>
<td>实数类型或实数值</td>
</tr>
<tr>
<td><code>isscalar(x)</code></td>
</tr>
</tbody>
</table>
</div>
<h2 id="Mathmatics"><a href="#Mathmatics" class="headerlink" title="Mathmatics"></a>Mathmatics</h2><blockquote>
<ul>
<li>部分数学函数为<em>ufunc</em></li>
</ul>
</blockquote>
<h3 id="UFunc初等运算"><a href="#UFunc初等运算" class="headerlink" title="UFunc初等运算"></a>UFunc初等运算</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Function</th>
<th>Desc</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>add(x1,x2,/[out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>subtract(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>multiply(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>divide(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>true_devide(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>floor_devide(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>logaddexp(x1,x2,/[,out,where,casting,...])</code></td>
<td><code>ln(x1+x2)</code></td>
</tr>
<tr>
<td><code>logaddexp2(x1,x2,/[,out,where,casting,...])</code></td>
<td><code>log_2 (x1+x2)</code></td>
</tr>
<tr>
<td><code>negative(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>positive(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>power(x1,x2,/[,out,where,casting,order,...])</code></td>
<td><code>x1^x2</code></td>
</tr>
<tr>
<td><code>float_power(x1,x2,/[,out,where,casting,...])</code></td>
<td><code>x1^x2</code></td>
</tr>
<tr>
<td><code>remainder(x1,x2,/[,out,where,casting,...])</code></td>
<td>求余/取模</td>
</tr>
<tr>
<td><code>mod(x1,x2,/[,out,where,casting,order,...])</code></td>
<td>求余/取模</td>
</tr>
<tr>
<td><code>fmod(x1,x2,/[,out,where,casting,order,...])</code></td>
<td>求余/取模</td>
</tr>
<tr>
<td><code>divmod(x1,x2,/[,out1,out2],/[out,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>absolute(x,/[,out,where,casting,order,...])</code>/<code>abs</code></td>
<td></td>
</tr>
<tr>
<td><code>rint(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>sign(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>heaviside(x1,x2,/[,out,where,casting,...])</code></td>
<td>阶跃函数</td>
</tr>
<tr>
<td><code>conj(x,/[,out,where,casting,...])</code></td>
<td>对偶</td>
</tr>
<tr>
<td><code>exp(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>exp2(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>log(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>log2(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>log10(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>expm1(x,/[,out,where,casting,order,...])</code></td>
<td>计算<code>exp(x)-1</code></td>
</tr>
<tr>
<td><code>log1p(x,/[,out,where,casting,order,...])</code></td>
<td>计算<code>ln(x+1)</code></td>
</tr>
<tr>
<td><code>sqrt(x,/[,out,where,casting,order,...])</code></td>
<td>非负平方根</td>
</tr>
<tr>
<td><code>square(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>cbrt(x,/[,out,where,casting,order,...])</code></td>
<td>立方根</td>
</tr>
<tr>
<td><code>reciprocal(x,/[,out,where,casting,order,...])</code></td>
<td>倒数</td>
</tr>
<tr>
<td><code>gcd(x,/[,out,where,casting,order,...])</code></td>
<td>最大公约数</td>
</tr>
<tr>
<td><code>lcm(x,/[,out,where,casting,order,...])</code></td>
<td>最小公倍数</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><code>out</code>参数可用于节省内存，如：<code>G=A*B+C</code><ul>
<li>等价于：<code>t1=A*B; G=t1+C; del t1;</code></li>
<li>可利用<code>out</code>节省中间过程内存：<code>G=A*B; np.add(G,C,G)</code></li>
</ul>
</li>
</ul>
<h3 id="UFunc-Floating函数"><a href="#UFunc-Floating函数" class="headerlink" title="UFunc Floating函数"></a>UFunc Floating函数</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fabs(x,/[,out,where,casting,order,...])</code></td>
<td>不可用于复数</td>
</tr>
<tr>
<td><code>signbit(x,/[,out,where,casting,order,...])</code></td>
<td><em>signbit</em>是否设置，即<code>&lt;0</code></td>
</tr>
<tr>
<td><code>copysign(x1,x2,/[,out,where,casting,order,...])</code></td>
<td>根据<code>x1</code>设置<code>x2</code>的<em>signbit</em></td>
</tr>
<tr>
<td><code>nextafter(x1,x2,/[,out,where,casting,order,...])</code></td>
<td><code>x1</code>朝向<code>x2</code>的下个浮点数，即变动最小精度</td>
</tr>
<tr>
<td><code>spacing(x,/[,out,where,casting,order,...])</code></td>
<td><code>x</code>和最近浮点数距离，即取值的最小精度</td>
</tr>
<tr>
<td><code>modf(x[,out1,out2],/[,out,where],...)</code></td>
<td>返回取值的整数、小数部分</td>
</tr>
<tr>
<td><code>ldexp(x1,x2,/[,out,where,casting,...])</code></td>
<td>计算<code>x1*2**x2</code>，即还原2为底的科学计数</td>
</tr>
<tr>
<td><code>frexp(x[,out1,out2],/[,out,where],...)</code></td>
<td>返回2为底的科学计数的假数、指数</td>
</tr>
<tr>
<td><code>floor(x,/,out,*,where,...)</code></td>
<td></td>
</tr>
<tr>
<td><code>ceil(x,/,out,*,where,...)</code></td>
<td></td>
</tr>
<tr>
<td><code>trunc(x,/,out,*,where,...)</code></td>
<td></td>
</tr>
<tr>
<td><code>rint(x,/[,out,where,casting,order,...])</code></td>
<td>最近整数</td>
</tr>
<tr>
<td><code>around(a[,decimals,out])</code>/<code>round</code>/<code>round_</code></td>
<td></td>
</tr>
<tr>
<td><code>fix(x[,out])</code></td>
<td>向零点取整</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<ul>
<li><code>np.fix</code>不是<em>ufunc</em>，但行为类似</li>
</ul>
</blockquote>
<h3 id="比较函数"><a href="#比较函数" class="headerlink" title="比较函数"></a>比较函数</h3><ul>
<li><p>数值比较</p>
<ul>
<li><code>np.equal()</code>更多应用于整形比较，比较浮点使用
<code>np.isclose()</code>更合适</li>
<li><code>np.allclose()</code>则是判断数组整体是否相同</li>
<li><code>array_equal(a1,a2)</code>数组<code>a1</code>、<code>a2</code>相同</li>
<li><code>array_equiv(a1,a2)</code>数组<code>a1</code>、<code>a2</code>广播后相同</li>
</ul>
</li>
<li><p>逻辑运算符</p>
<ul>
<li><code>&amp;</code>、<code>|</code>、<code>~</code>：逐元素逻辑运算<ul>
<li>优先级高于比较运算符</li>
</ul>
</li>
<li><code>and</code>、<code>or</code>、<code>not</code>：整个数组的逻辑运算</li>
</ul>
</li>
<li><p><code>np.maximum()</code>、<code>np.minimum()</code>函数</p>
<ul>
<li><code>max()</code>寻找最大值效率比<code>np.maximum.reduce()</code>低，同样
<code>min()</code>效率也较低</li>
</ul>
</li>
</ul>
<h4 id="UFunc比较函数"><a href="#UFunc比较函数" class="headerlink" title="UFunc比较函数"></a>UFunc比较函数</h4><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>greater(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
<td><code>&gt;</code></td>
</tr>
<tr>
<td><code>greater_equal(x1,x2,/[,out,where,casting,...])</code></td>
<td><code>&gt;=</code></td>
</tr>
<tr>
<td><code>less(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
<td><code>&lt;</code></td>
</tr>
<tr>
<td><code>less_equal(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
<td><code>&lt;=</code></td>
</tr>
<tr>
<td><code>not_equal(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
<td><code>!=</code></td>
</tr>
<tr>
<td><code>equal(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
<td><code>==</code></td>
</tr>
<tr>
<td><code>logical_and(x1,x2,/[,out,where,casting,...])</code></td>
<td>逐元素<code>and</code></td>
<td><code>and</code></td>
</tr>
<tr>
<td><code>logical_or(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
<td><code>or</code></td>
</tr>
<tr>
<td><code>logical_xor(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
<td>无</td>
</tr>
<tr>
<td><code>logical_not(x1,x2,/[,out,where,casting,...])</code></td>
<td></td>
<td><code>not</code></td>
</tr>
<tr>
<td><code>maximum(x1,x2,/[,out,where,casting,...])</code></td>
<td>逐元素选择较大者</td>
<td></td>
</tr>
<tr>
<td><code>minimum(x1,x2,/[,out,where,casting,...])</code></td>
<td>逐元素选择较小者</td>
<td></td>
</tr>
<tr>
<td><code>fmax(x1,x2,/[,out,where,casting,...])</code></td>
<td>逐元素选择较大者，忽略<code>NaN</code></td>
<td></td>
</tr>
<tr>
<td><code>fmin(x1,x2,/[,out,where,casting,...])</code></td>
<td>逐元素选择较小者，忽略<code>NaN</code></td>
</tr>
</tbody>
</table>
</div>
<h4 id="非UFunc"><a href="#非UFunc" class="headerlink" title="非UFunc"></a>非UFunc</h4><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>isclose(a,b[,rtol,atol,equal_nan])</code></td>
<td>逐元素容忍度范围内相等</td>
</tr>
<tr>
<td><code>allclose(a,b[,rtol,atol,equal_nan])</code></td>
<td><code>all(isclose())</code></td>
</tr>
<tr>
<td><code>array_equal(a1,a2[,equal_nan])</code></td>
<td>数组整体</td>
</tr>
<tr>
<td><code>array_equiv(a1,a2)</code></td>
<td>广播后相等</td>
</tr>
</tbody>
</table>
</div>
<h3 id="UFunc-Bit-twiddling函数"><a href="#UFunc-Bit-twiddling函数" class="headerlink" title="UFunc Bit-twiddling函数"></a>UFunc Bit-twiddling函数</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bitwise_and(x1,x2,/[,out,where,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>bitwise_or(x1,x2,/[,out,where,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>bitwise_xor(x1,x2,/[,out,where,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>invert(x,/[,out,where,casting,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>left_shift(x1,x2,/[,out,where,casting...])</code></td>
<td></td>
</tr>
<tr>
<td><code>left_shift(x1,x2,/[,out,where,casting...])</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="UFunc-三角函数"><a href="#UFunc-三角函数" class="headerlink" title="UFunc 三角函数"></a>UFunc 三角函数</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sin(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>cos(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>tan(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>arcsin(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>arccos(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>arctan(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>arctan2(x1,x2,/[,out,where,casting,order,...])</code></td>
<td>考虑象限下，<code>arctan(x1/x2)</code></td>
</tr>
<tr>
<td><code>hypot(x1,x2,/[,out,where,casting,order,...])</code></td>
<td>计算斜边</td>
</tr>
<tr>
<td><code>sinh(x,/[,out,where,casting,order,...])</code></td>
<td>双曲正弦</td>
</tr>
<tr>
<td><code>cosh(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>tanh(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>arcsinh(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>arccosh(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>arctanh(x,/[,out,where,casting,order,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>deg2rad(x,/[,out,where,casting,order,...])</code></td>
<td>角度转换为弧度</td>
</tr>
<tr>
<td><code>rad2deg/degrees(x,/[,out,where,casting,order,...])</code></td>
<td>弧度转换为角度</td>
</tr>
</tbody>
</table>
</div>
<h3 id="基本数学"><a href="#基本数学" class="headerlink" title="基本数学"></a>基本数学</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>prod(a[,axis,dtype,out,keepdims,...])</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>nanprod(a[,axis,dtype,out,keepdims,...])</code></td>
<td></td>
<td>无</td>
</tr>
<tr>
<td><code>sum(a[,axis,dtype,out,keepdims,...])</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>nansum(a[,axis,dtype,out,keepdims,...])</code></td>
<td></td>
<td>无</td>
</tr>
<tr>
<td><code>cumprod(a[,axis,dtype,out,keepdims,...])</code></td>
<td>累乘（也可用<em>ufunc.accumulate</em>）</td>
<td></td>
</tr>
<tr>
<td><code>cumsum(a[,axis,dtype,out,keepdims,...])</code></td>
<td>累加</td>
<td></td>
</tr>
<tr>
<td><code>nancumprod(a[,axis,dtype,out,keepdims,...])</code></td>
<td><code>NaN</code>视为<code>1</code></td>
<td>无</td>
</tr>
<tr>
<td><code>nancumsum(a[,axis,dtype,out,keepdims,...])</code></td>
<td><code>NaN</code>视为<code>0</code></td>
<td>无</td>
</tr>
<tr>
<td><code>diff(a[,n,axis,prepend,append,...])</code></td>
<td>沿给定轴1阶差分（保持类型不变，注意溢出）</td>
<td>无</td>
</tr>
<tr>
<td><code>ediff1d(ary[,to_end,to_begin]</code></td>
<td>沿展平顺序1阶差分</td>
<td>无</td>
</tr>
<tr>
<td><code>gradient(f,*varargs,**kwargs)</code></td>
<td>梯度</td>
<td>无</td>
</tr>
<tr>
<td><code>cross(a,b[,axisa,axisb,axisc,axis])</code></td>
<td>向量叉积</td>
<td>无</td>
</tr>
<tr>
<td><code>trapz(y[,x,dx,axis])</code></td>
<td>梯形法则定积分</td>
<td>无</td>
</tr>
</tbody>
</table>
</div>
<h3 id="复数运算"><a href="#复数运算" class="headerlink" title="复数运算"></a>复数运算</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>angle(z[,deg])</code></td>
<td>角度</td>
<td>无</td>
</tr>
<tr>
<td><code>real(val)</code></td>
<td>实部</td>
<td></td>
</tr>
<tr>
<td><code>imag(val)</code></td>
<td>虚部</td>
<td></td>
</tr>
<tr>
<td><code>conj/conjugate(x,/[,out,where,casting,order,...])</code></td>
<td>复共轭</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Miscellaneous"><a href="#Miscellaneous" class="headerlink" title="Miscellaneous"></a>Miscellaneous</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>nan_to_num(x[,copy,nan,posinf,neginf])</code></td>
<td>替换<code>NaN</code>、<code>inf</code>为数值</td>
</tr>
<tr>
<td><code>real_if_close(a[,to])</code></td>
<td>虚部接近0则省略</td>
</tr>
<tr>
<td><code>interp(x,xp,fp[,left,right,period])</code></td>
<td>1维线性插值</td>
</tr>
<tr>
<td><code>polyfit(x,y,deg[,rcond,full,w,cov])</code></td>
<td>最小二乘多项式拟合</td>
</tr>
</tbody>
</table>
</div>
<h2 id="Statistics"><a href="#Statistics" class="headerlink" title="Statistics"></a>Statistics</h2><blockquote>
<ul>
<li><code>axis=None</code>：默认值<code>None</code>，表示在整个数组上执行操作</li>
</ul>
</blockquote>
<h3 id="Count"><a href="#Count" class="headerlink" title="Count"></a>Count</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>count_nonzero(a[,axis])</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="顺序"><a href="#顺序" class="headerlink" title="顺序"></a>顺序</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>amin/min(a[,axis,out,keepdims,initial,where])</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>amax/max(a[,axis,out,keepdims,initial,where])</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>nanmin(a[,axis,out,keepdims,initial,where])</code></td>
<td>忽略<code>NaN</code></td>
</tr>
<tr>
<td><code>nanmax(a[,axis,out,keepdims,initial,where])</code></td>
<td></td>
</tr>
<tr>
<td><code>ptp(a[,axis,out,keepdims])</code></td>
<td>极差</td>
<td></td>
</tr>
<tr>
<td><code>percentile(a,q[,axis,out,...])</code></td>
<td><code>q</code>取值<code>[0-100]</code></td>
<td>无</td>
</tr>
<tr>
<td><code>nanpercentile(a,q[,axis,out,...])</code></td>
<td></td>
<td>无</td>
</tr>
<tr>
<td><code>quantile(a,q[,axis,out,overwrite_input,...])</code></td>
<td><code>q</code>取值<code>[0,1]</code></td>
<td>无</td>
</tr>
<tr>
<td><code>nanquantile(a,q[,axis,out,...])</code></td>
<td></td>
<td>无</td>
</tr>
</tbody>
</table>
</div>
<h3 id="均值、方差"><a href="#均值、方差" class="headerlink" title="均值、方差"></a>均值、方差</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>median(a[,axis,out,overwrite_input,keepdims])</code></td>
<td></td>
<td>无</td>
</tr>
<tr>
<td><code>average(a[,axis,weights,returned])</code></td>
<td></td>
<td>无</td>
</tr>
<tr>
<td><code>mean(a[,axis,dtype,out,keepdims])</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>std(a[,axis,dtype,out,ddof,keepdims])</code></td>
<td>标准差</td>
<td></td>
</tr>
<tr>
<td><code>var(a[,axis,dtype,out,ddof,keepdims])</code></td>
<td>方查</td>
<td></td>
</tr>
<tr>
<td><code>nanmedian(a[,axis,out,overwrite_input,...])</code></td>
<td>无</td>
</tr>
<tr>
<td><code>nanmean(a[,axis,dtype,out,keepdims])</code></td>
<td>无</td>
</tr>
<tr>
<td><code>nanstd(a[,axis,dtype,out,ddof,keepdims])</code></td>
<td>无</td>
</tr>
<tr>
<td><code>nanvar(a[,axis,dtype,out,ddof,keepdims])</code></td>
<td>无</td>
</tr>
</tbody>
</table>
</div>
<h3 id="相关系数"><a href="#相关系数" class="headerlink" title="相关系数"></a>相关系数</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>corrcoef(x[,y,rowvar,bias,ddof])</code></td>
<td>Pearson积差相关系数</td>
</tr>
<tr>
<td><code>correlate(a,v[,mode])</code></td>
<td>卷积</td>
</tr>
<tr>
<td><code>convolve(a,v[,mode])</code></td>
<td>离散、线性卷积</td>
</tr>
<tr>
<td><code>cov(m[,y,rowvar,bias,ddof,fweights,...])</code></td>
<td>方差</td>
</tr>
</tbody>
</table>
</div>
<h2 id="Array-Creation"><a href="#Array-Creation" class="headerlink" title="Array Creation"></a>Array Creation</h2><h3 id="Ones-and-Zeros"><a href="#Ones-and-Zeros" class="headerlink" title="Ones and Zeros"></a>Ones and Zeros</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>empty(shape[,dtype,order])</code></td>
<td>无初始化</td>
</tr>
<tr>
<td><code>empty_like(prototype[,dtype,order,subok,...])</code></td>
<td>shape、类型同<code>prototype</code></td>
</tr>
<tr>
<td><code>eye(N[,M,k,dtype,order])</code></td>
<td>对角为1的2D数组</td>
</tr>
<tr>
<td><code>identity(n[,dtype])</code></td>
<td>单位矩阵数组</td>
</tr>
<tr>
<td><code>ones(shape[,dtype,order])</code></td>
<td></td>
</tr>
<tr>
<td><code>ones_like(a[,dtype,order,subok,shape])</code></td>
<td></td>
</tr>
<tr>
<td><code>zeros(shape[,dtype,order])</code></td>
<td></td>
</tr>
<tr>
<td><code>zeros_like(a[,dtype,order,subok,shape])</code></td>
<td></td>
</tr>
<tr>
<td><code>full(shape,fill_value[,dtype,order])</code></td>
<td>全<code>full_value</code>数组</td>
</tr>
<tr>
<td><code>full_like(a,fill_value[,dtype,order,...])</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="Numerical-Ranges"><a href="#Numerical-Ranges" class="headerlink" title="Numerical Ranges"></a>Numerical Ranges</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>arange([start,]stop[,step][,dtpye])</code></td>
<td>给定间距</td>
</tr>
<tr>
<td><code>linspace(start,stop[,num,endpoint])</code></td>
<td>给定数量，等差均分</td>
</tr>
<tr>
<td><code>geomspace(start,stop[,num,endpoint,base,...])</code></td>
<td>等比均分</td>
</tr>
<tr>
<td><code>logspace(start,stop[,num,endpoint,base,...])</code></td>
<td>在<em>log10</em>尺度上均分，同<code>np.power(10, np.linspace(start,stop))</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="Repetition"><a href="#Repetition" class="headerlink" title="Repetition"></a>Repetition</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tile(A,reps)</code></td>
<td>重复<code>A</code>（可是数组）创建一维数组</td>
<td>无</td>
</tr>
<tr>
<td><code>repeat(a,repeats[,axis])</code></td>
<td>沿已有轴重复<code>a</code>创建</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Matrix-Relative"><a href="#Matrix-Relative" class="headerlink" title="Matrix-Relative"></a>Matrix-Relative</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>diag(v[,k])</code></td>
<td>从2维<code>v</code>抽取对角、或以1维<code>v</code>作为对角</td>
</tr>
<tr>
<td><code>diagflat(v[,k])</code></td>
<td></td>
</tr>
<tr>
<td><code>tri(N[,M,k,dtype])</code></td>
<td>对角线及以下为1、其余为0矩阵</td>
</tr>
<tr>
<td><code>tril(m[,k])</code></td>
<td>下三角</td>
</tr>
<tr>
<td><code>triu(m[,k])</code></td>
<td>上三角</td>
</tr>
<tr>
<td><code>vander(x[,N,increasing])</code></td>
<td>Vandermonde矩阵</td>
</tr>
</tbody>
</table>
</div>
<h3 id="From-Existing-Data"><a href="#From-Existing-Data" class="headerlink" title="From Existing Data"></a>From Existing Data</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>array(object[,dtype,copy,order,subok,ndmin])</code></td>
<td></td>
</tr>
<tr>
<td><code>copy(a[,order])</code></td>
<td></td>
</tr>
<tr>
<td><code>frombuffer(buffer[,dtype,count,offset]</code></td>
<td>从缓冲（如字节串）创建数组</td>
</tr>
<tr>
<td><code>fromfunction(function,shape,**kwargs)</code></td>
<td>以坐标为参数，从函数创建数组</td>
</tr>
<tr>
<td><code>fromiter(iterable,dtype[,count])</code></td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<ul>
<li>改变数组数据类型也可以视为是创建新数组</li>
</ul>
</blockquote>
<h2 id="转入、转出"><a href="#转入、转出" class="headerlink" title="转入、转出"></a>转入、转出</h2><h3 id="类型转出"><a href="#类型转出" class="headerlink" title="类型转出"></a>类型转出</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.item(*args)</code></td>
<td>根据<code>args</code>选择元素复制至标准python标量</td>
</tr>
<tr>
<td><code>.tolist()</code></td>
<td>转换为<code>.ndim</code>层嵌套python标量列表</td>
</tr>
<tr>
<td><code>.itemset(*args)</code></td>
<td>插入元素（尝试转换类型）</td>
</tr>
<tr>
<td><code>.byteswap([inplace])</code></td>
<td>反转字节序</td>
</tr>
<tr>
<td><code>.view([dtype,type])</code></td>
<td>创建新视图</td>
</tr>
<tr>
<td><code>.getfield(dtype[,offset])</code></td>
<td>设置数据类型为指定类型</td>
</tr>
<tr>
<td><code>.setflags([write,align,uic])</code></td>
<td>设置标志</td>
</tr>
<tr>
<td><code>.fill(value)</code></td>
<td>使用标量填充</td>
</tr>
</tbody>
</table>
</div>
<h3 id="打包二进制"><a href="#打包二进制" class="headerlink" title="打包二进制"></a>打包二进制</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Function</th>
<th>Desc</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>packbits(a[,axis,bitorder])</code></td>
<td>元素打包为标志位，<code>0</code>补足，返回<code>uint8</code>数组</td>
</tr>
<tr>
<td><code>upackbits(a[,axis,bitorder])</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="输入、输出"><a href="#输入、输出" class="headerlink" title="输入、输出"></a>输入、输出</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>格式</th>
<th>输入</th>
<th>输出</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dump(file)</code></td>
<td>pickle</td>
<td>无</td>
<td>文件</td>
</tr>
<tr>
<td><code>tofile(fid[,sep,format])</code></td>
<td>内存内容（<code>sep=&quot;&quot;</code>）、分割符串</td>
<td>无</td>
<td>文件</td>
</tr>
<tr>
<td><code>fromfile(file[,dtype,count,sep,offset])</code></td>
<td>字节串、分割符串</td>
<td>文件</td>
<td>数组</td>
</tr>
<tr>
<td><code>save(file,arr[,allow_pickle,fix_imports])</code></td>
<td><code>.npy</code></td>
<td>数组</td>
<td>文件</td>
</tr>
<tr>
<td><code>savez(file,*args,**kwds)</code></td>
<td>非压缩的<code>.npz</code></td>
<td>（多个）数组</td>
<td>文件</td>
</tr>
<tr>
<td><code>savez_compressed(file,*args,**kwds)</code></td>
<td>压缩的<code>.npz</code></td>
<td>（多个）数组</td>
<td>无</td>
</tr>
<tr>
<td><code>load(file[,mmap_mode,allow_pickle,...])</code></td>
<td><code>.npy</code>、<code>.npz</code>、pickle</td>
<td>文件</td>
<td>数组</td>
</tr>
<tr>
<td><code>savetxt(fname,X[,fmt,delimiter,newline,...])</code></td>
<td>分割符串</td>
<td>二维以下数组</td>
<td>文件</td>
</tr>
<tr>
<td><code>loadtxt(fname[,dtype,comments,delimiter,...])</code></td>
<td>分割符串</td>
<td>文件</td>
<td>数组</td>
</tr>
<tr>
<td><code>genfromtxt(fname[,dtype,comments,...])</code></td>
<td>分割符串</td>
<td>文件</td>
<td>数组</td>
</tr>
<tr>
<td><code>fromregex(file,regexp,dtype[,encoding])</code></td>
<td>正则表达式结构</td>
<td>文件</td>
<td>数组</td>
</tr>
</tbody>
</table>
</div>
<h3 id="串"><a href="#串" class="headerlink" title="串"></a>串</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
<th>Method Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>array2string(a[,max_line_width,precision,...])</code></td>
<td></td>
<td><code>__str__</code></td>
</tr>
<tr>
<td><code>array_repr(arr[,max_line_width,precision,...])</code></td>
<td></td>
<td><code>__repr__</code></td>
</tr>
<tr>
<td><code>array_str(arr[,max_line_width,precision,...])</code></td>
<td></td>
<td><code>__str__</code></td>
</tr>
<tr>
<td><code>dumps()</code></td>
<td>无</td>
<td>pickle序列化</td>
</tr>
<tr>
<td><code>loads(*args,**kwargs)</code></td>
<td>pickle</td>
<td>字节串</td>
<td>数组</td>
</tr>
<tr>
<td><code>tobytes([order])</code>/<code>tostring</code></td>
<td>内存内容字节串</td>
</tr>
<tr>
<td><code>fromstring(string[,dtype,count,sep])</code></td>
<td>从字符串、字节串（<code>sep=&quot;&quot;</code>，且缺省）创建1维数组</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><code>np.loads</code>即<code>pickle.loads</code>，不建议使用</li>
<li><code>np.fromstring</code><ul>
<li><code>sep=&quot;&quot;</code>：从二进制字节串中创建数组，类<code>frombuffer</code></li>
<li><code>sep</code>置为分割符时，只能指定一种元素分隔符，也只能
解析1维数组的字符串</li>
</ul>
</li>
</ul>
<h3 id="字符串输出格式"><a href="#字符串输出格式" class="headerlink" title="字符串输出格式"></a>字符串输出格式</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Routine</th>
<th>Function Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>format_float_positional(x[,precision,...])</code></td>
<td>格式化位置计数</td>
</tr>
<tr>
<td><code>format_float_scientific(x[,precision,...])</code></td>
<td>格式化科学计数</td>
</tr>
<tr>
<td><code>set_printoptions([precision,threshold,...])</code></td>
<td></td>
</tr>
<tr>
<td><code>get_printoptions()</code></td>
<td></td>
</tr>
<tr>
<td><code>set_string_function(f[,repr])</code></td>
<td></td>
</tr>
<tr>
<td><code>printoptions(*args,**kwargs)</code></td>
<td>设置打印选项的上下文管理器</td>
</tr>
<tr>
<td><code>binary_repr(num[,width])</code></td>
<td>二进制字符串</td>
</tr>
<tr>
<td><code>base_repr(number[,base,padding])</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="Data-Source"><a href="#Data-Source" class="headerlink" title="Data Source"></a>Data Source</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Function</th>
<th>Desc</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DataSource([destpath])</code></td>
<td>通用数据源文件（file，http，ftp等）</td>
</tr>
</tbody>
</table>
</div>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-02T15:17:39.000Z" title="8/2/2019, 11:17:39 PM">2019-08-02</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-08-02T15:17:39.000Z" title="8/2/2019, 11:17:39 PM">2019-08-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Java/">Java</a><span> / </span><a class="link-muted" href="/categories/Java/Scala/">Scala</a></span><span class="level-item">28 minutes read (About 4219 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Java/Scala/entity_components.html">Scala 基本实体</a></h1><div class="content"><h2 id="Expression"><a href="#Expression" class="headerlink" title="Expression"></a><em>Expression</em></h2><p>表达式：可计算的语句</p>
<ul>
<li><em>value</em>：常量，引用常量不会再次计算<ul>
<li>不能被重新赋值</li>
<li>类型可以被推断、也可以显式声明类型</li>
<li>可以被声明为<code>lazy</code>，只有被真正使用时才被赋值</li>
</ul>
</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> constant = <span class="number">1</span></span><br><span class="line"><span class="keyword">lazy</span> <span class="keyword">val</span> lazy_constant = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> variable = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<ul>
<li><em>variable</em>：变量，除可重新赋值外类似常量</li>
</ul>
<h3 id="Unified-Types"><a href="#Unified-Types" class="headerlink" title="Unified Types"></a><em>Unified Types</em></h3><blockquote>
<ul>
<li>Scala中所有值都有类型，包括数值、函数</li>
</ul>
</blockquote>
<h4 id="类型层次结构"><a href="#类型层次结构" class="headerlink" title="类型层次结构"></a>类型层次结构</h4><p><img src="/imgs/scala_unified_types_diagram.svg" alt="scala_unified_types_diagram"></p>
<ul>
<li><p><code>Any</code>：顶级类型，所有类型超类</p>
<ul>
<li>定义一些通用方法<ul>
<li><code>equals</code></li>
<li><code>hashCode</code></li>
<li><code>toString</code></li>
</ul>
</li>
</ul>
</li>
<li><p><code>AnyVal</code>：值类型</p>
<ul>
<li>有9个预定义非空值类型<ul>
<li><code>Double</code></li>
<li><code>Float</code></li>
<li><code>Long</code></li>
<li><code>Int</code></li>
<li><code>Short</code></li>
<li><code>Byte</code></li>
<li><code>Char</code></li>
<li><code>Boolean</code></li>
<li><code>Unit</code>：唯一单例值<code>()</code></li>
</ul>
</li>
<li>值类型可以按以下方向转换（非父子类之间）
<img src="/imgs/scala_value_types_casting_diagram.svg" alt="scala_value_types_casting_diagram"></li>
</ul>
</li>
<li><p><code>AnyRef</code>：引用类型</p>
<ul>
<li>所有非值类型都被定义为引用类型</li>
<li>用户自定义类型都是其子类型</li>
<li>若Scala被应用于Java运行环境中，<code>AnyRef</code>相当于
<code>java.lang.object</code></li>
</ul>
</li>
<li><p><code>Nothing</code>：底部类型，所有类型的子类型</p>
<ul>
<li>没有值是<code>Nothing</code>类型</li>
<li>可以视为<ul>
<li><strong>不对值进行定义的表达式</strong>的类型</li>
<li>不能正常返回的方法</li>
</ul>
</li>
<li>用途<ul>
<li>给出非正常终止的信号：抛出异常、程序退出、死循环</li>
</ul>
</li>
</ul>
</li>
<li><p><code>NULL</code>：所有引用类型的子类型</p>
<ul>
<li>唯一单例值<code>null</code></li>
<li>用途<ul>
<li>使得Scala满足和其他JVM语言的互操作性，几乎不应该
在Scala代码中使用</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h4><div class="table-container">
<table>
<thead>
<tr>
<th>数据类型</th>
<th>取值范围</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Byte</code></td>
<td>$[-2^7, 2^7-1]$</td>
<td></td>
</tr>
<tr>
<td><code>Short</code></td>
<td>$[-2^{15}, 2^{15}-1]$</td>
<td></td>
</tr>
<tr>
<td><code>Int</code></td>
<td>$[-2^{31}, 2^{31}-1]$</td>
<td></td>
</tr>
<tr>
<td><code>Long</code></td>
<td>$[-2^{63}, 2^{63}]$</td>
<td></td>
</tr>
<tr>
<td><code>Char</code></td>
<td>$[0, 2^{16}-1]$</td>
<td></td>
</tr>
<tr>
<td><code>String</code></td>
<td>连续字符串</td>
<td><strong>按值比较</strong></td>
</tr>
<tr>
<td><code>Float</code></td>
<td>32bits浮点</td>
<td></td>
</tr>
<tr>
<td><code>Double</code></td>
<td>64bits浮点</td>
<td></td>
</tr>
<tr>
<td><code>Boolean</code></td>
<td><code>true</code>、<code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>Unit</code></td>
<td><code>()</code></td>
<td>不带任何意义的值类型</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> x = <span class="number">0x2F</span>		<span class="comment">// 16进制</span></span><br><span class="line"><span class="keyword">val</span> x = <span class="number">41</span>			<span class="comment">// 10进制</span></span><br><span class="line"><span class="keyword">val</span> x = <span class="number">041</span>			<span class="comment">// 8进制</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> f = <span class="number">3.14</span>F</span><br><span class="line"><span class="keyword">val</span> f = <span class="number">3.14</span>f		<span class="comment">// `Float`浮点</span></span><br><span class="line"><span class="keyword">val</span> d = <span class="number">3.14</span></span><br><span class="line"><span class="keyword">val</span> d = <span class="number">0.314e1</span>		<span class="comment">// `Double`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> c = &#x27;<span class="type">A</span>&#x27;</span><br><span class="line"><span class="keyword">val</span> c = &#x27;\u0022&#x27;</span><br><span class="line"><span class="keyword">val</span> c = &#x27;\<span class="string">&quot;&#x27;		// `Char类型`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">val str = &quot;</span>\<span class="string">&quot;hello, world\&quot;&quot;</span>		<span class="comment">// 字符串</span></span><br><span class="line"><span class="keyword">val</span> str = <span class="string">&quot;&quot;&quot;&quot;hello, world&quot;&quot;&quot;</span><span class="string">&quot;		// 忽略转义</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var x = true</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><code>Unit</code>值<code>()</code>在概念上与<code>Tuple0</code>值<code>()</code>相同（均唯一单例值）
  （但<code>Tuple0</code>类型不存在？？？）</li>
</ul>
</blockquote>
<h4 id="Tuples"><a href="#Tuples" class="headerlink" title="Tuples"></a><em>Tuples</em></h4><p>元组：不同类型值的聚集，可将不同类型的值放在同一个变量中保存</p>
<ul>
<li><p>元组包含一系列类：<code>Tuple2</code>、<code>Tuple3</code>直到<code>Tuple22</code></p>
<ul>
<li>创建包含n个元素的元组时，就是从中实例化相应类，用
组成元素的类型进行参数化</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li>比较：按值（内容）比较</li>
<li>输出：输出括号包括的内容</li>
</ul>
</li>
<li><p>访问元素</p>
<ul>
<li><code>&lt;tuple&gt;._&lt;n&gt;</code>：访问元组中第n个元素（从1开始）</li>
<li>元组支持模式匹配[解构]</li>
</ul>
</li>
<li><p>用途</p>
<ul>
<li>需要从函数中返回多个值</li>
</ul>
</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> t3 = (<span class="string">&quot;hello&quot;</span>, <span class="number">1</span>, <span class="number">3.14</span>)</span><br><span class="line"><span class="keyword">val</span> (str, i, d) = t3</span><br><span class="line"><span class="comment">// 必须括号包裹，否则三个变量被赋同值</span></span><br><span class="line">println(t3._1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> t2 = (<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">val</span> t22 = <span class="number">1</span> -&gt; <span class="number">3</span></span><br><span class="line"><span class="comment">// `-&gt;`同样可以用于创建元组</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>基于内容的比较衍生出模式匹配提取</li>
<li>如果元素具有更多含义选择<code>case class</code>，否则选择元组</li>
</ul>
</blockquote>
<h4 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a><em>Symbol</em></h4><p>符号类型：起标识作用，在模式匹配、内容判断中常用</p>
<ul>
<li>特点<ul>
<li>比较：按内容比较</li>
<li>输出：原样输出</li>
</ul>
</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> s: <span class="type">Symbol</span> = <span class="symbol">&#x27;start</span></span><br><span class="line"><span class="keyword">if</span> (s == <span class="symbol">&#x27;start</span>) println(<span class="string">&quot;start......&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="运算符号"><a href="#运算符号" class="headerlink" title="运算符号"></a>运算符号</h3><ul>
<li><p>任何具有单个参数的方法都可以用作<strong>中缀运算符</strong>，而运算符
（狭义）就是普通方法</p>
<ul>
<li>可以使用点号调用</li>
<li>可以像普通方法一样定义运算符<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Vec</span>(<span class="params">val x: <span class="type">Double</span>, val y: <span class="type">Double</span></span>)</span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">+</span></span>(that: <span class="type">Vec</span>) =</span><br><span class="line">		<span class="keyword">new</span> <span class="type">Vec</span>(<span class="keyword">this</span>.x + that.x, <span class="keyword">this</span>.y + that.y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>表达式中运算符优先级：根据运算符第一个字符评估优先级</p>
<ul>
<li>其他未列出字符</li>
<li><code>*</code>、<code>/</code>、<code>%</code></li>
<li><code>+</code>、<code>-</code></li>
<li><code>:</code></li>
<li><code>+!</code></li>
<li><code>&lt;</code>、<code>&gt;</code></li>
<li><code>&amp;</code></li>
<li><code>^</code></li>
<li><code>|</code></li>
<li>所有字母：<code>[a-zA-Z]</code></li>
</ul>
</li>
</ul>
<h4 id="数值运算"><a href="#数值运算" class="headerlink" title="数值运算"></a>数值运算</h4><ul>
<li><p>四则运算</p>
<ul>
<li><code>+</code></li>
<li><code>-</code></li>
<li><code>*</code></li>
<li><code>/</code></li>
<li><code>%</code></li>
</ul>
</li>
<li><p>按位</p>
<ul>
<li><code>&amp;</code>、<code>|</code>、<code>^</code>、<code>~</code></li>
<li><code>&gt;&gt;</code>/<code>&lt;&lt;</code>：有符号移位</li>
<li><code>&gt;&gt;&gt;</code>/<code>&lt;&lt;&lt;</code>：无符号移位</li>
</ul>
</li>
<li><p>比较运算</p>
</li>
<li><code>&gt;</code>、<code>&lt;</code>、<code>&lt;=</code>、<code>&gt;=</code></li>
<li><code>==</code>/<code>equals</code>：基于内容比较</li>
<li><p><code>eq</code>：基于引用比较</p>
</li>
<li><p>逻辑运算</p>
<ul>
<li><code>||</code>、<code>&amp;&amp;</code></li>
</ul>
</li>
</ul>
<h4 id="字符串运算"><a href="#字符串运算" class="headerlink" title="字符串运算"></a>字符串运算</h4><blockquote>
<ul>
<li>Scala中<code>String</code>实际就是Java中<code>java.lang.String</code>类型<blockquote>
<ul>
<li>可调用Java中<code>String</code>所有方法</li>
<li>并定义有将<code>String</code>转换为<code>StingOps</code>类型的隐式转换函数
 ，可用某某些额外方法</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<ul>
<li><code>indexOf(&lt;idx&gt;)</code></li>
<li><code>toUppercase</code>、<code>toLowercase</code></li>
<li><code>reverse</code></li>
<li><code>drop(&lt;idx&gt;)</code></li>
<li><code>slice&lt;&lt;start&gt;,&lt;end&gt;&gt;</code></li>
<li><code>.r</code>：字符串转换为正则表达式对象</li>
</ul>
<h3 id="类型推断"><a href="#类型推断" class="headerlink" title="类型推断"></a>类型推断</h3><ul>
<li><p>编译器通常可以推断出</p>
<ul>
<li>表达式类型：工作原理类似推断方法返回值类型</li>
<li><strong>非递归方法</strong>的返回值类型</li>
<li>多态方法、泛型类中泛型参数类型</li>
</ul>
</li>
<li><p>编译器不推断方法的形参类型</p>
<ul>
<li>但某些情况下，编译器可以推断作为参数传递的匿名函数
形参类型</li>
</ul>
</li>
<li><p>不应该依赖类型推断场合</p>
<ul>
<li>公开可访问API成员应该具有显式类型声明以增加可读性</li>
<li><p>避免类型推断推断类型太具体</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="literal">null</span></span><br><span class="line"><span class="comment">// 被推断为为`Null`类型仅有单例值，不能再分配其他值</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h3><p>类型别名：<strong>具体类型</strong>别名</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 泛型参数必须指定具体类型</span></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">JHashMap</span> </span>= java.util.<span class="type">HashMap</span>[<span class="type">String</span>, <span class="type">String</span>]</span><br></pre></td></tr></table></figure>
<h2 id="Code-Blocks"><a href="#Code-Blocks" class="headerlink" title="Code Blocks"></a><em>Code Blocks</em></h2><p>代码块：使用<code>&#123;&#125;</code>包围的表达式组合</p>
<ul>
<li>代码块中最后表达式的结果作为整个代码块的结果<ul>
<li>Scala建议使用纯函数，函数不应该有副作用</li>
<li>所以其中基本应该没有语句概念，所有代码块均可视为
表达式，用于赋值语句</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><code>&#123;&#125;</code>：允许换行的<code>()</code>，Scala中<code>&#123;&#125;</code>基本同<code>()</code></li>
</ul>
</blockquote>
<h3 id="控制表达式"><a href="#控制表达式" class="headerlink" title="控制表达式"></a>控制表达式</h3><h4 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a><code>if</code>语句</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(&lt;eva_expr&gt;)&#123;</span><br><span class="line">	<span class="comment">// code-block if true</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(&lt;eva_expr&gt;)&#123;</span><br><span class="line">	<span class="comment">// code-block</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="comment">// code-block if false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>返回值：对应函数块返回值</li>
</ul>
<h4 id="while语句"><a href="#while语句" class="headerlink" title="while语句"></a><code>while</code>语句</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(&lt;eva_expr&gt;)&#123;</span><br><span class="line">	<span class="comment">// code-block if true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Scala中<code>while</code>作用被弱化、不推荐使用</li>
<li>返回值：始终为<code>Unit</code>类型<code>()</code></li>
</ul>
<h4 id="for语句"><a href="#for语句" class="headerlink" title="for语句"></a><code>for</code>语句</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>&#123;</span><br><span class="line">	&lt;item1&gt; &lt;- &lt;iter1&gt;</span><br><span class="line">	&lt;item2&gt; &lt;- &lt;iter2&gt;</span><br><span class="line">	<span class="keyword">if</span> &lt;filter_exp&gt;</span><br><span class="line">	<span class="keyword">if</span> &lt;filter_exp&gt;</span><br><span class="line">&#125;&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>以上在同语句中<strong>多个迭代表达式</strong>等价于嵌套<code>for</code></li>
<li>返回值<ul>
<li>默认返回<code>Unit</code>类型<code>()</code></li>
<li>配合<code>yield</code>返回值迭代器（元素会被消耗）</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>注意：迭代器中元素会被消耗，大部分情况不应该直接在嵌套
  <code>for</code>语句中使用</li>
</ul>
</blockquote>
<h3 id="match模式匹配"><a href="#match模式匹配" class="headerlink" title="match模式匹配"></a><code>match</code>模式匹配</h3><ul>
<li><p>模式匹配的候选模式</p>
<ul>
<li>常量</li>
<li>构造函数：解构对象<ul>
<li>需伴生对象实现有<code>unapply</code>方法，如：<code>case class</code></li>
</ul>
</li>
<li>序列<ul>
<li>需要类伴生对象实现有<code>unapplySeq</code>方法，如：
<code>Seq[+A]</code>类、及其子类</li>
</ul>
</li>
<li>元组</li>
<li>类型：适合需要对不同类型对象需要调用不同方法<ul>
<li>一般使用类型首字母作为<code>case</code>标识符<code>name</code></li>
<li>对密封类，无需匹配其他任意情况的case</li>
<li>不匹配可以隐式转换的类型</li>
</ul>
</li>
<li>变量绑定</li>
</ul>
</li>
<li><p>候选模式可以增加<em>pattern guards</em>以更灵活的控制程序</p>
</li>
<li><p>模式匹配可以视为<strong>解构已有值，将解构结果map至给定名称</strong></p>
<ul>
<li>可以用于<strong>普通赋值语句</strong>中用于解构模式</li>
<li>显然也适合于<code>for</code>语句中模式匹配</li>
</ul>
</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;target&gt; <span class="keyword">match</span> &#123;</span><br><span class="line">	<span class="comment">// 常量模式 + 守卫语句</span></span><br><span class="line">	<span class="keyword">case</span> x <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span> =&gt; </span><br><span class="line">	<span class="comment">// 构造函数模式</span></span><br><span class="line">	<span class="keyword">case</span> <span class="type">Dog</span>(a, b) =&gt; </span><br><span class="line">	<span class="comment">// 序列模式</span></span><br><span class="line">	<span class="keyword">case</span> <span class="type">Array</span>(_, second) =&gt;</span><br><span class="line">	<span class="comment">// 元组模式</span></span><br><span class="line">	<span class="keyword">case</span> (second, _*) =&gt;</span><br><span class="line">	<span class="comment">// 类型模式</span></span><br><span class="line">	<span class="keyword">case</span> str: <span class="type">String</span> =&gt;</span><br><span class="line">	<span class="comment">// 变量绑定</span></span><br><span class="line">	<span class="keyword">case</span> all<span class="meta">@Dog</span>(name, _) =&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通赋值语句中模式匹配</span></span><br><span class="line"><span class="keyword">val</span> all<span class="meta">@Array</span>(head, _*) = <span class="type">Array</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>可在普通类伴生对象中实现<code>unapply</code>、<code>unapplySeq</code>实现模式
  匹配，此单例对象称为<em>extractor objects</em></li>
</ul>
</blockquote>
<h4 id="unapply"><a href="#unapply" class="headerlink" title="unapply"></a><code>unapply</code></h4><p><code>unapply</code>方法：接受实例对象、返回创建其所用的参数</p>
<ul>
<li>构造模式依靠类伴生对象中<code>unapply</code>实现</li>
<li><code>unapply</code>方法返回值应该符合<ul>
<li>若用于判断真假，可以返回<code>Boolean</code>类型值</li>
<li>若用于提取单个<code>T</code>类型的值，可以返回<code>Option[T]</code></li>
<li>若需要提取多个类型的值，可以将其放在可选元组
<code>Option[(T1, T2, ..., Tn)]</code></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><code>case class</code>默认实现有此方法</li>
</ul>
</blockquote>
<pre><code><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>(<span class="params">val name: <span class="type">String</span>, val age: <span class="type">Int</span></span>)</span>&#123;</span><br><span class="line"><span class="comment">// 伴生对象中定义`unapply`方法解构对象</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Dog</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">unapply</span></span>(dog: <span class="type">Dog</span>): <span class="type">Option</span>[(<span class="type">String</span>, <span class="type">Int</span>)]&#123;</span><br><span class="line">		<span class="keyword">if</span> (dog!=<span class="literal">null</span>) <span class="type">Some</span>(dog.name, dog.age)</span><br><span class="line">		<span class="keyword">else</span> <span class="type">None</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><h4 id="unapplySeq"><a href="#unapplySeq" class="headerlink" title="unapplySeq"></a><code>unapplySeq</code></h4><p><code>unapplySeq</code>方法：接受实例对象、返回创建其所用的序列</p>
<ul>
<li>序列模式依靠类伴生对象中<code>unapplySeq</code>实现</li>
<li>方法应返回<code>Option[Seq[T]]</code></li>
</ul>
<blockquote>
<ul>
<li><code>Seq[A+]</code>默认实现此方法</li>
</ul>
</blockquote>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// `scala.Array`伴生对象定义</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Array</span> <span class="keyword">extends</span> <span class="title">FallbackArrayBuilding</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">T</span>: <span class="type">ClassTag</span>](xs: <span class="type">T</span>*): <span class="type">Array</span>[<span class="type">T</span>] = &#123;</span><br><span class="line">		<span class="keyword">val</span> array = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">T</span>](xs.length)</span><br><span class="line">		<span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span>(x &lt;- xs.iterator) &#123;</span><br><span class="line">			array(i) = x</span><br><span class="line">			i += <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">		array</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[x: <span class="type">Boolean</span>, xs: <span class="type">Boolean</span>*]: <span class="type">Array</span>[<span class="type">Boolean</span>] = &#123;</span><br><span class="line">		<span class="keyword">val</span> array = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Boolean</span>](xs.length + <span class="number">1</span>)</span><br><span class="line">		array(<span class="number">0</span>) = x</span><br><span class="line">		<span class="keyword">var</span> i = <span class="number">1</span></span><br><span class="line">		<span class="keyword">for</span>(x &lt;- xs.iterator)&#123;</span><br><span class="line">			array(i) = x</span><br><span class="line">			i += <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">		array</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 省略其它`apply`方法 */</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">unapplySeq</span></span>[<span class="type">T</span>](x: <span class="type">Array</span>[<span class="type">T</span>]): <span class="type">Option</span>[<span class="type">IndexedSeq</span>[<span class="type">T</span>]] =</span><br><span class="line">		<span class="keyword">if</span>(x == <span class="literal">null</span>) <span class="type">None</span></span><br><span class="line">		<span class="keyword">else</span> <span class="type">Some</span>(x.toIndexedSeq)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="正则表达式模式匹配"><a href="#正则表达式模式匹配" class="headerlink" title="正则表达式模式匹配"></a>正则表达式模式匹配</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.util.matching.&#123;<span class="type">Regex</span>, <span class="type">MatchIterator</span>&#125;</span><br><span class="line"><span class="comment">// `.r`方法将字符串转换为正则表达式</span></span><br><span class="line"><span class="keyword">val</span> dateP = <span class="string">&quot;&quot;&quot;(\d\d\d\d)-(\d\d)-(\d\d)&quot;&quot;&quot;</span>.r</span><br><span class="line"><span class="keyword">val</span> dateP = <span class="keyword">new</span> <span class="type">Regex</span>(<span class="string">&quot;&quot;&quot;(\d\d\d\d)-(\d\d)-(\d\d)&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用`Regex`的`unapplySeq`实现模式匹配</span></span><br><span class="line"><span class="comment">// 不过此应该是定义在`Regex`类而不是伴生对象中</span></span><br><span class="line"><span class="keyword">for</span>(date &lt;- dateP.findAllIn(<span class="string">&quot;2015-12-31 2016-01-01&quot;</span>))&#123;</span><br><span class="line">	date <span class="keyword">match</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> dateRegex(year, month, day) =&gt;</span><br><span class="line">		<span class="keyword">case</span> _ =&gt;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// `for`语句中模式匹配</span></span><br><span class="line"><span class="keyword">for</span>(dateP(year, month, day) &lt;- dateP.findAllIn(<span class="string">&quot;2015-12-31 2016-01-01&quot;</span>))&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><code>scala.util.matching</code>具体参见<code>cs_java/scala/stdlib</code></li>
</ul>
</blockquote>
<h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a><em>Functions</em></h2><p>函数：带有参数的表达式</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 带一个参数的匿名函数，一般用作高阶函数参数</span></span><br><span class="line"><span class="type">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>).map((x: <span class="type">Int</span>) =&gt; x + <span class="number">1</span>)</span><br><span class="line"><span class="type">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>).map(_+<span class="number">1</span>)			<span class="comment">// 简化写法</span></span><br><span class="line"><span class="comment">// 具名函数</span></span><br><span class="line"><span class="keyword">val</span> fx: <span class="type">Float</span> =&gt; <span class="type">Int</span> = (x: <span class="type">Float</span>) =&gt; x.toInt</span><br></pre></td></tr></table></figure>
<ul>
<li><p>函数结构</p>
<ul>
<li>可以带有多个参数、不带参数</li>
<li>无法显式声明返回值类型</li>
</ul>
</li>
<li><p>函数可以类似普通常量使用<code>lazy</code>修饰，当函数被使用时才会被
创建</p>
</li>
<li><p>作高阶函数参数时可简化</p>
<ul>
<li>参数类型可推断、可被省略</li>
<li>仅有一个参数，可省略参数周围括号</li>
<li>仅有一个参数，可使用占位符<code>_</code>替代参数声明整体</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>Java：函数被编译为内部类，使用时被创建为对象、赋值给相应
  变量</li>
<li>Scala中函数是“一等公民”，允许定义高阶函数、方法<blockquote>
<ul>
<li>可以传入对象方法作为高阶函数的参数，Scala编译器会将
 方法强制转换为函数</li>
<li>使用高阶函数利于减少冗余代码</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h3 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h3><p>函数类型：Scala中有<code>Funtion&lt;N&gt;[T1, T2, ..., TN+1]</code>共22种函数
类型，最后泛型参数为返回值类型</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实例化`Function2[T1, T2, T3]`创建函数</span></span><br><span class="line"><span class="keyword">val</span> sum = <span class="keyword">new</span> <span class="type">Function2</span>[<span class="type">Int</span>, <span class="type">Int</span>, <span class="type">Int</span>] &#123;</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(x: <span class="type">Int</span>, y: <span class="type">Int</span>): <span class="type">Int</span> = x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> sum = (x: <span class="type">Int</span>, y: <span class="type">Int</span>) =&gt; x + y</span><br></pre></td></tr></table></figure>
<h3 id="偏函数"><a href="#偏函数" class="headerlink" title="偏函数"></a>偏函数</h3><p>偏函数：只处理参数定义域中子集，子集之外参数抛出异常</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scala中定义</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">PartialFunction</span>[-<span class="type">A</span>, +<span class="type">B</span>] <span class="keyword">extends</span> (<span class="params"><span class="type">A</span> =&gt; <span class="type">B</span></span>)</span>&#123;</span><br><span class="line">	<span class="comment">// 判断元素在偏函数处理范围内</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">isDefinedAt</span></span>(?ele: <span class="type">A</span>)</span><br><span class="line">	<span class="comment">// 组合多个偏函数</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">orElse</span></span>(?pf: <span class="type">PartialFunction</span>[<span class="type">A</span>, <span class="type">B</span>])</span><br><span class="line">	<span class="comment">// 方法的连续调用</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">addThen</span></span>(?pf: <span class="type">PartialFunction</span>[<span class="type">A</span>, <span class="type">B</span>])</span><br><span class="line">	<span class="comment">// 匹配则调用、否则调用回调函数</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">applyOrElse</span></span>(?ele: <span class="type">A</span>, ?callback: <span class="type">Function1</span>[<span class="type">B</span>, <span class="type">Any</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>偏函数实现了<code>Function1</code>特质</li>
<li>用途<ul>
<li>适合作为<code>map</code>函数参数，利用模式匹配简化代码</li>
</ul>
</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> receive: <span class="type">PartialFunction</span>[<span class="type">Any</span>, <span class="type">Unit</span>] = &#123;</span><br><span class="line">	<span class="keyword">case</span> x: <span class="type">Int</span> =&gt; println(<span class="string">&quot;Int type&quot;</span>)</span><br><span class="line">	<span class="keyword">case</span> x: <span class="type">String</span> =&gt; println(<span class="string">&quot;String type&quot;</span>)</span><br><span class="line">	<span class="keyword">case</span> _ =&gt; println(<span class="string">&quot;other type&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a><em>Methods</em></h2><p>方法：表现、行为类似函数，但有关键差别</p>
<ul>
<li><p><code>def</code>定义方法，包括方法名、参数列表、返回类型、方法体</p>
</li>
<li><p>方法可以接受多个<strong>参数列表</strong>、没有参数列表</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addThenMutltiply</span></span>(x: <span class="type">Int</span>, y: <span class="type">Int</span>)(multiplier: <span class="type">Int</span>): <span class="type">Int</span> = (x+y) * multiplier</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">name</span></span>: <span class="type">String</span> = <span class="type">System</span>.getProperty(<span class="string">&quot;user.name&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Scala中可以嵌套定义方法</p>
</li>
</ul>
<blockquote>
<ul>
<li>Java中全在类内，确实都是方法</li>
</ul>
</blockquote>
<h3 id="Currying"><a href="#Currying" class="headerlink" title="Currying"></a><em>Currying</em></h3><p>柯里化：使用较少的参数列表调用多参数列表方法时会产生新函数，
该函数接受剩余参数列表作为其参数</p>
<ul>
<li>多参数列表/参数分段有更复杂的调用语法，适用场景<ul>
<li>给定部分参数列表<ul>
<li>可以尽可能利用类型推断，简化代码</li>
<li>创建新函数，复用代码</li>
</ul>
</li>
<li>指定参数列表中部分参数为<code>implicit</code></li>
</ul>
</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> number = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>)</span><br><span class="line">numbers.foldLeft(<span class="number">0</span>)(_ + _)</span><br><span class="line"><span class="comment">// 柯里化生成新函数</span></span><br><span class="line"><span class="keyword">val</span> numberFunc = numbers.foldLeft(<span class="type">List</span>[<span class="type">Int</span>]())_</span><br><span class="line"><span class="keyword">val</span> square = numberFunc((xs, x) =&gt; xs:+ x*x)</span><br><span class="line"><span class="keyword">val</span> cube = numberFunc((xs, x) =&gt; xs:+ x*x*x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute</span></span>(arg: <span class="type">Int</span>)(<span class="keyword">implicit</span> ec: <span class="type">ExecutionContext</span>)</span><br></pre></td></tr></table></figure>
<h3 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h3><p>隐式转换：编译器发现类型不匹配时，在作用域范围内查找能够转换
类型的隐式转换</p>
<ul>
<li><p>类型<code>S</code>到类型<code>T</code>的隐式转换由<code>S =&gt; T</code>类型函数的隐式值、
或可以转换为所需值的隐式方法定义</p>
<ul>
<li>隐式转换只与源类型、目标类型有关</li>
<li>源类型到目标类型的隐式转换<strong>只会进行一次</strong></li>
<li>若作用域中有多个隐式转换，编译器将报错</li>
</ul>
</li>
<li><p>适用场合：以下情况将搜索隐式转换</p>
<ul>
<li>隐式转换函数、类：表达式<code>e</code>的类型<code>S</code>不符合期望类型
<code>T</code></li>
<li>隐式参数列表、值：表达式<code>e</code>类型<code>S</code>没有声明被访问的
成员<code>m</code></li>
</ul>
</li>
<li><p>隐式转换可能会导致陷阱，编译器会在编译隐式转换定义时发出
警告，可以如下关闭警告</p>
<ul>
<li><code>import scala.language.implicitConversions</code>到隐式
转换上下文范围内</li>
<li>启用编译器选项<code>-language: implicitConversions</code></li>
</ul>
</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.language.implicitCoversions</span><br><span class="line"></span><br><span class="line"><span class="comment">// `scala.Predef`中定义有</span></span><br><span class="line"><span class="comment">// 隐式转换函数</span></span><br><span class="line"><span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">int2Integer</span></span>(x: <span class="type">Int</span>) =</span><br><span class="line">	java.lang.<span class="type">Integer</span>.valueOf(x)</span><br><span class="line"><span class="comment">// 隐式参数列表</span></span><br><span class="line"><span class="meta">@inline</span> <span class="function"><span class="keyword">def</span> <span class="title">implicitly</span></span>[<span class="type">T</span>](<span class="keyword">implicit</span> e:<span class="type">T</span>) = e</span><br></pre></td></tr></table></figure>
<h4 id="隐式转换函数、类"><a href="#隐式转换函数、类" class="headerlink" title="隐式转换函数、类"></a>隐式转换函数、类</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 隐式转换函数</span></span><br><span class="line"><span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">float2int</span></span>(x: <span class="type">Float</span>) = x.toInt</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐式类</span></span><br><span class="line"><span class="keyword">implicit</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span>(<span class="params">val name: <span class="type">String</span></span>)</span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">bark</span> </span>= println(<span class="string">s&quot;<span class="subst">$name</span> is barking&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">&quot;Tom&quot;</span>.bark</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐式类最终被翻译为</span></span><br><span class="line"><span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">string2Dog</span></span>(name: <span class="type">String</span>): <span class="type">Dog</span> = <span class="keyword">new</span> <span class="type">Dog</span>(name)</span><br></pre></td></tr></table></figure>
<ul>
<li>隐式类通过隐式转换函数实现<ul>
<li>其主构造函数参数有且只有一个</li>
<li>代码更简洁、晦涩，类和方法绑定</li>
</ul>
</li>
</ul>
<h4 id="隐式值、参数列表"><a href="#隐式值、参数列表" class="headerlink" title="隐式值、参数列表"></a>隐式值、参数列表</h4><ul>
<li><p>若参数列表中参数没正常传递，Scala将尝试自动传递
<strong>正确类型的隐式值</strong></p>
</li>
<li><p>查找隐式参数的位置</p>
<ul>
<li>调用包含隐式参数列表的方法时，首先查找可以直接访问、
无前缀的隐式定义、隐式参数</li>
<li>在伴生对象中查找与隐式候选类型相关的、有隐式标记的
成员</li>
</ul>
</li>
<li><p>说明</p>
<ul>
<li>隐式值不能是顶级值</li>
<li><code>implicit</code><strong>能且只能</strong>作用于最后参数列表</li>
<li>方法才能包含隐式参数列表，<strong>函数不可</strong></li>
<li>包含隐式参数列表方法不可偏函数化</li>
</ul>
</li>
<li><p>例1</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Monoid</span>[<span class="type">A</span>]</span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x: <span class="type">A</span>, y: <span class="type">A</span>): <span class="type">A</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">unit</span></span>: <span class="type">A</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ImplicitTest</span></span>&#123;</span><br><span class="line">	<span class="comment">// `implicit`声明该匿名类对象为隐式值</span></span><br><span class="line">	<span class="keyword">implicit</span> <span class="keyword">val</span> stringMonoid: <span class="type">Monoid</span>[<span class="type">String</span>] = <span class="keyword">new</span> <span class="type">Monoid</span>[<span class="type">String</span>]&#123;</span><br><span class="line">		<span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x: <span class="type">String</span>, y: <span class="type">String</span>): <span class="type">Strinng</span> = x concat y</span><br><span class="line">		<span class="function"><span class="keyword">def</span> <span class="title">unit</span></span>: <span class="type">String</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">implicit</span> <span class="keyword">val</span> intMonoid: <span class="type">Monoid</span>[<span class="type">Int</span>] = <span class="keyword">new</span> <span class="type">Monoid</span>[<span class="type">Int</span>] &#123;</span><br><span class="line">		<span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x: <span class="type">Int</span>, y: <span class="type">Int</span>): <span class="type">Int</span> = x + y</span><br><span class="line">		<span class="function"><span class="keyword">def</span> <span class="title">unit</span></span>: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义隐式参数列表</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>[<span class="type">A</span>](xs: <span class="type">List</span>[<span class="type">A</span>])(<span class="keyword">implicit</span> m: <span class="type">Monoid</span>[<span class="type">A</span>]): <span class="type">A</span> =</span><br><span class="line">		<span class="keyword">if</span> (xs.isEmpty) m.unit</span><br><span class="line">		<span class="keyword">else</span> m.add(xs.head, sum(xs.tail))</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">		println(sum(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)))</span><br><span class="line">		println(sum(<span class="type">List</span>(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>)))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>例2</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Multiplicable</span>[<span class="type">T</span>] </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">multiply</span></span>(x: <span class="type">T</span>): <span class="type">T</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义隐式单例对象</span></span><br><span class="line"><span class="keyword">implicit</span> <span class="class"><span class="keyword">object</span> <span class="title">MultiplicableInt</span> <span class="keyword">extends</span> <span class="title">Multiplicable</span>[<span class="type">Int</span>]</span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">multiply</span></span>(x: <span class="type">Int</span>) = x*x</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">implicit</span> <span class="class"><span class="keyword">object</span> <span class="title">MultiplicableString</span> <span class="keyword">extends</span> <span class="title">Mulitplicable</span>[<span class="type">String</span>]</span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">multiply</span></span>(x: <span class="type">String</span>) = x*<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// `T: Multiplicable`限定作用域存在相应隐式对象、或隐式值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span></span>[<span class="type">T</span>: <span class="type">Multiplicable</span>](x: <span class="type">T</span>) = &#123;</span><br><span class="line">	<span class="comment">// 调用`implicitly`返回隐式对象、或隐式值</span></span><br><span class="line">	<span class="keyword">val</span> ev = implicitly[<span class="type">Multiplcable</span>[<span class="type">T</span>]]</span><br><span class="line">	ev.multiply(x)</span><br><span class="line">&#125;</span><br><span class="line">println(multiply(<span class="number">5</span>))</span><br><span class="line">println(multiply(<span class="number">5</span>))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="传名参数"><a href="#传名参数" class="headerlink" title="传名参数"></a>传名参数</h3><p>传名参数：仅在被使用时触发实际参数的求值运算</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate</span></span>(input: =&gt; <span class="type">Int</span>) = input * <span class="number">37</span></span><br><span class="line"><span class="comment">// 在参数类型前加上`=&gt;`将普通（传值）参数变为传名参数</span></span><br></pre></td></tr></table></figure>
<ul>
<li>传名参数<ul>
<li>若在函数体中未被使用，则不会对其求值</li>
<li>若参数是计算密集、长时运算的代码块，延迟计算能力可以
帮助提高性能</li>
</ul>
</li>
<li>传值参数：仅被计算一次</li>
</ul>
<h4 id="传名参数实现while循环"><a href="#传名参数实现while循环" class="headerlink" title="传名参数实现while循环"></a>传名参数实现while循环</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">whileLoop</span></span>(condition: =&gt; <span class="type">Boolean</span>)(body: =&gt; <span class="type">Unit</span>): <span class="type">Unit</span> =</span><br><span class="line">	<span class="keyword">if</span>(condition)&#123;</span><br><span class="line">		body</span><br><span class="line">		whileLoop(condition)(body)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">2</span></span><br><span class="line">whileLoop(i &gt; <span class="number">0</span>)&#123;</span><br><span class="line">	println(i)</span><br><span class="line">	i -= <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h3><p>默认参数：调用时可以忽略具有默认值的参数</p>
<ul>
<li>调用时忽略前置参数时，其他参数必须带名传递</li>
<li>跳过前置可选参数传参必须<strong>带名传参</strong></li>
</ul>
<blockquote>
<ul>
<li>Java中可以通过剔除可选参数的重载方法实现同样效果</li>
<li>Java代码中调用时，Scala中默认参数必须、不能使用命名参数</li>
</ul>
</blockquote>
<h3 id="命名参数调用"><a href="#命名参数调用" class="headerlink" title="命名参数调用"></a>命名参数调用</h3><ul>
<li>调用方法时，实际参数可以通过其对应形参名标记<ul>
<li>命名参数顺序可以打乱</li>
<li>未命名参数需要<strong>按照方法签名中形参顺序</strong>放在前面</li>
</ul>
</li>
</ul>
<h2 id="Exception"><a href="#Exception" class="headerlink" title="Exception"></a>Exception</h2><p>异常处理：<code>try&#123;throw...&#125;catch&#123;case...&#125;</code>抛出捕获异常</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">def <span class="title">main</span><span class="params">(args: Array[String])</span></span>&#123;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		val fp = <span class="keyword">new</span> FileReader(<span class="string">&quot;Input&quot;</span>)</span><br><span class="line">	&#125;<span class="keyword">catch</span>&#123;</span><br><span class="line">		<span class="keyword">case</span> ex: FileNotFoundException =&gt; println(<span class="string">&quot;File Missing&quot;</span>)</span><br><span class="line">		<span class="keyword">case</span> ex: IOException =&gt; println(<span class="string">&quot;IO Exception&quot;</span>)</span><br><span class="line">	&#125;finally&#123;</span><br><span class="line">		println(<span class="string">&quot;finally&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-06-03T16:55:56.000Z" title="6/4/2019, 12:55:56 AM">2019-06-04</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-06-03T16:55:56.000Z" title="6/4/2019, 12:55:56 AM">2019-06-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/Py3Ref/">Py3Ref</a></span><span class="level-item">an hour read (About 10552 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/Py3Ref/cls_special_methods.html">Special Methods</a></h1><div class="content"><h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2><p>特殊方法：python类中具有特殊名称的方法，实现<strong>由特殊语法</strong>
所引发的特定操作</p>
<ul>
<li><p>python实现<strong>操作符重载</strong>的方式</p>
<ul>
<li>允许每个类自行定义基于操作符的特定行为</li>
<li>特定操作包括python内置的<strong>钩子函数</strong></li>
</ul>
</li>
<li><p>钩子函数不能简单的看作<strong>直接调用</strong>特殊方法</p>
<ul>
<li>尝试调用备用实现：<code>iter</code>、<code>reversed</code></li>
<li>修改方法返回值：<code>dir</code></li>
</ul>
</li>
<li><p>大部分情况下，若没有定义适当方法，尝试<strong>执行操作</strong>将
<code>raise AttributeError</code>、<code>raise TypeError</code></p>
<ul>
<li><p>但<code>__hash__</code>、<code>__iter__</code>、<code>__reversed__</code>、
<code>__contains__</code>等方法即使未定义，其<strong>对应钩子函数</strong>
实现会尝试调用可能的其他方法完成操作
（直接<code>obj.__xxx__</code>调用方法仍然报错）</p>
</li>
<li><p>将特殊方法设为<code>None</code>表示对应操作不可用，此时即使以上
<code>hash</code>、<code>iter</code>、<code>reversed</code>、<code>in</code>等操作也不会尝试调用
备用方法</p>
</li>
</ul>
</li>
</ul>
<h2 id="实例创建、销毁"><a href="#实例创建、销毁" class="headerlink" title="实例创建、销毁"></a>实例创建、销毁</h2><p>调用类时，元属性方法执行顺序</p>
<ul>
<li><code>__prepare__()</code>：创建命名空间</li>
<li>依次执行类定义语句</li>
<li><code>__new__()</code>：创建类实例</li>
<li><code>__init__()</code>：初始化类<ul>
<li><code>__new__</code><strong>返回的新实例</strong>的<code>__init__</code>方法将被调用</li>
<li>用户定义<code>__new__</code>返回对象不一定期望类实例，调用的
<code>__init__</code>随之不一定是期望方法</li>
</ul>
</li>
<li>返回<code>__new__</code>返回类实例</li>
</ul>
<h3 id="prepare"><a href="#prepare" class="headerlink" title="__prepare__"></a><code>__prepare__</code></h3><ul>
<li>在所有类定义开始执行前被调用，用于创建类命名空间</li>
<li>一般这个方法只是简单的返回一个字典或其他映射对象</li>
</ul>
<h3 id="new"><a href="#new" class="headerlink" title="__new__"></a><code>__new__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">classmethod</span> <span class="built_in">object</span>.__new__(cls[, *args, **kwargs]):</span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：创建、返回<code>cls</code>类新实例</p>
<ul>
<li><code>super().__new__(cls[,...])</code>调用超类方法创建类实例，
然后根据需要修改新创建实例再返回</li>
</ul>
</li>
<li><p>参数</p>
<ul>
<li><code>cls</code>：待实例化类</li>
<li>其余参数：类构造器表达式参数</li>
</ul>
</li>
<li><p>返回值：<code>cls</code>类新实例</p>
<ul>
<li><code>__new__</code>返回值就是类构造器的返回值，有绝对控制权</li>
</ul>
</li>
</ul>
<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><ul>
<li><p><code>__new__</code>：<em>builtin_function_or_method</em></p>
</li>
<li><p><code>__new__</code>是静态方法：以需实例化类作为第一个参数</p>
<ul>
<li><code>__new__</code>方法绑定当前<strong>类对象</strong></li>
<li>特例，不需要显式声明为静态方法</li>
</ul>
</li>
<li><p>原生有两个<code>__new__</code>函数，二者C实现不同</p>
<ul>
<li><code>type.__new__</code>：元类继承，用于创建类对象</li>
<li><code>object.__new__</code>：其他类继承，用于创建实例</li>
</ul>
</li>
</ul>
<h3 id="init"><a href="#init" class="headerlink" title="__init__"></a><code>__init__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__init__</span>(<span class="params">self[, *args, *kwargs]</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：初始化类实例</p>
<ul>
<li>类构造器中<code>__new__</code>返回类实例调用此方法初始化</li>
<li>若基类有用户定义<code>__init__</code>方法，则其派生类<code>__init__</code>
应该<strong>显式调用</strong>基类<code>__init__</code>保证基类部分正确初始化</li>
</ul>
</li>
<li><p>参数</p>
<ul>
<li><code>self</code>：当前类实例</li>
<li>其余参数：类构造器表达式参数</li>
</ul>
</li>
<li><p>返回值：<code>None</code>，否则<code>raise TypeError</code></p>
</li>
</ul>
<h3 id="del"><a href="#del" class="headerlink" title="__del__"></a><code>__del__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__del__</span>(<span class="params">self</span>)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>用途：实例销毁时（引用计数变为0）被调用<ul>
<li>若基类有<code>__del__</code>方法，则其派生类<code>__del__</code>方法中
需要<strong>显式调用</strong>基类<code>__del__</code>保证基类部分正确清除</li>
<li>对象重生：在其中创建该实例的新引用推迟其销毁<ul>
<li>不推荐</li>
<li>重生对象被销毁时<code>__del__</code>是否会被再次调用取决于
具体实现</li>
<li>当前CPython实现中只会调用一次</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h4><ul>
<li>解释器退出时不会确保为仍然存在的对象调用<code>__del__</code>方法</li>
<li>“钩子函数”：<code>del</code><ul>
<li><code>del x</code>不直接调用<code>x.__del__()</code></li>
<li><code>del x</code>仅将<code>x</code>的引用计数减一</li>
</ul>
</li>
</ul>
<h2 id="输出属性"><a href="#输出属性" class="headerlink" title="输出属性"></a>输出属性</h2><h3 id="repr"><a href="#repr" class="headerlink" title="__repr__"></a><code>__repr__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：输出对象的“官方”字符串表示</p>
<ul>
<li>如果可能，应类似有效的python表达式，可以用于重建具有
相同取值的对象（适当环境下）</li>
<li>若不可能，返回形如<code>&lt;...some useful description...&gt;</code>
的字符串</li>
<li>常用于调试，确保内容丰富、信息无歧义很重要</li>
</ul>
</li>
<li><p>返回值：字符对象</p>
<ul>
<li>内置钩子函数：<code>repr</code></li>
<li><strong>交互环境</strong>下直接“执行”变量的结果</li>
</ul>
</li>
</ul>
<h3 id="str"><a href="#str" class="headerlink" title="__str__"></a><code>__str__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：生成对象“非正式”、格式良好的字符串表示</p>
<ul>
<li>返回较方便、准确的描述信息</li>
</ul>
</li>
<li><p>返回值：字符串对象</p>
<ul>
<li>内置钩子函数：<code>str</code></li>
</ul>
</li>
</ul>
<h4 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h4><ul>
<li><p><code>object.__str__</code>方法默认实现调用<code>object.__repr__</code></p>
<ul>
<li>所以若未定义<code>__str__</code>，需要实例“非正式”字符串表示时
也会使用<code>__repr__</code></li>
</ul>
</li>
<li><p><code>format</code>、<code>print</code>函数会隐式调用对象<code>__str__</code>方法</p>
<ul>
<li>此时若<code>__str__</code>返回非字符串会<code>raise TypeError</code></li>
</ul>
</li>
</ul>
<h3 id="bytes"><a href="#bytes" class="headerlink" title="__bytes__"></a><code>__bytes__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__bytes__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：生成对象的字节串表示</p>
</li>
<li><p>返回值：<code>bytes</code>对象</p>
<ul>
<li>内置钩子函数：<code>bytes</code></li>
</ul>
</li>
</ul>
<h3 id="format"><a href="#format" class="headerlink" title="__format__"></a><code>__format__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__format__</span>(<span class="params">self, format_spec</span>)</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：生成对象的“格式化”字符串表示</p>
<ul>
<li>内部常调用<code>format</code>、<code>str.format</code>实现格式化</li>
<li><code>object.__format__(x, &#39;&#39;)</code>等同于<code>str(x)</code></li>
</ul>
</li>
<li><p>参数</p>
<ul>
<li><code>fomrat_spec</code>：包含所需格式选项描述的字符串<ul>
<li>参数解读由实现<code>__format__</code>的类型决定</li>
<li>大多数类将格式化委托给内置类型、或使用相似格式化
语法</li>
</ul>
</li>
</ul>
</li>
<li><p>返回值：字符串对象</p>
<ul>
<li>内置钩子函数：<code>format</code></li>
</ul>
</li>
</ul>
<h3 id="hash"><a href="#hash" class="headerlink" title="__hash__"></a><code>__hash__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__hash__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：计算对象hash值返回</p>
<ul>
<li>相等的对象（即使类型不同）<strong>理应</strong>具有相同hash值</li>
<li>建议把参与比较的对象的全部组件的hash值打包为元组，
对元组做hash运算<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__hash__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">hash</span>((self.name, self.nick, self.color))</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>返回值：整数</p>
<ul>
<li>内置钩子函数：<code>hash()</code></li>
</ul>
</li>
</ul>
<h4 id="说明-3"><a href="#说明-3" class="headerlink" title="说明"></a>说明</h4><ul>
<li><p><code>hash()</code>会从对象自定义的<code>__hash__()</code>方法返回值中截断为
<code>Py_ssize_t</code>大小</p>
<ul>
<li>64bits编译平台通常为8bytes、32bits为4bytes</li>
<li>若对象<code>__hash__()</code>需要在不同位大小的平台上互操作，
需要检查支持的平台位宽</li>
</ul>
<blockquote>
<ul>
<li>查看<code>sys.hash_info.width</code></li>
</ul>
</blockquote>
</li>
<li><p><code>set</code>、<code>frozenset</code>、<code>dict</code>这3个hash集类型中成员的操作
会调用相应<code>__hash__()</code></p>
</li>
<li><p>类的<code>__hash__</code>方法设置为<code>None</code>时</p>
<ul>
<li>尝试获取实例hash值时将<code>raise TypeError</code></li>
<li><code>isinstance(obj, collecitons.abc.Hashable)</code>返回
<code>False</code></li>
<li>单纯在<code>__hash__</code>中显式<code>raise TypeError</code>会被错误
认为是可hash</li>
</ul>
</li>
</ul>
<h4 id="关联-eq"><a href="#关联-eq" class="headerlink" title="关联__eq__"></a>关联<code>__eq__</code></h4><p>hash绝大部分应用场景是比较是否相等，所以<code>__hash__</code>、<code>__eq__</code>
密切相关</p>
<ul>
<li><p>类未定义<code>__eq__</code></p>
<ul>
<li>也不应该定义<code>__hash__</code>，单独hash结果无法保证比较结果</li>
</ul>
</li>
<li><p>类实现<code>__eq__</code></p>
<ul>
<li>未定义<code>__hash__</code>：其实例将不可被用作hash集类型的项</li>
<li>类中定义了可变对象：不应该实现<code>__hash__</code>，因为hash集
实现要求键hash值不可变</li>
</ul>
</li>
<li><p>类重载<code>__eq__</code>方法</p>
<ul>
<li>默认其<code>__hash__</code>被隐式设为<code>None</code></li>
<li>否则须设置<code>__has__ = &lt;ParentClass&gt;.__hash__</code>显式保留
来自父类<code>__hash__</code>实现</li>
</ul>
</li>
</ul>
<h4 id="默认实现"><a href="#默认实现" class="headerlink" title="默认实现"></a>默认实现</h4><ul>
<li><p><code>float</code>、<code>integer</code>、<code>decimal.Decimal</code>等数字类型hash运算
是基于为任意有理数定义的统一数学函数</p>
<blockquote>
<ul>
<li>详细参考<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#hashing-of-numeric-types">https://docs.python.org/zh-cn/3/library/stdtypes.html#hashing-of-numeric-types</a></li>
</ul>
</blockquote>
</li>
<li><p><code>str</code>、<code>bytes</code>、<code>datetime</code>对象<code>__hash__</code>值会使用不可预知
值<strong>随机加盐</strong></p>
<ul>
<li>盐在单独python进程中保持不变，但在重复执行的python
进程之间是不可预测的</li>
<li>目的是为了防止某种形式的DDos服务攻击</li>
</ul>
</li>
<li><p>改变hash值会影响集合迭代次序</p>
<ul>
<li>python也不保证次序不会改变</li>
</ul>
</li>
</ul>
<h3 id="bool"><a href="#bool" class="headerlink" title="__bool__"></a><code>__bool__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__bool__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：返回<code>True</code>、<code>False</code>实现真值检测</p>
<ul>
<li>未定义：调用<code>__len__</code>返回非0值时对象逻辑为真</li>
<li><code>__len__</code>、<code>__bool__</code>均未定义：所有实例逻辑为真</li>
</ul>
</li>
<li><p>返回值：<code>False</code>、<code>True</code></p>
<ul>
<li>内置构造函数：<code>bool()</code></li>
</ul>
</li>
</ul>
<h3 id="例"><a href="#例" class="headerlink" title="例"></a>例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pair</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x, y</span>):</span></span><br><span class="line">		self.x = x</span><br><span class="line">		self.y = y</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="comment"># 返回实例代码表示形式</span></span><br><span class="line">		<span class="comment"># 通常用于重新构造实例</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Pair(&#123;0.x!r&#125;, &#123;0.y!r&#125;)&quot;</span>.<span class="built_in">format</span>(self)</span><br><span class="line">			<span class="comment"># 格式化代码`!r`指明输出使用`__repr__`而不是默认</span></span><br><span class="line">				<span class="comment"># 的`__str___`</span></span><br><span class="line">			<span class="comment"># 格式化代码`0.x`表示第一个参数`x`属性</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;(&#123;0.x!s&#125;, &#123;0.y!s&#125;)&quot;</span>.<span class="built_in">format</span>(self)</span><br><span class="line">			<span class="comment"># 格式化代码`!s`指明使用默认`__str__`</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__format__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">if</span> self.x == <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">return</span> self.y</span><br><span class="line">		<span class="keyword">elif</span> self.y == <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">return</span> self.x</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&#123;0.x!r&#125;, &#123;0.y!r&#125;&quot;</span>.<span class="built_in">format</span>(self)</span><br></pre></td></tr></table></figure>
<h2 id="Rich-Comparison-Methods"><a href="#Rich-Comparison-Methods" class="headerlink" title="Rich Comparison Methods"></a><em>Rich Comparison Methods</em></h2><p>富比较方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__lt__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__le__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__ne__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__gt__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__ge__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：比较运算符重载</p>
<ul>
<li><code>x &lt; y</code>：调用<code>x.__lt__(y)</code></li>
<li><code>x &lt;= y</code>：调用<code>x.__le__(y)</code></li>
<li><code>x == y</code>：调用<code>x.__eq__(y)</code></li>
<li><code>x != y</code>：调用<code>x.__ne__(y)</code></li>
</ul>
</li>
<li><p>返回值</p>
<ul>
<li>成功比较返回<code>False</code>、<code>True</code></li>
<li>若指定方法没有相应实现，富比较方法会返回单例对象
<code>NotImplemented</code></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>比较运算默认实现参见<em>cs_python/py3ref/expressions</em></li>
</ul>
</blockquote>
<h3 id="说明-4"><a href="#说明-4" class="headerlink" title="说明"></a>说明</h3><ul>
<li><p>默认情况下，<code>__ne__</code>会委托给<code>__eq__</code>，并将结果取反，除非
结果为<code>NotImplemented</code></p>
</li>
<li><p>比较运算符之间没有其他隐含关系</p>
<ul>
<li><code>x &lt; y or x == y</code>为真不意味着<code>x &lt;= y</code></li>
<li>要根据单个运算自动生成排序操作可以利用
<code>functools.total_ordering()</code>装饰器简化实现</li>
</ul>
</li>
<li><p>以上方法没有对调参数版本（左边参数不支持该操作，右边参数
支持该操作）</p>
<ul>
<li>若两个操作数类型不同、且右操作数是左操作数直接或间接
子类，优先选择右操作数的<strong>反射方法</strong>，否则左操作数
方法（不考虑虚拟子类）</li>
<li>反射方法<ul>
<li><code>__lt__</code>、<code>__gt__</code>互为反射</li>
<li><code>__le__</code>、<code>__ge__</code>互为反射</li>
<li><code>__eq__</code>、<code>__ne__</code>各为自身反射</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="内部信息"><a href="#内部信息" class="headerlink" title="内部信息"></a>内部信息</h2><h3 id="dict"><a href="#dict" class="headerlink" title="__dict__"></a><code>__dict__</code></h3><ul>
<li><p>钩子函数：<code>vars</code>、<code>dir</code>（部分）</p>
<ul>
<li><code>vars</code>是真正对应的钩子函数，返回键值对</li>
<li><code>dir</code>执行过程中会访问<code>__dict__</code>、<code>__class__</code>，而且
只返回keys</li>
</ul>
</li>
<li><p><strong>对象</strong>底层字典，存储对象属性、方法</p>
<ul>
<li>注意区分开：实例属性、类属性、基类属性，<code>__dict__</code>
只包括<strong>当前实例</strong>属性、方法</li>
<li>返回结果是<code>dir</code>结果的子集</li>
</ul>
</li>
<li><p>调用实例<code>obj</code>的属性时，按照以下顺序查找</p>
<ul>
<li><code>obj.__dict__</code>：当前实例的<code>__dict__</code>中</li>
<li><code>type(obj).__dict__</code>：实例所属类的<code>__dict__</code>中</li>
<li><code>type(obj).mro().__dict__</code>：基类的<code>__dict__</code>中</li>
</ul>
</li>
<li><p>在大部分情况下<code>__dict__</code>会自动更新，如<code>setattr</code>函数时，
或说实例的属性、方法更新就是<code>__dict__</code>的变动</p>
<ul>
<li><p>一般情况下不要直接访问<code>__dict__</code>，除非真的清楚所有
细节，如果类使用了<code>cls.__slots__</code>、<code>@property</code>、
描述器类等高级技术时代码可能会被破坏</p>
</li>
<li><p>尽量使用<code>setattr</code>函数，让python控制其更新</p>
</li>
</ul>
</li>
</ul>
<h3 id="class"><a href="#class" class="headerlink" title="__class__"></a><code>__class__</code></h3><ul>
<li><p>用途：返回实例所属类</p>
</li>
<li><p>返回值：实例（狭义）返回类、类返回元类</p>
<ul>
<li>钩子函数：<code>type</code></li>
</ul>
</li>
</ul>
<h3 id="objclass"><a href="#objclass" class="headerlink" title="__objclass__"></a><code>__objclass__</code></h3><ul>
<li>用途：被<code>inspect</code>模块解读为<strong>指定实例所在的类</strong><ul>
<li>合适的设置可以有助于动态类属性的运行时检查</li>
<li>对于可调用对象：指明第一个位置参数应为特定类型的
实例、子类<ul>
<li>描述器类：<code>instance</code>参数<h1 id="todo"><a href="#todo" class="headerlink" title="todo"></a>todo</h1></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="slots"><a href="#slots" class="headerlink" title="__slots__"></a><code>__slots__</code></h3><ul>
<li><p>用途：显式声明数据成员、特征属性，限制实例添加属性</p>
<ul>
<li><p>可赋值为：字符串、可迭代对象、实例使用的变量名构成的
字符串序列</p>
<ul>
<li>可迭代对象中元素可以是任何类型</li>
<li>还可以映射类型，未来可能会分别赋给每个键特殊含义
的值</li>
</ul>
</li>
<li><p><code>__slots__</code>会为已声明变量保留空间</p>
<ul>
<li>直接访问将<code>raise AttributeError</code></li>
<li><code>dir</code>可以找到<code>__slots__</code>中声明的变量</li>
</ul>
</li>
</ul>
</li>
<li><p>阻止默认为每个实例创建<code>__dict__</code>、<code>__weakref__</code>的
行为，除非在<code>__slots__</code>中显式声明、或在父类中可用</p>
<ul>
<li><p>无<code>__dict__</code>属性实例无法给未在<code>__slots__</code>中列出
的新变量赋值</p>
<ul>
<li>但是python很多特性依赖于普通的依赖字典实现，定义
<code>__slots__</code>的类不再支持普通类某些特性</li>
<li>大多数情况下，应该只在经常使用到作为数据结构的
类上定义<code>__slots__</code></li>
<li>不应该把<code>__slots__</code>作为防止用户给实例增加新属性
的封装工具</li>
</ul>
</li>
<li><p>无<code>__weakref__</code>属性实例不支持对实例的弱引用</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>是阻止给实例创建<code>__dict__</code>，类本身仍然有<code>__dict__</code>属性
  （<code>dir</code>返回值中无<code>__dict__</code>，<code>__dir__</code>返回值中有）</li>
</ul>
</blockquote>
<h4 id="说明-5"><a href="#说明-5" class="headerlink" title="说明"></a>说明</h4><ul>
<li><p><code>__slots__</code>声明的行为不只限于定义其的类</p>
<ul>
<li><p>父类中声明<code>__slots__</code>可以在子类中使用，但子类将获得
<code>__dict__</code>、<code>__weakref__</code>，除非其也定义了<code>__slots__</code></p>
</li>
<li><p>子类<code>__slots__</code>中定义的slot将覆盖父类中同名slot</p>
<ul>
<li>需要直接从基类直接获取描述器才能访问</li>
<li>这会导致程序未定义，以后增加检查避免</li>
</ul>
</li>
<li><p>多重继承中只允许一个父类具有非空<code>__slots__</code>，否则
<code>raise TypeError</code></p>
</li>
</ul>
</li>
<li><p><code>__slots__</code>是在类层次上的实现：为每个变量创建描述器</p>
<ul>
<li>类属性不能被用于给在<code>__slots__</code>中定义变量设置默认值</li>
<li>否则类属性会覆盖描述器赋值，变成只读属性</li>
</ul>
</li>
<li><p>非空的<code>__slots__</code>不适用于派生自“可变长度”内置类型，如
<code>int</code>、<code>bytes</code>、<code>tuple</code></p>
</li>
<li><p>定义类属性<code>__slots__</code>后，python会为实例属性使用紧凑内部
表示</p>
<ul>
<li>实例属性使用固定大小、很小的数组构建，而不是为每个
实例定义字典</li>
<li>在<code>__slots__</code>列出的属性名在内部映射到数组指定下标上</li>
<li>类似于R中<code>factor</code>类型、C中<code>enum</code>类型</li>
<li>相比<code>__dict__</code>可以显著节省空间、提升属性查找速度</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span>:</span></span><br><span class="line">	__slots__ = [<span class="string">&quot;year&quot;</span>, <span class="string">&quot;month&quot;</span>, <span class="string">&quot;day&quot;</span>]</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, year, month, day</span>):</span></span><br><span class="line">		self.year = year</span><br><span class="line">		self.month = month</span><br><span class="line">		self.day = day</span><br></pre></td></tr></table></figure>
<ul>
<li><p>继承自未定义<code>__slots__</code>类时，实例中<code>__dict__</code>、
<code>__weakref__</code>属性将总是可访问的</p>
</li>
<li><p><code>__class__</code>赋值仅在两个类具有相同<code>__slots__</code>值时才有用</p>
</li>
</ul>
<h2 id="自定义属性访问"><a href="#自定义属性访问" class="headerlink" title="自定义属性访问"></a>自定义属性访问</h2><h3 id="getattr"><a href="#getattr" class="headerlink" title="__getattr__"></a><code>__getattr__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__getattr__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：<code>.</code>默认属性访问引发<code>AttributeError</code>而失败时调用</p>
<ul>
<li>如果属性通过正常机制找到，<code>__getattr__</code>不会被调用<ul>
<li>在<code>__getattr__</code>、<code>__setattr__</code>之间故意设置的
不对称性</li>
<li>出于效率考虑</li>
</ul>
</li>
<li>对实例变量而言，无需在实例属性字典中插入值，就可以
模拟对其的完全控制</li>
</ul>
</li>
<li><p>返回值：计算后的属性值、或<code>raise AttributeError</code></p>
</li>
</ul>
<h4 id="说明-6"><a href="#说明-6" class="headerlink" title="说明"></a>说明</h4><ul>
<li><p>可能引发<code>AttributeError</code></p>
<ul>
<li>调用<code>__getattribute__</code>时因为<code>name</code>不是实例属性、
或是类关系树中属性</li>
<li>对调用<code>__get__</code>获取<code>name</code>描述器</li>
</ul>
</li>
<li><p>调用<code>__getattr__</code>是<code>.</code>运算符中逻辑</p>
<ul>
<li><code>__getattribute__</code>显式调用<code>raise AtttributeError</code>
不会调用<code>__getattr__</code></li>
</ul>
</li>
<li><p><code>__getattr__</code>甚至不是<code>object</code>具有的
<code>&lt;wrapper_descriptor&gt;</code></p>
</li>
<li><p>相较于<code>__getattribute__</code>其实更常用，因为修改<strong>所有</strong>对
对对象的访问逻辑没啥价值</p>
</li>
</ul>
<h3 id="getattribute"><a href="#getattribute" class="headerlink" title="__getattribute__"></a><code>__getattribute__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span>(<span class="params">self, key</span>):</span></span><br><span class="line">	<span class="string">&quot;Emulate type_getattro() in Objects/typeobject.c&quot;</span></span><br><span class="line">	v = <span class="built_in">object</span>.__getattribute__(self, key)</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">hasattr</span>(v, <span class="string">&quot;__get__&quot;</span>):</span><br><span class="line">		<span class="keyword">return</span> v.__get__(<span class="literal">None</span>, self)</span><br><span class="line">	<span class="keyword">return</span> v</span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：访问对象属性时无条件被调用</p>
<ul>
<li><strong>判断访问属性类型、做对应操作</strong><ul>
<li>描述器：调用描述器方法</li>
<li>实例方法：为类中函数绑定实例</li>
<li>类方法：为类中函数绑定类</li>
<li>静态方法：不绑定</li>
<li>普通属性</li>
</ul>
</li>
<li>作为<strong>通过特定语法、内置函数隐式调用的结果</strong>情况下，
查找特殊方法时仍可能被跳过</li>
</ul>
</li>
<li><p>返回值：找到的属性值、或<code>raise AttributeError</code></p>
</li>
</ul>
<blockquote>
<ul>
<li><code>__getattribute__</code>仅对继承自<code>object</code>的新式类实例可用</li>
</ul>
</blockquote>
<h4 id="说明-7"><a href="#说明-7" class="headerlink" title="说明"></a>说明</h4><ul>
<li><p>内置类型均有各自<code>__getattribute__</code>函数实例</p>
<ul>
<li>其均为<code>wrapper_descriptor</code>类型（C实现的函数）</li>
<li>各函数实例标识符不同，若其均“继承自<code>object</code>”，其
应为同一个函数实例</li>
<li>自定义类真继承自<code>object</code>类，其<code>__getattribute__</code>同
<code>object.__getattribute__</code></li>
</ul>
</li>
<li><p>自定义实现</p>
<ul>
<li>为<strong>避免方法中无限递归</strong>，实现总应该调用具有相同名称
基类方法访问所需要的属性</li>
</ul>
</li>
</ul>
<h4 id="钩子函数"><a href="#钩子函数" class="headerlink" title="钩子函数"></a>钩子函数</h4><ul>
<li><p><code>.</code>运算符：首先调用<code>__getattribute__</code>，若无访问结果，
调用<code>__getattr__</code></p>
<blockquote>
<ul>
<li><code>.</code>运算符说明参见<em>cs_python/py3ref/cls_basics</em></li>
</ul>
</blockquote>
</li>
<li><p><code>getattr</code>：基本同<code>.</code>运算符，除可捕获异常，设置默认返回值</p>
</li>
<li><p><code>hasattr</code>：内部调用<code>getattr</code>，根据<code>raise Exception</code>判断
属性是否存在</p>
<ul>
<li>可以通过<code>@property.getter</code>中<code>raise AttributeError</code>
使得属性看起来不存在</li>
<li>内部有更多<code>boilerplate</code>相较于<code>getattr</code>更慢</li>
<li>则按照字面意思使用不需要考虑过多</li>
</ul>
</li>
</ul>
<h3 id="setattr"><a href="#setattr" class="headerlink" title="__setattr__"></a><code>__setattr__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__setattr__</span>(<span class="params">self, name, value</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：<strong>属性被尝试赋值时被调用</strong></p>
<ul>
<li>默认实现：将值保存到实例字典</li>
<li>若<code>__setattr__</code>要赋值给实例属性，应该调用同名基类
方法</li>
</ul>
</li>
<li><p>返回指：<code>None</code></p>
<ul>
<li>钩子函数：<code>setattr</code></li>
</ul>
</li>
</ul>
<h3 id="delattr"><a href="#delattr" class="headerlink" title="__delattr__"></a><code>__delattr__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__delattr__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：<strong>删除实例属性时被调用</strong></p>
<ul>
<li>默认实现：从实例字典中删除对应项</li>
<li>应该在<code>del obj.name</code>对该对象有意义时才实现</li>
</ul>
</li>
<li><p>返回值：<code>None</code></p>
<ul>
<li>内置钩子函数：<code>delattr</code>、<code>del</code></li>
</ul>
</li>
</ul>
<h3 id="dir"><a href="#dir" class="headerlink" title="__dir__"></a><code>__dir__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__dir__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：返回实例中“可访问”名称的字符串列表</p>
<ul>
<li>默认实现：返回实例、类、祖先类所有属性</li>
<li>交互式解释器就是在<code>__dir__</code>/<code>dir</code>返回列表中进行查询
进行补全</li>
</ul>
</li>
<li><p>返回值：序列</p>
<ul>
<li>内置钩子函数：<code>dir</code><ul>
<li><code>dir()</code>获取<code>__dir__</code>返回序列，转换为列表、排序</li>
<li><code>dir()</code>会剔除<code>__dir__</code>返回值中部分值</li>
<li>若<code>__dir__</code>返回值不可迭代，报错</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="自定义模块属性访问"><a href="#自定义模块属性访问" class="headerlink" title="自定义模块属性访问"></a>自定义模块属性访问</h3><ul>
<li><p><code>__getattr__</code>、<code>__dir__</code>可以用于自定义对模块属性的访问</p>
<ul>
<li>模块层次<code>__getattr__</code>类似普通类<ul>
<li>接受属性名作为参数</li>
<li>返回计算后结果、或<code>raise AttributeError</code></li>
<li>若正常查找<code>__getattribute__</code>无法在模块中找到某个
属性，调用<code>__getattr__</code></li>
</ul>
</li>
<li>模块层次<code>__dir__</code>类似普通类<ul>
<li>不接受参数</li>
<li>返回模块中可访问名称的字符串列表</li>
</ul>
</li>
</ul>
</li>
<li><p>可以将模块的<code>__class__</code>属性设置为<code>types.ModuleType</code>子类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> types <span class="keyword">import</span> ModuleType</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VersboseModule</span>(<span class="params">ModuleType</span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">f&quot;verbose <span class="subst">&#123;self.__name__&#125;</span>&quot;</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span>(<span class="params">self, attr, value</span>):</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">f&quot;settting <span class="subst">&#123;attr&#125;</span>&quot;</span>)</span><br><span class="line">		<span class="built_in">super</span>().__setattr__(attr, value)</span><br><span class="line"></span><br><span class="line">sys.modules[__name__].__class__ = VerboseModule</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<ul>
<li>设置模块<code>__getattr__</code>、<code>__class__</code>只影响使用<strong>属性访问</strong>
  语法进行查找，直接访问模块全局变量（通过模块内代码、对
  模块全局字典引用）不受影响</li>
</ul>
</blockquote>
<h2 id="描述器类"><a href="#描述器类" class="headerlink" title="描述器类"></a>描述器类</h2><p>描述器：<strong>具有“绑定行为”</strong>的对象属性</p>
<ul>
<li><p>类中定义其中任意一个方法，则其实例被称为描述器</p>
<ul>
<li><code>__set__</code></li>
<li><code>__get__</code></li>
<li><code>__delete__</code></li>
</ul>
</li>
<li><p>所有对描述器属性的访问会被<code>__get__</code>、<code>__set__</code>、
<code>__delete__</code>方法捕获/重载</p>
<ul>
<li>如果只是想简单的自定义某个类的属性处理逻辑，使用
<code>@porperty</code>装饰器简化实现</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><code>@property</code>参见<em>cs_python/py3ref/cls_basics</em></li>
</ul>
</blockquote>
<h3 id="描述器协议"><a href="#描述器协议" class="headerlink" title="描述器协议"></a>描述器协议</h3><ul>
<li>以下方法仅包含其的类的实例出现在类属性中才有效<ul>
<li>即以下方法必须在（祖先）类<code>__dict__</code>中出现，而不是
实例<code>__dict__</code>中</li>
<li>即描述器只能定义为类属性，不能定义为实例属性</li>
</ul>
</li>
</ul>
<h4 id="get"><a href="#get" class="headerlink" title="__get__"></a><code>__get__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__get__</span>(<span class="params">self, instance, owner=<span class="literal">None</span></span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：访问描述器属性时调用，重载实例属性访问</p>
<ul>
<li>若描述器未定义<code>__get__</code>，则访问属性会返回描述器对象
自身，除非实例字典<code>__dict__</code>中有同名属性</li>
<li>若仅仅只是从底层实例字典中获取属性值，<code>__get__</code>方法
不用实现</li>
</ul>
</li>
<li><p>参数</p>
<ul>
<li><code>instance</code>：用于方法属性的实例</li>
<li><code>owner</code>：实例所属类，若通过类获取属性则为<code>None</code></li>
</ul>
</li>
<li><p>返回值：计算后属性值、或<code>raise AttributeError</code></p>
</li>
<li><p>示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self, instance, cls</span>):</span></span><br><span class="line">	<span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">		<span class="comment"># 装饰器类一般作为类属性，需要考虑通过类直接访问</span></span><br><span class="line">			<span class="comment"># 描述器类属性，此时`instance is None`</span></span><br><span class="line">		<span class="comment"># 常用操作是返回当前实例</span></span><br><span class="line">		<span class="keyword">return</span> self</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> instance.__dict__[self.name]</span><br><span class="line"></span><br><span class="line">	<span class="comment"># self：描述器类当前实例</span></span><br><span class="line">	<span class="comment"># instance：定义描述器作为类属性的类的实例</span></span><br><span class="line">	<span class="comment"># cls：定义描述器作为类属性的类</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="set"><a href="#set" class="headerlink" title="__set__"></a><code>__set__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__set__</span>(<span class="params">self, instance, name, value</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：设置实例<code>instance</code>的“描述器属性”值为<code>value</code>，重载
实例属性赋值</p>
<ul>
<li>常用实现：操作实例<code>instance.__dict__</code>存储值，使得
看起来是设置普通实例属性</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__set__</span>(<span class="params">self, instance, name, value</span>):</span></span><br><span class="line">	<span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> instance(value, <span class="built_in">int</span>):</span><br><span class="line">			<span class="keyword">raise</span> TypeError(<span class="string">&quot;expect an int&quot;</span>)</span><br><span class="line">		instance.__dict__[self.name] = value</span><br><span class="line">		<span class="comment"># 操作实例底层`__dict__`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># `value`：赋给描述器类属性的值</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="delete"><a href="#delete" class="headerlink" title="__delete__"></a><code>__delete__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__delete__</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用于：“删除”实例<code>instance</code>的“描述器属性”，重载实例属性
删除</p>
<ul>
<li>具体实现应取决于<code>__set__</code>实现</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__delete__</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">	<span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">del</span> instance.__dict__[self.name]</span><br><span class="line">		<span class="comment"># 操作实例底层`__dict__`</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="set-name"><a href="#set-name" class="headerlink" title="__set_name__"></a><code>__set_name__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__set_name__</span>(<span class="params">self, owner, name</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li>用途：类<code>owner</code>被创建时调用，描述器被赋给<code>name</code></li>
</ul>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><ul>
<li><p>描述器的实现依赖于<code>object.__getattribute__()</code>方法</p>
<ul>
<li>可以通过重写类的<code>__getattribute__</code>方法改变、关闭
描述器行为</li>
</ul>
</li>
<li><p>描述器调用：描述器<code>x</code>定义在类<code>A</code>中、<code>a = A()</code></p>
<ul>
<li>直接调用：<code>x.__get__(a)</code></li>
<li>实例绑定：<code>a.x</code><ul>
<li>转换为：<code>type(a).__dict__[&#39;x&#39;].__get__(a)</code></li>
</ul>
</li>
<li>类绑定：<code>A.x</code><ul>
<li>转换为：<code>A.__dict__[&#39;x&#39;].__get__(None,A)</code></li>
</ul>
</li>
<li>超绑定：<code>super(a, A).x</code><ul>
<li></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="实例绑定—资料描述器"><a href="#实例绑定—资料描述器" class="headerlink" title="实例绑定—资料描述器"></a>实例绑定—资料描述器</h4><blockquote>
<ul>
<li>资料描述器：定义了<code>__set__</code>、<code>__delete__</code>方法</li>
<li>非资料描述器：只定义了<code>__get__</code>方法</li>
</ul>
</blockquote>
<ul>
<li><p>访问对象属性时，描述器调用的<strong>优先级</strong>取决于描述器定义的方法</p>
<ul>
<li>优先级：资料描述器 &gt; 实例字典属性 &gt; 非资料描述器</li>
<li>实例属性会重载非资料描述器</li>
<li>实例属性和资料描述器同名时，优先访问描述器，否则优先
访问属性</li>
</ul>
</li>
<li><p>只读资料描述器：<code>__set__</code>中<code>raise AttributeError</code>得到</p>
</li>
</ul>
<h4 id="描述器调用"><a href="#描述器调用" class="headerlink" title="描述器调用"></a>描述器调用</h4><h1 id="todo-1"><a href="#todo-1" class="headerlink" title="todo"></a>todo</h1><h4 id="Python设计"><a href="#Python设计" class="headerlink" title="Python设计"></a>Python设计</h4><ul>
<li><p><code>function</code>类中定义有<code>__get__</code>方法，则其实例（即函数）
都为非资料描述器</p>
<ul>
<li>所以实例可以覆盖、重载方法</li>
<li><code>__getattribute__</code>会根据不同方法类型选择绑定对象<ul>
<li><code>staticmethod</code>：静态方法</li>
<li><code>classmethod</code>：类方法</li>
<li>实例方法</li>
</ul>
</li>
</ul>
</li>
<li><p><code>super</code>类中定义有<code>__get__</code>方法，则其实例也为描述器</p>
</li>
<li><p><code>@property</code>方法被实现为资料描述器</p>
</li>
</ul>
<h3 id="特殊描述器类"><a href="#特殊描述器类" class="headerlink" title="特殊描述器类"></a>特殊描述器类</h3><h1 id="todo-2"><a href="#todo-2" class="headerlink" title="todo"></a>todo</h1><ul>
<li><p><code>wrapper_descripter</code>：<code>&lt;slot wrapper&gt;</code>，封装C实现的函数</p>
<ul>
<li>等价于CPython3中函数</li>
<li>调用<code>__get__</code>绑定后得到<code>&lt;method-wrapper&gt;</code></li>
<li><code>object</code>的方法全是<code>&lt;slot wrapper&gt;</code></li>
</ul>
</li>
<li><p><code>method-wrapper</code>：<code>&lt;method-wrapper&gt;</code>，封装C实现的绑定方法</p>
<ul>
<li>等价于CPython3中绑定方法</li>
</ul>
</li>
</ul>
<h4 id="function描述器类"><a href="#function描述器类" class="headerlink" title="function描述器类"></a><code>function</code>描述器类</h4><p><code>function</code>描述器类：实例化即得到函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">function</span>:</span></span><br><span class="line">	function(code, <span class="built_in">globals</span>[, name[, argdefs[, closure]]])</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, /, *args, **kwargs</span>):</span></span><br><span class="line">		<span class="comment"># 作为一个函数调用自身</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self, instance, owner, /</span>):</span></span><br><span class="line">		<span class="comment"># 返回`owner`类型实例`instance`的属性</span></span><br><span class="line">		<span class="comment"># 即返回绑定方法</span></span><br></pre></td></tr></table></figure>
<h4 id="method描述器类"><a href="#method描述器类" class="headerlink" title="method描述器类"></a><code>method</code>描述器类</h4><p><code>method</code>描述器类：实例化即得到<em>(bound )method</em>，绑定方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">method</span>:</span></span><br><span class="line">	method(function, instance)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, /, *args, **kwargs</span>):</span></span><br><span class="line">		<span class="comment"># 作为函数调用自身</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self, instance, owner, /</span>):</span></span><br><span class="line">		<span class="comment"># 返回自身</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><em>(bound )method</em>：绑定方法，（首个参数）绑定为具体实例
  的函数，即实例属性</li>
</ul>
</blockquote>
<h4 id="XXmethod描述类"><a href="#XXmethod描述类" class="headerlink" title="XXmethod描述类"></a><code>XXmethod</code>描述类</h4><blockquote>
<ul>
<li>代码是C实现，这里是python模拟，和<code>help</code>结果不同</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classmethod</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, method</span>):</span></span><br><span class="line">		self.method = method</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self, obj, cls</span>):</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">lambda</span> *args, **kw: self.method(cls,*args,**kw)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">staticmethod</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, <span class="built_in">callable</span></span>):</span></span><br><span class="line">		self.f = <span class="built_in">callable</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self, obj, cls=<span class="literal">None</span></span>):</span></span><br><span class="line">		<span class="keyword">return</span> self.f</span><br><span class="line"><span class="meta">	@property</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__func__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">return</span> self.f</span><br></pre></td></tr></table></figure>
<ul>
<li><p>类中静态方法、类方法就是以上类型的描述器</p>
<ul>
<li>静态方法：不自动传入第一个参数</li>
<li>类方法：默认传递类作为第一个参数</li>
<li>描述器用途就是避免默认传入实例为第一个参数的行为</li>
</ul>
</li>
<li><p>静态方法、类方法均是非资料描述器，所以和实例属性重名时
会被覆盖</p>
</li>
<li><p>所以类静态方法、类方法不能直接通过<code>__dict__</code>获取、调用，
需要调用<code>__get__</code>方法返回绑定方法才能调用</p>
<ul>
<li>直接访问属性则由<code>__getattribute__</code>方法代劳</li>
</ul>
</li>
</ul>
<h3 id="例-1"><a href="#例-1" class="headerlink" title="例"></a>例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Integer</span>:</span></span><br><span class="line">	<span class="comment"># 描述器类</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">		self.name = name</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self, instance, cls</span>):</span></span><br><span class="line">		<span class="comment"># 描述器的每个方法会接受一个操作实例`instance`</span></span><br><span class="line">		<span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">			<span class="comment"># 描述器只能定义为类属性，在这里处理直接使用类</span></span><br><span class="line">				<span class="comment"># 访问描述器类的逻辑</span></span><br><span class="line">			<span class="keyword">return</span> self</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">return</span> instance.__dict__(self.name)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__set__</span>(<span class="params">self, instance, value</span>):</span></span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> instance(value, <span class="built_in">int</span>):</span><br><span class="line">			rasie TypeError(<span class="string">&quot;expect an int&quot;</span>)</span><br><span class="line">		instance.__dict__[self.name] = value</span><br><span class="line">			<span class="comment"># 描述器方法会操作实例底层`__dict__`属性</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__delete__</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">		<span class="keyword">del</span> instance.__dict__[self.name]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>:</span></span><br><span class="line">	x = Integer(<span class="string">&quot;x&quot;</span>)</span><br><span class="line">	y = Integer(<span class="string">&quot;y&quot;</span>)</span><br><span class="line">		<span class="comment"># 需要将描述器的实例作为类属性放在类的定义中使用</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x, y</span>):</span></span><br><span class="line">		self.x = x</span><br><span class="line">		self.y = y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">	p = Point(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">	<span class="built_in">print</span>(p.x)</span><br><span class="line">		<span class="comment"># 调用`Point.x.__get__(p, Point)`</span></span><br><span class="line">	<span class="built_in">print</span>(Point.x)</span><br><span class="line">		<span class="comment"># 调用`Point.x.__get__(None, Point)`</span></span><br><span class="line">	p.y = <span class="number">5</span></span><br><span class="line">		<span class="comment"># 调用`Point.y.__set__(p, 5)`</span></span><br></pre></td></tr></table></figure>
<h2 id="自定义类创建"><a href="#自定义类创建" class="headerlink" title="自定义类创建"></a>自定义类创建</h2><h3 id="init-subclass"><a href="#init-subclass" class="headerlink" title="__init_subclass__"></a><code>__init_subclass__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">classmethod</span> <span class="built_in">object</span>.__init_subclass__(cls):</span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li>用途：派生类继承父类时，基类的<code>__init_subclas__</code>被调用<ul>
<li>可以用于编写能够改变子类行为的类</li>
<li>类似类装饰器，但是类装饰其影响其应用的类，而
<code>__init_subclass__</code>影响基类所有派生子类</li>
<li>默认实现：无行为、只有一个参数<code>cls</code></li>
<li>方法默认、隐式为类方法，不需要<code>classmethod</code>封装</li>
</ul>
</li>
</ul>
<ul>
<li><p>参数</p>
<ul>
<li><code>cls</code>：指向新的子类</li>
<li>默认实现无参数，可以覆盖为自定义参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Philosopher</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init_subclass__</span>(<span class="params">self, default_name, **kwargs</span>):</span></span><br><span class="line">		<span class="built_in">super</span>().__init_subclass__(**kwrags)</span><br><span class="line">		cls.default_name = default_name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AstraliaPhilosopher</span>(<span class="params">Philosopher, default_name=<span class="string">&quot;Bruce&quot;</span></span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li>定义派生类时需要注意传递参数</li>
<li>元类参数<code>metaclass</code>会被其他类型机制消耗，不会被传递
给<code>__init_subclass__</code></li>
</ul>
</li>
</ul>
<h3 id="元类"><a href="#元类" class="headerlink" title="元类"></a>元类</h3><ul>
<li><p>默认情况下，类使用<code>type</code>构建</p>
<ul>
<li>类体在新的命名空间中执行，类名被局部绑定到
元类创建结果<code>type(name, bases, namespace)</code></li>
</ul>
</li>
<li><p>可在类定义部分传递<code>metaclass</code>关键字参数，自定义类创建
过程</p>
<ul>
<li>类继承同样继承父类元类参数</li>
<li>其他类定义过程中的其他关键字参数会在以下元类操作中
进行传递<ul>
<li>解析MRO条目</li>
<li>确定适当元类</li>
<li>准备类命名空间<code>__prepare__</code></li>
<li>执行类主体</li>
<li>创建类对象</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="解释MRO条目"><a href="#解释MRO条目" class="headerlink" title="解释MRO条目"></a>解释MRO条目</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def type.__mro_entries__():</span><br><span class="line">	pass</span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：若类定义中基类不是<code>type</code>的实例，则使用此方法对
基类进行搜索</p>
<ul>
<li>找到结果时，以原始基类元组作为参数进行调用</li>
</ul>
</li>
<li><p>返回值：类的元组替代基类被使用</p>
<ul>
<li>元组可以为空，此时原始基类将被忽略</li>
</ul>
</li>
</ul>
<h4 id="元类确定"><a href="#元类确定" class="headerlink" title="元类确定"></a>元类确定</h4><ul>
<li>若没有显式给出基类、或元类，使用<code>type()</code></li>
<li>若显式给出的元类不是<code>type()</code>的实例，直接用其作为元类</li>
<li>若显式给出<code>type()</code>实例作为元类、或定义有基类，则选取
“最派生”元类<ul>
<li>最派生元类从显式指定的元类、基类中元类中选取</li>
<li>最派生元类应为所有候选元类的子类型</li>
<li>若没有满足条件的候选元类则<code>raise TypeError</code></li>
</ul>
</li>
</ul>
<h4 id="准备类命名空间"><a href="#准备类命名空间" class="headerlink" title="准备类命名空间"></a>准备类命名空间</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">type</span>.<span class="title">__prepare__</span>(<span class="params">name, bases, **kwds</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：确定合适的元类之后，准备类命名空间</p>
<ul>
<li>若元类没有<code>__prepare__</code>属性，类命名空间将被初始化为
空<code>ordered mapping</code></li>
</ul>
</li>
<li><p>参数：来自于类定义中的关键字参数</p>
</li>
</ul>
<h4 id="执行类定义主体"><a href="#执行类定义主体" class="headerlink" title="执行类定义主体"></a>执行类定义主体</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exec</span>(body, <span class="built_in">globals</span>(), namespace)</span><br><span class="line">	<span class="comment"># 执行类主体类似于</span></span><br></pre></td></tr></table></figure>
<ul>
<li>普通调用和<code>exec()</code>区别<ul>
<li>类定义在函数内部时<ul>
<li>词法作用域允许类主体、方法引用来自当前、外部
作用域名称</li>
<li>但内部方法仍然无法看到在类作用域层次上名称</li>
<li>类变量必须通过实例的第一个形参、类方法方法</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="创建类对象"><a href="#创建类对象" class="headerlink" title="创建类对象"></a>创建类对象</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">metaclass(name, base, namespace, **kwds):</span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：执行类主体填充类命名空间后，将通过调用
<code>metaclass(name, base, namespace, **kwds)</code>创建类对象</p>
</li>
<li><p>参数：来自类定义中的关键字参数</p>
</li>
</ul>
<h5 id="说明-8"><a href="#说明-8" class="headerlink" title="说明"></a>说明</h5><ul>
<li><p>若类主体中有方法中引用<code>__class__</code>、<code>super</code>，则<code>__class__</code>
将被编译器创建为隐式闭包引用</p>
<ul>
<li>这使得无参数调用<code>super</code>可以能基于词法作用域正确
定位类</li>
<li>而被用于进行当前调用的类、实例则是基于传递给方法
的第一个参数来标识</li>
</ul>
</li>
</ul>
<h2 id="自定义实例、子类检查"><a href="#自定义实例、子类检查" class="headerlink" title="自定义实例、子类检查"></a>自定义实例、子类检查</h2><ul>
<li><p>以下方法应该的定义在元类中，不能在类中定义为类方法</p>
<ul>
<li>类似于实例从类中查找方法</li>
</ul>
</li>
<li><p>元类<code>abc.ABCMeta</code>实现了以下方法以便允许将抽象基类<code>ABC</code>
作为“虚拟基类”添加到任何类、类型（包括内置类型）中</p>
</li>
</ul>
<h3 id="instancecheck"><a href="#instancecheck" class="headerlink" title="__instancecheck__"></a><code>__instancecheck__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">class</span>.<span class="title">__instancecheck__</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：若<code>instance</code>被视为<code>class</code>直接、间接实例则返回真值</p>
<ul>
<li>重载<code>instance</code>内置函数行为</li>
</ul>
</li>
<li><p>返回：布尔值</p>
<ul>
<li>内置钩子函数：<code>isintance(instance, class)</code></li>
</ul>
</li>
</ul>
<h3 id="subclasscheck"><a href="#subclasscheck" class="headerlink" title="__subclasscheck__"></a><code>__subclasscheck__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span>.__subclasscheck__(self, subclass):</span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：若<code>subclass</code>被视为<code>class</code>的直接、间解子类则返回
真值</p>
<ul>
<li>重载<code>issubclass</code>内置函数行为</li>
</ul>
</li>
<li><p>返回：布尔值</p>
<ul>
<li>内置钩子函数：<code>issubclass(subclass, class)</code></li>
</ul>
</li>
</ul>
<h2 id="模拟范型类型"><a href="#模拟范型类型" class="headerlink" title="模拟范型类型"></a>模拟范型类型</h2><h3 id="class-getitem"><a href="#class-getitem" class="headerlink" title="__class_getitem__"></a><code>__class_getitem__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">classmethod</span> <span class="built_in">object</span>.__class_getitem__(cls, key):</span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：按照<code>key</code>指定类型返回表示泛型类的专门化对象</p>
<ul>
<li>实现<em>PEP 484</em>规定的泛型类语法</li>
<li>查找基于对象自身</li>
<li>主要被保留用于静态类型提示，不鼓励其他尝试使用</li>
<li>方法默认、隐式为类方法，不需要<code>classmethod</code>封装</li>
</ul>
</li>
<li><p>参数</p>
<ul>
<li><code>cls</code>：当前类</li>
<li><code>key</code>：类型</li>
</ul>
</li>
</ul>
<h2 id="模拟可调用对象"><a href="#模拟可调用对象" class="headerlink" title="模拟可调用对象"></a>模拟可调用对象</h2><h3 id="call"><a href="#call" class="headerlink" title="__call__"></a><code>__call__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__call__</span>(<span class="params">self[,args...]</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li>用途：实例作为函数被调用时被调用<ul>
<li>若定义此方法<code>x(arg1, arg2, ...)</code>等价于
<code>x.__call__(arg1, args2, ...)</code></li>
</ul>
</li>
</ul>
<h2 id="模拟容器类型"><a href="#模拟容器类型" class="headerlink" title="模拟容器类型"></a>模拟容器类型</h2><ul>
<li><code>collections.abc.MutableMapping</code>为抽象基类<ul>
<li>其实现基本方法集<code>__getitem__</code>、<code>__setitem__</code>、
<code>__delitem__</code>、<code>keys()</code></li>
<li>可以方法继承、扩展、实现自定义映射类</li>
</ul>
</li>
</ul>
<h3 id="len"><a href="#len" class="headerlink" title="__len__"></a><code>__len__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__len__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：计算、返回实例长度</p>
<ul>
<li>若对象未定义<code>__bool__</code>，以<code>__len__</code>是否返回非0作为
布尔运算结果</li>
</ul>
</li>
<li><p>返回值：非负整形</p>
<ul>
<li>钩子函数：<code>len()</code></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>CPython：要求长度最大为<code>sys.maxsize</code>，否则某些特征可能
  会<code>raise OverflowError</code></li>
</ul>
</blockquote>
<h3 id="length-hint"><a href="#length-hint" class="headerlink" title="__length_hint__"></a><code>__length_hint__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__length_hist__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：返回对象长度<strong>估计值</strong></p>
<ul>
<li>存粹为优化性能，不要求正确无误</li>
</ul>
</li>
<li><p>返回值：非负整形</p>
<ul>
<li>钩子函数：<code>operator.length_hint()</code></li>
</ul>
</li>
</ul>
<h3 id="getitem"><a href="#getitem" class="headerlink" title="__getitem__"></a><code>__getitem__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__getitem__</span>(<span class="params">self, key</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：实现根据索引取值</p>
</li>
<li><p>参数</p>
<ul>
<li><p>序列<code>key</code>：整数、切片对象</p>
<ul>
<li><code>key</code>类型不正确将<code>raise TypeError</code></li>
<li><code>key</code>在实例有效范围外将<code>raise IndexError</code></li>
</ul>
</li>
<li><p>映射<code>key</code>：可hash对象</p>
<ul>
<li><code>key</code>不存在将<code>raise KeyError</code></li>
</ul>
</li>
</ul>
</li>
<li><p>返回值：<code>self[key]</code></p>
</li>
</ul>
<h3 id="setitem"><a href="#setitem" class="headerlink" title="__setitem__"></a><code>__setitem__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__setitem__</span>(<span class="params">self, key, value</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：实现根据索引赋值</p>
</li>
<li><p>参数：同<code>__geitem__</code></p>
</li>
</ul>
<h3 id="delitem"><a href="#delitem" class="headerlink" title="__delitem__"></a><code>__delitem__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__delitem</span>(<span class="params">self, key</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：实现删除索引对应项</p>
</li>
<li><p>参数：同<code>__getitem__</code></p>
</li>
</ul>
<h3 id="missing"><a href="#missing" class="headerlink" title="__missing__"></a><code>__missing__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__missing__</span>(<span class="params">self, key</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li>用途：<code>__getitem__</code>无法找到映射中键时调用</li>
</ul>
<h3 id="reversed"><a href="#reversed" class="headerlink" title="__reversed__"></a><code>__reversed__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：为容器类创建逆向迭代器</p>
</li>
<li><p>返回值：逆向迭代对象</p>
<ul>
<li>内置钩子函数：<code>reversed()</code></li>
</ul>
</li>
</ul>
<h4 id="说明-9"><a href="#说明-9" class="headerlink" title="说明"></a>说明</h4><ul>
<li><p>若未提供<code>__reversed__</code>方法，<code>reversed</code>函数将回退到使用
<strong>序列协议</strong>：<code>__len__</code>、<code>__getitem__</code></p>
</li>
<li><p>支持序列协议的对象应该仅在能够提供比<code>reversed</code>更高效实现
时才提供<code>__reversed__</code>方法</p>
</li>
</ul>
<h3 id="contains"><a href="#contains" class="headerlink" title="__contains__"></a><code>__contains__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__contains__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：实现成员检测</p>
<ul>
<li>若<code>item</code>是<code>self</code>成员则返回<code>True</code>、否则返回<code>False</code></li>
<li>对映射应检查键</li>
</ul>
</li>
<li><p>返回值：布尔值</p>
<ul>
<li>钩子运算：<code>in</code></li>
</ul>
</li>
</ul>
<h4 id="说明-10"><a href="#说明-10" class="headerlink" title="说明"></a>说明</h4><ul>
<li><p>若未提供<code>__contains__</code>方法，成员检测将依次尝试</p>
<ul>
<li>通过<code>__iter__</code>进行迭代</li>
<li>使用<code>__getitem__</code>旧式序列迭代协议</li>
</ul>
</li>
<li><p>容器对象可以提供更有效率的实现</p>
</li>
</ul>
<h2 id="模拟数字"><a href="#模拟数字" class="headerlink" title="模拟数字"></a>模拟数字</h2><h3 id="数字运算"><a href="#数字运算" class="headerlink" title="数字运算"></a>数字运算</h3><p>定义以下方法即可模拟数字类型</p>
<ul>
<li>特定类型数值类型不支持的运算应保持未定义状态</li>
<li>若不支持与提供的参数进行运算，应返回<code>NotImplemented</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__add__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `+`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__sub__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `-`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__mul__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `*`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__matmul__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `@`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__truediv__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `/`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__floordiv__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `//`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__mod__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `%`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__divmod__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `divmod()`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__pow__</span>(<span class="params">self, other[, modulo=<span class="number">1</span>]</span>):</span></span><br><span class="line">	<span class="comment"># `pow()`/`**`</span></span><br><span class="line">	<span class="comment"># 若要支持三元版本内置`pow()`函数，应该接受可选的第三个</span></span><br><span class="line">		<span class="comment"># 参数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__lshift__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `&lt;&lt;`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rshift__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `&gt;&gt;`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__and__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `&amp;`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__or__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `|`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__xor__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `~`</span></span><br></pre></td></tr></table></figure>
<h3 id="反射二进制算术运算"><a href="#反射二进制算术运算" class="headerlink" title="反射二进制算术运算"></a>反射二进制算术运算</h3><p>以下成员函数仅在<strong>左操作数不支持相应运算</strong>、
<strong>且两操作数类型不同时</strong>被调用</p>
<ul>
<li><p>实例作为作为相应运算的右操作数</p>
</li>
<li><p>若右操作数类型为左操作数类型子类，且字类提供如下反射方法</p>
<ul>
<li>右操作数反射方法优先于左操作数非反射方法被调用</li>
<li>允许子类覆盖祖先类运算符</li>
</ul>
</li>
<li><p>三元版<code>pow()</code>不会尝试调用<code>__rpow__</code>（转换规则太复杂）</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__radd__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `+`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rsub__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `-`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rmul__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `*`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rmatmul__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `@`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rtruediv__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `/`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rfloordiv__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `//`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rmod__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `%`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rdivmod__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `divmod()`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rpow__</span>(<span class="params">self, other[, modulo=<span class="number">1</span>]</span>):</span></span><br><span class="line">	<span class="comment"># `pow()`/`**`</span></span><br><span class="line">	<span class="comment"># 若要支持三元版本内置`pow()`函数，应该接受可选的第三个</span></span><br><span class="line">		<span class="comment"># 参数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rlshift__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `&lt;&lt;`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rrshift__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `&gt;&gt;`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rand__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `&amp;`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__ror__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `|`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__rxor__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `~`</span></span><br></pre></td></tr></table></figure>
<h3 id="扩展算术赋值"><a href="#扩展算术赋值" class="headerlink" title="扩展算术赋值"></a>扩展算术赋值</h3><p>实现以下方法实现扩展算数赋值</p>
<ul>
<li><p>以下方法应该尝试对自身进行操作</p>
<ul>
<li>修改<code>self</code>、返回结果（不一定为<code>self</code>）</li>
</ul>
</li>
<li><p>若方法未定义，相应扩展算数赋值将回退到普通方法中</p>
</li>
<li><p>某些情况下，扩展赋值可导致未预期错误</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__iadd__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `+=`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__isub__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `-=`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__imul__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `*=`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__imatmul__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `@=`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__itruediv__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `/=`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__ifloordiv__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `//=`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__imod__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `%=`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__ipow__</span>(<span class="params">self, other[, modulo=<span class="number">1</span>]</span>):</span></span><br><span class="line">	<span class="comment"># `**=`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__ilshift__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `&lt;&lt;=`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__irshift__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `&gt;&gt;=`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__iand__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `&amp;=`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__ior__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `|=`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__ixor__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">	<span class="comment"># `~=`</span></span><br></pre></td></tr></table></figure>
<h3 id="一元算术运算"><a href="#一元算术运算" class="headerlink" title="一元算术运算"></a>一元算术运算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__neg__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="comment"># `-`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__pos__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="comment"># `+`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__abs__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="comment"># `abs()`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__invert__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="comment"># `~`</span></span><br></pre></td></tr></table></figure>
<h3 id="类型转换运算"><a href="#类型转换运算" class="headerlink" title="类型转换运算"></a>类型转换运算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__complex__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="comment"># `complex()`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__int__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="comment"># `int()`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__float__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="comment"># `float()`</span></span><br></pre></td></tr></table></figure>
<h3 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__index__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>存在此方法表明对象属于整数类型</p>
<ul>
<li>必须返回整数</li>
<li>为保证以一致性，同时也应该定义<code>__int__()</code>，两者返回
相同值</li>
</ul>
</li>
<li><p>调用此方法以实现<code>operator.index()</code>、或需要无损的转换为
整数对象</p>
<ul>
<li>作为索引、切片参数</li>
<li>作为<code>bin()</code>、<code>hex()</code>、<code>oct()</code>函数参数</li>
</ul>
</li>
</ul>
<h3 id="精度运算"><a href="#精度运算" class="headerlink" title="精度运算"></a>精度运算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__round__</span>(<span class="params">self[, ndigits]</span>):</span></span><br><span class="line">	<span class="comment"># `round()`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__trunc__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="comment"># `math.trunc()`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__floor__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="comment"># `math.floor()`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__ceil__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="comment"># `math.ceil()`</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>返回值：除<code>__round__</code>中给出<code>ndigits</code>参数外，都应该为
原对象截断为<code>Integral</code>（通常为<code>int</code>）</p>
</li>
<li><p>若未定义<code>__int__</code>，则<code>int</code>回退到<code>__trunc__</code></p>
</li>
</ul>
<h2 id="元属性查找"><a href="#元属性查找" class="headerlink" title="元属性查找"></a>元属性查找</h2><ul>
<li><p>元属性查找通常会绕过<code>__getattribute__</code>方法，甚至包括元类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>(<span class="params"><span class="built_in">type</span></span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span>(<span class="params">*args</span>):</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;Metaclass getattribute invoked&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">type</span>.__getattribute__(*args)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>(<span class="params"><span class="built_in">object</span>, metaclass=Meta</span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__len__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">10</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span>(<span class="params">*args</span>):</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;Class getattribute invoked&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">object</span>.__geattribute__(*args)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	c = C()</span><br><span class="line">	c.__len__()</span><br><span class="line">		<span class="comment"># 通过实例显式调用</span></span><br><span class="line">		<span class="comment"># 输出`Class getattribute invoked\n10&quot;</span></span><br><span class="line">	<span class="built_in">type</span>(c).__len__(c)</span><br><span class="line">		<span class="comment"># 通过类型显式调用</span></span><br><span class="line">		<span class="comment"># 输出`Metaclass getattribute invoked\n10&quot;</span></span><br><span class="line">	<span class="built_in">len</span>(c)</span><br><span class="line">		<span class="comment"># 隐式查找</span></span><br><span class="line">		<span class="comment"># 输出`10`</span></span><br></pre></td></tr></table></figure>
<ul>
<li>为解释器内部速度优化提供了显著空间</li>
<li>但是牺牲了处理特殊元属性时的灵活性<ul>
<li>特殊元属性必须设置在类对象本身上以便始终一致地
由解释器发起调用</li>
</ul>
</li>
</ul>
</li>
<li><p>隐式调用元属性仅保证<strong>元属性定义在对象类型中</strong>能正确发挥
作用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	c = C()</span><br><span class="line">	c.__len__() = <span class="keyword">lambda</span>: <span class="number">5</span></span><br><span class="line">	<span class="built_in">len</span>(c)</span><br><span class="line">		<span class="comment"># `rasie TypeError`</span></span><br></pre></td></tr></table></figure>
<ul>
<li>元属性定义在实例字典中会引发异常</li>
<li>若元属性的隐式查找过程使用了传统查找过程，会在对类型
对象本身发起调用时失败</li>
<li><p>可以通过在查找元属性时绕过实例避免</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(<span class="number">1</span>).__hash__(<span class="number">1</span>) == <span class="built_in">hash</span>(<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(<span class="built_in">int</span>).__hash__(<span class="built_in">int</span>) == <span class="built_in">hash</span>(<span class="built_in">int</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="上下文管理器协议"><a href="#上下文管理器协议" class="headerlink" title="上下文管理器协议"></a>上下文管理器协议</h2><p>上下文管理器：定义了在执行<code>with</code>语句时要建立的运行时上下文
的对象</p>
<ul>
<li><p>上下文管理器为执行代码块，处理进入、退出运行时所需上下文</p>
<ul>
<li>通常使用<code>with</code>语句调用</li>
<li>也可以直接调用协议中方法方法</li>
</ul>
</li>
<li><p>典型用法</p>
<ul>
<li>保存、恢复各种全局状态</li>
<li>锁、解锁资源：避免死锁</li>
<li>关闭打开的文件：自动控制资源释放</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>可利用<code>contextlib</code>模块方便实现上下文管理器协议</li>
</ul>
</blockquote>
<h3 id="enter"><a href="#enter" class="headerlink" title="__enter__"></a><code>__enter__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">contextmanager</span>.<span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：创建、进入与当前对象相关的运行时上下文</p>
<ul>
<li>在执行<code>with</code>语句块前设置运行时上下文</li>
</ul>
</li>
<li><p>返回值</p>
<ul>
<li><code>with</code>子句绑定方法返回值到<code>as</code>子句中指定的目标，如果
方法返回值</li>
</ul>
</li>
</ul>
<h3 id="exit"><a href="#exit" class="headerlink" title="__exit__"></a><code>__exit__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">contextmanger</span>.<span class="title">__exit__</span>(<span class="params">self, exc_type, exc_value, traceback</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：销毁、退出关联到此对象的运行时上下文</p>
<ul>
<li><code>with</code>语句块结束后，<code>__exit__</code>方法触发进行清理工作</li>
<li>不论<code>with</code>代码块中发生什么，即使是出现异常，
<code>__exit__</code>控制流也会执行完</li>
</ul>
</li>
<li><p>参数：描述了导致上下文退出的异常，正常退出则各参数为
<code>None</code></p>
<ul>
<li><code>exc_type</code></li>
<li><code>exc_value</code></li>
<li><code>traceback</code></li>
</ul>
</li>
<li><p>返回值：布尔值</p>
<ul>
<li>若上下文因异常退出<ul>
<li>希望方法屏蔽此异常（避免传播），应该返回真值，
异常被清空</li>
<li>否则异常在退出此方法时将按照正常流程处理</li>
</ul>
</li>
<li>方法中不应该重新引发被传入的异常，这是调用者的责任</li>
</ul>
</li>
</ul>
<h3 id="例-2"><a href="#例-2" class="headerlink" title="例"></a>例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> socket, AF_INET, SOCK_STREAM</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LazyConnection</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, address, family=AF_INET, <span class="built_in">type</span>=SOCK_STREAM</span>):</span></span><br><span class="line">		self.address = address</span><br><span class="line">		self.family = family</span><br><span class="line">		self.<span class="built_in">type</span> = <span class="built_in">type</span></span><br><span class="line">		self.connections = []</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">		sock = socket(self.family, self.<span class="built_in">type</span>)</span><br><span class="line">		sock.connect(self.address)</span><br><span class="line">		self.connections.append(sock)</span><br><span class="line">		<span class="keyword">return</span> self.sock</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_ty, exc_val, tb</span>):</span></span><br><span class="line">		self.connections.pop().close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">	conn = LazyConnection(<span class="string">&quot;www.python.org&quot;</span>, <span class="number">80</span>))</span><br><span class="line">	<span class="keyword">with</span> conn <span class="keyword">as</span> s1:</span><br><span class="line">		<span class="comment"># `conn.__enter___()` executes: connection opened</span></span><br><span class="line">		s.send(<span class="string">b&quot;GET /index.html HTTP/1.0\r\n&quot;</span>)</span><br><span class="line">		s.send(<span class="string">b&quot;Host: www.python.org\r\n&quot;</span>)</span><br><span class="line">		s.send(<span class="string">b&quot;\r\n&quot;</span>)</span><br><span class="line">		resp = <span class="string">b&quot;&quot;</span>.join(<span class="built_in">iter</span>(partial(s.recv, <span class="number">8192</span>), <span class="string">b&quot;&quot;</span>))</span><br><span class="line">		<span class="comment"># `conn.__exit__()` executes: connection closed</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">with</span> conn <span class="keyword">as</span> s2:</span><br><span class="line">			<span class="comment"># 此版本`LasyConnection`可以看作是连接工厂</span></span><br><span class="line">			<span class="comment"># 使用列表构造栈管理连接，允许嵌套使用</span></span><br><span class="line">			<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h2 id="迭代器协议"><a href="#迭代器协议" class="headerlink" title="迭代器协议"></a>迭代器协议</h2><ul>
<li>可迭代对象：实现<code>__iter__</code>方法的对象</li>
<li>迭代器对象：同时实现<code>__next__</code>方法的可迭代对象</li>
</ul>
<blockquote>
<ul>
<li>使用<code>collections.abc</code>模块判断对象类型</li>
</ul>
</blockquote>
<h3 id="iter"><a href="#iter" class="headerlink" title="__iter__"></a><code>__iter__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：创建迭代器对象，<strong>不负责产生、返回迭代器元素</strong></p>
<ul>
<li>容器对象要提供迭代须实现此方法<ul>
<li>容器支持不同迭代类型，可以提供额外方法专门请求
不同迭代类型迭代器</li>
</ul>
</li>
<li>迭代对象本身需要实现此方法，返回对象自身<ul>
<li>允许容器、迭代器均可配合<code>for...in...</code>语句使用</li>
</ul>
</li>
</ul>
</li>
<li><p>返回值：迭代器对象</p>
<ul>
<li>映射类型应该逐个迭代容器中键</li>
<li>内置钩子函数：<code>iter()</code></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>此方法对应Python/C API中python对象类型结构体中
  <code>tp_iter</code>槽位</li>
</ul>
</blockquote>
<h3 id="next"><a href="#next" class="headerlink" title="__next__"></a><code>__next__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__next__</span>():</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：从迭代器中返回下一项</p>
<ul>
<li>若没有项可以返回，则<code>raise StopIteration</code></li>
<li>一旦引发<code>raise StopIteration</code>，对后续调用必须一直
引发同样的异常，否则此行为特性无法正常使用</li>
</ul>
</li>
<li><p>返回值：迭代器对象中下个元素</p>
<ul>
<li>映射类型返回容器中键</li>
<li>内置钩子函数：<code>next()</code></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>此方法对应Python/C API中python对象类型结构体中
  <code>tp_iternext</code>槽位</li>
</ul>
</blockquote>
<h2 id="协程-异步"><a href="#协程-异步" class="headerlink" title="协程/异步"></a>协程/异步</h2><h3 id="await"><a href="#await" class="headerlink" title="__await__"></a><code>__await__</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__await__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：用于实现<strong>可等待对象</strong></p>
</li>
<li><p>返回值：迭代器</p>
<ul>
<li>钩子运算：<code>await</code></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><code>asyncio.Future</code>实现此方法以与<code>await</code>表达式兼容</li>
</ul>
</blockquote>
<h4 id="Awaitable-Objects"><a href="#Awaitable-Objects" class="headerlink" title="Awaitable Objects"></a><em>Awaitable Objects</em></h4><p>可等待对象：异步调用句柄，<strong>等待结果应为迭代器</strong></p>
<ul>
<li><p>主要是实现<code>__await__</code>方法对象</p>
<ul>
<li>从<code>async def</code>函数返回的协程对象</li>
</ul>
</li>
<li><p><code>type.coroutine()</code>、<code>asyncio.coroutine()</code>装饰的生成器
返回的生成器迭代器对象也属于可等待对象，但其未实现
<code>__await__</code></p>
</li>
</ul>
<blockquote>
<ul>
<li>协程对象参见<em>cs_python/py3ref/dm_gfuncs</em></li>
<li>py3.7前多次<code>await</code>可等待对象返回<code>None</code>，之后报错</li>
</ul>
</blockquote>
<h3 id="异步迭代器协议"><a href="#异步迭代器协议" class="headerlink" title="异步迭代器协议"></a>异步迭代器协议</h3><ul>
<li>异步迭代器常用于<code>async for</code>语句中</li>
</ul>
<blockquote>
<ul>
<li>其他参见迭代器协议</li>
</ul>
</blockquote>
<h4 id="aiter"><a href="#aiter" class="headerlink" title="__aiter__"></a><code>__aiter__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__aiter__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li>用途：返回异步迭代器对象，<strong>不负责产生、返回迭代器元素</strong><ul>
<li>返回其他任何对象都将<code>raise TypeError</code></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>其他参见<code>__iter__</code>方法</li>
</ul>
</blockquote>
<h4 id="anext"><a href="#anext" class="headerlink" title="__anext__"></a><code>__anext__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__anext__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>返回：从异步迭代器返回下个结果值</p>
<ul>
<li>迭代结束时应该<code>raise StopAsyncIteration</code></li>
</ul>
</li>
<li><p>用途</p>
<ul>
<li>在其中调用异步代码</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>其他参见<code>__next__</code>方法</li>
</ul>
</blockquote>
<h4 id="例-3"><a href="#例-3" class="headerlink" title="例"></a>例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reader</span>:</span></span><br><span class="line">	<span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">readline</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__aiter__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">return</span> self</span><br><span class="line">	<span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">__anext__</span>(<span class="params">self</span>):</span></span><br><span class="line">		val = <span class="keyword">await</span> self.readline()</span><br><span class="line">		<span class="keyword">if</span> val == <span class="string">&quot;b&quot;</span>:</span><br><span class="line">			<span class="keyword">raise</span> StopAsyncIteration</span><br><span class="line">		<span class="keyword">return</span> val</span><br></pre></td></tr></table></figure>
<h3 id="异步上下文管理器协议"><a href="#异步上下文管理器协议" class="headerlink" title="异步上下文管理器协议"></a>异步上下文管理器协议</h3><ul>
<li>异步上下文管理器常用于<code>async with</code><strong>异步</strong>语句中</li>
</ul>
<blockquote>
<ul>
<li>其他参见上下文管理器协议</li>
</ul>
</blockquote>
<h4 id="aenter"><a href="#aenter" class="headerlink" title="__aenter__"></a><code>__aenter__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__aenter__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：异步创建、进入关联当前对象的上下文执行环境</p>
<ul>
<li>由<code>async def</code>定义为协程函数，即在创建上下文执行环境
时可以被挂起</li>
</ul>
</li>
<li><p>返回：可等待对象</p>
</li>
</ul>
<blockquote>
<ul>
<li>其他参见<code>__enter__</code></li>
</ul>
</blockquote>
<h4 id="aexit"><a href="#aexit" class="headerlink" title="__aexit__"></a><code>__aexit__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">object</span>.<span class="title">__aexit__</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：异步销毁、退出关联当前对象的上下文执行环境</p>
<ul>
<li>由<code>async def</code>定义为协程函数，即在销毁上下文执行环境
时可以被挂起</li>
</ul>
</li>
<li><p>返回：可等待对象</p>
</li>
</ul>
<blockquote>
<ul>
<li>其他参见<code>__exit__</code>函数</li>
</ul>
</blockquote>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithm/"><span class="level-start"><span class="level-item">Algorithm</span></span><span class="level-end"><span class="level-item tag">36</span></span></a><ul><li><a class="level is-mobile" href="/categories/Algorithm/Data-Structure/"><span class="level-start"><span class="level-item">Data Structure</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Heuristic/"><span class="level-start"><span class="level-item">Heuristic</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Issue/"><span class="level-start"><span class="level-item">Issue</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Problem/"><span class="level-start"><span class="level-item">Problem</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Specification/"><span class="level-start"><span class="level-item">Specification</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/C-C/"><span class="level-start"><span class="level-item">C/C++</span></span><span class="level-end"><span class="level-item tag">34</span></span></a><ul><li><a class="level is-mobile" href="/categories/C-C/Cppref/"><span class="level-start"><span class="level-item">Cppref</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/Cstd/"><span class="level-start"><span class="level-item">Cstd</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/MPI/"><span class="level-start"><span class="level-item">MPI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/STL/"><span class="level-start"><span class="level-item">STL</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/CS/"><span class="level-start"><span class="level-item">CS</span></span><span class="level-end"><span class="level-item tag">14</span></span></a><ul><li><a class="level is-mobile" href="/categories/CS/Character/"><span class="level-start"><span class="level-item">Character</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Parallel/"><span class="level-start"><span class="level-item">Parallel</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Program-Design/"><span class="level-start"><span class="level-item">Program Design</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Storage/"><span class="level-start"><span class="level-item">Storage</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Daily-Life/"><span class="level-start"><span class="level-item">Daily Life</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/Daily-Life/Maxism/"><span class="level-start"><span class="level-item">Maxism</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">27</span></span></a><ul><li><a class="level is-mobile" href="/categories/Database/Hadoop/"><span class="level-start"><span class="level-item">Hadoop</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/SQL-DB/"><span class="level-start"><span class="level-item">SQL DB</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/Spark/"><span class="level-start"><span class="level-item">Spark</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/Java/Scala/"><span class="level-start"><span class="level-item">Scala</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">42</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Bash-Programming/"><span class="level-start"><span class="level-item">Bash Programming</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Configuration/"><span class="level-start"><span class="level-item">Configuration</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/File-System/"><span class="level-start"><span class="level-item">File System</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/IPC/"><span class="level-start"><span class="level-item">IPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Process-Schedual/"><span class="level-start"><span class="level-item">Process Schedual</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Shell/"><span class="level-start"><span class="level-item">Shell</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Tool/"><span class="level-start"><span class="level-item">Tool</span></span><span class="level-end"><span class="level-item tag">14</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Tool/Vi/"><span class="level-start"><span class="level-item">Vi</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Model/"><span class="level-start"><span class="level-item">ML Model</span></span><span class="level-end"><span class="level-item tag">21</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Model/Linear-Model/"><span class="level-start"><span class="level-item">Linear Model</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Model-Component/"><span class="level-start"><span class="level-item">Model Component</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Nolinear-Model/"><span class="level-start"><span class="level-item">Nolinear Model</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Unsupervised-Model/"><span class="level-start"><span class="level-item">Unsupervised Model</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/"><span class="level-start"><span class="level-item">ML Specification</span></span><span class="level-end"><span class="level-item tag">17</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/Click-Through-Rate/"><span class="level-start"><span class="level-item">Click Through Rate</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/Click-Through-Rate/Recommandation-System/"><span class="level-start"><span class="level-item">Recommandation System</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/Computer-Vision/"><span class="level-start"><span class="level-item">Computer Vision</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Specification/FinTech/"><span class="level-start"><span class="level-item">FinTech</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/FinTech/Risk-Control/"><span class="level-start"><span class="level-item">Risk Control</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/Graph-Analysis/"><span class="level-start"><span class="level-item">Graph Analysis</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Specification/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Technique/"><span class="level-start"><span class="level-item">ML Technique</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Technique/Feature-Engineering/"><span class="level-start"><span class="level-item">Feature Engineering</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Technique/Neural-Network/"><span class="level-start"><span class="level-item">Neural Network</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Theory/"><span class="level-start"><span class="level-item">ML Theory</span></span><span class="level-end"><span class="level-item tag">11</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Theory/Loss/"><span class="level-start"><span class="level-item">Loss</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Theory/Model-Enhencement/"><span class="level-start"><span class="level-item">Model Enhencement</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Theory/Optimization/"><span class="level-start"><span class="level-item">Optimization</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Algebra/"><span class="level-start"><span class="level-item">Math Algebra</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Algebra/Linear-Algebra/"><span class="level-start"><span class="level-item">Linear Algebra</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Algebra/Universal-Algebra/"><span class="level-start"><span class="level-item">Universal Algebra</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Analysis/"><span class="level-start"><span class="level-item">Math Analysis</span></span><span class="level-end"><span class="level-item tag">23</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Analysis/Fourier-Analysis/"><span class="level-start"><span class="level-item">Fourier Analysis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Functional-Analysis/"><span class="level-start"><span class="level-item">Functional Analysis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Optimization/"><span class="level-start"><span class="level-item">Optimization</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Real-Analysis/"><span class="level-start"><span class="level-item">Real Analysis</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Mixin/"><span class="level-start"><span class="level-item">Math Mixin</span></span><span class="level-end"><span class="level-item tag">18</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Mixin/Statistics/"><span class="level-start"><span class="level-item">Statistics</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Mixin/Time-Series/"><span class="level-start"><span class="level-item">Time Series</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Probability/"><span class="level-start"><span class="level-item">Probability</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">89</span></span></a><ul><li><a class="level is-mobile" href="/categories/Python/Cookbook/"><span class="level-start"><span class="level-item">Cookbook</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Jupyter/"><span class="level-start"><span class="level-item">Jupyter</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Keras/"><span class="level-start"><span class="level-item">Keras</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Matplotlib/"><span class="level-start"><span class="level-item">Matplotlib</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Numpy/"><span class="level-start"><span class="level-item">Numpy</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Pandas/"><span class="level-start"><span class="level-item">Pandas</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Py3Ref/"><span class="level-start"><span class="level-item">Py3Ref</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Py3std/"><span class="level-start"><span class="level-item">Py3std</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Pywin32/"><span class="level-start"><span class="level-item">Pywin32</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Readme/"><span class="level-start"><span class="level-item">Readme</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/TensorFlow/"><span class="level-start"><span class="level-item">TensorFlow</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Twists/"><span class="level-start"><span class="level-item">Twists</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/RLang/"><span class="level-start"><span class="level-item">RLang</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Rust/"><span class="level-start"><span class="level-item">Rust</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Set/"><span class="level-start"><span class="level-item">Set</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/"><span class="level-start"><span class="level-item">Tool</span></span><span class="level-end"><span class="level-item tag">13</span></span></a><ul><li><a class="level is-mobile" href="/categories/Tool/Editor/"><span class="level-start"><span class="level-item">Editor</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Markup-Language/"><span class="level-start"><span class="level-item">Markup Language</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Web-Browser/"><span class="level-start"><span class="level-item">Web Browser</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Windows/"><span class="level-start"><span class="level-item">Windows</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Web/"><span class="level-start"><span class="level-item">Web</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/Web/CSS/"><span class="level-start"><span class="level-item">CSS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/NPM/"><span class="level-start"><span class="level-item">NPM</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/Proxy/"><span class="level-start"><span class="level-item">Proxy</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/Thrift/"><span class="level-start"><span class="level-item">Thrift</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="UBeaRLy"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">UBeaRLy</p><p class="is-size-6 is-block">Protector of Proxy</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Earth, Solar System</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">392</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">93</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">522</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/xyy15926" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/xyy15926"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-04T15:07:54.896Z">2021-08-04</time></p><p class="title"><a href="/uncategorized/README.html"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T07:46:51.000Z">2021-08-03</time></p><p class="title"><a href="/Web/NPM/hexo_config.html">Hexo 建站</a></p><p class="categories"><a href="/categories/Web/">Web</a> / <a href="/categories/Web/NPM/">NPM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T02:32:45.000Z">2021-08-03</time></p><p class="title"><a href="/Web/NPM/config.html">NPM 总述</a></p><p class="categories"><a href="/categories/Web/">Web</a> / <a href="/categories/Web/NPM/">NPM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-02T08:11:11.000Z">2021-08-02</time></p><p class="title"><a href="/Python/Py3std/internet_data.html">互联网数据</a></p><p class="categories"><a href="/categories/Python/">Python</a> / <a href="/categories/Python/Py3std/">Py3std</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-29T13:55:00.000Z">2021-07-29</time></p><p class="title"><a href="/Linux/Shell/sh_apps.html">Shell 应用程序</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Shell/">Shell</a></p></div></article></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5385776267343559" data-ad-slot="6995841235" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="UBeaRLy" height="28"></a><p class="is-size-7"><span>&copy; 2021 UBeaRLy</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/xyy15926/proxy"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>