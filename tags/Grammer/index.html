<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: Grammer - Hexo</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="UBeaRLy&#039;s Proxy"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="UBeaRLy&#039;s Proxy"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Hexo"><meta property="og:url" content="https://xyy15926.github.io/"><meta property="og:site_name" content="Hexo"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://xyy15926.github.io/img/og_image.png"><meta property="article:author" content="UBeaRLy"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://xyy15926.github.io"},"headline":"Hexo","image":["https://xyy15926.github.io/img/og_image.png"],"author":{"@type":"Person","name":"UBeaRLy"},"publisher":{"@type":"Organization","name":"Hexo","logo":{"@type":"ImageObject","url":"https://xyy15926.github.io/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/darcula.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-5385776267343559" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Hexo" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Visit on GitHub" href="https://github.com/xyy15926/proxy"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">Grammer</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-07-31T18:23:16.000Z" title="8/1/2019, 2:23:16 AM">2019-08-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-07-31T18:23:16.000Z" title="8/1/2019, 2:23:16 AM">2019-08-01</time></span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Bash-Programming/">Bash Programming</a></span><span class="level-item">15 minutes read (About 2274 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Linux/Bash-Programming/variables.html">Shell编程基础</a></h1><div class="content"><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="定义、使用、删除"><a href="#定义、使用、删除" class="headerlink" title="定义、使用、删除"></a>定义、使用、删除</h3><ul>
<li><p>定义变量</p>
<ul>
<li>定义时不加<code>$</code>符号</li>
<li>变量名和等号之间不能有空格</li>
<li>变量名只能由英文字母、数字、下划线，且不以数字开头，
不能用bash中的关键字</li>
<li>已经定义变量可以重新定义</li>
</ul>
</li>
<li><p>使用变量</p>
<ul>
<li><script type="math/tex">var_name`/`${var_name}`：变量名前加`</script>即可使用，
未定义变量直接使用不报错，返回空值</li>
<li><code>&#123;&#125;</code>可选，但是<code>&#123;&#125;</code>能够明确定义变量名范围，帮助阅读、
解释器执行</li>
</ul>
</li>
<li><p><strong>匿名变量</strong></p>
<ul>
<li>可以认为所以语句（命令）的执行结果都存储在一个匿名
变量中，可以在其之前加上<code>$</code>获取其结果</li>
</ul>
</li>
<li><p><code>readonly</code>：设置变量为只读变量，更改（重定义）变量报错</p>
</li>
<li><p><code>unset</code>：删除变量，不能删除只读变量</p>
</li>
</ul>
<h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><p>局部变量：在脚本、命令中定义</p>
<ul>
<li><p>仅在当前shell实例中有效</p>
<ul>
<li>shell变量默认为<em>global</em>，作用域从被定义处开始到脚本
末尾（即使在函数内部定义）</li>
<li>显式<code>local</code>声明作用域局限于函数内部</li>
</ul>
</li>
<li><p>其他shell启动的程序不能访问局部变量</p>
</li>
</ul>
<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><p>环境变量：就是shell中的普通变量，只是这些变量往往被进程读取
用于自身初始化、设置</p>
<ul>
<li>狭义：<code>export</code>/<code>declare -x</code>声明的变量，只有这样的变量
才能默认被子进程继承</li>
<li>广义；shell中所有的变量（包括局部变量）</li>
</ul>
<h4 id="环境变量设置"><a href="#环境变量设置" class="headerlink" title="环境变量设置"></a>环境变量设置</h4><p>在shell中设置环境变量有两种方式</p>
<ul>
<li><p><code>export</code>/<code>declare -x</code>：设置全局（环境）变量</p>
<ul>
<li>任何在该shell设置环境变量后，启动的（子）进程都会
继承该变量</li>
<li>对于常用、许多进程需要的环境变量应该这样设置</li>
</ul>
</li>
<li><p><code>&lt;ENV_NAME&gt;=... cmd</code>：设置临时环境变量</p>
<ul>
<li><code>&lt;ENV_NAME&gt;=...</code>不能被子进程继承，所以必须在其后立刻
接命令</li>
<li>只对当前语句有效，也<strong>不能覆盖</strong>同名变量</li>
</ul>
</li>
</ul>
<h4 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h4><ul>
<li>环境变量是某些程序正常运行的必要条件</li>
<li>所有程序都能访问环境变量，可用作进程通信<ul>
<li>在程序中设置环境变量，供其他进程访问变量</li>
<li>父进程为子进程设置环境变量，供其访问</li>
</ul>
</li>
</ul>
<h3 id="Shell变量"><a href="#Shell变量" class="headerlink" title="Shell变量"></a>Shell变量</h3><p>Shell变量：shell程序设置的特殊变量，包括环境变量、局部变量，
保证shell的正常运行</p>
<ul>
<li><p><code>$0</code>：shell执行脚本名</p>
<ul>
<li>交互式bash（即普通终端中）该参数为<code>-bash</code><ul>
<li>则<code>source</code>执行脚本时，该参数可能非预期</li>
</ul>
</li>
<li>以下shell变量均不考虑<code>$0</code>，如<ul>
<li>函数中<code>$0</code>也是脚本名</li>
<li><code>shift</code>无法跳过该参数</li>
</ul>
</li>
</ul>
</li>
<li><p><code>$1,..., $9</code>：向脚本传递的位置参数</p>
</li>
<li><code>$@</code>：脚本、函数参数列表</li>
<li><code>$*</code>：脚本、函数参数字符串</li>
<li><code>$#</code>：脚本、函数参数数量</li>
<li><code>$?</code>：上条命令执行结果</li>
<li>$$$$：脚本进程号</li>
<li><code>$!</code>：执行脚本最后一条命令</li>
</ul>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><h3 id="拼接"><a href="#拼接" class="headerlink" title="拼接"></a>拼接</h3><blockquote>
<ul>
<li>shell中字符默认为字符串，自动拼接</li>
</ul>
</blockquote>
<h3 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h3><ul>
<li><p><code>*</code>：匹配任意长度字符串</p>
<ul>
<li>不包括<code>.</code>、<code>/</code>，必须显式匹配</li>
</ul>
</li>
<li><p><code>?</code>：匹配一个字符</p>
</li>
<li><p><code>[]</code>：匹配出现在<code>[]</code>中的字符</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /[eh][to][cm]*</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 匹配`/etc`、`/home`等</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>&#123;&#125;</code></p>
<ul>
<li><p>枚举全部</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir &#123;user1, user2&#125;-&#123;home, bin&#125;</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 笛卡尔积（字符串连接）</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 等价于建立`user1-home, user1-bin, user2-home, user2-bin`</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> &#123;1..10&#125;</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 生成序列</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 见`<span class="keyword">for</span>`中`RangeIterator`部分</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="子串"><a href="#子串" class="headerlink" title="子串"></a>子串</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> file=/dir1/dir2/dir3/file.txt.bak</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> null=<span class="string">&quot;&quot;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h4><ul>
<li><code>$&#123;&lt;var_name&gt;:n[:m]&#125;</code>：从第<code>n</code>开始<code>m</code>个字符<ul>
<li><code>n</code>、<code>m</code>非负值<ul>
<li><code>n</code>：从0开始的<strong>下标起始</strong></li>
<li><code>m</code>：<strong>切片长度</strong>，<strong>缺省表示到末尾</strong></li>
</ul>
</li>
<li><code>n</code>、<code>m</code>使用<code>0-</code>负值表示<ul>
<li><code>n</code>：从0开始的负向<strong>下标起始</strong></li>
<li><code>m</code>：从0开始的负向<strong>下标终止</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>解释</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$&#123;file:0:5&#125;</code></td>
<td>提取首个字符开始的5个字符</td>
<td><code>/dir1</code></td>
</tr>
<tr>
<td><code>$&#123;file:5:5&#125;</code></td>
<td>提取第5个字符开始的5个字符</td>
<td><code>/dir2</code></td>
</tr>
<tr>
<td><code>$&#123;file:5&#125;</code></td>
<td>提取第5个字符开始至末尾</td>
<td><code>/dir2...</code></td>
</tr>
<tr>
<td><code>$&#123;file:0-5&#125;</code></td>
<td>反向计算下标</td>
<td><code>t.bak</code></td>
</tr>
<tr>
<td><code>$&#123;file:0-5:0-1&#125;</code></td>
<td>反向计算下标</td>
<td><code>t.ba</code></td>
</tr>
<tr>
<td><code>$&#123;file:5:0-2&#125;</code></td>
<td>提取第5个字符开始至<code>-2</code>下标处</td>
<td><code>/dir2.../t.b</code></td>
</tr>
</tbody>
</table>
</div>
<h4 id="子串匹配"><a href="#子串匹配" class="headerlink" title="子串匹配"></a>子串匹配</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">&#123;&lt;var_name&gt;%&lt;pattern&gt;&#125;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;&lt;var_name&gt;%%&lt;pattern&gt;&#125;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;&lt;var_name&gt;<span class="comment">#&lt;pattern&gt;&#125;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;&lt;var_name&gt;<span class="comment">##&lt;pattern&gt;&#125;</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>#</code>：去掉字符串左边最短pattern</li>
<li><code>##</code>：去掉字符串左边最长pattern</li>
<li><code>%</code>：去掉字符串右边最短pattern</li>
<li><code>%%</code>：去掉字符串右边最长pattern</li>
</ul>
<blockquote>
<ul>
<li>注意：<code>var_name</code>前不要变量标志<code>$</code></li>
<li>以上4种模式返回新值，不改变原变量值</li>
<li>仅在<code>pattern</code>中使用通配符时，最短、最长匹配才有区别</li>
</ul>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>解释</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$&#123;file#*/&#125;</code></td>
<td>去除首个<code>/</code>及其左边</td>
<td><code>dir2/dir3/file.txt.bak</code></td>
</tr>
<tr>
<td><code>$&#123;file##*/&#125;</code></td>
<td>仅保留最后<code>/</code>右边</td>
<td><code>file.txt.bak</code></td>
</tr>
<tr>
<td><code>$&#123;file#*.&#125;</code></td>
<td>去除首个<code>.</code>及其左边</td>
<td><code>txt.bak</code></td>
</tr>
<tr>
<td><code>$&#123;file##*.&#125;</code></td>
<td>仅保留最后<code>.</code>右边</td>
<td><code>bak</code></td>
</tr>
<tr>
<td><code>$&#123;file%/*&#125;</code></td>
<td>去除最后<code>/</code>及其右边</td>
<td><code>/dir1/dir2/dir3</code></td>
</tr>
<tr>
<td><code>$&#123;file%%*/&#125;</code></td>
<td>去除首个<code>/</code>及其右边</td>
<td>空值</td>
</tr>
<tr>
<td><code>$&#123;file%*.&#125;</code></td>
<td>去除最后<code>.</code>及其右边</td>
<td><code>/dir1/dir2/dir3/file.txt</code></td>
</tr>
<tr>
<td><code>$&#123;file%%*.&#125;</code></td>
<td>去除首个<code>.</code>及其右边</td>
<td><code>/dir1/dir2/dir3/file.txt</code></td>
</tr>
</tbody>
</table>
</div>
<h4 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h4><ul>
<li><code>/from/to</code>：替换首个<code>from</code>为<code>to</code></li>
<li><code>//from/to</code>：替换全部<code>from</code>为<code>to</code></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>解释</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$&#123;file/dir/path&#125;</code></td>
<td>替换首个<code>dir</code>为<code>path</code></td>
<td><code>/path1/dir2/dir3/file.txt.bak</code></td>
</tr>
<tr>
<td><code>$&#123;file/dir/path&#125;</code></td>
<td>替换全部<code>dir</code>为<code>path</code></td>
<td><code>/path1/path2/path3/file.txt.bak</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="默认值替换"><a href="#默认值替换" class="headerlink" title="默认值替换"></a>默认值替换</h3><ul>
<li><code>-</code>：变量<strong>未设置</strong>返回</li>
<li><code>+</code>：变量<strong>设置</strong>返回</li>
<li><code>=</code>：变量<strong>未设置</strong>返回、设置变量</li>
<li><code>?</code>：变量<strong>未设置</strong>输出至stderr</li>
<li><code>:</code>：以上命令条件包括<strong>空值</strong>（空值视为未设置）</li>
</ul>
<p><img src="/imgs/shell_variable_assignment.png" alt="shell_variable_assignment"></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>解释</th>
<th>示例</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$&#123;井&lt;var_name&gt;&#125;</code></td>
<td>获取字符串长度</td>
<td><code>$&#123;井file&#125;</code></td>
<td>27</td>
</tr>
<tr>
<td><code>$&#123;&lt;var_name&gt;-&lt;default&gt;&#125;</code></td>
<td>变量<strong>未设置</strong>返回默认值</td>
<td><code>$&#123;invalid-file.txt.bak&#125;</code></td>
<td><code>file.txt.bak</code></td>
</tr>
<tr>
<td><code>$&#123;&lt;var_name&gt;:-&lt;default&gt;&#125;</code></td>
<td>变量<strong>未设置、空值</strong>返回默认值</td>
<td><code>$&#123;null-file.txt.bak&#125;</code></td>
<td><code>file.txt.bak</code></td>
</tr>
<tr>
<td><code>$&#123;&lt;var_name&gt;+&lt;default&gt;&#125;</code></td>
<td>变量<strong>设置</strong>返回默认值</td>
<td><code>$&#123;file-file.txt.bak&#125;</code></td>
<td><code>fil.txt.bak</code></td>
</tr>
<tr>
<td><code>$&#123;&lt;var_name&gt;:+&lt;default&gt;&#125;</code></td>
<td>变量<strong>非空</strong>返回默认值</td>
<td><code>$&#123;file-file.txt.bak&#125;</code></td>
<td><code>file.txt.bak</code></td>
</tr>
<tr>
<td><code>$&#123;&lt;var_name&gt;=&lt;default&gt;&#125;</code></td>
<td>变量<strong>未设置</strong>，返回默认值、并设置变量为默认值</td>
<td><code>$&#123;invalid=file.txt.bak&#125;</code></td>
<td><code>file.txt.bak</code></td>
</tr>
<tr>
<td><code>$&#123;&lt;var_name&gt;:=&lt;default&gt;&#125;</code></td>
<td>变量<strong>未设置、空值</strong>返回默认值、并设置变量为默认值</td>
<td><code>$&#123;null=file.txt.bak&#125;</code></td>
<td><code>file.txt.bak</code></td>
</tr>
<tr>
<td><code>&#123;$&lt;var_name&gt;?&lt;default&gt;&#125;</code></td>
<td>变量<strong>未设置</strong>输出默认值至stderr</td>
<td><code>&#123;invalid?file.txt.bak&#125;</code></td>
<td><code>file.txt.bak</code>输出至stderr</td>
</tr>
<tr>
<td><code>&#123;$&lt;var_name&gt;:?&lt;default&gt;&#125;</code></td>
<td>变量<strong>未设置、空值</strong>输出默认值至stderr</td>
<td><code>&#123;$null:?file.txt.bak&#125;</code></td>
<td><code>file.txt.bak</code>输出至stderr</td>
</tr>
</tbody>
</table>
</div>
<h3 id="字符串比较"><a href="#字符串比较" class="headerlink" title="字符串比较"></a>字符串比较</h3><ul>
<li><p><code>=, !=, -z, -n</code>：字符串相等、不相等、为空、非空</p>
</li>
<li><p>使用<code>=</code>比较变量是否为某字符串时，其中在<strong>两侧添加字符</strong>
保证<code>=</code>不为空值，否则若<code>$test</code>为空值，表达式报错</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if [[ &quot;$text&quot;x = &quot;text&quot;x ]]; then</span><br><span class="line">	command</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<ul>
<li>比较变量时要在两侧加上双引号<code>&quot;&quot;</code>，否则可能报错、结果不
  符合预期</li>
</ul>
</blockquote>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> A=(a b c def)</span></span><br></pre></td></tr></table></figure>
<h3 id="取值"><a href="#取值" class="headerlink" title="取值"></a>取值</h3><ul>
<li><code>[]</code>：选择数组元素<ul>
<li><code>[n]</code>：返回数组第n个元素</li>
<li><code>[*]</code>/<code>[@]</code>：返回数组全部元素</li>
</ul>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>解释</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$&#123;A[@]&#125;</code></td>
<td>返回全部元素</td>
<td><code>a b c def</code></td>
</tr>
<tr>
<td><code>$&#123;A[*]&#125;</code></td>
<td>同上</td>
<td>同上</td>
</tr>
<tr>
<td><code>$&#123;A[0]&#125;</code></td>
<td>返回数组第一个元素</td>
<td><code>a</code></td>
</tr>
<tr>
<td><code>$&#123;井A[@]&#125;</code></td>
<td>返回数组元素总数</td>
<td>4</td>
</tr>
<tr>
<td><code>$&#123;井A[*]&#125;</code></td>
<td>同上</td>
<td>同上</td>
</tr>
<tr>
<td><code>$&#123;井A[3]&#125;</code></td>
<td>返回数组第4个元素长度</td>
<td>3</td>
</tr>
<tr>
<td><code>A[3]=xyz</code></td>
<td>设置数组第4个元素值</td>
</tr>
</tbody>
</table>
</div>
<h2 id="数值"><a href="#数值" class="headerlink" title="数值"></a>数值</h2><ul>
<li><code>(())</code>/<code>[]</code>：在其中执行整数运算</li>
<li><code>let</code>：执行数值运算</li>
</ul>
<h3 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h3><ul>
<li><p>返回的数据结果相当于存储在一个匿名变量中，使用的话需要
在之前加上<code>$</code></p>
</li>
<li><script type="math/tex; mode=display">(())`/`$[]`中的变量名称可以省略`</script><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> a=5; b=7; c=2;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> $((a + b * <span class="variable">$c</span>))</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 19</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>$((N#xx))</code>/<code>$[$#xx]</code>：将其他进制数据转换为10进制</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> $((<span class="number">2#110</span>))</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 6</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>自增、自减运算可以在<code>(())</code>/<code>[]</code>中直接执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> a=5; ((a++)); <span class="built_in">echo</span> <span class="variable">$a</span>;</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 6</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="特殊运算符"><a href="#特殊运算符" class="headerlink" title="特殊运算符"></a>特殊运算符</h3><ul>
<li><code>~</code>：位与</li>
<li><code>|</code>：位或</li>
<li><code>^</code>：位异或</li>
<li><code>&gt;&gt;</code>：位右移</li>
<li><code>&lt;&lt;</code>：位左移</li>
<li><code>**</code>：数值平方</li>
<li><code>+=, ++, -=, --, *=, \=</code>：自变化运算符</li>
</ul>
<h3 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h3><ul>
<li><code>-eq, -ne, -ge, -le, -lt, -gt</code>：比较</li>
<li><code>==, !=, &gt;=, &lt;=, &lt;, &gt;</code>：数值比较</li>
</ul>
<h2 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h2><ul>
<li><code>-e</code>：目标存在</li>
<li><code>-f</code>：文件为一般文件（非目录、设备）</li>
<li><code>-s</code>：文件大小非0</li>
<li><code>-d</code>：目标为目录</li>
<li><code>-b</code>：文件为块设备（软盘、光驱）</li>
<li><code>-c</code>：文件为流设备（键盘、modem、声卡）</li>
<li><code>-p</code>：文件为管道</li>
<li><code>-h</code>/<code>L</code>：目标为符号链接</li>
<li><code>-S</code>：目标为Socket</li>
<li><code>-t</code>：文件描述符被关联到终端<ul>
<li>一般用于检测脚本的stdin是否来自终端<code>[ -t 0 ]</code>，或
输出是否输出至终端<code>[ -t 1 ]</code></li>
</ul>
</li>
<li><code>-r</code>：目标是否可读权限</li>
<li><code>-w</code>：目标是否可写权限</li>
<li><code>-x</code>：目标是否可执行权限</li>
<li><code>-g</code>：目标是否设置有set-group-id</li>
<li><code>-u</code>：目标是否设置有set-user-id</li>
<li><code>-k</code>：目标是否设置sticky bit</li>
<li><code>-O</code>：用户是否是文件所有者</li>
<li><code>-G</code>：用户是否属于文件所有组</li>
<li><code>-N</code>：文件从上次读取到现在为止是否被修改</li>
<li><code>f1 -nt f2</code>：文件<code>f1</code>比<code>f2</code>新</li>
<li><code>f1 -ot f2</code>：文件<code>f1</code>比<code>f2</code>旧</li>
<li><code>f1 -ef f2</code>：文件<code>f1</code>、<code>f2</code>指向相似文件实体（相同的硬链接）</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-07-31T17:38:59.000Z" title="8/1/2019, 1:38:59 AM">2019-08-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-07-31T17:38:59.000Z" title="8/1/2019, 1:38:59 AM">2019-08-01</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/Py3Ref/">Py3Ref</a></span><span class="level-item">22 minutes read (About 3283 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/Py3Ref/lexical_analysis.html">Lexical Analysis</a></h1><div class="content"><ul>
<li>python将读取的程序问题转换为Unicode码点<ul>
<li>源文件的文本编码可由编码声明指定</li>
<li>默认<em>UTF-8</em></li>
</ul>
</li>
<li>词法分析器将文件拆分为token</li>
<li>解释器以词法分析器生成的token流作为输入</li>
</ul>
<h2 id="行结构"><a href="#行结构" class="headerlink" title="行结构"></a>行结构</h2><h3 id="逻辑行"><a href="#逻辑行" class="headerlink" title="逻辑行"></a>逻辑行</h3><p>逻辑行：逻辑行的结束以<code>NEWLINE</code> token表示</p>
<ul>
<li>语句不能跨越逻辑行边集，除非其语法允许包含<code>NEWLINE</code>
（如复合语句包含多个子语句）</li>
<li>逻辑行可由一个、多个物理行按照明确、隐含行拼接规则
构成</li>
</ul>
<blockquote>
<p>python程序可以分为很多逻辑行</p>
</blockquote>
<h3 id="物理行"><a href="#物理行" class="headerlink" title="物理行"></a>物理行</h3><p>物理行：以行终止序列结束的字符序列</p>
<ul>
<li>源文件、字符串中可以使用任何标准平台上行终止序列<ul>
<li>Unix：<code>\n</code>换行符<code>LF</code></li>
<li>Win：<code>\r\n</code>回车加换行<code>CR LF</code></li>
<li>Macintosh：<code>\r</code>回车<code>CR</code></li>
</ul>
</li>
<li>输入结束会被作为最后物理行的隐含终止标志</li>
</ul>
<blockquote>
<ul>
<li>嵌入Python源码字符串应使用标准C传统换行符<code>\n</code></li>
</ul>
</blockquote>
<h4 id="显式行拼接"><a href="#显式行拼接" class="headerlink" title="显式行拼接"></a>显式行拼接</h4><p>显式行拼接：两个、多个物理行使用<code>\</code>拼接为一个逻辑行</p>
<ul>
<li>物理行以<strong>不在字符串、注释内</strong>的反斜杠结尾时，将与下行
拼接构成一个单独逻辑行<ul>
<li>反斜杠、其后换行符将被删除</li>
</ul>
</li>
<li>以反斜杠结束的行不能带有注释</li>
<li>反斜杠不能用于<ul>
<li>拼接注释</li>
<li>拼接字符串外token</li>
</ul>
</li>
<li>不允许原文字符串以外反斜杠存在于物理行其他位置</li>
</ul>
<h4 id="隐式行拼接"><a href="#隐式行拼接" class="headerlink" title="隐式行拼接"></a>隐式行拼接</h4><p>隐式行拼接</p>
<ul>
<li><p>圆括号、方括号、花括号内表达式允许被分为多个物理行，无需
使用反斜杠</p>
<ul>
<li>拼接行可以带有注释</li>
<li>后续行缩进不影响程序结构、允许为空白行</li>
<li>拼接行之间不会有<code>NEWLINE</code> token</li>
</ul>
</li>
<li><p>三引号<code>&quot;&quot;&quot;</code>/<code>&#39;&#39;&#39;</code>字符串允许被分为多个物理行</p>
<ul>
<li>拼接行中不允许带有注释</li>
</ul>
</li>
</ul>
<h4 id="空白行"><a href="#空白行" class="headerlink" title="空白行"></a>空白行</h4><p>空白行：只包含空格符、制表符、进纸符、注释的逻辑行会被忽略，
不生成<code>NEWLINE</code> token</p>
<ul>
<li><p>交互式输入语句时，对空白行处理可能因为读取-求值-打印循环
的<strong>具体实现</strong>而存在差异</p>
<ul>
<li>标准交互模式解释器中：完全空白逻辑行将会结束一条多行
复合语句</li>
</ul>
</li>
</ul>
<h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><p>注释：一不包含在字符串内的<code>#</code>开头，在物理行末尾结束</p>
<ul>
<li>注释标志逻辑行的结束，除非存在隐含行拼接规则</li>
<li>注释在语法分析中被忽略，不属于token</li>
</ul>
<h3 id="编码声明"><a href="#编码声明" class="headerlink" title="编码声明"></a>编码声明</h3><p>编码声明：位于python脚本第一、第二行，匹配正则表达式
<code>coding[=:]\s*([-\w.]+)</code>的注释将被作为编码声明处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: &lt;encoding-name&gt; -*-</span></span><br></pre></td></tr></table></figure>
<ul>
<li>表达式第一组指定了源码文件编码<ul>
<li>编码声明指定编码名称必须是python所认可的编码</li>
<li>词法分析将使用此编码：语义字符串、注释、标识符</li>
</ul>
</li>
<li>编码声明须独占一行，若在第二行，则第一行也必须为注释</li>
<li>没有编码声明，默认编码为<em>UTF-8</em><ul>
<li>若文件首字节为<em>UTF-8</em>字节顺序标志<code>b\xef\xbb\xbf</code>，
文件编码也声明为<em>UTF-8</em></li>
</ul>
</li>
</ul>
<h3 id="缩进"><a href="#缩进" class="headerlink" title="缩进"></a>缩进</h3><p>缩进：<strong>逻辑行开头</strong>的空白（空格符、制表符）被用于计算该行
的缩进等级，决定语句段落组织结构</p>
<ul>
<li>首个非空白字符之前的空格总数确定该行的缩进层次<ul>
<li>缩进不能使用反斜杠进行拼接，首个反斜杠之前空格将确定
缩进层次</li>
</ul>
</li>
<li>制表符被替换为1-8个空白，使得缩进的空格总数为8倍数<ul>
<li>源文件若混合使用制表符、空格符缩进，并使得确定缩进
层次需要依赖于制表符对应空格数量设置，将引发
<code>TabError</code></li>
<li>由于非Unix平台上文本编辑器本身特性，源文件中混合使用
制表符、空格符是不明智的</li>
</ul>
</li>
<li>进纸符<ul>
<li>在行首时：在缩进层级计算中被忽略</li>
<li>行首空格内其他位置：效果未定义，可能导致空格计数重置
为0</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>不同平台可能会显式限制最大缩进层级</li>
</ul>
</blockquote>
<h4 id="INDENT-DEDENT-token"><a href="#INDENT-DEDENT-token" class="headerlink" title="INDENT/DEDENT token"></a><code>INDENT</code>/<code>DEDENT</code> token</h4><ul>
<li>读取文件第一行前，向堆栈中压入零值，不再弹出</li>
<li>被压入栈的层级数值从底至顶持续增加</li>
<li>每个逻辑行开头的行缩进层级将和栈顶进行比较<ul>
<li>相同：不做处理</li>
<li>新行层级较高：压入栈中，生成<code>INDENT</code> token</li>
<li>新行层级较低：应为栈中层级数值之一<ul>
<li>栈中高于该层级所有数值被弹出</li>
<li>每弹出一级数值生成一个<code>DEDENT</code> token</li>
</ul>
</li>
</ul>
</li>
<li>文件末尾，栈中剩余每个大于0数值生成一个<code>DEDENT</code> token</li>
</ul>
<h2 id="Tokens"><a href="#Tokens" class="headerlink" title="Tokens"></a>Tokens</h2><p>型符</p>
<ul>
<li>空白字符不属于token<ul>
<li>除逻辑行开头、字符串内，空格符、制表符、进纸符等
空白符均可分隔token</li>
<li>否则彼此相连的token会被解析为一个不同的token</li>
</ul>
</li>
<li>若存在二义性，将从左至右尽可能长读取合法字符串组成token</li>
</ul>
<h3 id="Indentifiers"><a href="#Indentifiers" class="headerlink" title="Indentifiers"></a>Indentifiers</h3><p>标识符/名称：python标识符语法基于Unicode标准附件UAX-31，有
修改</p>
<ul>
<li><p>ASCII字符集内可用于标识符与py2一致</p>
<ul>
<li>大、小写字母</li>
<li>下划线<code>_</code></li>
<li>数字<code>0-9</code></li>
</ul>
</li>
<li><p>py3中引入ASCII字符集以外的额外字符</p>
<ul>
<li>其分类使用包含于<code>unicodedata</code>模块中Unicode字符数据库
版本</li>
</ul>
</li>
<li><p>标识符没有长度限制、大小写敏感</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">identifier   ::=  xid_start xid_continue*</span><br><span class="line">id_start     ::=  &lt;all characters in general categories Lu, Ll, Lt, Lm, Lo, Nl, the underscore, and characters with the Other_ID_Start property&gt;</span><br><span class="line">id_continue  ::=  &lt;all characters in id_start, plus characters in the categories Mn, Mc, Nd, Pc and others with the Other_ID_Continue property&gt;</span><br><span class="line">xid_start    ::=  &lt;all characters in id_start whose NFKC normalization is in &quot;id_start xid_continue*&quot;&gt;</span><br><span class="line">xid_continue ::=  &lt;all characters in id_continue whose NFKC normalization is in &quot;id_continue*&quot;&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><code>Lu</code>：大写字母</li>
<li><code>Ll</code>：小写字母</li>
<li><code>Lt</code>：词首大写字母</li>
<li><code>Lm</code>：修饰字母</li>
<li><code>Lo</code>：其他字母</li>
<li><code>Nl</code>：字母数字</li>
<li><code>Mn</code>：非空白标识</li>
<li><code>Mc</code>：含空白标识</li>
<li><code>Nd</code>：十进制数字</li>
<li><code>Pc</code>：连接标点</li>
<li><code>Other_ID_Start</code>：由<code>PropList.txt</code>定义的显式字符列表，
  用来支持向后兼容</li>
<li><code>Other_ID_Continue</code>：同上</li>
</ul>
</blockquote>
<h4 id="Keywords"><a href="#Keywords" class="headerlink" title="Keywords"></a>Keywords</h4><p>关键字：以下标识符作为语言的保留字、关键字，不能用作普通
标识符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">False      await      else       import     pass</span><br><span class="line">None       break      except     in         raise</span><br><span class="line">True       class      finally    is         return</span><br><span class="line">and        continue   for        lambda     try</span><br><span class="line">as         def        from       nonlocal   while</span><br><span class="line">assert     del        global     not        with</span><br><span class="line">async      elif       if         or         yield</span><br></pre></td></tr></table></figure>
<h4 id="保留标识符类"><a href="#保留标识符类" class="headerlink" title="保留标识符类"></a>保留标识符类</h4><p>以下划线字符开头、结尾的标识符类：具有特殊函数</p>
<ul>
<li><p><code>_*</code>：不会被<code>from module import *</code>导入</p>
<ul>
<li>特殊标识符<code>_</code>：交互式解释器中用于存放最近一次求值
结果，不处于交互模式时无特殊含义、无预定义</li>
</ul>
</li>
<li><p><code>__*__</code>：系统定义名称</p>
<ul>
<li>由解释器极其实现（包括标准库）定义</li>
<li>任何不遵循文档指定方式使用<code>__*__</code>行为可能导致无警告
出错</li>
</ul>
</li>
<li><p><code>__*</code>：类私有名称</p>
<ul>
<li>在类定义中使用</li>
<li>会以<strong>混合形式</strong>重写避免基类、派生类私有属性之间出现
名称冲突</li>
</ul>
</li>
</ul>
<h3 id="字面值"><a href="#字面值" class="headerlink" title="字面值"></a>字面值</h3><p>字面值：表示一些内置类型常量</p>
<h4 id="字符串、字节串字面值"><a href="#字符串、字节串字面值" class="headerlink" title="字符串、字节串字面值"></a>字符串、字节串字面值</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">stringliteral   ::=  [stringprefix](shortstring | longstring)</span><br><span class="line">stringprefix    ::=  &quot;r&quot; | &quot;u&quot; | &quot;R&quot; | &quot;U&quot; | &quot;f&quot; | &quot;F&quot;</span><br><span class="line">                     | &quot;fr&quot; | &quot;Fr&quot; | &quot;fR&quot; | &quot;FR&quot; | &quot;rf&quot; | &quot;rF&quot; | &quot;Rf&quot; | &quot;RF&quot;</span><br><span class="line">shortstring     ::=  &quot;&#x27;&quot; shortstringitem* &quot;&#x27;&quot; | &#x27;&quot;&#x27; shortstringitem* &#x27;&quot;&#x27;</span><br><span class="line">longstring      ::=  &quot;&#x27;&#x27;&#x27;&quot; longstringitem* &quot;&#x27;&#x27;&#x27;&quot; | &#x27;&quot;&quot;&quot;&#x27; longstringitem* &#x27;&quot;&quot;&quot;&#x27;</span><br><span class="line">shortstringitem ::=  shortstringchar | stringescapeseq</span><br><span class="line">longstringitem  ::=  longstringchar | stringescapeseq</span><br><span class="line">shortstringchar ::=  &lt;any source character except &quot;\&quot; or newline or the quote&gt;</span><br><span class="line">longstringchar  ::=  &lt;any source character except &quot;\&quot;&gt;</span><br><span class="line">stringescapeseq ::=  &quot;\&quot; &lt;any source character&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bytesliteral   ::=  bytesprefix(shortbytes | longbytes)</span><br><span class="line">bytesprefix    ::=  &quot;b&quot; | &quot;B&quot; | &quot;br&quot; | &quot;Br&quot; | &quot;bR&quot; | &quot;BR&quot; | &quot;rb&quot; | &quot;rB&quot; | &quot;Rb&quot; | &quot;RB&quot;</span><br><span class="line">shortbytes     ::=  &quot;&#x27;&quot; shortbytesitem* &quot;&#x27;&quot; | &#x27;&quot;&#x27; shortbytesitem* &#x27;&quot;&#x27;</span><br><span class="line">longbytes      ::=  &quot;&#x27;&#x27;&#x27;&quot; longbytesitem* &quot;&#x27;&#x27;&#x27;&quot; | &#x27;&quot;&quot;&quot;&#x27; longbytesitem* &#x27;&quot;&quot;&quot;&#x27;</span><br><span class="line">shortbytesitem ::=  shortbyteschar | bytesescapeseq</span><br><span class="line">longbytesitem  ::=  longbyteschar | bytesescapeseq</span><br><span class="line">shortbyteschar ::=  &lt;any ASCII character except &quot;\&quot; or newline or the quote&gt;</span><br><span class="line">longbyteschar  ::=  &lt;any ASCII character except &quot;\&quot;&gt;</span><br><span class="line">bytesescapeseq ::=  &quot;\&quot; &lt;any ASCII character&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><code>stringprefix</code>、<code>bytesprefix</code>与字面值剩余部分之间不允许
  由空白符</li>
<li>源字符集由编码声明定义</li>
<li>字节串字面值只允许ASCII字符（但允许存储不大于256）</li>
</ul>
</blockquote>
<ul>
<li><p>两种字面值都可以使用成对（连续三个）单引号、双引号标示
首尾</p>
<ul>
<li>单引号<code>&#39;&#39;</code>：允许包含双引号<code>&quot;&quot;</code></li>
<li>双引号<code>&quot;&quot;</code>：允许包含单引号<code>&#39;&#39;</code></li>
<li>三重引号<code>&#39;&#39;&#39;</code>、<code>&quot;&quot;&quot;</code><ul>
<li>原样保留：未经转义的换行、（非三联）引号、空白符</li>
</ul>
</li>
</ul>
</li>
<li><p>反斜杠<code>\</code>用于对特殊含义字符进行转义</p>
</li>
</ul>
<h5 id="字符串前缀"><a href="#字符串前缀" class="headerlink" title="字符串前缀"></a>字符串前缀</h5><ul>
<li><p><code>b</code>/<code>B</code>前缀：字节串字面值</p>
<ul>
<li>创建<code>bytes</code>类型而非<code>str</code>类型实例</li>
<li>只能包含ASCII字符</li>
<li>字节对应数值大于128必须以转义形式表示</li>
</ul>
</li>
<li><p><code>r</code>/<code>R</code>：原始字符串/字节串</p>
<ul>
<li>其中反斜杠<code>\</code>被当作其本身字面字符处理</li>
<li>转换序列不在有效</li>
<li>原始字面值不能以单个<code>\</code>结束，会转义之后引号字符</li>
</ul>
</li>
<li><p><code>f</code>/<code>F</code>：格式化字符串字面值</p>
</li>
</ul>
<h5 id="转义规则"><a href="#转义规则" class="headerlink" title="转义规则"></a>转义规则</h5><ul>
<li><p>字符串、字节串字面值中转义序列基本类似标准C转义规则</p>
<ul>
<li><code>\xhh</code>：必须接受2个16进制数码</li>
</ul>
</li>
<li><p>以下转义序列仅在字符串字面值中可用</p>
<ul>
<li><code>\N&#123;name&#125;</code>：Unicode数据库中名称为name的字符</li>
<li><code>\uxxxx</code>：必须接受4个16进制数码</li>
<li><code>\Uxxxxxxxx</code>：必须接受8个16进制数码</li>
</ul>
</li>
<li><p>无法识别的转义序列</p>
<ul>
<li>py3.6之前将原样保留在字符串中</li>
<li>py3.6开始，将引发<code>DeprecationWarning</code>，未来可能会
引发<code>SyntaxError</code></li>
</ul>
</li>
</ul>
<h5 id="字符串字面值拼接"><a href="#字符串字面值拼接" class="headerlink" title="字符串字面值拼接"></a>字符串字面值拼接</h5><ul>
<li><p>多个相邻字符串、字符串字面值（空白符分隔），含义等同于
全部拼接为一体</p>
<ul>
<li>所用引号可以彼此不同（三引号风格也可用）</li>
<li>每部分字符串可以分别加注释</li>
<li>可以包括格式化字符串字面值</li>
</ul>
</li>
<li><p>此特性是在<strong>句法层面定义</strong>，在编译时实现</p>
<ul>
<li>在运行时拼接字符串表达式必须使用<code>+</code>运算符</li>
</ul>
</li>
</ul>
<h5 id="格式化字符串字面值"><a href="#格式化字符串字面值" class="headerlink" title="格式化字符串字面值"></a>格式化字符串字面值</h5><p>格式化字符串字面值：带有<code>f/F</code>前缀的字符串字面值</p>
<ul>
<li><p>包含可替换字段，即以<code>&#123;&#125;</code>标示的格式表达式</p>
<ul>
<li>字符串<code>&#123;&#125;</code>以外部分按字面值处理</li>
<li>双重花括号<code>&#123; &#123; &#125; &#125;</code>被替换为相应单个花括号</li>
</ul>
</li>
<li><p>格式表达式<strong>被当作正常的包含在圆括号中python表达式</strong>处理
，在运行时从左至右被求值</p>
<ul>
<li>不允许空表达式</li>
<li><code>lambda</code>空表达式必须显式加上圆括号</li>
<li>可以包含换行：如三引号字符串</li>
<li>不能包含注释</li>
<li>不能<code>\</code>反斜杠，考虑创建临时变量</li>
</ul>
</li>
<li><p>格式化字符串字面值可以拼接，但是一个替换字段不能拆分到
多个字面值中</p>
</li>
<li><p>格式化字符串不能用作文档字符串，即使其中没有包含表达式</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">f_string          ::=  (literal_char | &quot;&#123;&#123;&quot; | &quot;&#125;&#125;&quot; | replacement_field)*</span><br><span class="line">replacement_field ::=  &quot;&#123;&quot; f_expression [&quot;!&quot; conversion] [&quot;:&quot; format_spec] &quot;&#125;&quot;</span><br><span class="line">f_expression      ::=  (conditional_expression | &quot;*&quot; or_expr)</span><br><span class="line">                         (&quot;,&quot; conditional_expression | &quot;,&quot; &quot;*&quot; or_expr)* [&quot;,&quot;]</span><br><span class="line">                       | yield_expression</span><br><span class="line">conversion        ::=  &quot;s&quot; | &quot;r&quot; | &quot;a&quot;</span><br><span class="line">format_spec       ::=  (literal_char | NULL | replacement_field)*</span><br><span class="line">literal_char      ::=  &lt;any code point except &quot;&#123;&quot;, &quot;&#125;&quot; or NULL&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>!</code>：标识转换字段</p>
<ul>
<li><code>!s</code>：对结果调用<code>str()</code></li>
<li><code>!r</code>：调用<code>repr()</code></li>
<li><code>!a</code>：调用<code>ascii()</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&quot;Fred&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;he said his name is <span class="subst">&#123;name!r&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;he said his name is &#123;repr(name)&#125;&quot;</span>)</span><br><span class="line">	<span class="comment"># 二者等价</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>:</code>：标识格式说明符，结果使用<code>format()</code>协议格式化</p>
<ul>
<li>格式说明符被传入表达式或转换结果的<code>.__format__()</code>
方法</li>
<li>省略格式说明符则传入空字符串</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">width, precision = <span class="number">4</span>, <span class="number">10</span></span><br><span class="line">value = decimal.Deciaml(<span class="string">&quot;12.345&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;result: <span class="subst">&#123;value: &#123;width&#125;</span>.<span class="subst">&#123;precision&#125;</span>&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">today = datetime(yeat=<span class="number">2017</span>, month=<span class="number">1</span>, day=<span class="number">27</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;today: %B %d, %Y&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">number = <span class="number">1024</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;number: #0x&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>顶层格式说明符可以包含嵌套替换字段</p>
<ul>
<li>嵌套字段可以包含有自身的转换字段、格式说明符，但不能
包含更深层嵌套替换字段</li>
</ul>
</li>
</ul>
<h4 id="数字字面值"><a href="#数字字面值" class="headerlink" title="数字字面值"></a>数字字面值</h4><ul>
<li>数字字面值不包括正负号<ul>
<li>负数实际上是由单目运算符<code>-</code>和字面值组合而成</li>
</ul>
</li>
<li>没有专门复数字面值<ul>
<li>复数以一对浮点数表示</li>
<li>取值范围同浮点数</li>
</ul>
</li>
<li>数字字面值可以使用下划线<code>_</code>将数码分组提高可读性<ul>
<li>确定数字大小时，字面值之间的下滑线被忽略</li>
<li>下划线可以放在数码之间、基数说明符<code>0x</code>等之后</li>
<li>浮点数中不能直接放在<code>.</code>后</li>
</ul>
</li>
</ul>
<h5 id="整形数字字面值"><a href="#整形数字字面值" class="headerlink" title="整形数字字面值"></a>整形数字字面值</h5><ul>
<li>整形数字字面值没有长度限制，只受限于内存</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">integer      ::=  decinteger | bininteger | octinteger | hexinteger</span><br><span class="line">decinteger   ::=  nonzerodigit ([&quot;_&quot;] digit)* | &quot;0&quot;+ ([&quot;_&quot;] &quot;0&quot;)*</span><br><span class="line">bininteger   ::=  &quot;0&quot; (&quot;b&quot; | &quot;B&quot;) ([&quot;_&quot;] bindigit)+</span><br><span class="line">octinteger   ::=  &quot;0&quot; (&quot;o&quot; | &quot;O&quot;) ([&quot;_&quot;] octdigit)+</span><br><span class="line">hexinteger   ::=  &quot;0&quot; (&quot;x&quot; | &quot;X&quot;) ([&quot;_&quot;] hexdigit)+</span><br><span class="line">nonzerodigit ::=  &quot;1&quot;...&quot;9&quot;</span><br><span class="line">digit        ::=  &quot;0&quot;...&quot;9&quot;</span><br><span class="line">bindigit     ::=  &quot;0&quot; | &quot;1&quot;</span><br><span class="line">octdigit     ::=  &quot;0&quot;...&quot;7&quot;</span><br><span class="line">hexdigit     ::=  digit | &quot;a&quot;...&quot;f&quot; | &quot;A&quot;...&quot;F&quot;</span><br></pre></td></tr></table></figure>
<h5 id="浮点数字字面值"><a href="#浮点数字字面值" class="headerlink" title="浮点数字字面值"></a>浮点数字字面值</h5><ul>
<li>整形数部分、指数部分解析时总以10为计数</li>
<li>浮点数字面值允许范围依赖于具体实现</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">floatnumber   ::=  pointfloat | exponentfloat</span><br><span class="line">pointfloat    ::=  [digitpart] fraction | digitpart &quot;.&quot;</span><br><span class="line">exponentfloat ::=  (digitpart | pointfloat) exponent</span><br><span class="line">digitpart     ::=  digit ([&quot;_&quot;] digit)*</span><br><span class="line">fraction      ::=  &quot;.&quot; digitpart</span><br><span class="line">exponent      ::=  (&quot;e&quot; | &quot;E&quot;) [&quot;+&quot; | &quot;-&quot;] digitpart</span><br></pre></td></tr></table></figure>
<h5 id="虚数字面值"><a href="#虚数字面值" class="headerlink" title="虚数字面值"></a>虚数字面值</h5><ul>
<li>序数字面值将生成实部为<code>0.0</code>的复数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imagnumber ::=  (floatnumber | digitpart) (&quot;j&quot; | &quot;J&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+       -       *       **      /       //      %      @</span><br><span class="line">&lt;&lt;      &gt;&gt;      &amp;       |       ^       ~</span><br><span class="line">&lt;       &gt;       &lt;=      &gt;=      ==      !=</span><br></pre></td></tr></table></figure>
<h3 id="分隔符"><a href="#分隔符" class="headerlink" title="分隔符"></a>分隔符</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(       )       [       ]       &#123;       &#125;</span><br><span class="line">,       :       .       ;       @       =       -&gt;</span><br><span class="line">+=      -=      *=      /=      //=     %=      @=</span><br><span class="line">&amp;=      |=      ^=      &gt;&gt;=     &lt;&lt;=     **=</span><br></pre></td></tr></table></figure>
<ul>
<li>以上列表中后半部分为<strong>增强赋值操作符</strong><ul>
<li>在词法中作为分隔符，同时起运算作用</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;       &quot;       #       \</span><br></pre></td></tr></table></figure>
<ul>
<li>以上可打印ASCII字符<ul>
<li>作为其他token组成部分时有特殊意义</li>
<li>或对词法分析器有特殊意义</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$       ?</span><br></pre></td></tr></table></figure>
<ul>
<li>以上可打印ASCII字符不再Python词法中使用<ul>
<li>出现在字符串字面值、注释之外将<strong>无条件引发错误</strong></li>
</ul>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-07-31T17:37:27.000Z" title="8/1/2019, 1:37:27 AM">2019-08-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-07-31T17:37:27.000Z" title="8/1/2019, 1:37:27 AM">2019-08-01</time></span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Bash-Programming/">Bash Programming</a></span><span class="level-item">12 minutes read (About 1755 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Linux/Bash-Programming/flow_control.html">Shell执行控制</a></h1><div class="content"><h2 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h2><h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><ul>
<li><p><code>;</code>：连续执行指令，分割多条命令</p>
<ul>
<li>所以如果不是在一行内执行，<code>;</code>是可以有任意多个</li>
</ul>
</li>
<li><p><code>:</code>：内建空指令，返回值为0</p>
</li>
<li><p><code>&amp;&amp;, ||</code>：逻辑与、或，全部（任意）之前的命令执行成功才会
执行下连接中的命令</p>
</li>
</ul>
<h3 id="“转义”"><a href="#“转义”" class="headerlink" title="“转义”"></a>“转义”</h3><ul>
<li><p><code>\\</code>：转义字符</p>
<ul>
<li>放在指令前，取消<code>alias</code></li>
<li>特殊符号前转义，Shell将不对其后字符作特殊处理，当作
普通字符（即<code>$, \&#39;, \&quot;</code>）</li>
<li>行尾表示连接下一行，回车符只起换行作用，视为空格</li>
</ul>
</li>
<li><p><code>$</code>：变量符号，表示其后字符串为一个变量</p>
</li>
<li><p><code>\&#39;, \&quot;</code>：内部视为字符串</p>
</li>
<li><p><code>--</code>：命令行中转义<code>-</code>，否则shell认为<code>-</code>是参数选项</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rm -- -file</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 删除文件`-file`</span></span><br></pre></td></tr></table></figure>
<ul>
<li>还可以在之前加上路径避免<code>-</code>被解释为参数选项</li>
<li><code>\</code>、<code>&#39;&#39;</code>等均无效</li>
</ul>
</li>
</ul>
<h3 id="引号"><a href="#引号" class="headerlink" title="引号"></a>引号</h3><h4 id="单引号-39-39"><a href="#单引号-39-39" class="headerlink" title="单引号&#39;&#39;"></a>单引号<code>&#39;&#39;</code></h4><ul>
<li><p>单引号括起字符都作为普通字符，变量无效</p>
</li>
<li><p>单引号字串中不能出现单独的单引号，使用转义符也不行，但是
可以成对出现，作为字符串拼接使用</p>
</li>
</ul>
<h4 id="双引号-quot-quot"><a href="#双引号-quot-quot" class="headerlink" title="双引号&quot;&quot;"></a>双引号<code>&quot;&quot;</code></h4><ul>
<li>双引号字串中可以有变量、转义字符</li>
</ul>
<h4 id="反引号"><a href="#反引号" class="headerlink" title="反引号``"></a>反引号<code>``</code></h4><p>反引号扩起字符串表示<em>Shell解释命令</em>，执行时shell首先解释其，
以标准输出替代整个反引号</p>
<ul>
<li><p>括号中语句为命令，分号连接</p>
<ul>
<li><code>``</code>中的表达式只需要符合C语言的运算规则
即可，甚至可以使用三目预算符、逻辑表达式</li>
</ul>
</li>
<li><p>命令和括号之间无空格</p>
</li>
<li><p><code>$``</code>可以将命令输出作为变量返回值，同<code>$()</code></p>
</li>
</ul>
<h3 id="括号"><a href="#括号" class="headerlink" title="括号"></a>括号</h3><h4 id=""><a href="#" class="headerlink" title="()"></a><code>()</code></h4><ul>
<li><p>命令组/运算表达式：其中的命令列表将在<strong>新子shell运行</strong></p>
<ul>
<li>其中变量之后不能使用，不影响当前shell环境</li>
<li>多个命令之间分号分隔，最后命令可以省略</li>
<li>命令和括号之间可以无空格</li>
</ul>
</li>
<li><p>命令替换：等同于引号<code>``</code></p>
<ul>
<li>bash扫描命令行，执行<code>$()</code>结构中命令，将标准输出作为
匿名变量值</li>
<li><code>()</code>中出现<code>()</code>不需要转义，<code>``</code>需要转义</li>
<li><code>()</code>中不能使用C风格的运算表达式</li>
</ul>
<blockquote>
<ul>
<li>部分shell可能不支持<code>()</code>，如：tcsh</li>
</ul>
</blockquote>
</li>
<li><p>初始化数组：参见<em>数组</em></p>
</li>
</ul>
<h4 id="-1"><a href="#-1" class="headerlink" title="(())"></a><code>(())</code></h4><ul>
<li><p>整数扩展：计算、扩展算数表达式结果</p>
<ul>
<li>表达式结果为0则退出状态为1、false</li>
<li>表达式结果为1则退出状态为0、true</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=5;((a++))			# 自增运算符</span><br><span class="line">b=$((16#5f))		# 进制转换</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>退出状态和<code>[]</code>完全相反</li>
<li>其中可使用任何符合C语言的运算，包括三目运算符</li>
</ul>
</blockquote>
</li>
<li><p>算术比较：</p>
<ul>
<li>其中变量可以不使用<code>$</code>前缀、支持多个表达式逗号分隔</li>
<li>可直接使用C风格表达式，如：<code>for</code>、<code>while</code>循环语句中</li>
</ul>
</li>
</ul>
<pre><code><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for((i=0;i&lt;5;i++))</span><br><span class="line">for i in `seq 0 4`</span><br><span class="line">for i iin &#123;0..4&#125;</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 三者等价</span></span><br><span class="line">if ((i&lt;5))</span><br><span class="line">if [ $i -lt 5 ]</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 二者等价</span></span><br></pre></td></tr></table></figure>
</code></pre><h4 id="、"><a href="#、" class="headerlink" title="[]、[[]]"></a><code>[]</code>、<code>[[]]</code></h4><ul>
<li><p><code>[]</code></p>
<ul>
<li>条件测试表达式：参见<code>if</code></li>
<li>数组索引</li>
<li>正则表达式范围</li>
</ul>
</li>
<li><p><code>[[]]</code></p>
<ul>
<li>条件测试表达式：参见<em><code>if</code></em></li>
</ul>
</li>
</ul>
<h4 id="-2"><a href="#-2" class="headerlink" title="{}"></a><code>&#123;&#125;</code></h4><ul>
<li><p>创建匿名函数</p>
<ul>
<li>不开启新进程</li>
<li>括号内变量之后可继续使用</li>
<li>括号内命令分号分隔，最后一个语句也要有分号</li>
<li><code>&#123;</code>和第一个语句之间要有空格</li>
</ul>
</li>
<li><p>字符串</p>
<ul>
<li>默认值替换：参见<em>字符串默认值替换</em></li>
<li>获取子串：参见<em>字符串子串</em></li>
<li>获取切片：参见<em>字符串子串</em></li>
<li>字符串替换：参见<em>字符串子串</em></li>
</ul>
</li>
<li><p><code>$</code>后包括变量名精确分隔变量名，参见<em>变量使用</em></p>
</li>
</ul>
<h3 id="其他符号"><a href="#其他符号" class="headerlink" title="其他符号"></a>其他符号</h3><h4 id="-3"><a href="#-3" class="headerlink" title="!"></a><code>!</code></h4><p>Shell中<code>!</code>称为事件提示符，可以方便的<strong>引用历史命令</strong>：当<code>!</code>
后跟随字母不是空格、换行、回车、<code>=</code>、<code>(</code>时，做命令替换</p>
<ul>
<li><p><code>![-]n</code>：引用history中的正数/倒数第n个命令</p>
<ul>
<li><code>!!</code>：等同<code>!-1</code>，执行上条命令</li>
</ul>
</li>
<li><p><code>!cmd</code>：引用最近以<code>cmd</code><strong>开头</strong>的命令，包括参数</p>
<ul>
<li><code>!cmd:gs/pattern/replace</code>：将上条<code>cmd</code>开头命令中
<code>pattern</code>替换为<code>replace</code></li>
</ul>
</li>
<li><p><code>!?str[?]</code>：引用最近<strong>包含</strong><code>str</code>的命令，<code>str</code>可以是参数</p>
</li>
<li><p>参数引用</p>
<ul>
<li><code>!$</code>：最后一个参数</li>
<li><code>!:-</code>：除最后一个参数</li>
<li><code>!*</code>：所有参数</li>
</ul>
</li>
</ul>
<h2 id="控制语句"><a href="#控制语句" class="headerlink" title="控制语句"></a>控制语句</h2><h3 id="if、"><a href="#if、" class="headerlink" title="if、[]"></a><code>if</code>、<code>[]</code></h3><p>用于条件控制结构，结构如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if test_expression; then</span><br><span class="line">	then command_1</span><br><span class="line">	else command_2</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>test &lt;expr&gt;</code>：bash内部命令，判断表达式是否为真</p>
<ul>
<li>其后只能有一个表达式判断，无法使用逻辑与、或连接</li>
</ul>
</li>
<li><p><code>[ &lt;expr&gt; ]</code>：基本等同于<code>test</code></p>
<ul>
<li>整数比较：<code>-ne</code>、<code>-eq</code>、<code>-gt</code>、<code>-lt</code></li>
<li>字符串比较：转义形式大、小号<code>\&lt;</code>、<code>/&gt;</code></li>
<li>逻辑表达式连接：<code>-o</code>（或）、<code>-a</code>（与）、<code>!</code>（非）
（不能使用<code>||</code>（或）、<code>&amp;&amp;</code>（与））</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if [ $? == 0 ]</span><br><span class="line">if test $? == 0</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 二者等价</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>注意内部<strong>两边要有空格</strong></li>
<li>事实上是<code>[</code>等同于<code>test</code>，<code>]</code>表示关闭条件判断，新版
 bash强制要求闭合</li>
</ul>
</blockquote>
</li>
<li><p><code>[[ &lt;expr&gt; ]]</code>条件测试</p>
<ul>
<li>整数比较：<code>!=</code>、<code>=</code>、<code>&lt;</code>、<code>&gt;</code></li>
<li>字符串：支持模式匹配（此时右侧模式时不能加引号）</li>
<li>逻辑表示式连接：<code>||</code>（或）、<code>&amp;&amp;</code>（与）、<code>!</code>（非）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if [[ $a != 0 &amp;&amp; $b == 1 ]]</span><br><span class="line">if [ $a -eq 0 ] &amp;&amp; [ $b -eq 1]</span><br><span class="line">if [ $a -eq 0 -a $b -eq 1]</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 三者等价</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><code>[[</code>：bash关键字，bash将其视为单独元素并返回退出
 状态码</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="case"><a href="#case" class="headerlink" title="case"></a><code>case</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">case chars in</span><br><span class="line">char_pattern_1)</span><br><span class="line"><span class="meta">	#</span><span class="bash"> `)`是必要的</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 匹配即停止，不会下沉</span></span><br><span class="line">	command_1</span><br><span class="line">;;</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 每个模式字符串可以有多条命令，最后一条必须以`;;`结尾</span></span><br><span class="line">char_pattern_2 | char_pattern_3)</span><br><span class="line"><span class="meta">	#</span><span class="bash"> `|`分隔，或，可以匹配其中一个模式即可</span></span><br><span class="line">	command_2</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 匹配所有字符串模式，捕获所有</span></span><br><span class="line">	command_3</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 返回值位最后执行命令的退出值，未执行命令则为0</span></span><br></pre></td></tr></table></figure>
<h3 id="while"><a href="#while" class="headerlink" title="while"></a><code>while</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">while test_expression</span><br><span class="line"><span class="meta">	#</span><span class="bash"> test_expression是指`<span class="built_in">test</span>`、`[]`语句</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 测试条件为真进入循环体</span></span><br><span class="line">do</span><br><span class="line">	command_1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h3 id="until"><a href="#until" class="headerlink" title="until"></a><code>until</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">until test_exprssion</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 测试条件为假进入循环体</span></span><br><span class="line">do</span><br><span class="line">	command_1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h3 id="for"><a href="#for" class="headerlink" title="for"></a><code>for</code></h3><h4 id="CStyle"><a href="#CStyle" class="headerlink" title="CStyle"></a>CStyle</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for ((i=0; i&lt;limit; i++))</span><br><span class="line"><span class="meta">	#</span><span class="bash"> C-style <span class="keyword">for</span></span></span><br><span class="line">do</span><br><span class="line">	command_1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="ListStyle"><a href="#ListStyle" class="headerlink" title="ListStyle"></a>ListStyle</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for var in var_arr</span><br><span class="line"><span class="meta">	#</span><span class="bash"> list-style <span class="keyword">for</span></span></span><br><span class="line">do</span><br><span class="line">	command</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h5 id="FileIterator"><a href="#FileIterator" class="headerlink" title="FileIterator"></a>FileIterator</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for var in /path/to/file_regex</span><br><span class="line"><span class="meta">	#</span><span class="bash"> `var`依次取（当前）目录下的与正则表达式匹配的文件名</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 执行循环体语句</span></span><br><span class="line">do</span><br><span class="line">	command</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<ul>
<li><code>/path/to/file_regex</code>注意<ul>
<li>路径不存在：<code>$var</code>为该字符串</li>
<li>不能用<code>&quot;&quot;</code>括起，否则：<code>$var</code>只取路径下所有匹配合并
，空格分隔</li>
</ul>
</li>
</ul>
<h5 id="ParamsIterator"><a href="#ParamsIterator" class="headerlink" title="ParamsIterator"></a>ParamsIterator</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for var[ in $*]</span><br><span class="line"><span class="meta">	#</span><span class="bash"> `var`依次取位置参数的值，执行循环体中命令</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> `[ <span class="keyword">in</span> $*]`可以省略</span></span><br><span class="line">do</span><br><span class="line">	command</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h5 id="RangeIterator"><a href="#RangeIterator" class="headerlink" title="RangeIterator"></a>RangeIterator</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">for i in $(seq start end)</span><br><span class="line">do</span><br><span class="line">	command</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">for i in &#123;start..end&#125;</span><br><span class="line">do</span><br><span class="line">	command</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h3 id="break-continue-exit"><a href="#break-continue-exit" class="headerlink" title="break, continue, exit"></a><code>break, continue, exit</code></h3><ul>
<li><code>break[n]</code>：跳出n层循环体，默认跳出一层循环体</li>
<li><code>continue[n]</code>：跳过n层循环体在其之后的语句，回到循环开头
，默认跳过一次循环体</li>
<li><code>exit</code>：退出程序，后跟返回值</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-07-09T16:48:33.000Z" title="7/10/2019, 12:48:33 AM">2019-07-10</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-07-09T16:48:33.000Z" title="7/10/2019, 12:48:33 AM">2019-07-10</time></span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a><span> / </span><a class="link-muted" href="/categories/Database/SQL-DB/">SQL DB</a></span><span class="level-item">6 minutes read (About 859 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Database/SQL-DB/sql_grammer.html">SQL语法</a></h1><div class="content"><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>			<span class="operator">&lt;</span>field<span class="operator">&gt;</span>, <span class="keyword">DISTINCT</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">INTO</span>			<span class="operator">&lt;</span>new_tbl<span class="operator">&gt;</span> [<span class="keyword">IN</span> <span class="operator">&lt;</span>other_db<span class="operator">&gt;</span>]</span><br><span class="line"><span class="keyword">FROM</span>			<span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">WHERE</span>			<span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>OP<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span><span class="operator">/</span><span class="operator">&lt;</span>field<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span>		<span class="operator">&lt;</span>field<span class="operator">&gt;</span> [<span class="keyword">ASC</span><span class="operator">/</span><span class="keyword">DESC</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>		<span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>[<span class="operator">&lt;</span>field<span class="operator">&gt;</span>]</span><br><span class="line"><span class="keyword">VALUES</span>			(<span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span>);</span><br><span class="line"></span><br><span class="line">UPDATE			<span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">SET</span>				<span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">=</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">WHERE</span>			<span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>OP<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span><span class="operator">/</span><span class="operator">&lt;</span>field<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">FROM</span>			<span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">WHERE</span>			<span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>OP<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span><span class="operator">/</span><span class="operator">&lt;</span>field<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="数据库、表、索引、视图"><a href="#数据库、表、索引、视图" class="headerlink" title="数据库、表、索引、视图"></a>数据库、表、索引、视图</h3><h4 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE <span class="operator">&lt;</span>db_name<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>(</span><br><span class="line">	<span class="operator">&lt;</span>field<span class="operator">&gt;</span>		<span class="operator">&lt;</span>dtype<span class="operator">&gt;</span>,</span><br><span class="line">	<span class="operator">&lt;</span>field<span class="operator">&gt;</span>		<span class="operator">&lt;</span>dtype<span class="operator">&gt;</span>		<span class="operator">&lt;</span>CSTRT<span class="operator">&gt;</span>,					<span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line">	<span class="operator">&lt;</span>CSTRT<span class="operator">&gt;</span>		(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,),								<span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line">	<span class="keyword">CONSTRAINT</span> [<span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>] <span class="operator">&lt;</span>cstrt<span class="operator">&gt;</span> (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)		<span class="operator">!</span><span class="comment">-- common</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX <span class="operator">&lt;</span>index_name<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ON</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span> (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>);</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 创建视图</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> <span class="operator">&lt;</span>view_name<span class="operator">&gt;</span> <span class="keyword">AS</span></span><br><span class="line"><span class="operator">&lt;</span>select_expr<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h5 id="自增字段"><a href="#自增字段" class="headerlink" title="自增字段"></a>自增字段</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">IDENTITY</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> AUTO_INCREMENT</span><br><span class="line"><span class="operator">!</span><span class="comment">-- ORACLE：创建自增序列，调用`.nextval`方法获取下个自增值</span></span><br><span class="line"><span class="keyword">CREATE</span> SEQUENCE <span class="operator">&lt;</span>seq<span class="operator">&gt;</span></span><br><span class="line">MINVALUE <span class="operator">&lt;</span>min<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">WITH</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span></span><br><span class="line">INCREMENT <span class="keyword">BY</span> <span class="operator">&lt;</span>step<span class="operator">&gt;</span></span><br><span class="line">CACHE <span class="operator">&lt;</span>cache<span class="operator">&gt;</span>				<span class="operator">!</span><span class="comment">-- 提高性能</span></span><br></pre></td></tr></table></figure>
<h4 id="丢弃"><a href="#丢弃" class="headerlink" title="丢弃"></a>丢弃</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 丢弃索引</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>.<span class="operator">&lt;</span>index_name<span class="operator">&gt;</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- ORACLE</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX <span class="operator">&lt;</span>index_name<span class="operator">&gt;</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX <span class="operator">&lt;</span>index_name<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 丢弃表/数据</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>;</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 丢弃数据库</span></span><br><span class="line"><span class="keyword">DROP</span> DATABASE <span class="operator">&lt;</span>db_name<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 丢弃视图</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> <span class="operator">&lt;</span><span class="keyword">view</span><span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 添加列</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 删除列</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 修改类型</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h3><h4 id="TOP"><a href="#TOP" class="headerlink" title="TOP"></a><em>TOP</em></h4><ul>
<li>MSSQL：<code>SELECT TOP &lt;num&gt;/&lt;num&gt; PERCENT *</code></li>
<li>MYSQL：<code>LIMIT &lt;num&gt;</code></li>
<li>ORACLE：<code>WHERE ROWNUM &lt;= &lt;num&gt;</code></li>
</ul>
<h4 id="Alias"><a href="#Alias" class="headerlink" title="Alias"></a><em>Alias</em></h4><ul>
<li><code>AS</code>：指定行、列别名</li>
</ul>
<h4 id="Join"><a href="#Join" class="headerlink" title="Join"></a><em>Join</em></h4><ul>
<li><code>[INNER] JOIN</code></li>
<li><code>LEFT JOIN</code></li>
<li><code>RIGHT JOIN</code></li>
<li><code>FULL JOIN</code></li>
</ul>
<h4 id="Union"><a href="#Union" class="headerlink" title="Union"></a><em>Union</em></h4><ul>
<li><code>UNION</code>：合并<code>SELECT</code>结果集<ul>
<li>要求结果集中列数量、类型必须相同</li>
</ul>
</li>
</ul>
<h4 id="NULL"><a href="#NULL" class="headerlink" title="NULL"></a><em>NULL</em></h4><ul>
<li><code>IS [NOT] NULL</code>：比较是否为<code>NULL</code>值</li>
</ul>
<blockquote>
<ul>
<li>比较符无法测试<code>NULL</code>值</li>
</ul>
</blockquote>
<h3 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h3><h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><ul>
<li><code>=</code>：有些方言可以使用<code>==</code></li>
<li><code>&lt;&gt;</code>：有些方言可以使用<code>!=</code></li>
<li><code>&gt;</code></li>
<li><code>&lt;</code></li>
<li><code>&gt;=</code></li>
<li><code>&lt;=</code></li>
<li><code>BETWEEN &lt;value&gt; AND &lt;value&gt;</code></li>
<li><code>[NOT] IN (&lt;value&gt;)</code></li>
<li><code>[NOT] LIKE &lt;pattern&gt;</code><ul>
<li><code>%</code>：匹配0个、多个字符</li>
<li><code>_</code>：匹配一个字符</li>
<li><code>[&lt;char&gt;]</code>：字符列中任意字符</li>
<li><code>^[&lt;char&gt;]/[!&lt;char&gt;]</code>：非字符列中任意字符</li>
</ul>
</li>
</ul>
<h4 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h4><ul>
<li><code>AND</code></li>
<li><code>OR</code></li>
</ul>
<h4 id="符号-1"><a href="#符号-1" class="headerlink" title="符号"></a>符号</h4><ul>
<li><code>&#39;</code>：SQL中使用单引号包括文本值<ul>
<li>大部分方言也支持<code>&quot;</code>双引号</li>
</ul>
</li>
</ul>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><h4 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h4><div class="table-container">
<table>
<thead>
<tr>
<th>TEXT类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CHAR([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>VARCHAR([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>TINYTEXT</code></td>
<td></td>
</tr>
<tr>
<td><code>LONGTEXT</code></td>
<td></td>
</tr>
<tr>
<td><code>MEDIUMITEXT</code></td>
<td></td>
</tr>
<tr>
<td><code>BLOB</code></td>
<td></td>
</tr>
<tr>
<td><code>MEDIUMBLOB</code></td>
<td></td>
</tr>
<tr>
<td><code>LONGBLOB</code></td>
<td></td>
</tr>
<tr>
<td><code>ENUM(&lt;val_list&gt;)</code></td>
<td></td>
</tr>
<tr>
<td><code>SET</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>NUMBER类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>TINYINT([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>SMALLINT([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>MEDIUMINT([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>INT([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>BIGINT([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>FLOAT([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>DOUBLE([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>DECIMAL([&lt;size&gt;])</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>DATE类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DATE()</code></td>
<td></td>
</tr>
<tr>
<td><code>DATETIME()</code></td>
<td></td>
</tr>
<tr>
<td><code>TIMSTAMP()</code></td>
<td></td>
</tr>
<tr>
<td><code>TIME()</code></td>
<td></td>
</tr>
<tr>
<td><code>YEAR()</code></td>
</tr>
</tbody>
</table>
</div>
<h4 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h4><div class="table-container">
<table>
<thead>
<tr>
<th>ASCII类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CHAR([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>VARCHAR([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>TEXT</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>UNICODE类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CHAR([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>VARCHAR([&lt;size&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>text</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>BINARY类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bit</code></td>
<td></td>
</tr>
<tr>
<td><code>binary([&lt;n&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>varbinary([&lt;n&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>image</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>NUMBER类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>TINYINT</code></td>
<td></td>
</tr>
<tr>
<td><code>SMALLINT</code></td>
<td></td>
</tr>
<tr>
<td><code>MEDIUMINT</code></td>
<td></td>
</tr>
<tr>
<td><code>INT</code></td>
<td></td>
</tr>
<tr>
<td><code>BIGINT</code></td>
<td></td>
</tr>
<tr>
<td><code>DECIMAL(p, s)</code></td>
<td></td>
</tr>
<tr>
<td><code>FLOAT([&lt;n&gt;])</code></td>
<td></td>
</tr>
<tr>
<td><code>REAL</code></td>
<td></td>
</tr>
<tr>
<td><code>SMALLMONEY</code></td>
<td></td>
</tr>
<tr>
<td><code>MONEY</code></td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>DATE类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DATETIME</code></td>
<td></td>
</tr>
<tr>
<td><code>DATETIME2</code></td>
<td></td>
</tr>
<tr>
<td><code>SMALLDATETIME</code></td>
<td></td>
</tr>
<tr>
<td><code>DATE</code></td>
<td></td>
</tr>
<tr>
<td><code>TIME</code></td>
<td></td>
</tr>
<tr>
<td><code>DATETIMEOFFSET</code></td>
<td></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h3><ul>
<li><p>建表时添加约束</p>
<ul>
<li>MSSQL、ORACLE：可直接在字段声明后添加约束</li>
<li>MySQL：需独立指定约束</li>
</ul>
</li>
<li><p>向已有表添加约束</p>
<ul>
<li>可以添加匿名、具名约束</li>
<li>MSSQL、ORACLE：有<code>COLUMN</code>关键字</li>
</ul>
</li>
<li><p>删除约束</p>
<ul>
<li>MySQL：使用约束关键字指定</li>
<li>MSSQL、ORACLE：使用<code>CONSTRAINT</code>关键字指定</li>
</ul>
</li>
</ul>
<h4 id="NOT-NULL"><a href="#NOT-NULL" class="headerlink" title="NOT NULL"></a><code>NOT NULL</code></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>
<h4 id="DEFAULT"><a href="#DEFAULT" class="headerlink" title="DEFAULT"></a><code>DEFAULT</code></h4><p><code>DEFAULT</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 建表</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">DEFAULT</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 已有表添加</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 删除</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> <span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br></pre></td></tr></table></figure>
<h4 id="UNIQUE"><a href="#UNIQUE" class="headerlink" title="UNIQUE"></a><code>UNIQUE</code></h4><p><code>UNIQUE</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 建表</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> [<span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>] <span class="keyword">UNIQUE</span> (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">UNIQUE</span> [KEY] [<span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>] (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">UNIQUE</span></span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 已有表添加</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">UNIQUE</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span> <span class="keyword">UNIQUE</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,);</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 删除</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABlE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="PRIMARY-KEY"><a href="#PRIMARY-KEY" class="headerlink" title="PRIMARY KEY"></a><code>PRIMARY KEY</code></h4><p><code>PRIMARY KEY</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 建表</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> [<span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>] <span class="keyword">PRIMARY</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MYSQL</span></span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">PRIMARY</span> KEY</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 已有表添加</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span> <span class="keyword">PRIMARY</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,);</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 删除</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="FOREIGN-KEY"><a href="#FOREIGN-KEY" class="headerlink" title="FOREIGN KEY"></a><code>FOREIGN KEY</code></h4><p><code>FOREIGN KEY</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 建表</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> [<span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>] <span class="keyword">FOREIGN</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="keyword">REFERENCES</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MYSQL</span></span><br><span class="line"><span class="keyword">FOREIGN</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="keyword">REFERENCES</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">FOREIGN</span> KEY</span><br><span class="line"><span class="keyword">REFERENCES</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 已有表添加</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="keyword">REFERENCES</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span> <span class="keyword">FOREIGN</span> KEY (<span class="operator">&lt;</span>field<span class="operator">&gt;</span>,)</span><br><span class="line"><span class="keyword">REFERENCES</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span>(<span class="operator">&lt;</span>field<span class="operator">&gt;</span>);</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 删除</span></span><br><span class="line"><span class="operator">!</span><span class="operator">-</span>  MySQL</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="CHECK"><a href="#CHECK" class="headerlink" title="CHECK"></a><code>CHECK</code></h4><p><code>CHECK</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span><span class="comment">-- 建表</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> [<span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>] <span class="keyword">CHECK</span>(<span class="operator">&lt;</span><span class="keyword">condition</span><span class="operator">&gt;</span>)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">CHECK</span> (<span class="keyword">condition</span>)</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="operator">&lt;</span>field<span class="operator">&gt;</span> <span class="operator">&lt;</span>dtype<span class="operator">&gt;</span> <span class="keyword">CHECK</span>(<span class="operator">&lt;</span><span class="keyword">condition</span><span class="operator">&gt;</span>)</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 已有表添加</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL、MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CHECK</span> (<span class="keyword">condition</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span> <span class="keyword">CHECK</span> (<span class="keyword">condition</span>);</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="comment">-- 删除</span></span><br><span class="line"><span class="operator">!</span><span class="comment">-- MySQL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CHECK</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br><span class="line"><span class="operator">!</span><span class="comment">-- MSSQL、ORACLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>tbl<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> <span class="operator">&lt;</span>cstrt_name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="内建函数"><a href="#内建函数" class="headerlink" title="内建函数"></a>内建函数</h2><h3 id="Date"><a href="#Date" class="headerlink" title="Date"></a><em>Date</em></h3><ul>
<li><p>MySQL</p>
<ul>
<li><code>NOW()</code></li>
<li><code>CURDATE()</code></li>
<li><code>CURTIME()</code></li>
<li><code>DATE()</code></li>
<li><code>EXTRACT()</code></li>
<li><code>DATE_ADD()</code></li>
<li><code>DATE_SUB()</code></li>
<li><code>DATE_DIFF()</code></li>
<li><code>DATE_FORMAT()</code></li>
</ul>
</li>
<li><p>MSSQL</p>
<ul>
<li><code>GETDATE()</code></li>
<li><code>DATEPART()</code></li>
<li><code>DATEADD()</code></li>
<li><code>DATEDIFF()</code></li>
<li><code>CONVERT()</code></li>
</ul>
</li>
</ul>
<h3 id="NULL-1"><a href="#NULL-1" class="headerlink" title="NULL"></a><em>NULL</em></h3><ul>
<li><p>MSSQL</p>
<ul>
<li><code>ISNULL(&lt;field&gt;, &lt;replacement&gt;)</code></li>
</ul>
</li>
<li><p>ORACLE</p>
<ul>
<li><code>NVL(&lt;field&gt;, &lt;repalcement&gt;)</code></li>
</ul>
</li>
<li><p>MySQL</p>
<ul>
<li><code>IFNULL(&lt;field&gt;, &lt;replacement&gt;)</code></li>
<li><code>COALESCE(&lt;field&gt;, &lt;replacement&gt;)</code></li>
</ul>
</li>
</ul>
<h3 id="Aggregate聚集函数"><a href="#Aggregate聚集函数" class="headerlink" title="Aggregate聚集函数"></a><em>Aggregate</em>聚集函数</h3><h3 id="Scalar"><a href="#Scalar" class="headerlink" title="Scalar"></a><em>Scalar</em></h3></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:37.000Z" title="3/21/2019, 5:27:37 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-04T02:52:55.000Z" title="8/4/2021, 10:52:55 AM">2021-08-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Tool/">Tool</a><span> / </span><a class="link-muted" href="/categories/Linux/Tool/Vi/">Vi</a></span><span class="level-item">13 minutes read (About 1912 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Linux/Tool/Vi/vimscripts.html">Vimscripts 编程</a></h1><div class="content"><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="普通变量"><a href="#普通变量" class="headerlink" title="普通变量"></a>普通变量</h3><p>创建变量、变量赋值都需要用到<code>let</code>关键字</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = <span class="string">&quot;bar&quot;</span></span><br><span class="line"><span class="keyword">echo</span> foo</span><br><span class="line"><span class="keyword">let</span> foo = <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="keyword">echo</span> foo</span><br></pre></td></tr></table></figure>
<h4 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h4><ul>
<li><p><code>Number</code>32位带符号整形（整形之间除法同c）</p>
<ul>
<li><code>:echo 0xef</code>：16进制</li>
<li><code>:echo 017</code>：8进制（鉴于以下，不建议使用）</li>
<li><code>:echo 019</code>：10进制（9不可能出现，vim自动处理）</li>
</ul>
</li>
<li><p><code>Float</code></p>
<ul>
<li><code>:echo 5.1e-3</code>：科学计数法）</li>
<li><code>:echo 5.0e3</code>：科学计数法中一定要有小数点</li>
</ul>
</li>
</ul>
<blockquote>
<p>   类型转换：Number和Float运算时会强制转换为Float</p>
</blockquote>
<h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><h5 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h5><ul>
<li><p><code>+</code>、<code>if</code>这些“运算”中，vim会强制转换变量类型</p>
<ul>
<li>数字开头的字符串会转为相应<code>Number</code>（即使符合Float也
会舍弃小数点后）</li>
<li>而非数字开头 则转换为0</li>
</ul>
</li>
<li><p>连接<code>.</code></p>
<ul>
<li><code>.</code>连接时vim可以自动将Number转换为字符串然后连接</li>
<li>但是对于 Float，vim不能自动转换</li>
</ul>
</li>
<li><p>转义<code>\</code>：</p>
<ul>
<li>注意<code>echom &quot;foo\nbar&quot;</code>类似的输出时，<code>echom</code>不会像
<code>echo</code>一样输出两行，而是将换行输出为vim<strong>默认</strong>
（即使设置了<code>listchars</code>）的“换行符”</li>
</ul>
</li>
<li><p>字符串字面量<code>&#39;&#39;</code></p>
<ul>
<li>所见即所得（py中r’’)，注意连续两个单引号表示单引号</li>
</ul>
</li>
<li><p>内建字符串函数</p>
<ul>
<li><code>strlen(str)</code>（len(str)效果对字符串同）</li>
<li><code>split(str, token=&quot; &quot;)</code></li>
<li><code>join([str], token=&quot; &quot;)</code></li>
<li><code>tolower(str)</code></li>
<li><code>toupper(str)</code></li>
</ul>
</li>
<li><p>字符串比较<code>==</code>、<code>==？</code>、<code>==#</code></p>
<ul>
<li><p><code>==</code>：对字符串比较是否大小写敏感取决于设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">set noignorecase</span><br><span class="line">if &quot;foo&quot;==&quot;Foo&quot;</span><br><span class="line">	echo &quot;bar&quot;（不会输出）</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">set ignorecase</span><br><span class="line">if &quot;foo&quot;==&quot;Foo&quot;</span><br><span class="line">	echo &quot;bar&quot;（会输出）</span><br><span class="line">endif</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>==?</code>：对字符串比较大小写永远不敏感</p>
</li>
<li><p><code>==#</code>：对字符串比较大小写永远敏感</p>
</li>
</ul>
</li>
<li><p><code>&lt;</code>、<code>&gt;</code>：同上，也有3种</p>
</li>
</ul>
<h3 id="集合类型变量"><a href="#集合类型变量" class="headerlink" title="集合类型变量"></a>集合类型变量</h3><h4 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h4><p>vim列表特点</p>
<ul>
<li>有序、异质</li>
<li>索引从0开始，可以使用负数索引，使用下标得到对应元素</li>
<li>支持切割<ul>
<li>是闭区间（这个和<code>python</code>不同）</li>
<li>可以负数区间切割</li>
<li>可以忽略起始/结尾索引表示从0开始/末尾截至</li>
<li>切割区间越界是安全的<blockquote>
<p>   字符串可以像列表一样切割、索引，但是不可以使用负数
索引，却可以使用负数切割</p>
</blockquote>
</li>
</ul>
</li>
<li><code>+</code>用于连接两个列表</li>
</ul>
<p>列表内建函数</p>
<ul>
<li><code>add(list, item)</code>：添加新元素</li>
<li><code>len(list)</code>：列表长度</li>
<li><code>get(list, index, default_val)</code>：获取列表元素，越界则
返回<code>default_val</code></li>
<li><code>index(list, item)</code>：返回元素索引，不存在返回<code>-1</code></li>
<li><code>join(list, token)</code>：将列表中元素转换为字符串后，使用
<code>toke</code>连接，缺省为<code>&lt;space&gt;</code></li>
<li><code>reverse(list)</code>：反转列表</li>
</ul>
<h4 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h4><p>字典特性</p>
<ul>
<li><p>值是异质的，键可以不是字符串，但是会被强制转换为字符串，
因此，在查找值时也可以使用非字符串<code>dict[100]</code>，同样会被
强制转换为字符串<code>dict[&quot;100&quot;]</code>之后查找</p>
</li>
<li><p>支持属性<code>.</code>查找，甚至可以后接<code>Number</code></p>
</li>
<li><p>添加新元素就和普通赋值一样：<code>let dict.100 = 100</code></p>
</li>
<li><p>移除字典中的元素</p>
<ul>
<li><code>remove(dict, index)</code></li>
<li><code>unlet dict.index</code>/<code>unlet dict[index]</code>
移除不存在的元素事报错</li>
</ul>
</li>
</ul>
<blockquote>
<p>   允许定义时多一个<code>,</code></p>
</blockquote>
<h5 id="内建函数"><a href="#内建函数" class="headerlink" title="内建函数"></a>内建函数</h5><ul>
<li><p><code>get(dict, index, default_val)</code>：同列表</p>
</li>
<li><p><code>has_key(dict, index)</code>：检查字典中是否有给定键，返回
<code>1</code>（真）或<code>0</code>（假）</p>
</li>
<li><p><code>item(dict)</code>：返回字典键值对，和字典一样无序</p>
</li>
<li><p><code>keys(dict)</code>：返回字典所有键</p>
</li>
<li><p><code>values(dict)</code>：返回字典所有值</p>
</li>
</ul>
<h3 id="作为变量的选项"><a href="#作为变量的选项" class="headerlink" title="作为变量的选项"></a>作为变量的选项</h3><ul>
<li><p>bool选项输出0、1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:set wrap</span><br><span class="line">:set nowrap</span><br></pre></td></tr></table></figure>
</li>
<li><p>键值选项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:set textwidth=80</span><br><span class="line">:echo &amp;textwidth</span><br></pre></td></tr></table></figure>
</li>
<li><p>本地选项（<code>l:</code>作用域下）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let &amp;l:number=1</span><br></pre></td></tr></table></figure>
</li>
<li><p>选项变量还可以参与运算</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let &amp;textwidth=100</span><br><span class="line">let &amp;textwidht = &amp;textwidth + 10</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="作为变量的寄存器"><a href="#作为变量的寄存器" class="headerlink" title="作为变量的寄存器"></a>作为变量的寄存器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let @a = &quot;hello&quot;</span><br><span class="line">echo @a</span><br><span class="line">echo @&quot;</span><br><span class="line">echo @/</span><br></pre></td></tr></table></figure>
<h3 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a>变量作用域</h3><p>以<code>&lt;char&gt;:</code>开头表示作用域变量</p>
<ul>
<li>变量默认为全局变量</li>
<li><code>b:</code>：当前缓冲区作用域变量</li>
<li><code>g:</code>：全局变量</li>
</ul>
<h2 id="语句"><a href="#语句" class="headerlink" title="语句"></a>语句</h2><h3 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h3><p>vim中没有<code>not</code>关键字，可以使用<code>!</code>表示否定</p>
<ul>
<li><code>!</code>：否</li>
<li><code>||</code>：或</li>
<li><code>&amp;&amp;</code>：与</li>
</ul>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&quot;1one&quot;</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;one&quot;</span>（会输出）</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="string">&quot;one&quot;</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;one&quot;</span>（会输出）</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<h4 id="finish关键字"><a href="#finish关键字" class="headerlink" title="finish关键字"></a><code>finish</code>关键字</h4><p><code>finally</code>时结束整个vimscripts的运行</p>
<h3 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h3><h4 id="for语句"><a href="#for语句" class="headerlink" title="for语句"></a><code>for</code>语句</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">c</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i in [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">c</span>+=i</span><br><span class="line"><span class="keyword">endfor</span></span><br><span class="line"><span class="keyword">echom</span> <span class="keyword">c</span></span><br></pre></td></tr></table></figure>
<h4 id="while语句"><a href="#while语句" class="headerlink" title="while语句"></a><code>while</code>语句</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">c</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> total = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">c</span>&lt;=<span class="number">4</span></span><br><span class="line">	<span class="keyword">let</span> total+=<span class="keyword">c</span></span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">c</span>+=<span class="number">1</span></span><br><span class="line"><span class="keyword">endwhile</span></span><br><span class="line"><span class="keyword">echom</span> total</span><br></pre></td></tr></table></figure>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>没有作用域限制的vimscripts函数必须以大写字母开头
（有作用域限制最好也是大写字母开头）</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">func Func(arg1,...)</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;Func&quot;</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">a:arg1</span>（arg1）</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">a:0</span>（额外（可变）参数数量）</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">a:1</span>（第一个额外参数）</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">a:000</span>（所有额外参数的<span class="keyword">list</span>）</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;Func&quot;</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>   当<code>function</code>后没有紧跟<code>!</code>时，函数已经被定义，将会给出
    错误，而<code>function!</code>时会直接将原函数替换，除非原函数正在
    执行，此时仍然报错</p>
</blockquote>
<ul>
<li><p>调用方式</p>
<ul>
<li><code>:call Func()</code>：call直接调用（return值会被直接丢弃）</li>
<li><code>:echo Func()</code>：表达式中调用</li>
</ul>
</li>
<li><p>函数结束时没有return，隐式返回0</p>
</li>
<li><p>函数参数：最多20个</p>
<ul>
<li><p>参数全部位于<code>a:</code>参数作用域下</p>
<ul>
<li><code>a:arg1</code>：一般参数</li>
<li><code>a:0</code>：额外（可变）参数数量</li>
<li><code>a:n</code>：第n个额外参数</li>
<li><code>a:000</code>：包含额外参数list</li>
</ul>
</li>
<li><p>参数不能重新赋值</p>
</li>
</ul>
</li>
</ul>
<p>vim中函数可以赋值给变量，同样的此时变量需要大写字母开头，
当然可以作为集合变量的元素，甚至也可以作为参数传递</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function! Reversed(l)</span><br><span class="line">	let nl = deepcopy(a:l)</span><br><span class="line">	call reverse(nl)</span><br><span class="line">	return nl</span><br><span class="line">endfunction</span><br><span class="line"></span><br><span class="line">let Myfunc = function(&quot;Reversed&quot;)</span><br><span class="line"></span><br><span class="line">function! Mapped(func, l)</span><br><span class="line">	let nl = deepcopy(a:l)</span><br><span class="line">	call map(nl, string(a:func) . &#x27;(v:val)&#x27;)</span><br><span class="line">	return nl</span><br><span class="line">endfunction</span><br><span class="line"></span><br><span class="line">call Mapped(function(&quot;Reversed&quot;), [[3,2], [1,2]])</span><br><span class="line"></span><br><span class="line">let funcs = [function(&quot;Reversed&quot;), function(&quot;Mapped&quot;)]</span><br></pre></td></tr></table></figure>
<p>更多函数参见<code>functions.vim</code>（如果完成了）</p>
<h2 id="Execute、Normal"><a href="#Execute、Normal" class="headerlink" title="Execute、Normal"></a>Execute、Normal</h2><ul>
<li><p><code>:execute</code>：把字符串当作vimscript命令执行（命令行输入）
<code>:execute &quot;echom &#39;hello, world&#39;&quot;&lt;cr&gt;</code></p>
<p>大多数语言中应该避免使用”eval”之类构造可执行字符串，但是
vimscripts代码大部分只接受用户输入，安全不是严重问题，
使用<code>:execute</code>命令能够极大程度上简化命令</p>
<blockquote>
<p>   <code>:execute</code>命令用于配置文件时，不要忽略结尾的<code>&lt;cr&gt;</code>，
   表示“执行命令”</p>
</blockquote>
</li>
<li><p><code>:normal</code>：接受一串<strong>键值</strong>，并当作是normal模式接受按键</p>
<ul>
<li><p><code>:normal</code>后的按键会执行映射，<code>:normal!</code>忽略所有映射</p>
</li>
<li><p><code>:normal</code>无法识别“<cr>”这样的特殊字符序列
<code>:normal /foo&lt;cr&gt;</code>
这样的命令并不会搜索，因为“没有按回车”</p>
</li>
</ul>
</li>
<li><p><code>:execute</code>和:normal结合使用，让<code>:normal</code>接受<strong>按下</strong>
“无法打印”字符（<code>&lt;cr&gt;</code>、<code>&lt;esc&gt;</code>等），<code>execute</code>能够接受
按键</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">execute</span> <span class="string">&quot;normal! gg/foo\&lt;cr&gt;dd&quot;</span></span><br><span class="line">:<span class="keyword">execute</span> <span class="string">&quot;normal! mqA;\&lt;esc&gt;`q&quot;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><p>vim有四种不同的解析正则表达式的“模式”</p>
<ul>
<li><p>默认模式下<code>\+</code>表示“一个或多个之前字符”的正常<code>+</code>意义，
其他的符号如<code>&#123;,&#125;,*</code>也都需要添加转义斜杠表示正常意义，
否则表示字符字面意</p>
<ul>
<li><p><code>:execute &quot;normal! gg/for .\\+ in .\\+:\&lt;cr&gt;</code>：
execute接受字符串，将<code>\\</code>转义，然后正则表达式解析，
查找<code>python</code>的<code>for</code>语句</p>
</li>
<li><p><code>:execute &quot;normal! gg&quot;.&#39;/for .\+ in .\+:&#39;.&quot;\&lt;cr&gt;&quot;</code>：
使用字符串字面量避免<code>\\</code>，但是注意此时<code>\&lt;cr&gt;</code>也不会
被转义为<strong>按下回车</strong>（<code>\n</code>才是换行符），所以需要分开
书写、连接</p>
</li>
</ul>
</li>
<li><p><code>\v</code>模式下，vim使用“very magic”<strong>正常</strong>正则解析模式</p>
<ul>
<li><code>:execute &quot;normal! gg&quot;.&#39;/\vfor .+ in .+:&#39;.&quot;\&lt;cr&gt;&quot;</code></li>
</ul>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:37.000Z" title="3/21/2019, 5:27:37 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-02-17T03:57:08.000Z" title="2/17/2019, 11:57:08 AM">2019-02-17</time></span><span class="level-item"><a class="link-muted" href="/categories/Rust/">Rust</a></span><span class="level-item">37 minutes read (About 5483 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Rust/grammer.html">Rust 语法</a></h1><div class="content"><h2 id="Rust是基于表达式的语言"><a href="#Rust是基于表达式的语言" class="headerlink" title="Rust是基于表达式的语言"></a>Rust是基于表达式的语言</h2><p>表达式返回一个值，而语句不返回，rust中除两种语句外，全是
表达式</p>
<ul>
<li><code>let</code>引入绑定<ul>
<li>可变绑定赋值是表达式，返回空tuple</li>
<li>声明后初始化绑定？#todo</li>
</ul>
</li>
<li>表达式语句：表达式后跟分号转换为语句</li>
</ul>
<p>代码中rust希望语句后跟语句，使用分号分隔表达式，所以rust
看起来和其他大部分分号结尾语言相似</p>
<p><code>&#123;&#125;</code>包裹的代码块内最后一“句”没有以”;”结尾，那么是表达式，且
返回该表达式的值，整个代码块可以看作是表达式，否则为语句，
没有返回值，函数同</p>
<h2 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h2><h3 id="Refutability（可反驳性）"><a href="#Refutability（可反驳性）" class="headerlink" title="Refutability（可反驳性）"></a>Refutability（可反驳性）</h3><ul>
<li>refutable（可反驳的）：对某些可能值匹配失败的模式，
<code>if let</code>、<code>while let</code>只能接受可反驳的模式，因为这就用于
处理可能的失败</li>
<li>irrefutable（不可反驳的）：能匹配任何传递的可能值，<code>let</code>
语句、函数参数、<code>for</code>循环只能接受不可反驳的模式，因为
通过不匹配值的程序无意义</li>
</ul>
<blockquote>
<p>   可能值是指“类型”相同，可用于匹配的值</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="literal">Some</span>(x) = some_optiona_value;</span><br><span class="line">	<span class="comment">//`Some(x)`是refutable模式，若`some_optional_value`为</span></span><br><span class="line">	<span class="comment">//None，则此时无法成功匹配，此语句可能无法正常工作</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> x = <span class="number">5</span> &#123;</span><br><span class="line">	<span class="comment">//`x`是inrefutable模式，对所有可能值都可以匹配，此语句</span></span><br><span class="line">	<span class="comment">//无意义</span></span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Refutable"><a href="#Refutable" class="headerlink" title="Refutable"></a>Refutable</h3><h4 id="match控制流"><a href="#match控制流" class="headerlink" title="match控制流"></a><code>match</code>控制流</h4><ul>
<li>各分支模式同值“类型”必须完全一致才能匹配</li>
<li>返回类型必须一致，如果有返回值</li>
<li>匹配必须是穷尽的，可以使用通配符<code>_</code>（匹配所有的值）代替<ul>
<li>match是匹配到就退出，不像switch一样会继续下沉</li>
<li>通配符不总是需要的，对于枚举类型只要含有所有枚举
成员的分支即可</li>
</ul>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="literal">Some</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">let</span> y = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> x&#123;</span><br><span class="line">	<span class="literal">Some</span>(<span class="number">50</span>) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;got 50&quot;</span>),</span><br><span class="line">		<span class="comment">//`Some(50)`这个模式规定了“值”</span></span><br><span class="line">	<span class="literal">Some</span>(y) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;matched, y = &#123;:?&#125;&quot;</span>, y),</span><br><span class="line">		<span class="comment">//match表达式作用域中的`y`会覆盖周围环境的`y`</span></span><br><span class="line">	_ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;default case, x = &#123;:?&#125;&quot;</span>, x),</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;at the end: x = &#123;:?&#125;, y = &#123;:?&#125;&quot;</span>, x, y);</span><br></pre></td></tr></table></figure>
<h4 id="if-let-else-简洁控制流"><a href="#if-let-else-简洁控制流" class="headerlink" title="if let[else]简洁控制流"></a><code>if let[else]</code>简洁控制流</h4><ul>
<li>只匹配关心的一个模式</li>
<li>可以添加<code>else</code>语句，类似<code>match</code>通配符匹配</li>
<li><code>if let</code>、<code>else if</code>、<code>else if let</code>等相互组合可以提供更多
的灵活性<ul>
<li><code>else if</code>可以不是模式匹配</li>
<li>各<code>if</code>后的比较的值可以没有关联</li>
</ul>
</li>
<li>没有穷尽性检查，可能会遗漏一些情况</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> favorite_color: <span class="built_in">Option</span>&lt;&amp;<span class="built_in">str</span>&gt; = <span class="literal">None</span>;</span><br><span class="line">	<span class="keyword">let</span> is_tuesday = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">let</span> age: <span class="built_in">Result</span>&lt;<span class="built_in">u8</span>, _&gt; = <span class="string">&quot;34&quot;</span>.parse();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Some</span>(color) = favorite_color&#123;</span><br><span class="line">		<span class="comment">//模式匹配</span></span><br><span class="line">		<span class="comment">//注意这里是`=`而不是一般值比较`==`</span></span><br><span class="line">		<span class="comment">//`while`同</span></span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;favorite color is &#123;&#125;&quot;</span>, color&#125;;</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span> is_tuesday&#123;</span><br><span class="line">		<span class="comment">//普通`if`条件语句</span></span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;Tuesday is green day!&quot;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Ok</span>(age) = age&#123;</span><br><span class="line">		<span class="comment">//`age`变量覆盖原变量</span></span><br><span class="line">		<span class="comment">//此时`age`是`u8`类型</span></span><br><span class="line">		<span class="keyword">if</span> age &gt; <span class="number">30</span> &#123;</span><br><span class="line">			<span class="comment">//因此此条件不能提出，因为两个`age`变量不同，</span></span><br><span class="line">			<span class="comment">//不能共存在同一条语句中</span></span><br><span class="line">			<span class="built_in">println!</span>(<span class="string">&quot;Using purple as the background color&quot;</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="built_in">println!</span>(<span class="string">&quot;Using orange as the background color&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;Using blue as the background color&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Irrefutable"><a href="#Irrefutable" class="headerlink" title="Irrefutable"></a>Irrefutable</h3><h4 id="while-let条件循环"><a href="#while-let条件循环" class="headerlink" title="while let条件循环"></a><code>while let</code>条件循环</h4><p>和<code>if let</code>条件表达式类似，循环直到模式不匹配</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut</span> stack = <span class="built_in">Vec</span>::new();</span><br><span class="line">	stack.push(<span class="number">1</span>);</span><br><span class="line">	stack.push(<span class="number">2</span>);</span><br><span class="line">	stack.push(<span class="number">3</span>);</span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">let</span> <span class="literal">Some</span>(top) = stack.pop()&#123;</span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, top);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="for解构"><a href="#for解构" class="headerlink" title="for解构"></a><code>for</code>解构</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> v = <span class="built_in">vec!</span>[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">	<span class="keyword">for</span> (index, value) <span class="keyword">in</span> v.iter().enumerate()&#123;</span><br><span class="line">		<span class="comment">//解构tuple</span></span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; is at index &#123;&#125;&quot;</span>, value, index);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="let解构"><a href="#let解构" class="headerlink" title="let解构"></a><code>let</code>解构</h4><p><code>let</code>语句本“应该“看作是模式匹配</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> PARTTERN = EXPRESSION;</span><br><span class="line">	<span class="comment">//这样就和`if let`模式匹配中`=`一致</span></span><br><span class="line">	<span class="comment">//应该可以把`=`看作是模式匹配的符号</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x = <span class="number">5</span>;</span><br><span class="line">	<span class="comment">//这里`x`是一个模式“变量”</span></span><br><span class="line"><span class="keyword">let</span> (x, y, z) = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">	<span class="comment">//`(x, y, z)`是模式“3元元组“</span></span><br><span class="line">	<span class="comment">//解构元组</span></span><br></pre></td></tr></table></figure>
<h4 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h4><p>类似于<code>let</code>语句，函数参数也“应该”看作是模式匹配</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">foo</span></span>(x: <span class="built_in">i32</span>)&#123;</span><br><span class="line">	<span class="comment">//`x`表示模式“变量”</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_coordinates</span></span>(&amp;(x, y): &amp;(<span class="built_in">i32</span>, <span class="built_in">i32</span>))&#123;</span><br><span class="line">	<span class="comment">//这里`(x, y)`是模式“元组”</span></span><br><span class="line">	<span class="comment">//但是这里处于函数变量类型的要求，有点像元组结构体</span></span><br><span class="line">	<span class="comment">//调用时使用元组即可</span></span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;Current location: (&#123;&#125;, &#123;&#125;)&quot;</span>, x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="模式匹配用法"><a href="#模式匹配用法" class="headerlink" title="模式匹配用法"></a>模式匹配用法</h3><h4 id="、-“或“"><a href="#、-“或“" class="headerlink" title="|、...“或“"></a><code>|</code>、<code>...</code>“或“</h4><ul>
<li><code>|</code>“或”匹配多个模式</li>
<li><code>...</code>闭区间范围模式，仅适用于数值、<code>char</code>值</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">match</span> x &#123;</span><br><span class="line">	<span class="number">1</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;one&quot;</span>),</span><br><span class="line">		<span class="comment">//`1`是模式“字面值”</span></span><br><span class="line">	<span class="number">2</span> | <span class="number">3</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;two or three&quot;</span>),</span><br><span class="line">		<span class="comment">//`|`分隔，匹配多个模式</span></span><br><span class="line">	<span class="number">5</span>...<span class="number">10</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;through 5 to 10&quot;</span>),</span><br><span class="line">		<span class="comment">//`...`表示匹配一个**闭区间**范围的值</span></span><br><span class="line">		<span class="comment">//这个语法只能用于数字或者是`char`值，因为编译器会</span></span><br><span class="line">		<span class="comment">//检查范围不为空，而只有数字、`char`值rust可以判断</span></span><br><span class="line">	_ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;anything&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line"><span class="keyword">match</span> x &#123;</span><br><span class="line">	<span class="string">&#x27;a&#x27;</span>...<span class="string">&#x27;j&#x27;</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;early ASCII letter&quot;</span>),</span><br><span class="line">	<span class="string">&#x27;k&#x27;</span>...<span class="string">&#x27;z&#x27;</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;late ASCII letter&quot;</span>),</span><br><span class="line">	_ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;something else&quot;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="、-”忽略“"><a href="#、-”忽略“" class="headerlink" title="_、..”忽略“"></a><code>_</code>、<code>..</code>”忽略“</h4><ul>
<li><p><code>_</code>忽略整个值</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">foo</span></span>(_: <span class="built_in">i32</span>, y: <span class="built_in">i32</span>)&#123;</span><br><span class="line">	<span class="comment">//函数签名中忽略整个值</span></span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;this code only use the y parameter: &#123;&#125;&quot;</span>, y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	foo(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut</span> setting_value = <span class="literal">Some</span>(<span class="number">5</span>); <span class="keyword">let</span> new_setting_value = <span class="literal">Some</span>(<span class="number">10</span>);</span><br><span class="line">	<span class="keyword">match</span> (setting_value, new_setting_value)&#123;</span><br><span class="line">		(<span class="literal">Some</span>(_), <span class="literal">Some</span>()) =&gt; &#123;</span><br><span class="line">			<span class="comment">//嵌套`_`忽略部分值</span></span><br><span class="line">			<span class="comment">//此时没有任何值所有权</span></span><br><span class="line">			<span class="built_in">println!</span>(<span class="string">&quot;can&#x27;t overwrite an exsiting customized value&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		_ =&gt; &#123;</span><br><span class="line">			setting_value = new_setting_value;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;setting is &#123;:?&#125;&quot;</span>, setting_value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>_var</code>变量名前添加下划线忽略未使用变量，此时值所有权
仍然会转移，只是相当于告诉编译器忽略该未使用变量</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> _x = <span class="number">5</span>;</span><br><span class="line">		<span class="comment">//两个变量未使用，但是编译时只有一个warning</span></span><br><span class="line">	<span class="keyword">let</span> y = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> s = <span class="literal">Some</span>(<span class="number">5</span>);</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Some</span>(_s) = s &#123;</span><br><span class="line">		<span class="comment">//值所有权已转移，`s`不能继续使用</span></span><br><span class="line">		<span class="comment">//编译器忽略未使用`_s`，不给出warning</span></span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;get a integer&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>..</code>忽略剩余值</p>
<ul>
<li><code>..</code>的使用必须无歧义</li>
<li>对于结构体即使只有一个field，需使用<code>..</code>忽略剩余值，
不能使用<code>_</code><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> numbers = (<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>);</span><br><span class="line">	<span class="keyword">match</span> numbers&#123;</span><br><span class="line">		(first, .., last) =&gt; &#123;</span><br><span class="line">			<span class="built_in">println!</span>(<span class="string">&quot;Some numbers: &#123;&#125;, &#123;&#125;&quot;</span>, first, last);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> (x, _, z) = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">	<span class="comment">//`_`忽略模式中各一个值</span></span><br><span class="line"><span class="keyword">let</span> (x, .., z) = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">	<span class="comment">//`..`忽略模式中多个值</span></span><br></pre></td></tr></table></figure>
<h4 id="解构结构体"><a href="#解构结构体" class="headerlink" title="解构结构体"></a>解构结构体</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span>&#123;</span><br><span class="line">	x: <span class="built_in">i32</span>,</span><br><span class="line">	y: <span class="built_in">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> p = Point&#123;x: <span class="number">0</span>, y: <span class="number">7</span>&#125;;</span><br><span class="line">	<span class="keyword">let</span> Point&#123;x: a, y: b&#125; = p;</span><br><span class="line">		<span class="comment">//`Point&#123;x: a, y: b&#125;`是模式”Point结构体“</span></span><br><span class="line">		<span class="comment">//解构结构体</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> p = Point&#123;x: <span class="number">0</span>, y: <span class="number">7</span>&#125;;</span><br><span class="line">	<span class="keyword">let</span> Point&#123;x, y&#125; = p;</span><br><span class="line">		<span class="comment">//模式匹配解构结构体简写</span></span><br><span class="line">		<span class="comment">//只要列出结构体字段，模式创建相同名称的变量</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> p = Point&#123;x: <span class="number">0</span>, y: <span class="number">7</span>&#125;;</span><br><span class="line">	<span class="keyword">match</span> p &#123;</span><br><span class="line">		Point &#123;x, y: <span class="number">0</span>&#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;on the x axis at &#123;&#125;&quot;</span>, x),</span><br><span class="line">		Point &#123;x: <span class="number">0</span>, y&#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;on the y axis at &#123;&#125;&quot;</span>, y),</span><br><span class="line">		Point &#123;x, y&#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;on neither axis: (&#123;&#125;, &#123;&#125;)&quot;</span>, x, y),</span><br><span class="line">			<span class="comment">//这里没有`_`通配符，因为`Point &#123;x, y&#125;`模式已经</span></span><br><span class="line">			<span class="comment">//是irrefutable，不需要</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="解构枚举"><a href="#解构枚举" class="headerlink" title="解构枚举"></a>解构枚举</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Message</span></span>&#123;</span><br><span class="line">	Quit,</span><br><span class="line">	Move&#123;x: <span class="built_in">i32</span>, y:<span class="built_in">i32</span>&#125;,</span><br><span class="line">	Write(<span class="built_in">String</span>),</span><br><span class="line">	ChangeColor(<span class="built_in">i32</span>, <span class="built_in">i32</span>, <span class="built_in">i32</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> msg = Message::ChangeColor(<span class="number">0</span>, <span class="number">160</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> p = <span class="keyword">match</span> msg&#123;</span><br><span class="line">		<span class="comment">//这里`match`返回值必须类型完全相同</span></span><br><span class="line">		Message::Move&#123;x, y&#125; <span class="keyword">if</span> x == <span class="number">0</span> =&gt; (x, y),</span><br><span class="line">			<span class="comment">//对于`Message`中的匿名结构体类型的成员，匿名</span></span><br><span class="line">			<span class="comment">//结构体没有枚举类型外的定义、名称，无法、也</span></span><br><span class="line">			<span class="comment">//不应该直接获取结构体</span></span><br><span class="line">		Message::Write(<span class="keyword">ref</span> <span class="built_in">str</span>) =&gt; &#123;</span><br><span class="line">			<span class="comment">//`Message::Write`不是`Message`的一个枚举成员</span></span><br><span class="line">			<span class="comment">//必须`Message::Write(str)`才是（能够匹配）</span></span><br><span class="line">			<span class="built_in">println!</span>(<span class="string">&quot;write &#123;&#125;&quot;</span>, <span class="built_in">str</span>);</span><br><span class="line">			(<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">		&#125;,</span><br><span class="line">		Message::ChangeColor(..) =&gt; (<span class="number">1</span>,<span class="number">0</span>),</span><br><span class="line">			<span class="comment">//类似的，需要使用`..`忽略值，仅`ChangeColor`</span></span><br><span class="line">			<span class="comment">//不是`Message`成员</span></span><br><span class="line">		_ =&gt; &#123;</span><br><span class="line">			<span class="built_in">println!</span>(<span class="string">&quot;quit&quot;</span>);</span><br><span class="line">			(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="amp-、ref、ref-mut”引用“"><a href="#amp-、ref、ref-mut”引用“" class="headerlink" title="&amp;、ref、ref mut”引用“"></a><code>&amp;</code>、<code>ref</code>、<code>ref mut</code>”引用“</h4><ul>
<li><p><code>&amp;</code>匹配引用，“获得”值</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> points = <span class="built_in">vec!</span>[</span><br><span class="line">	Point &#123;x: <span class="number">0</span>, y: <span class="number">0</span>&#125;,</span><br><span class="line">	Point &#123;x: <span class="number">1</span>, y: <span class="number">5</span>&#125;,</span><br><span class="line">	Point &#123;x: <span class="number">10</span>, y: -<span class="number">3</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sum_of_squares: <span class="built_in">i32</span> = points</span><br><span class="line">	.iter()</span><br><span class="line">	.map(|&amp;Point &#123;x, y&#125;| x * x + y * y)</span><br><span class="line">		<span class="comment">//`&amp;`匹配一个引用</span></span><br><span class="line">	.sum();</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>ref</code>匹配值，“获得”不可变引用</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> robot_name = <span class="literal">Some</span>(<span class="built_in">String</span>::from(<span class="string">&quot;Bors&quot;</span>));</span><br><span class="line"><span class="keyword">match</span> robot_name&#123;</span><br><span class="line">	<span class="literal">Some</span>(<span class="keyword">ref</span> name) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;found a name: &#123;&#125;&quot;</span>, name),</span><br><span class="line">		<span class="comment">//使用`ref`获取不可变引用才能编译成功</span></span><br><span class="line">		<span class="comment">//否则所有权转移，之后报错</span></span><br><span class="line">	<span class="literal">None</span> =&gt; (),</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;robot_name is: &#123;:?&#125;&quot;</span>, robot_name);</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>ref mut</code>匹配值，“获得”可变引用</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> robot_name = <span class="literal">Some</span>(<span class="built_in">String</span>::from(<span class="string">&quot;Bors&quot;</span>));</span><br><span class="line"><span class="keyword">match</span> robot_name&#123;</span><br><span class="line">	<span class="literal">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> name) =&gt; *name = <span class="built_in">String</span>::from(<span class="string">&quot;NewName&quot;</span>),</span><br><span class="line">	<span class="literal">None</span> =&gt; (),</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;robot_name is: &#123;:?&#125;&quot;</span>, robot_name);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="ifmatch-guard"><a href="#ifmatch-guard" class="headerlink" title="ifmatch guard"></a><code>if</code>match guard</h4><p>匹配守卫<em>match guard</em>：放在<code>=&gt;</code>之前的<code>if</code>语句，<code>match</code>
分支的额外条件，条件为真才会继续执行分支代码</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num = <span class="literal">Some</span>(<span class="number">4</span>);</span><br><span class="line"><span class="keyword">let</span> y = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">match</span> num&#123;</span><br><span class="line">	<span class="literal">Some</span>(x) <span class="keyword">if</span> x &lt; y =&gt; <span class="built_in">println!</span>(<span class="string">&quot;&#x27;less than y: &#123;&#125;&quot;</span>, x),</span><br><span class="line">	<span class="literal">Some</span>(x) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, x),</span><br><span class="line">	<span class="literal">None</span> =&gt; (),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">let</span> y = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">match</span> x &#123;</span><br><span class="line">	<span class="number">4</span> | <span class="number">5</span> | <span class="number">6</span> <span class="keyword">if</span> y =&gt; <span class="built_in">println!</span>(<span class="string">&quot;yes&quot;</span>),</span><br><span class="line">		<span class="comment">//`4 | 5 | 6`整体作为一个模式，match guard作用于</span></span><br><span class="line">		<span class="comment">//模式整体，而不是单独的`6`</span></span><br><span class="line">	_ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;no&quot;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="绑定"><a href="#绑定" class="headerlink" title="@绑定"></a><code>@</code>绑定</h4><p><code>@</code>允许在创建存放值的变量时，同时测试值是否匹配模式</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Message</span></span>&#123;</span><br><span class="line">	Hello &#123; id: <span class="built_in">i32</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> msg = Message::Hello &#123; id: <span class="number">5</span> &#125;;</span><br><span class="line"><span class="keyword">match</span> msg&#123;</span><br><span class="line">	Message::Hello&#123; id: id_variable @ <span class="number">3</span>...<span class="number">7</span> &#125; =&gt; &#123;</span><br><span class="line">		<span class="comment">//匹配结构体模式（值绑定`id_variable`）&amp;&amp;值在`3...7`范围</span></span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;Found an id in range: &#123;&#125;&quot;</span>, id_variable)</span><br><span class="line">	&#125;,</span><br><span class="line">	Message::Hello&#123; id: <span class="number">10</span>...<span class="number">12</span> &#125; =&gt; &#123;</span><br><span class="line">		<span class="comment">//此分支模式指定了值的范围，但是没有绑定值给变量`id`</span></span><br><span class="line">		<span class="comment">//结构体匹配简略写法不能应用与此</span></span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;Found an id in another range&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	Message::Hello&#123; id &#125; =&gt; &#123;</span><br><span class="line">		<span class="comment">//此分支结构体匹配简略写法，值绑定于`id`</span></span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;Found some other id: &#123;&#125;&quot;</span>, id)</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="闭包closures和函数指针"><a href="#闭包closures和函数指针" class="headerlink" title="闭包closures和函数指针"></a>闭包closures和函数指针</h2><p>闭包是可以保存进变量或作为参数传递给其他函数的匿名函数，
可以在一个地方创建闭包，而在不同的上下文执行闭包。和函数
的区别在于，其可以捕获调用者作用域中的值，当然这会有性能
损失，如果不需要捕获调用者作用域中的值可以考虑使用函数</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> closures = |param1, param2|&#123;</span><br><span class="line">	...</span><br><span class="line">	expression</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>闭包参数：<strong>调用者</strong>使用，<ul>
<li>创建闭包赋值给变量，再通过变量调用闭包</li>
<li>创建闭包作为参数传递，其他函数调用</li>
</ul>
</li>
<li>捕获环境变量：创建闭包作为参数传递，直接使用周围环境变量</li>
</ul>
<h3 id="闭包类型推断和注解"><a href="#闭包类型推断和注解" class="headerlink" title="闭包类型推断和注解"></a>闭包类型推断和注解</h3><p>闭包不要求像函数一样需要在参数和返回值上注明类型，函数需要
类型注解因为其是需要暴露给的显示接口的一部分，而闭包不用于
作为对外暴露的接口</p>
<ul>
<li>作为匿名函数直接使用，或者存储在变量中</li>
<li>通常很短，使用场景上下文比较简单，编译器能够推断参数和
返回值类型</li>
</ul>
<p>当然，闭包也可以添加注解增加明确性</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span>  <span class="title">add_one_v1</span>   &#123;<span class="title">x</span>: <span class="title">u32</span>&#125; -&gt; <span class="title">u32</span> &#123; <span class="title">x</span> + 1 &#125;;</span></span><br><span class="line"><span class="function"><span class="title">let</span> <span class="title">add_one_v2</span> = |<span class="title">x</span>: <span class="title">u32</span>| -&gt; <span class="title">u32</span> &#123; <span class="title">x</span> + 1 &#125;;</span></span><br><span class="line"><span class="function"><span class="title">let</span> <span class="title">add_one_v3</span> = |<span class="title">x</span>|             &#123; <span class="title">x</span> + 1 &#125;;</span></span><br><span class="line"><span class="function"><span class="title">let</span> <span class="title">add_one_v4</span> = |<span class="title">x</span>|               <span class="title">x</span> + 1;</span></span><br><span class="line"><span class="function">	//闭包体只有一行可以省略`&#123;&#125;`</span></span><br></pre></td></tr></table></figure>
<p>Rust会根据闭包出调用为每个参数和返回值推断类型，并将其锁定，
如果尝试对同一闭包使用不同类型的参数调用会报错</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> example_closure = |x| x;</span><br><span class="line"><span class="keyword">let</span> s = example_closure(<span class="built_in">String</span>::from(<span class="string">&quot;hello&quot;</span>));</span><br><span class="line">	<span class="comment">//此时已经锁定闭包参数、返回值类型</span></span><br><span class="line"><span class="keyword">let</span> n = example_closure(<span class="number">5</span>);</span><br><span class="line">	<span class="comment">//尝试使用`i32`类型调用闭包会报错</span></span><br></pre></td></tr></table></figure>
<h3 id="Fntrait-bound"><a href="#Fntrait-bound" class="headerlink" title="Fntrait bound"></a><code>Fn</code>trait bound</h3><p>每个闭包实例有自己独有的匿名类型，即使两个闭包有相同的签名，
其类型依然不同。为了定义使用闭包的结构体、枚举、函数参数，
（这些定义中都需要指定元素类型），需要使用泛型和trait 
bound</p>
<ul>
<li><code>FnOnce</code>：获取从周围环境捕获的变量的所有权，因此只能调用
一次，即<code>Once</code>的含义</li>
<li><code>Fn</code>：获取从周围环境捕获的变量的不可变引用</li>
<li><code>FnMut</code>：获取从周围环境捕获的变量的可变引用</li>
</ul>
<p>所有的闭包都实现了以上3个trait中的一个，Rust根据闭包如何
使用环境中的变量推断其如何捕获环境，及实现对应的trait</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Cacher</span></span>&lt;T&gt;</span><br><span class="line">	<span class="keyword">where</span> T: <span class="built_in">Fn</span>(<span class="built_in">u32</span>) -&gt; <span class="built_in">u32</span>&#123;</span><br><span class="line">		<span class="comment">//`T`的类型中包括`Fn`、参数、返回值三个限定</span></span><br><span class="line">	calculation: T,</span><br><span class="line">	value: <span class="built_in">Option</span>&lt;<span class="built_in">u32</span>&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Function-Pointer-fn"><a href="#Function-Pointer-fn" class="headerlink" title="Function Pointer fn"></a>Function Pointer <code>fn</code></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">add_one</span></span>(x: <span class="built_in">i32</span>) -&gt; <span class="built_in">i32</span>&#123;</span><br><span class="line">	x + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">do_twice</span></span>(f: <span class="function"><span class="keyword">fn</span></span>(<span class="built_in">i32</span>) -&gt; <span class="built_in">i32</span>, arg: <span class="built_in">i32</span>) -&gt; <span class="built_in">i32</span>&#123;</span><br><span class="line">	<span class="comment">//`f`是`fn`函数指针类型</span></span><br><span class="line">	f(arg) + f(arg)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> answer = do_twice(add_one, <span class="number">5</span>);</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;the anwser is: &#123;&#125;&quot;</span>, anwser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数指针类型实现了以上<strong>全部</strong><code>Fn</code>、<code>FnMut</code>、<code>FnOnce</code>三个
trait，所以总是可以在调用期望闭包作为参数的函数时传递函数
指针，因此倾向于使用泛型和闭包trait bound的函数，这样可以
同时使用闭包、函数指针作为参数。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list_of_numbers = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> list_of_Strings: <span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt; = list_of_numbers</span><br><span class="line">	.iter()</span><br><span class="line">	.map(|i| i.to_string())</span><br><span class="line">		<span class="comment">//闭包作为参数传递</span></span><br><span class="line">	.collect();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> list_of_strings: <span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt; = list_of_numbers</span><br><span class="line">	.iter()</span><br><span class="line">	.map(<span class="built_in">ToString</span>::to_string)</span><br><span class="line">		<span class="comment">//函数作为参数传递</span></span><br><span class="line">		<span class="comment">//使用了完全限定语法，因为存在多个`to_string`函数</span></span><br><span class="line">		<span class="comment">//标准库为所有实现了`Display`的类型实现了此trait</span></span><br><span class="line">	.collect();</span><br></pre></td></tr></table></figure>
<p>与不存在闭包的外部代码（如C语言，只有函数没有闭包）交互时，
只能使用函数作为参数，不能使用闭包。</p>
<h3 id="move关键字"><a href="#move关键字" class="headerlink" title="move关键字"></a><code>move</code>关键字</h3><p><code>move</code>关键字强制闭包获其捕获的环境变量的所有权，在将闭包
传递给新线程以便将数据移动到新线程时非常实用</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> x = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">	<span class="keyword">let</span> equal_to_x = <span class="keyword">move</span> |z| z == x;</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;can&#x27;t use x here: &#123;:?&#125;&quot;</span>, x);</span><br><span class="line">		<span class="comment">//此时`x`的所有权已经转移进闭包，不能在闭包外使用</span></span><br><span class="line">	<span class="keyword">let</span> y = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">	<span class="built_in">assert!</span>(equal_to_x(y));</span><br></pre></td></tr></table></figure>
<h3 id="返回闭包"><a href="#返回闭包" class="headerlink" title="返回闭包"></a>返回闭包</h3><p>闭包表现为trait，没有确定的类型、大小，无法直接返回，也不
允许使用函数指针<code>fn</code>作为返回值类型，需要使用trait对象返回
闭包</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">return_closure</span></span>() -&gt; <span class="built_in">Box</span>&lt;<span class="built_in">Fn</span>(<span class="built_in">i32</span>) -&gt; <span class="built_in">i32</span>&gt;&#123;</span><br><span class="line">	<span class="comment">//trait对象作为返回值</span></span><br><span class="line">	<span class="built_in">Box</span>::new(|x| x + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="迭代器Iterator"><a href="#迭代器Iterator" class="headerlink" title="迭代器Iterator"></a>迭代器Iterator</h2><p>迭代器负责遍历序列中的每一项和决定序列何时结束的逻辑。Rust
中迭代器时惰性的，直到调用方法”消费“迭代器之前都不会有效果</p>
<h3 id="Iteratortrait"><a href="#Iteratortrait" class="headerlink" title="Iteratortrait"></a><code>Iterator</code>trait</h3><p>迭代器都实现了标准库中<code>Iterator</code>trait</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Iterator</span></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">type</span> <span class="title">Item</span></span>;</span><br><span class="line">		<span class="comment">//定义`Iterator`的关联类型</span></span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">next</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; <span class="built_in">Option</span>&lt;Self::Item);</span><br><span class="line">		<span class="comment">//参数是`&amp;mut self`，要求迭代器是`mut`类型</span></span><br><span class="line">		<span class="comment">//`next`方法改变了迭代器中用来记录序列位置的状态</span></span><br><span class="line">	<span class="comment">//methods with default implementation elided</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="next方法"><a href="#next方法" class="headerlink" title="next方法"></a><code>next</code>方法</h3><p><code>next</code>是<code>Iterator</code>唯一要求被实现的方法，其返回迭代器中封装
在<code>Some</code>中的一项（<strong>消费</strong>迭代器中的一项），迭代器结束时，
返回<code>None</code>。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">iterator_demostration</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> v1 = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut</span> v_iter = v1.iter();</span><br><span class="line">		<span class="comment">//注意`v_iter`声明为`mut`</span></span><br><span class="line">		<span class="comment">//使用`for`循环时无需使`v1_iter`可变，`for`会获取其</span></span><br><span class="line">		<span class="comment">//所有权并在后台使其可变</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">assert_eq!</span>(v1_iter.next(), <span class="literal">Some</span>(&amp;<span class="number">1</span>));</span><br><span class="line">	<span class="built_in">assert_eq!</span>(v1_iter.next(), <span class="literal">Some</span>(&amp;<span class="number">2</span>));</span><br><span class="line">	<span class="built_in">assert_eq!</span>(v1_iter.next(), <span class="literal">Some</span>(&amp;<span class="number">3</span>));</span><br><span class="line">		<span class="comment">//真的很难理解，rust中&amp;integer是怎么比较的</span></span><br><span class="line">	<span class="built_in">assert_eq!</span>(v1_iter.nett(), <span class="literal">None</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="消费适配器Comsuming-Adaptors"><a href="#消费适配器Comsuming-Adaptors" class="headerlink" title="消费适配器Comsuming Adaptors"></a>消费适配器Comsuming Adaptors</h3><p><code>Iterator</code>trait中定义，调用<code>next</code>方法，消耗迭代器</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">iterator_sum</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> v1 = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">	<span class="keyword">let</span> v1_iter = v1.iter();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> total:<span class="built_in">i32</span> = v1_iter.sum();</span><br><span class="line">		<span class="comment">//`sum`获取迭代器所有权，`v1_iter`不能继续使用</span></span><br><span class="line">	<span class="built_in">assert_eq!</span>(total, <span class="number">6</span>);</span><br></pre></td></tr></table></figure>
<h3 id="迭代器适配器Iterator-Adaptors"><a href="#迭代器适配器Iterator-Adaptors" class="headerlink" title="迭代器适配器Iterator Adaptors"></a>迭代器适配器Iterator Adaptors</h3><p><code>Iterator</code>trait中定义，将当前迭代器变为其他迭代器，同样是
惰性的，必须调用消费适配器以便获取迭代适配器的结果</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v1:<span class="built_in">Vec</span>&lt;<span class="built_in">i32</span>&gt; = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">v1.iter().map(|x| x + <span class="number">1</span>);</span><br><span class="line">	<span class="comment">//这里因为没有调用消费适配器，其实没有做事</span></span><br><span class="line"><span class="keyword">let</span> v2:<span class="built_in">Vec</span>&lt;_&gt; =  v1.iter().map(|x| x + <span class="number">1</span>).collect();</span><br><span class="line"><span class="built_in">assert_eq!</span>(v2, <span class="built_in">vec!</span>[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Shoe</span></span>&#123;</span><br><span class="line">	size: <span class="built_in">u32</span>,</span><br><span class="line">	style: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">shoes_in_my_size</span></span>(shoes: <span class="built_in">Vec</span>&lt;Shoe&gt;, show_size: <span class="built_in">u32</span>) -&gt; <span class="built_in">Vec</span>&lt;Shoe&gt;&#123;</span><br><span class="line">	shoes.into_iter()</span><br><span class="line">			<span class="comment">//获取vector所有权的迭代器</span></span><br><span class="line">		.filter(|s| s.size == show_size)</span><br><span class="line">			<span class="comment">//这里使用闭包获取外部环境变量</span></span><br><span class="line">		.collect()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">filter_by_size</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> shoes = <span class="built_in">vec!</span>[</span><br><span class="line">		Shoe&#123;size: <span class="number">10</span>, style: <span class="built_in">String</span>::from(<span class="string">&quot;sneaker&quot;</span>)&#125;,</span><br><span class="line">		Shoe&#123;size: <span class="number">13</span>, style: <span class="built_in">String</span>::from(<span class="string">&quot;sandal&quot;</span>)&#125;,</span><br><span class="line">		Shoe&#123;size: <span class="number">10</span>, style: <span class="built_in">String</span>::from(<span class="string">&quot;boot&quot;</span>)&#125;,</span><br><span class="line">	];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> in_my_size = shoes_in_my_size(shoes, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">assert_eq!</span>(</span><br><span class="line">		in_my_size,</span><br><span class="line">		<span class="built_in">vec!</span>[</span><br><span class="line">			Shoe&#123;size: <span class="number">10</span>, style: <span class="built_in">String</span>::from(<span class="string">&quot;sneaker&quot;</span>)&#125;,</span><br><span class="line">			Shoe&#123;size: <span class="number">10</span>, style: <span class="built_in">String</span>::from(<span class="string">&quot;boot&quot;</span>)&#125;,</span><br><span class="line">		]</span><br><span class="line">	);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="实现Iterator"><a href="#实现Iterator" class="headerlink" title="实现Iterator"></a>实现<code>Iterator</code></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Counter</span></span>&#123;</span><br><span class="line">	count: <span class="built_in">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Counter&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; Counter&#123;</span><br><span class="line">		Counter&#123;count: <span class="number">0</span>&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="built_in">Iterator</span> <span class="keyword">for</span> Counter&#123;</span><br><span class="line">	<span class="class"><span class="keyword">type</span> <span class="title">Item</span></span> = <span class="built_in">u32</span>;</span><br><span class="line">		<span class="comment">//迭代器将返回`u32`值集合</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">next</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; <span class="built_in">Option</span>&lt;Self::Item&gt;&#123;</span><br><span class="line">		<span class="keyword">self</span>.count += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">self</span>.count &lt; <span class="number">6</span>&#123;</span><br><span class="line">			<span class="literal">Some</span>(<span class="keyword">self</span>.count)</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="literal">None</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">using_other_iterator_trait_methods</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> sum: <span class="built_in">u32</span> = Counter::new().zip(Counter::new().skip(<span class="number">1</span>))</span><br><span class="line">								.map(|(a, b)| a * b)</span><br><span class="line">								.filter(|x| x % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">								.sum();</span><br><span class="line">	<span class="built_in">assert_eq!</span>(<span class="number">18</span>, sum);</span><br></pre></td></tr></table></figure>
<h2 id="并发（并行）"><a href="#并发（并行）" class="headerlink" title="并发（并行）"></a>并发（并行）</h2><p>多线程可以改善性能，但是也会增加复杂性</p>
<ul>
<li>竞争状态Race Conditions：多个线程以不一致的顺序访问资源</li>
<li>死锁Dead Lock：线程互相等待资源释放，阻止继续运行</li>
<li>只会在特定情况出现、无法稳定重现的bug</li>
</ul>
<p>线程模型</p>
<ul>
<li><code>1:1</code>模型：一个OS线程对应一个语言线程，语言调用操作系统
API创建线程，性能较好</li>
<li><code>M:N</code>模型：语言有自己的线程实现，其提供的线程称为
<strong>绿色</strong>(green)线程，M个绿色线程对应N个OS线程，更好的
运行控制、更底的上下文切换成本</li>
</ul>
<p>Rust为了更小的运行时（这里表示二进制文件中语言自身提供的
代码）考虑，标准库中只提供了<code>1:1</code>线程模式实现。可以通过一些
crate扩展<code>M:N</code>线程模式。</p>
<h3 id="spawn创建新线程"><a href="#spawn创建新线程" class="headerlink" title="spawn创建新线程"></a><code>spawn</code>创建新线程</h3><p><code>std::thread::spawn</code>接受一个闭包作为参数，返回<code>JoinHandle</code>
类型的句柄。作为<code>spawn</code>参数的闭包和一般的闭包有些不同，
线程直接独立执行，所以此时闭包捕获外部环境变量不能按照默认
的获取不可变引用，因为此时捕获的变量值可能已经被丢弃，必须
使用<code>move</code>关键字获取所有权，而一般的闭包是顺序执行的，没有
特殊需要可以直接获取不可变引用，而能够保证值不被丢弃。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">use</span> std::time:Duration;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> handle = thread::spawn(|| &#123;</span><br><span class="line">		<span class="comment">//`thread::spawn`接受一个闭包作为参数，返回</span></span><br><span class="line">		<span class="comment">//`JoinHandle`类型的值（不是引用）</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span>..<span class="number">10</span>&#123;</span><br><span class="line">			<span class="built_in">println!</span>(<span class="string">&quot;number &#123;&#125; from spwaned thread!&quot;</span>, i);</span><br><span class="line">			thread::sleep(Duration::from_millis(<span class="number">1</span>));</span><br><span class="line">		&#125;</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span>..<span class="number">5</span>&#123;</span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;number&#123;&#125; from main thread!&quot;</span>, i);</span><br><span class="line">		thread::sleep(Duration::from_millis(<span class="number">1</span>));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	handle.join().wrap();</span><br><span class="line">		<span class="comment">//`JoinHandle.join()`将阻塞直到其对应的线程结束</span></span><br><span class="line">		<span class="comment">//如果调用`join`，spawn线程可能无法执行完毕</span></span><br><span class="line">		<span class="comment">//因为主线程执行完，整个进行结束</span></span><br><span class="line">		<span class="comment">//注意`join`调用的位置决定阻塞的位置</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> v = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span> , <span class="number">3</span>];</span><br><span class="line">	<span class="keyword">let</span> handle = thread::spawn(<span class="keyword">move</span> || &#123;</span><br><span class="line">		<span class="comment">//这里`move`关键字将捕获的外部环境中变量`v`所有权</span></span><br><span class="line">		<span class="comment">//移入spawn线程，否则无法正常编译</span></span><br><span class="line">		prinln!(<span class="string">&quot;here&#x27;s a vector: &#123;:?&#125;&quot;</span>, v);</span><br><span class="line">	&#125;);</span><br><span class="line">	handle.join().unwrap();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="消息传递"><a href="#消息传递" class="headerlink" title="消息传递"></a>消息传递</h3><p>Rust中实现消息传递并发的主要工具是通道（channel）</p>
<h4 id="mpsc-channel"><a href="#mpsc-channel" class="headerlink" title="mpsc::channel"></a><code>mpsc::channel</code></h4><p>mpsc：multiple producer single consumer，多个生产者，单个
消费者，即Rust标准库实现通道的方式允许多个产生值的发送端，但
只能有一个消费这些值的接收端。发送端或接收端任一被丢弃时，
意味着通道被关闭</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">use</span> std::sync:mpsc;</span><br><span class="line"><span class="keyword">use</span> std::time:Duration;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> (tx, rx) = mpsc::channel();</span><br><span class="line">		<span class="comment">//`tx`表示发送端，`rx`表示接收端</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> tx1 = mpsc::Sender::clone(&amp;tx);</span><br><span class="line">		<span class="comment">//clone发送端创建多个生产者</span></span><br><span class="line"></span><br><span class="line">	thread::spawn(<span class="keyword">move</span> || &#123;</span><br><span class="line">		<span class="keyword">let</span> vals = <span class="built_in">vec!</span>[</span><br><span class="line">			<span class="built_in">String</span>::from(<span class="string">&quot;hi&quot;</span>),</span><br><span class="line">			<span class="built_in">String</span>::from(<span class="string">&quot;from&quot;</span>),</span><br><span class="line">			<span class="built_in">String</span>::from(<span class="string">&quot;the&quot;</span>),</span><br><span class="line">			<span class="built_in">String</span>::from(<span class="string">&quot;thread&quot;</span>),</span><br><span class="line">		];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> val <span class="keyword">in</span> vals &#123;</span><br><span class="line">			tx1.send(val).unwrap();</span><br><span class="line">				<span class="comment">//`send`会获取参数所有权归接收者所有，避免</span></span><br><span class="line">				<span class="comment">//值被其他线程丢弃、修改导致意外结果</span></span><br><span class="line"></span><br><span class="line">				<span class="comment">//`send`返回`Result&lt;T, E&gt;`，如果接收端被丢弃</span></span><br><span class="line">				<span class="comment">//将没有发送值的目标，将返回`Err&lt;E&gt;`</span></span><br><span class="line">			thread::sleep(Duration::from_secs(<span class="number">1</span>));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	thread::spawn(<span class="keyword">move</span> || &#123;d</span><br><span class="line">		<span class="keyword">let</span> vals = <span class="built_in">vec!</span>[</span><br><span class="line">			<span class="built_in">String</span>::from(<span class="string">&quot;move&quot;</span>),</span><br><span class="line">			<span class="built_in">String</span>::from(<span class="string">&quot;messages&quot;</span>),</span><br><span class="line">			<span class="built_in">String</span>::from(<span class="string">&quot;for&quot;</span>),</span><br><span class="line">			<span class="built_in">String</span>::from(<span class="string">&quot;you&quot;</span>),</span><br><span class="line">		];</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> val <span class="keyword">in</span> vals&#123;</span><br><span class="line">			tx.send(val).unwrap();</span><br><span class="line">			thread::sleep(Duration::from_secs(<span class="number">1</span>));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> received = rx.recv().unwrap();</span><br><span class="line">		<span class="comment">//`recv`将阻塞直到接收到一个值，返回`Result&lt;T, E&gt;`</span></span><br><span class="line">		<span class="comment">//通道发送端关闭时`recv`将返回`Err&lt;E&gt;`表明不会有新值</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> received = rx.try_recv().unwrap();</span><br><span class="line">		<span class="comment">//`try_recv`不阻塞，立刻返回`Result&lt;T, E&gt;`，`Err&lt;E&gt;`</span></span><br><span class="line">		<span class="comment">//表示当前没有消息</span></span><br><span class="line">		<span class="comment">//可以再循环中多次调用`try_recv`，有消息进行处理，</span></span><br><span class="line">		<span class="comment">//否则进行其他工作直到下次调用`try_recv`</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> received <span class="keyword">in</span> rx&#123;</span><br><span class="line">		<span class="comment">//将接收端`rx`当作迭代器使用，返回接收到值</span></span><br><span class="line">		<span class="built_in">println!</span>(<span class="string">&quot;Got: &#123;&#125;&quot;</span>, received);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="共享状态"><a href="#共享状态" class="headerlink" title="共享状态"></a>共享状态</h3><p>（任何语言）通道都类似于单所有权，一旦值通过通道传送，将无法
再次使用，而共享内存类似于多所有权</p>
<h4 id="Mutex-lt-T-gt"><a href="#Mutex-lt-T-gt" class="headerlink" title="Mutex&lt;T&gt;"></a><code>Mutex&lt;T&gt;</code></h4><p>互斥器mutex：mutual exclusion，任意时刻只允许一个线程访问
数据</p>
<ul>
<li>线程在访问数据之前需要获取互斥器的锁lock，lock是作为
互斥器一部分的数据结构，记录数据所有者的排他访问权</li>
<li>处理完互斥器保护的数据之后，需要解锁，这样才能允许其他
线程获取数据</li>
</ul>
<p><code>Mutex&lt;T&gt;</code>类似于线程安全版本的<code>RefCell&lt;T&gt;</code>（<code>cell</code>族），
提供了内部可变性，<code>Mutex&lt;T&gt;</code>有可能造成死锁，如一个操作需要
两个锁，两个线程各持一个互相等待。</p>
<p><code>Arc&lt;T&gt;</code>原子引用计数atomically reference counted，则是
线程安全版本的<code>Rc&lt;T&gt;</code>，而线程安全带有性能惩罚，如非必要，
使用单线程版本<code>Rc&lt;T&gt;</code>性能更好。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::&#123;Mutex, Arc&#125;;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>()&#123;</span><br><span class="line">	<span class="keyword">let</span> counter = Arc::new(Mutex::new(<span class="number">0</span>));</span><br><span class="line">		<span class="comment">//因为需要在多个线程内引用，所以需要使用多所有权</span></span><br><span class="line">		<span class="comment">//数据结构，而`Rc`不是线程安全的，需要使用线程安全</span></span><br><span class="line">		<span class="comment">//`Arc`</span></span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut</span> handles = <span class="built_in">vec!</span>[];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span>&#123;</span><br><span class="line">		<span class="keyword">let</span> counter = Arc::clone(&amp;counter);</span><br><span class="line">		<span class="keyword">let</span> handle = thread::spawn(<span class="keyword">move</span> || &#123;</span><br><span class="line">			<span class="keyword">let</span> <span class="keyword">mut</span> num = counter.lock().unwrap();</span><br><span class="line">			<span class="comment">//`lock`返回一个`MutexGuard`类型的智能指针，</span></span><br><span class="line">			<span class="comment">//实现了`Deref`指向其内部数据，`Drop`当</span></span><br><span class="line">			<span class="comment">//`MutexGuard`离开作用域时自动释放锁</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">//只有`lock`才能获取值，类型系统保证访问数据之前</span></span><br><span class="line">			<span class="comment">//获取锁；而锁的释放自动发生，保证锁一定会释放</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">//这里发生了一次强制解引用多态，将`counter`</span></span><br><span class="line">			<span class="comment">//解引用为`Mutex&lt;T&gt;`类型</span></span><br><span class="line">			*num += <span class="number">1</span>;</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		handles.push(handle);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> handle <span class="keyword">in</span> handles&#123;</span><br><span class="line">		handle.join().unwrap();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>, counter.lock.unwrap());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Synctrait、Sendtrait"><a href="#Synctrait、Sendtrait" class="headerlink" title="Synctrait、Sendtrait"></a><code>Sync</code>trait、<code>Send</code>trait</h4><p>Rust的并发模型大部分属于标准库的实现，但是
<code>std::marker::Send</code>和<code>std::marker::Sync</code>时内嵌于语言的</p>
<ul>
<li><code>Send</code>：表明类型所有权可以在线程间传递，几乎所有类型都是
<code>Send</code>的，<code>Rc&lt;T&gt;</code>是其中的一个例外，因为<code>Rc&lt;T&gt;</code>clone之后
在两个线程间可能同时更新引用计数，trait bound保证无法将
不安全的<code>Rc&lt;T&gt;</code>在线程间传递。任何全部由<code>Send</code>组成的类型
会自动标记为<code>Send</code></li>
<li><code>Sync</code>：表明类型可以安全的在多线程中拥有其值的引用，对于
任何类型，如果<code>&amp;T</code>是<code>Send</code>的，那么<code>T</code>就是<code>Sync</code>的。
<code>Cell&lt;T&gt;</code>系列不是<code>Sync</code>的，<code>Mutex&lt;T&gt;</code>是。基本类型是<code>Sync</code>
的，全部由<code>Sync</code>组成的类型也是<code>Sync</code>的</li>
</ul>
<p><code>Send</code>和<code>Sync</code>是标记trait，不需要实现任何方法，全部是<code>Send</code>
或<code>Sync</code>组成的类型就是<code>Send</code>或<code>Sync</code>，一般不需要手动实现
它们，而且手动实现这些标记trait涉及编写不安全代码</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:15.000Z" title="3/21/2019, 5:27:15 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-04T09:07:32.000Z" title="8/4/2021, 5:07:32 PM">2021-08-04</time></span><span class="level-item"><a class="link-muted" href="/categories/RLang/">RLang</a></span><span class="level-item">21 minutes read (About 3158 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/RLang/r_grammer.html">R语法</a></h1><div class="content"><h2 id="生存"><a href="#生存" class="headerlink" title="生存"></a>生存</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><ul>
<li>R语言的注释和其他脚本语言类似，使用<code>#</code>注释行，但是R没有
多行注释语法</li>
<li>可以使用<code>if(FALSE)</code>语句进行“注释”<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="literal">FALSE</span>) &#123;</span><br><span class="line">	<span class="string">&quot;comments&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="工作路径"><a href="#工作路径" class="headerlink" title="工作路径"></a>工作路径</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getwd()</span><br><span class="line">	<span class="comment"># 返回当前工作路径，默认`~/Documents`</span></span><br><span class="line">setwd(/path/to/dir)</span><br><span class="line">	<span class="comment"># 设置当前工作路径</span></span><br></pre></td></tr></table></figure>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><ul>
<li>R中有效的变量名称由字母、数字、点、下划线组成，变量名以
字母、后不跟数字的点开头</li>
<li>R中变量为动态类型，可多次更改变量数据类型</li>
<li>变量无法被声明，在首次赋值时生成</li>
</ul>
<h4 id="赋值"><a href="#赋值" class="headerlink" title="赋值"></a>赋值</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var.1 = <span class="built_in">c</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">	<span class="comment"># 不常用</span></span><br><span class="line">var.2 &lt;- <span class="built_in">c</span>(<span class="string">&quot;learn&quot;</span>, <span class="string">&quot;R&quot;</span>)</span><br><span class="line">	<span class="comment"># 常用方法</span></span><br><span class="line">var <span class="number">.3</span> &lt;&lt;- <span class="built_in">c</span>(<span class="number">3</span>, <span class="number">1</span>, <span class="literal">TRUE</span>, <span class="number">2</span>+<span class="number">3i</span>)</span><br><span class="line">	<span class="comment"># 特殊赋值符，可以扩展变作用域为“整个”工作空间</span></span><br><span class="line">	</span><br><span class="line"><span class="built_in">c</span>(<span class="literal">TRUE</span>, <span class="number">1</span>) -&gt; var.4</span><br><span class="line">	<span class="comment"># 右赋值符</span></span><br><span class="line"><span class="built_in">c</span>(<span class="literal">TRUE</span>, <span class="number">2</span>+<span class="number">3i</span>) -&gt;&gt; var.5</span><br></pre></td></tr></table></figure>
<h4 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h4><p><code>ls</code>函数可以搜索当前工作空间中所有可用变量</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls(</span><br><span class="line">	pattern = <span class="string">&quot;var_pattern&quot;</span>,</span><br><span class="line">	all.name = <span class="literal">FALSE</span>/<span class="literal">TRUE</span></span><br><span class="line">)</span><br><span class="line">	<span class="comment"># `pattern`：使用模式匹配变量名</span></span><br><span class="line">	<span class="comment"># `all.name`：开头变量默认隐藏，可通过设置参数展示</span></span><br></pre></td></tr></table></figure>
<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><p><code>rm</code>函数可以删除变量</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rm(var.3)</span><br><span class="line"></span><br><span class="line">rm(<span class="built_in">list</span> = ls())</span><br><span class="line">	<span class="comment"># 删除所有变量</span></span><br></pre></td></tr></table></figure>
<h3 id="数据导入"><a href="#数据导入" class="headerlink" title="数据导入"></a>数据导入</h3><h4 id="edit"><a href="#edit" class="headerlink" title="edit"></a><code>edit</code></h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mydata &lt;- data.frame(</span><br><span class="line">	age = numeric(<span class="number">0</span>),</span><br><span class="line">	gender = character(<span class="number">0</span>),</span><br><span class="line">	weight = numeric(<span class="number">0</span>)</span><br><span class="line">)</span><br><span class="line">	<span class="comment"># `numeric(0)`类似的赋值语句创建指定模式但不含数据变量</span></span><br><span class="line">mydata &lt;- edit(mydata)</span><br><span class="line">	<span class="comment"># `edit`会调用允许手动输入数据的文本编辑其</span></span><br><span class="line">	<span class="comment"># `edit`在副本上操作，需要重新给变量</span></span><br><span class="line">fix(mydata)</span><br><span class="line">	<span class="comment"># `mydata &lt;- edit(mydata)`等价写法，直接在原对象上操作</span></span><br></pre></td></tr></table></figure>
<h4 id="read-table"><a href="#read-table" class="headerlink" title="read.table"></a><code>read.table</code></h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DF &lt;- read.table(</span><br><span class="line">	file(/path/to/file),</span><br><span class="line">	header = <span class="literal">TRUE</span>/<span class="literal">FALSE</span>,</span><br><span class="line">	sep = <span class="string">&quot; \t\n\r&quot;</span>/<span class="string">&quot;,&quot;</span>,</span><br><span class="line">	row.names = <span class="built_in">c</span>(),</span><br><span class="line">	col.names = <span class="built_in">c</span>(<span class="string">&quot;V1&quot;</span>, <span class="string">&quot;V2&quot;</span>, ...)/<span class="built_in">c</span>(str),</span><br><span class="line">	na.strings = <span class="literal">NULL</span>/<span class="built_in">c</span>(str)),</span><br><span class="line">	colClasses = <span class="literal">NULL</span>/<span class="built_in">c</span>(<span class="string">&quot;numeric&quot;</span>, <span class="string">&quot;character&quot;</span>, <span class="string">&quot;NULL&quot;</span>),</span><br><span class="line">	<span class="built_in">quote</span> = <span class="string">&quot;&#x27;&quot;</span><span class="string">&quot;/str,</span></span><br><span class="line"><span class="string">	skip = 0/int,</span></span><br><span class="line"><span class="string">	stringAsFactors = TRUE/FALSE,</span></span><br><span class="line"><span class="string">	test = str</span></span><br><span class="line"><span class="string">)</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>说明：从<strong>带分隔符</strong>的文本文件中导入数据</p>
</li>
<li><p>参数</p>
<ul>
<li><code>header</code>：第一行是否包含变量名</li>
<li><code>sep</code>：分隔符，默认数个空格、tab、回车、换行</li>
<li><code>row.names</code>：指定行标记符</li>
<li><code>col.names</code>：指定DF对象列名</li>
<li><code>na.strings</code>：表示缺失值的字符串向量，其包含字符串
读取时转为NA</li>
<li><code>colClasses</code>：设置DF对象每列数据模式<ul>
<li>“NULL”表示跳过</li>
<li>长度小于列数时开始循环</li>
<li>读取大型文本可以提高速度</li>
</ul>
</li>
<li><code>quote</code>：字符串划定界限，默认<code>&quot;&#39;</code></li>
<li><code>StringAsFactor</code>：标记字符向量是否转换为factor<ul>
<li><code>colClasses</code>优先级更高</li>
<li>设为FALSE可以提升读取速度</li>
</ul>
</li>
<li><code>text</code>：读取、处理的字符串，而不是<code>file</code></li>
</ul>
</li>
</ul>
<h3 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">print()</span><br><span class="line">	<span class="comment"># 浏览对象取值</span></span><br><span class="line">str()</span><br><span class="line">	<span class="comment"># 查看对象结构</span></span><br><span class="line">ls()</span><br><span class="line">	<span class="comment"># 管理对象</span></span><br><span class="line">remove()</span><br><span class="line">rm()</span><br><span class="line">	<span class="comment"># 删除指定对象</span></span><br></pre></td></tr></table></figure>
<h2 id="数据模式（类型）"><a href="#数据模式（类型）" class="headerlink" title="数据模式（类型）"></a>数据模式（类型）</h2><ul>
<li>数据模式是指R存储数据的方式</li>
<li>即从存储角度对R数据对象划分</li>
<li><code>class</code>函数就是返回数据模式（类型）</li>
</ul>
<h3 id="Logical"><a href="#Logical" class="headerlink" title="Logical"></a>Logical</h3><p>只需要1byte存储</p>
<ul>
<li><code>TRUE/T</code></li>
<li><code>FALSE/F</code></li>
</ul>
<h3 id="Integer"><a href="#Integer" class="headerlink" title="Integer"></a>Integer</h3><p>占用2-4byte</p>
<ul>
<li><code>2L</code>、<code>0L</code></li>
</ul>
<h3 id="Numeric"><a href="#Numeric" class="headerlink" title="Numeric"></a>Numeric</h3><p>可进一步分</p>
<ul>
<li><code>float</code>占用4byte</li>
<li><code>double</code>占用8byte</li>
</ul>
<p>R中数值型数据默认为<code>double</code></p>
<ul>
<li><code>12.3</code>、<code>4</code></li>
</ul>
<h3 id="Complex"><a href="#Complex" class="headerlink" title="Complex"></a>Complex</h3><ul>
<li><code>comlplex</code>：<code>3+2i</code></li>
</ul>
<h3 id="Character"><a href="#Character" class="headerlink" title="Character"></a>Character</h3><p>R中<code>&#39;</code>、<code>&quot;</code>对中的任何值视为字符串</p>
<ul>
<li><code>&#39;</code>、<code>&quot;</code>必须在开头、结尾成对存在</li>
<li><code>&#39;</code>、<code>&quot;</code>结尾的字符串中，只能插入对方</li>
</ul>
<h4 id="paste"><a href="#paste" class="headerlink" title="paste"></a><code>paste</code></h4><p>连接多个字符串</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Chars = paste(</span><br><span class="line">	...,</span><br><span class="line">		<span class="comment"># 要组合的任意数量变量</span></span><br><span class="line">	sep = <span class="string">&quot; &quot;</span>,</span><br><span class="line">		<span class="comment"># 分隔符</span></span><br><span class="line">	collapse = <span class="literal">NULL</span>)</span><br><span class="line">		<span class="comment"># 消除两个字符串之间空格</span></span><br></pre></td></tr></table></figure>
<h4 id="format"><a href="#format" class="headerlink" title="format"></a><code>format</code></h4><p>将数字、字符串格式为特定样式</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Chars = format(</span><br><span class="line">	x([num, chars],</span><br><span class="line">		<span class="comment"># 向量</span></span><br><span class="line">	digits(int),</span><br><span class="line">		<span class="comment"># 显示的总位数</span></span><br><span class="line">	nsmall(int),</span><br><span class="line">		<span class="comment"># 小数点右边最小位数</span></span><br><span class="line">	scientific=<span class="literal">FALSE</span>/<span class="literal">TRUE</span>,</span><br><span class="line">		<span class="comment"># `TRUE`则显示科学计数法</span></span><br><span class="line">	width(int),</span><br><span class="line">		<span class="comment"># 在开始处填充空白来显示的最小宽度</span></span><br><span class="line">	justify = <span class="built_in">c</span>(<span class="string">&quot;left&quot;</span>, <span class="string">&quot;right&quot;</span>, <span class="string">&quot;centre&quot;</span>, <span class="string">&quot;none&quot;</span>))</span><br><span class="line">		<span class="comment"># 字符串显示位置</span></span><br></pre></td></tr></table></figure>
<h4 id="nchar"><a href="#nchar" class="headerlink" title="nchar"></a><code>nchar</code></h4><p>计算包括空格在内的字符串长度</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int = nchar(</span><br><span class="line">	x(chars)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="toupper、tolower"><a href="#toupper、tolower" class="headerlink" title="toupper、tolower"></a><code>toupper</code>、<code>tolower</code></h4><p>改变字符串大小写</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chars = toupper(</span><br><span class="line">	x(chars)</span><br><span class="line">)</span><br><span class="line">chars = tolower(</span><br><span class="line">	x(chars)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="substring"><a href="#substring" class="headerlink" title="substring"></a><code>substring</code></h4><p>获取字符串子串</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chars = substring(</span><br><span class="line">	x(chars),</span><br><span class="line">	first(int),</span><br><span class="line">	last(int)</span><br><span class="line">)</span><br><span class="line">	<span class="comment"># 包括头尾</span></span><br></pre></td></tr></table></figure>
<ul>
<li>R对象是指可以赋值给变量的任何事物，包括常量、数据结构、
函数</li>
<li>对象都拥有某种模式，描述对象如何存储</li>
<li>对象拥有某个“类”，向<code>print</code>这样的泛型函数表明如何处理
此对象</li>
</ul>
<h3 id="Raw"><a href="#Raw" class="headerlink" title="Raw"></a>Raw</h3><ul>
<li><code>raw</code>：<code>v &lt;- charToRaw(&quot;Hello&quot;)</code>（byte类型）</li>
</ul>
<h2 id="结构角度划分R对象"><a href="#结构角度划分R对象" class="headerlink" title="结构角度划分R对象"></a>结构角度划分R对象</h2><h3 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h3><p>用于存储数值型、字符型、逻辑型数据的一维<strong>数组</strong></p>
<ul>
<li>单个向量中的出数据必须拥有相同的类型、模式（数值型、字符
型、逻辑型）</li>
<li>R中没有标量，标量以单元素向量形式出现</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apple &lt;- <span class="built_in">c</span>(<span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;yellow&quot;</span>) </span><br><span class="line">apple[<span class="number">1</span>]</span><br><span class="line">	<span class="comment"># 访问单个元素，从1开始</span></span><br><span class="line">apple[<span class="number">1</span>: <span class="number">3</span>]</span><br><span class="line">	<span class="comment"># 切片，闭区间</span></span><br><span class="line">apple[<span class="number">7</span>] = <span class="string">&quot;seven&quot;</span></span><br><span class="line">	<span class="comment"># 将值赋给某个向量、矩阵、数组或列表中一个不存在的元素时</span></span><br><span class="line">		<span class="comment"># R将自动扩展其以容纳新值，中间部分设为`NA`</span></span><br><span class="line"></span><br><span class="line">is.vector(apple)</span><br></pre></td></tr></table></figure>
<h4 id="创建向量"><a href="#创建向量" class="headerlink" title="创建向量"></a>创建向量</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rep</span>(start: end, each=repeat_time)</span><br><span class="line">	<span class="comment"># 元素重复</span></span><br><span class="line"><span class="built_in">rep</span>(start: end, times=repeat_time)</span><br><span class="line">	<span class="comment"># 向量重复</span></span><br><span class="line"></span><br><span class="line">seq(from=start, to=end, by=step)</span><br><span class="line">	<span class="comment"># 指定步长</span></span><br><span class="line">seq(from=start, to=end, <span class="built_in">length</span>=len)</span><br><span class="line">	<span class="comment"># 指定个数</span></span><br><span class="line"></span><br><span class="line">vector(<span class="built_in">length</span>=len)</span><br><span class="line">	<span class="comment"># 元素为`FALSE`</span></span><br></pre></td></tr></table></figure>
<h4 id="访问向量元素"><a href="#访问向量元素" class="headerlink" title="访问向量元素"></a>访问向量元素</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a[<span class="number">1</span>]</span><br><span class="line">a[<span class="number">1</span>:<span class="number">2</span>]</span><br><span class="line">a[<span class="built_in">c</span>(<span class="number">1</span>,<span class="number">3</span>)]</span><br><span class="line">a[<span class="built_in">c</span>(<span class="built_in">T</span>, <span class="built_in">F</span>, <span class="built_in">T</span>)]</span><br><span class="line"></span><br><span class="line">a[-<span class="built_in">c</span>(<span class="number">1</span>:<span class="number">2</span>)]</span><br><span class="line">	<span class="comment"># 负号不能用于逻辑向量</span></span><br></pre></td></tr></table></figure>
<h3 id="Matrix"><a href="#Matrix" class="headerlink" title="Matrix"></a>Matrix</h3><p>二维数组：组织具有相同存储类型的一组变量</p>
<ul>
<li>每个元素都拥有相同的模式（数值型、字符型、逻辑型）</li>
</ul>
<h4 id="创建矩阵"><a href="#创建矩阵" class="headerlink" title="创建矩阵"></a>创建矩阵</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mtx &lt;- matrix(</span><br><span class="line">	vector,</span><br><span class="line">	nrow(int)</span><br><span class="line">	ncol(int),</span><br><span class="line">	byrow = <span class="literal">FALSE</span>/<span class="literal">TRUE</span>,</span><br><span class="line">	<span class="built_in">dimnames</span> = <span class="built_in">list</span>(</span><br><span class="line">		<span class="built_in">c</span>(row_names),</span><br><span class="line">		<span class="built_in">c</span>(col_names)</span><br><span class="line">	)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">is.matrix</span>()</span><br><span class="line"></span><br><span class="line">cbind()</span><br><span class="line">	<span class="comment"># 将多个已有向量（列）合并为矩阵</span></span><br></pre></td></tr></table></figure>
<h4 id="矩阵信息"><a href="#矩阵信息" class="headerlink" title="矩阵信息"></a>矩阵信息</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dim</span>(mtx)</span><br><span class="line">	<span class="comment"># 显示矩阵行、列</span></span><br><span class="line">colnames(mtx)</span><br><span class="line">colnames(mtx[, col_start: col_end])</span><br><span class="line">rownames(mtx)</span><br><span class="line">ronnames(mtx[row_start: row_end, ])</span><br></pre></td></tr></table></figure>
<h4 id="访问矩阵元素"><a href="#访问矩阵元素" class="headerlink" title="访问矩阵元素"></a>访问矩阵元素</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><p>类似于矩阵，但是维度可以大于2</p>
<ul>
<li>其中元素也只能拥有一种模式</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr &lt;- array(</span><br><span class="line">	vector,</span><br><span class="line">	dimensions(<span class="built_in">c</span>(int)),</span><br><span class="line">	<span class="built_in">dimnames</span> = <span class="built_in">c</span>(dim_names)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="Data-Frame"><a href="#Data-Frame" class="headerlink" title="Data.Frame"></a>Data.Frame</h3><p>数据帧是表、二维数组类似结构</p>
<ul>
<li>不同的列可以包含不同的模式</li>
<li>每列包含一个变量的值，每行包含来自每列的一组值</li>
<li>数据帧的数据可是数字、因子、字符串类型</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">df &lt;- data.frame(</span><br><span class="line">	col1(<span class="built_in">c</span>()),</span><br><span class="line">	col2(<span class="built_in">c</span>()),</span><br><span class="line">	...,</span><br><span class="line">	row.names = coln</span><br><span class="line">)</span><br><span class="line">	<span class="comment"># `row.names`：指定实例标识符，即index</span></span><br><span class="line"></span><br><span class="line">emp.data &lt;- data.frame(</span><br><span class="line">	emp_id = <span class="built_in">c</span>(<span class="number">1</span>:<span class="number">5</span>),</span><br><span class="line">	emp_name = <span class="built_in">c</span>(<span class="string">&quot;Rick&quot;</span>,<span class="string">&quot;Dan&quot;</span>,<span class="string">&quot;Michelle&quot;</span>,<span class="string">&quot;Ryan&quot;</span>,<span class="string">&quot;Gary&quot;</span>),</span><br><span class="line">	salary = <span class="built_in">c</span>(<span class="number">623.3</span>,<span class="number">515.2</span>,<span class="number">611.0</span>,<span class="number">729.0</span>,<span class="number">843.25</span>),</span><br><span class="line">	start_date = as.Date(<span class="built_in">c</span>(<span class="string">&quot;2017-01-01&quot;</span>, <span class="string">&quot;2017-09-23&quot;</span>,</span><br><span class="line">		<span class="string">&quot;2017-11-15&quot;</span>, <span class="string">&quot;2017-05-11&quot;</span>, <span class="string">&quot;2018-03-27&quot;</span>)),</span><br><span class="line">	stringsAsFactors = <span class="literal">FALSE</span></span><br><span class="line">)</span><br><span class="line">	<span class="comment"># 创建DF</span></span><br></pre></td></tr></table></figure>
<h4 id="统计性质"><a href="#统计性质" class="headerlink" title="统计性质"></a>统计性质</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">str(emp.data)</span><br><span class="line">	<span class="comment"># 可以获得DF结构</span></span><br><span class="line"></span><br><span class="line">summary(emp.data)</span><br><span class="line">	<span class="comment"># 获得DF的统计摘要、性质</span></span><br></pre></td></tr></table></figure>
<h4 id="筛、删、减"><a href="#筛、删、减" class="headerlink" title="筛、删、减"></a>筛、删、减</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">emp.data.cols &lt;- data.frame(</span><br><span class="line">	emp.data$emp_name,</span><br><span class="line">	emp.data$salary)</span><br><span class="line">	# 列名称获取DF中特定列</span><br><span class="line"></span><br><span class="line">emp.data.rows &lt;- emp.data([1:2, ]</span><br><span class="line">	# 行切片获取特定行</span><br><span class="line"></span><br><span class="line">emp.data.rows_2 &lt;- emp.data[c(3, 5), c(2, 4)]</span><br><span class="line">	# 行、列list获取特定行、列</span><br><span class="line"></span><br><span class="line">emp.data$dept &lt;- c(&quot;IT&quot;, &quot;Operations&quot;, &quot;IT&quot;, &quot;HR&quot;, &quot;Finance&quot;)</span><br><span class="line">	# 新列名添加新列</span><br><span class="line"></span><br><span class="line">emp.newdata &lt;- data.frame(</span><br><span class="line">	emp_id = c(6: 8),</span><br><span class="line">	emp_name = c(&quot;Rasmi&quot;,&quot;Pranab&quot;,&quot;Tusar&quot;),</span><br><span class="line">	salary = c(578.0,722.5,632.8), </span><br><span class="line">	start_date = as.Date(c(&quot;2013-05-21&quot;,&quot;2013-07-30&quot;,&quot;2014-06-17&quot;)),</span><br><span class="line">	dept = c(&quot;IT&quot;,&quot;Operations&quot;,&quot;Fianance&quot;),</span><br><span class="line">	stringsAsFactors = FALSE</span><br><span class="line">)</span><br><span class="line">emp.finaldata &lt;- rbind(emp.data, emp.newdata)</span><br><span class="line">	# `rbind`将新DF同原DFconcat，达到添加新行</span><br></pre></td></tr></table></figure>
<h4 id="拼、接"><a href="#拼、接" class="headerlink" title="拼、接"></a>拼、接</h4><h5 id="rbind"><a href="#rbind" class="headerlink" title="rbind"></a><code>rbind</code></h5><p>结合两个DF对象行</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">city &lt;- <span class="built_in">c</span>(<span class="string">&quot;Tampa&quot;</span>, <span class="string">&quot;Seattle&quot;</span>, <span class="string">&quot;Hartford&quot;</span>, <span class="string">&quot;Denver&quot;</span>)</span><br><span class="line">state &lt;- <span class="built_in">c</span>(<span class="string">&quot;FL&quot;</span>, <span class="string">&quot;WA&quot;</span>, <span class="string">&quot;CT&quot;</span>, <span class="string">&quot;CO&quot;</span>)</span><br><span class="line">zipcode &lt;- <span class="built_in">c</span>(<span class="number">33602</span>, <span class="number">98104</span>, <span class="number">06161</span>, <span class="number">80294</span>)</span><br><span class="line"></span><br><span class="line">address &lt;- cbind(city, state, zipcode)</span><br><span class="line">	<span class="comment"># `cbind`连接多个向量创建DF</span></span><br><span class="line"></span><br><span class="line">new.address &lt;- data.frame(</span><br><span class="line">	city = <span class="built_in">c</span>(<span class="string">&quot;Lowry&quot;</span>, <span class="string">&quot;Charlotte&quot;</span>),</span><br><span class="line">	state = <span class="built_in">c</span>(<span class="string">&quot;CO&quot;</span>, <span class="string">&quot;FL&quot;</span>),</span><br><span class="line">	zipcode = C(<span class="string">&quot;80230&quot;</span>, <span class="string">&quot;33949&quot;</span>),</span><br><span class="line">	stringAsFactors = <span class="literal">FALSE</span></span><br><span class="line">)</span><br><span class="line">	<span class="comment"># 使用`data.fram`创建DF</span></span><br><span class="line"></span><br><span class="line">all.address &lt;- rbind(</span><br><span class="line">	address,</span><br><span class="line">	new.address</span><br><span class="line">)</span><br><span class="line">	<span class="comment"># `rbind`结合两个DF的行</span></span><br></pre></td></tr></table></figure>
<h5 id="merge"><a href="#merge" class="headerlink" title="merge"></a><code>merge</code></h5><p>根据两DF列进行merge</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lirary(MASS)</span><br><span class="line">	<span class="comment"># 加载数据集</span></span><br><span class="line"></span><br><span class="line">merged.Pima &lt;- merge(</span><br><span class="line">	x = Pima.te,</span><br><span class="line">	y = Pima.tr,</span><br><span class="line">	by.x = <span class="built_in">c</span>(<span class="string">&quot;bp&quot;</span>, <span class="string">&quot;bmi&quot;</span>),</span><br><span class="line">	by.y = <span class="built_in">c</span>(<span class="string">&quot;bp&quot;</span>, <span class="string">&quot;bmi&quot;</span>)</span><br><span class="line">)</span><br><span class="line">	<span class="comment"># 根据DF某（些）列merge</span></span><br></pre></td></tr></table></figure>
<h5 id="melt、cast"><a href="#melt、cast" class="headerlink" title="melt、cast"></a><code>melt</code>、<code>cast</code></h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">library(MASS)</span><br><span class="line">library(reshape2)</span><br><span class="line">melton.ships &lt;- melt(</span><br><span class="line">	ships,</span><br><span class="line">	id = <span class="built_in">c</span>(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;year&quot;</span>)</span><br><span class="line">)</span><br><span class="line">	<span class="comment"># `melt`将剩余列转换为`variable`、`value`标识</span></span><br><span class="line"></span><br><span class="line">recasted.ship &lt;- cast(</span><br><span class="line">	molten.ship,</span><br><span class="line">	type+year~variable,<span class="built_in">sum</span></span><br><span class="line">)</span><br><span class="line">	<span class="comment"># 和`melt`相反，以某些列为“轴”合并</span></span><br></pre></td></tr></table></figure>
<h4 id="绑定"><a href="#绑定" class="headerlink" title="绑定"></a>绑定</h4><h5 id="attach、detach"><a href="#attach、detach" class="headerlink" title="attach、detach"></a><code>attach</code>、<code>detach</code></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">attach(emp.data)</span><br><span class="line">	# `attach`可以将数据框加入R的搜索路径</span><br><span class="line">	# 之后R遇到变量名之后，将检查搜索路径的数据框</span><br><span class="line">	# 注意，如果之前环境中已经有df对象列同名变量，那么原始</span><br><span class="line">		# 对象优先，不会被覆盖</span><br><span class="line"></span><br><span class="line">	emp.data.cols.copy &lt;- data.frame(</span><br><span class="line">		emp_name,</span><br><span class="line">		salary</span><br><span class="line">	)</span><br><span class="line">		# 否则需要之前一样使用`$`</span><br><span class="line">detach(emp.data)</span><br><span class="line">	# 将数据框从搜索路径移除</span><br></pre></td></tr></table></figure>
<h5 id="with"><a href="#with" class="headerlink" title="with"></a><code>with</code></h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span>(emp.data, &#123;</span><br><span class="line">	emp.data.cols.copy &lt;&lt;- data.frame(</span><br><span class="line">		emp_name,</span><br><span class="line">		salary</span><br><span class="line">	)</span><br><span class="line">&#125;)</span><br><span class="line">	<span class="comment"># `&#123;&#125;`中的语句都针对`emp.data`执行，如果只有一条语句，</span></span><br><span class="line">		<span class="comment"># 花括号可以省略</span></span><br><span class="line">	<span class="comment"># `with`语句内`&lt;-`赋值仅在其作用于内生效，需要使用`&lt;&lt;-`</span></span><br><span class="line">		<span class="comment"># 特殊赋值符保存至“全局”变量中</span></span><br></pre></td></tr></table></figure>
<h3 id="Factor"><a href="#Factor" class="headerlink" title="Factor"></a>Factor</h3><p>分类变量、有序变量在R中称为因子，其决定了数据的分析方式、
如何进行视觉呈现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fctr &lt;- factor(</span><br><span class="line">	vector(c(factors)),</span><br><span class="line">	ordered = FALSE/TRUE,</span><br><span class="line">	levels = c(ordered_unique_factors),</span><br><span class="line">	labels = c(factor_labels)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># `ordered`：默认不是有序变量</span></span><br><span class="line">	<span class="comment"># `levels`：指定factors的“排序”，确定映射的整数值，</span></span><br><span class="line">		<span class="comment"># 对于分类变量也可以设置</span></span><br><span class="line">		<span class="comment"># 没有在`levels`中显式指定的factor视为缺失</span></span><br><span class="line">	<span class="comment"># `labels`：设置各factor labels，输出则按照labels输出</span></span><br><span class="line">		<span class="comment"># 注意`labels`顺序必须和`levels`一致</span></span><br><span class="line">		<span class="comment"># 对数值型factor尤其有用</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>factor</code>以整形向量的形式存储类别值<ul>
<li>整数取值范围为<code>1~k</code>，<code>k</code>为定性（分类、有序）变量中
唯一值个数</li>
</ul>
</li>
<li>同时一个由字符串（原始值）组成的内部向量将映射到这些整数<ul>
<li>分类变量：字符串映射的整数值由字母序决定</li>
<li>有序变量：按字母序映射可能与逻辑顺序不一致，可以使用
参数<code>levels</code>指定顺序</li>
</ul>
</li>
</ul>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>一些对象、成分的有序集合</p>
<ul>
<li>允许整合若干（可能无关）的对象到单个对象下</li>
<li>很多R函数结果运行结果以列表形式返回，由调用者决定使用
其中何种成分</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">l &lt;- <span class="built_in">list</span>(</span><br><span class="line">	[name1 =]object1,</span><br><span class="line">	[name2 =]object2,</span><br><span class="line">	...</span><br><span class="line">)</span><br><span class="line">	<span class="comment"># 可以给列表中的对象命名</span></span><br><span class="line">	<span class="comment"># 命名成分`l$name1`也可以正常运行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">list1 &lt;- <span class="built_in">list</span>(<span class="built_in">c</span>(<span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>), <span class="number">21</span>, <span class="number">3</span>, <span class="built_in">sin</span>)</span><br><span class="line">print(list1)</span><br><span class="line">print(<span class="built_in">class</span>(list1))</span><br></pre></td></tr></table></figure>
<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><h3 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h3><p>算术操作符作用与向量的每个元素</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">v &lt;- <span class="built_in">c</span>(<span class="number">2</span>, <span class="number">5.5</span>, <span class="number">6</span>)</span><br><span class="line">t &lt;- <span class="built_in">c</span>(<span class="number">8</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">print(v + t)</span><br><span class="line">	<span class="comment"># 算术操作符作用与向量的每个元素</span></span><br><span class="line">print(v - t)</span><br><span class="line">print(v * t)</span><br><span class="line">print(v/t)</span><br><span class="line">print(v %% t)</span><br><span class="line">	<span class="comment"># 向量求余</span></span><br><span class="line">print(v %/% t)</span><br><span class="line">	<span class="comment"># 求商</span></span><br><span class="line">print(v ^ t)</span><br><span class="line">	<span class="comment"># 指数运算</span></span><br></pre></td></tr></table></figure>
<h3 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h3><p>比较两个向量的相应元素，返回布尔值向量</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">v &lt;- <span class="built_in">c</span>(<span class="number">2</span>, <span class="number">5.5</span>, <span class="number">6</span>, <span class="number">9</span>)</span><br><span class="line">t &lt;- <span class="built_in">c</span>(<span class="number">8</span>, <span class="number">2.5</span>, <span class="number">14</span>, <span class="number">9</span>)</span><br><span class="line">print (v &gt; t)</span><br><span class="line">	<span class="comment"># 比较两个向量的相应元素，返回布尔值向量</span></span><br><span class="line">print (v &lt; t)</span><br><span class="line">print (v == t)</span><br><span class="line">print (v != t)</span><br><span class="line">print (v &lt;= t)</span><br><span class="line">print (v &gt;= t)</span><br></pre></td></tr></table></figure>
<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><p>只适用于逻辑、数字、复杂类型向量，所有大于1的数字被认为是
逻辑值<code>TRUE</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">v &lt;- <span class="built_in">c</span>(<span class="number">3</span>, <span class="number">1</span>, <span class="literal">TRUE</span>, <span class="number">2</span>+<span class="number">3i</span>)</span><br><span class="line">t &lt;- <span class="built_in">c</span>(<span class="number">4</span>, <span class="number">1</span>, False, <span class="number">2</span>+<span class="number">3i</span>)</span><br><span class="line">print(v &amp; t)</span><br><span class="line">	<span class="comment"># 比较两个向量相应元素，返回布尔值向量</span></span><br><span class="line">print(v | t)</span><br><span class="line">print(!v)</span><br><span class="line"></span><br><span class="line">print(v &amp;&amp; t)</span><br><span class="line">	<span class="comment"># 只考虑向量的第一个元素，输出单个bool值元素向量</span></span><br><span class="line">print(v || t)</span><br></pre></td></tr></table></figure>
<h3 id="其他运算符"><a href="#其他运算符" class="headerlink" title="其他运算符"></a>其他运算符</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">t &lt;- 2: <span class="number">8</span></span><br><span class="line">	<span class="comment"># 为向量按顺序创建一系列数字</span></span><br><span class="line"></span><br><span class="line">v1 &lt;- 8</span><br><span class="line">v2 &lt;- 12</span><br><span class="line">print (v1 %in% t)</span><br><span class="line">print (v2 %in% t)</span><br><span class="line">	<span class="comment"># 标识元素是否属于向量</span></span><br><span class="line"></span><br><span class="line">M = matrix(<span class="built_in">c</span>(<span class="number">2</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">4</span>),</span><br><span class="line">	nrow = <span class="number">2</span>,</span><br><span class="line">	ncol = <span class="number">3</span>,</span><br><span class="line">	byrow = <span class="literal">TRUE</span>)</span><br><span class="line">t = M %*% t(M)</span><br><span class="line">	<span class="comment"># 矩阵相乘</span></span><br></pre></td></tr></table></figure>
<h2 id="R语句"><a href="#R语句" class="headerlink" title="R语句"></a>R语句</h2><h3 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">switch</span></span><br></pre></td></tr></table></figure>
<h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">repeat</span></span><br><span class="line"><span class="keyword">while</span></span><br><span class="line"><span class="keyword">for</span></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">next</span></span><br></pre></td></tr></table></figure>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func_name &lt;- <span class="keyword">function</span>(</span><br><span class="line">	arg_1,</span><br><span class="line">	arg_2,...)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="R内置函数"><a href="#R内置函数" class="headerlink" title="R内置函数"></a>R内置函数</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(seq(<span class="number">32</span>, <span class="number">44</span>))</span><br><span class="line">print(mean(<span class="number">25</span>: <span class="number">82</span>))</span><br><span class="line">print(<span class="built_in">sum</span>(<span class="number">41</span>: <span class="number">68</span>))</span><br></pre></td></tr></table></figure>
<h3 id="自定义参数"><a href="#自定义参数" class="headerlink" title="自定义参数"></a>自定义参数</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">new.function_1 &lt;- fucntion()&#123;</span><br><span class="line">	<span class="comment"># 无参数函数</span></span><br><span class="line">	<span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>: <span class="number">5</span>)&#123;</span><br><span class="line">		print(i ^ <span class="number">2</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">new.function_1()</span><br><span class="line"></span><br><span class="line">new.function_2 &lt;- <span class="keyword">function</span>(a, b, <span class="built_in">c</span>)&#123;</span><br><span class="line">	<span class="comment"># 有参数函数</span></span><br><span class="line">	result &lt;- a * b + <span class="built_in">c</span></span><br><span class="line">	print(result)</span><br><span class="line">&#125;</span><br><span class="line">new.function_2(<span class="number">5</span>, <span class="number">3</span>, <span class="number">11</span>)</span><br><span class="line">	<span class="comment"># 按参数顺序调用函数</span></span><br><span class="line">new.function_2(</span><br><span class="line">	a = <span class="number">11</span>,</span><br><span class="line">	b = <span class="number">5</span>,</span><br><span class="line">	<span class="built_in">c</span> = <span class="number">3</span>)</span><br><span class="line">	<span class="comment"># 按参数名称调用</span></span><br><span class="line"></span><br><span class="line">new.function_3 &lt;- <span class="keyword">function</span>(a=<span class="number">3</span>, b=<span class="number">6</span>)&#123;</span><br><span class="line">	<span class="comment"># 含有默认参数函数</span></span><br><span class="line">	result &lt;- a * b</span><br><span class="line">	print(result)</span><br><span class="line">&#125;</span><br><span class="line">new.function_3</span><br><span class="line">	<span class="comment"># 无参数（使用默认参数）</span></span><br><span class="line">new.function_3(<span class="number">9</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h3 id="函数功能延迟计算"><a href="#函数功能延迟计算" class="headerlink" title="函数功能延迟计算"></a>函数功能延迟计算</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">new.function &lt;- <span class="keyword">function</span>(a, b)&#123;</span><br><span class="line">	print(a ^ <span class="number">2</span>)</span><br><span class="line">	print(a)</span><br><span class="line">	print(b)</span><br><span class="line">&#125;</span><br><span class="line">new.function(<span class="number">6</span>)</span><br><span class="line">	<span class="comment"># 调用函数能部分执行成功，直到`print(b)`</span></span><br></pre></td></tr></table></figure>
<h2 id="包"><a href="#包" class="headerlink" title="包"></a>包</h2><p>R语言包是R函数、编译代码、样本数据的集合</p>
<ul>
<li>存储在R环境中名为<code>library</code>的目录下</li>
<li>默认情况下，只有R安装时提供默认包可用，已安装的其他包
必须显式加载</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.libPaths()</span><br><span class="line">	<span class="comment"># 获取包含R包的库位置</span></span><br><span class="line"></span><br><span class="line">library()</span><br><span class="line">	<span class="comment"># 获取已安装所有软件包列表</span></span><br><span class="line"></span><br><span class="line">search()</span><br><span class="line">	<span class="comment"># 获取当前R环境中加载的所有包</span></span><br></pre></td></tr></table></figure>
<h3 id="安装包"><a href="#安装包" class="headerlink" title="安装包"></a>安装包</h3><ul>
<li><p>直接从CRAN安装</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install.package(<span class="string">&quot;pkg_name&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>手动安装包：从<a target="_blank" rel="noopener" href="https://cran.r-project.org/web/packages/available_packages_by_name.html">https://cran.r-project.org/web/packages/available_packages_by_name.html</a>
中下载包，将zip文件保存</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install.package(/path/to/pkg.zip, repos=<span class="literal">NULL</span>, type=<span class="string">&quot;source&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="加载包"><a href="#加载包" class="headerlink" title="加载包"></a>加载包</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library(<span class="string">&quot;pkg_name&quot;</span>,</span><br><span class="line">	lib.loc=/path/to/library)</span><br><span class="line">	<span class="comment"># `lib.loc`参数默认应该就是`.libPaths`，一般不用设置</span></span><br></pre></td></tr></table></figure>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithm/"><span class="level-start"><span class="level-item">Algorithm</span></span><span class="level-end"><span class="level-item tag">36</span></span></a><ul><li><a class="level is-mobile" href="/categories/Algorithm/Data-Structure/"><span class="level-start"><span class="level-item">Data Structure</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Heuristic/"><span class="level-start"><span class="level-item">Heuristic</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Issue/"><span class="level-start"><span class="level-item">Issue</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Problem/"><span class="level-start"><span class="level-item">Problem</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Specification/"><span class="level-start"><span class="level-item">Specification</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/C-C/"><span class="level-start"><span class="level-item">C/C++</span></span><span class="level-end"><span class="level-item tag">34</span></span></a><ul><li><a class="level is-mobile" href="/categories/C-C/Cppref/"><span class="level-start"><span class="level-item">Cppref</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/Cstd/"><span class="level-start"><span class="level-item">Cstd</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/MPI/"><span class="level-start"><span class="level-item">MPI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/STL/"><span class="level-start"><span class="level-item">STL</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/CS/"><span class="level-start"><span class="level-item">CS</span></span><span class="level-end"><span class="level-item tag">14</span></span></a><ul><li><a class="level is-mobile" href="/categories/CS/Character/"><span class="level-start"><span class="level-item">Character</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Parallel/"><span class="level-start"><span class="level-item">Parallel</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Program-Design/"><span class="level-start"><span class="level-item">Program Design</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Storage/"><span class="level-start"><span class="level-item">Storage</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Daily-Life/"><span class="level-start"><span class="level-item">Daily Life</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/Daily-Life/Maxism/"><span class="level-start"><span class="level-item">Maxism</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">27</span></span></a><ul><li><a class="level is-mobile" href="/categories/Database/Hadoop/"><span class="level-start"><span class="level-item">Hadoop</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/SQL-DB/"><span class="level-start"><span class="level-item">SQL DB</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/Spark/"><span class="level-start"><span class="level-item">Spark</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/Java/Scala/"><span class="level-start"><span class="level-item">Scala</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">42</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Bash-Programming/"><span class="level-start"><span class="level-item">Bash Programming</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Configuration/"><span class="level-start"><span class="level-item">Configuration</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/File-System/"><span class="level-start"><span class="level-item">File System</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/IPC/"><span class="level-start"><span class="level-item">IPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Process-Schedual/"><span class="level-start"><span class="level-item">Process Schedual</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Shell/"><span class="level-start"><span class="level-item">Shell</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Tool/"><span class="level-start"><span class="level-item">Tool</span></span><span class="level-end"><span class="level-item tag">14</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Tool/Vi/"><span class="level-start"><span class="level-item">Vi</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Model/"><span class="level-start"><span class="level-item">ML Model</span></span><span class="level-end"><span class="level-item tag">21</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Model/Linear-Model/"><span class="level-start"><span class="level-item">Linear Model</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Model-Component/"><span class="level-start"><span class="level-item">Model Component</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Nolinear-Model/"><span class="level-start"><span class="level-item">Nolinear Model</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Unsupervised-Model/"><span class="level-start"><span class="level-item">Unsupervised Model</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/"><span class="level-start"><span class="level-item">ML Specification</span></span><span class="level-end"><span class="level-item tag">17</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/Click-Through-Rate/"><span class="level-start"><span class="level-item">Click Through Rate</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/Click-Through-Rate/Recommandation-System/"><span class="level-start"><span class="level-item">Recommandation System</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/Computer-Vision/"><span class="level-start"><span class="level-item">Computer Vision</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Specification/FinTech/"><span class="level-start"><span class="level-item">FinTech</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/FinTech/Risk-Control/"><span class="level-start"><span class="level-item">Risk Control</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/Graph-Analysis/"><span class="level-start"><span class="level-item">Graph Analysis</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Specification/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Technique/"><span class="level-start"><span class="level-item">ML Technique</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Technique/Feature-Engineering/"><span class="level-start"><span class="level-item">Feature Engineering</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Technique/Neural-Network/"><span class="level-start"><span class="level-item">Neural Network</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Theory/"><span class="level-start"><span class="level-item">ML Theory</span></span><span class="level-end"><span class="level-item tag">11</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Theory/Loss/"><span class="level-start"><span class="level-item">Loss</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Theory/Model-Enhencement/"><span class="level-start"><span class="level-item">Model Enhencement</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Theory/Optimization/"><span class="level-start"><span class="level-item">Optimization</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Algebra/"><span class="level-start"><span class="level-item">Math Algebra</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Algebra/Linear-Algebra/"><span class="level-start"><span class="level-item">Linear Algebra</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Algebra/Universal-Algebra/"><span class="level-start"><span class="level-item">Universal Algebra</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Analysis/"><span class="level-start"><span class="level-item">Math Analysis</span></span><span class="level-end"><span class="level-item tag">23</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Analysis/Fourier-Analysis/"><span class="level-start"><span class="level-item">Fourier Analysis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Functional-Analysis/"><span class="level-start"><span class="level-item">Functional Analysis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Optimization/"><span class="level-start"><span class="level-item">Optimization</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Real-Analysis/"><span class="level-start"><span class="level-item">Real Analysis</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Mixin/"><span class="level-start"><span class="level-item">Math Mixin</span></span><span class="level-end"><span class="level-item tag">18</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Mixin/Statistics/"><span class="level-start"><span class="level-item">Statistics</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Mixin/Time-Series/"><span class="level-start"><span class="level-item">Time Series</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Probability/"><span class="level-start"><span class="level-item">Probability</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">89</span></span></a><ul><li><a class="level is-mobile" href="/categories/Python/Cookbook/"><span class="level-start"><span class="level-item">Cookbook</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Jupyter/"><span class="level-start"><span class="level-item">Jupyter</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Keras/"><span class="level-start"><span class="level-item">Keras</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Matplotlib/"><span class="level-start"><span class="level-item">Matplotlib</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Numpy/"><span class="level-start"><span class="level-item">Numpy</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Pandas/"><span class="level-start"><span class="level-item">Pandas</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Py3Ref/"><span class="level-start"><span class="level-item">Py3Ref</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Py3std/"><span class="level-start"><span class="level-item">Py3std</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Pywin32/"><span class="level-start"><span class="level-item">Pywin32</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Readme/"><span class="level-start"><span class="level-item">Readme</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/TensorFlow/"><span class="level-start"><span class="level-item">TensorFlow</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Twists/"><span class="level-start"><span class="level-item">Twists</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/RLang/"><span class="level-start"><span class="level-item">RLang</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Rust/"><span class="level-start"><span class="level-item">Rust</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Set/"><span class="level-start"><span class="level-item">Set</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/"><span class="level-start"><span class="level-item">Tool</span></span><span class="level-end"><span class="level-item tag">13</span></span></a><ul><li><a class="level is-mobile" href="/categories/Tool/Editor/"><span class="level-start"><span class="level-item">Editor</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Markup-Language/"><span class="level-start"><span class="level-item">Markup Language</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Web-Browser/"><span class="level-start"><span class="level-item">Web Browser</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Windows/"><span class="level-start"><span class="level-item">Windows</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Web/"><span class="level-start"><span class="level-item">Web</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/Web/CSS/"><span class="level-start"><span class="level-item">CSS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/NPM/"><span class="level-start"><span class="level-item">NPM</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/Proxy/"><span class="level-start"><span class="level-item">Proxy</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/Thrift/"><span class="level-start"><span class="level-item">Thrift</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="UBeaRLy"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">UBeaRLy</p><p class="is-size-6 is-block">Protector of Proxy</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Earth, Solar System</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">392</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">93</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">522</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/xyy15926" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/xyy15926"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-04T15:07:54.896Z">2021-08-04</time></p><p class="title"><a href="/uncategorized/README.html"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T07:46:51.000Z">2021-08-03</time></p><p class="title"><a href="/Web/NPM/hexo_config.html">Hexo 建站</a></p><p class="categories"><a href="/categories/Web/">Web</a> / <a href="/categories/Web/NPM/">NPM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T02:32:45.000Z">2021-08-03</time></p><p class="title"><a href="/Web/NPM/config.html">NPM 总述</a></p><p class="categories"><a href="/categories/Web/">Web</a> / <a href="/categories/Web/NPM/">NPM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-02T08:11:11.000Z">2021-08-02</time></p><p class="title"><a href="/Python/Py3std/internet_data.html">互联网数据</a></p><p class="categories"><a href="/categories/Python/">Python</a> / <a href="/categories/Python/Py3std/">Py3std</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-29T13:55:00.000Z">2021-07-29</time></p><p class="title"><a href="/Linux/Shell/sh_apps.html">Shell 应用程序</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Shell/">Shell</a></p></div></article></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5385776267343559" data-ad-slot="6371777973" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Hexo" height="28"></a><p class="is-size-7"><span>&copy; 2021 UBeaRLy</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/xyy15926/proxy"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>