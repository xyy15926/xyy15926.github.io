<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Category: TensorFlow - UBeaRLy</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="UBeaRLy&#039;s Proxy"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="UBeaRLy&#039;s Proxy"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="UBeaRLy"><meta property="og:url" content="https://xyy15926.github.io/"><meta property="og:site_name" content="UBeaRLy"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://xyy15926.github.io/img/og_image.png"><meta property="article:author" content="UBeaRLy"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://xyy15926.github.io"},"headline":"UBeaRLy","image":["https://xyy15926.github.io/img/og_image.png"],"author":{"@type":"Person","name":"UBeaRLy"},"publisher":{"@type":"Organization","name":"UBeaRLy","logo":{"@type":"ImageObject","url":"https://xyy15926.github.io/img/logo.svg"}},"description":""}</script><link rel="alternate" href="/atom.xml" title="UBeaRLy" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/darcula.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><script data-ad-client="pub-5385776267343559" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="follow_it-verification-code" content="SVBypAPPHxjjr7Y4hHfn"><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="UBeaRLy" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Visit on GitHub" href="https://github.com/xyy15926/proxy"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">Categories</a></li><li><a href="/categories/Python/">Python</a></li><li class="is-active"><a href="#" aria-current="page">TensorFlow</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-19T09:25:00.000Z" title="8/19/2019, 5:25:00 PM">2019-08-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-02T07:08:50.000Z" title="8/2/2021, 3:08:50 PM">2021-08-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/TensorFlow/">TensorFlow</a></span><span class="level-item">3 minutes read (About 495 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/TensorFlow/tf_resources.html">TensorFlow资源管理</a></h1><div class="content"><h2 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h2><h3 id="tf-placeholder"><a href="#tf-placeholder" class="headerlink" title="tf.placeholder"></a><code>tf.placeholder</code></h3><p><em>placeholder</em>：占位符，执行时通过<code>feed_dict</code>参数设置值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tf.placeholder(</span><br><span class="line">	dtype,</span><br><span class="line">	shape=<span class="literal">None</span>,</span><br><span class="line">	name=<span class="literal">None</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><code>shape</code>：并不必须，但最好设置参数方便debug</li>
</ul>
</blockquote>
<ul>
<li>需要导入数据给placeholder，可能影响程序速度</li>
<li>方便用户替换图中值</li>
</ul>
<h3 id="tf-data-DataSet"><a href="#tf-data-DataSet" class="headerlink" title="tf.data.DataSet"></a><code>tf.data.DataSet</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">data</span>.<span class="title">DataSet</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	# 从<span class="title">tensor</span> <span class="title">slice</span>创建`<span class="title">Dataset</span>`</span></span><br><span class="line"><span class="function">	<span class="title">def</span> <span class="title">from_tensor_slices</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		?data=(<span class="params">?features, ?labels</span>)</span></span></span><br><span class="line"><span class="params"><span class="function">	</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 从生成器创建`Dataset`</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">from_generator</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		gen,</span></span></span><br><span class="line"><span class="params"><span class="function">		output_types,</span></span></span><br><span class="line"><span class="params"><span class="function">		output_shapes</span></span></span><br><span class="line"><span class="params"><span class="function">	</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 迭代数据集一次，无需初始化</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">make_one_shot_iterator</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 迭代数据集任意次，每轮迭代需要初始化</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">make_initializable_iterator</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># shuffle数据集</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">shuffle</span>(<span class="params">self, ?seed:<span class="built_in">int</span></span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 重复复制数据集</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">repeat</span>(<span class="params">self, ?times:<span class="built_in">int</span></span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 将数据集划分为batch</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">batch</span>(<span class="params">self, batch_size:<span class="built_in">int</span></span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">map</span>(<span class="params">self, func:<span class="built_in">callable</span></span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>创建只能迭代一轮的迭代器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">iterator = dataset.make_one_shot_iterator()</span><br><span class="line"><span class="comment"># 这里`X`、`Y`也是OPs，在执行时候才返回Tensor</span></span><br><span class="line">X, Y = iterator.get_next()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">	<span class="built_in">print</span>(sess.run([X, Y]))</span><br><span class="line">	<span class="built_in">print</span>(sess.run([X, Y]))</span><br><span class="line">	<span class="built_in">print</span>(sess.run([X, Y]))</span><br><span class="line">		<span class="comment"># 每次不同的值</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建可以多次初始化的迭代器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">iterator = data.make_initializable_iterator()</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">		<span class="comment"># 每轮重新初始化迭代器，重新使用</span></span><br><span class="line">		sess.run(iterator.initializer)</span><br><span class="line">		total_loss = <span class="number">0</span></span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">				sess.run([optimizer])</span><br><span class="line">		<span class="comment"># 手动处理迭代器消耗完毕</span></span><br><span class="line">		<span class="keyword">except</span> tf.error.OutOfRangeError:</span><br><span class="line">			<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>tf.data</code>和<code>tf.placeholder</code>适合场景对比</p>
<ul>
<li><code>tf.data</code>速度更快、适合处理多数据源</li>
<li><code>tf.placeholder</code>更pythonic、原型开发迭代速度快</li>
</ul>
</li>
</ul>
<h4 id="读取文件数据"><a href="#读取文件数据" class="headerlink" title="读取文件数据"></a>读取文件数据</h4><p>可以从多个文件中读取数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 文件每行为一个entry</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">data</span>.<span class="title">TextLineDataset</span>(<span class="params">filenames</span>):</span></span><br><span class="line"> <span class="comment"># 文件中entry定长</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">data</span>.<span class="title">FixedLengthRecordDataset</span>(<span class="params">filenames</span>):</span></span><br><span class="line"> <span class="comment"># 文件为tfrecord格式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">data</span>.<span class="title">TFRecordDataset</span>(<span class="params">filenames</span>):</span></span><br></pre></td></tr></table></figure>
<h4 id="tf-data-Iterator"><a href="#tf-data-Iterator" class="headerlink" title="tf.data.Iterator"></a><code>tf.data.Iterator</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">data</span>.<span class="title">Iterator</span>:</span></span><br><span class="line">	<span class="comment"># 获取下组迭代数据</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get_next</span>():</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 根据dtype、shape创建迭代器</span></span><br><span class="line"><span class="meta">	@classmethod</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">from_structure</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		?dtype: <span class="built_in">type</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		?shape: [<span class="built_in">int</span>]/(<span class="params"><span class="built_in">int</span></span>)</span></span></span><br><span class="line"><span class="params"><span class="function">	</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 从数据中初始化迭代器</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">make_initializer</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		?dataset: tf.data.Dataset</span></span></span><br><span class="line"><span class="params"><span class="function">	</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-19T09:20:00.000Z" title="8/19/2019, 5:20:00 PM">2019-08-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-08-19T09:20:00.000Z" title="8/19/2019, 5:20:00 PM">2019-08-19</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/TensorFlow/">TensorFlow</a></span><span class="level-item">2 minutes read (About 250 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/TensorFlow/tf_pythonio.html">TensorFlow Python IO接口</a></h1><div class="content"><h2 id="TFRecord"><a href="#TFRecord" class="headerlink" title="TFRecord"></a>TFRecord</h2><p>TFRecord格式：序列化的<code>tf.train.Example</code> protbuf对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">python_io</span>.<span class="title">TFRecordWriter</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		?fileanme: <span class="built_in">str</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		options: tf.python_io.TFRecordOptions,</span></span></span><br><span class="line"><span class="params"><span class="function">		name=<span class="literal">None</span></span></span></span><br><span class="line"><span class="params"><span class="function">	</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">python_io</span>.<span class="title">TFRecordReader</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		options: tf.python_io.TFRecordOptions,</span></span></span><br><span class="line"><span class="params"><span class="function">		name=<span class="literal">None</span></span></span></span><br><span class="line"><span class="params"><span class="function">	</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###	Feature/Features</span></span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">train</span>.<span class="title">Features</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		feature: &#123;<span class="built_in">str</span>: tf.train.Feature&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">	</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">train</span>.<span class="title">Feature</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		int64_list: tf.train.Int64List,</span></span></span><br><span class="line"><span class="params"><span class="function">		float64_list: tf.train.Float64List,</span></span></span><br><span class="line"><span class="params"><span class="function">	</span>)</span></span><br></pre></td></tr></table></figure>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><ul>
<li><p>转换、写入TFRecord</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建写入文件</span></span><br><span class="line">writer = tf.python_io.TFRecord(out_file)</span><br><span class="line">shape, binary_image = get_image_binary(image_file)</span><br><span class="line"><span class="comment"># 创建Features对象</span></span><br><span class="line">featurs = tf.train.Features(</span><br><span class="line">	feature = &#123;</span><br><span class="line">		<span class="string">&quot;label&quot;</span>: tf.train.Feature(int64_list=tf.train.Int64List(label)),</span><br><span class="line">		<span class="string">&quot;shape&quot;</span>: tf.train.Feature(bytes_list=tf.train.BytesList(shape)),</span><br><span class="line">		<span class="string">&quot;image&quot;</span>: tf.train.Feature(bytes_list=tf.train.BytesList(binary_image))</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 创建包含以上特征的示例对象</span></span><br><span class="line">sample = tf.train.Example(features=Features)</span><br><span class="line"><span class="comment"># 写入文件</span></span><br><span class="line">writer.write(sample.SerializeToString())</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>读取TFRecord</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dataset = tf.data.TFRecordDataset(tfrecord_files)</span><br><span class="line">dataset = dataset.<span class="built_in">map</span>(_parse_function)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_parse_function</span>(<span class="params">tf_record_serialized</span>):</span></span><br><span class="line">	features = &#123;</span><br><span class="line">		<span class="string">&quot;labels&quot;</span>: tf.FixedLenFeature([], tf.int64),</span><br><span class="line">		<span class="string">&quot;shape&quot;</span>: tf.FixedLenFeature([], tf.string),</span><br><span class="line">		<span class="string">&quot;image&quot;</span>: tf.FixedLenFeature([], tf.string)</span><br><span class="line">	&#125;</span><br><span class="line">	parsed_features = tf.parse_single_example(tfrecord_serialized, features)</span><br><span class="line">	<span class="keyword">return</span> parsed_features[<span class="string">&quot;label&quot;</span>], parsed_features[<span class="string">&quot;shape&quot;</span>],</span><br><span class="line">			parsed_features[<span class="string">&quot;image&quot;</span>]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-19T09:20:00.000Z" title="8/19/2019, 5:20:00 PM">2019-08-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-08-19T09:20:00.000Z" title="8/19/2019, 5:20:00 PM">2019-08-19</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/TensorFlow/">TensorFlow</a></span><span class="level-item">a few seconds read (About 84 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/TensorFlow/tf_flow_control.html">TensorFlow控制算符</a></h1><div class="content"><h2 id="控制OPs"><a href="#控制OPs" class="headerlink" title="控制OPs"></a>控制OPs</h2><h3 id="Neural-Network-Building-Blocks"><a href="#Neural-Network-Building-Blocks" class="headerlink" title="Neural Network Building Blocks"></a>Neural Network Building Blocks</h3><h4 id="tf-softmax"><a href="#tf-softmax" class="headerlink" title="tf.softmax"></a><code>tf.softmax</code></h4><h4 id="tf-Sigmod"><a href="#tf-Sigmod" class="headerlink" title="tf.Sigmod"></a><code>tf.Sigmod</code></h4><h4 id="tf-ReLU"><a href="#tf-ReLU" class="headerlink" title="tf.ReLU"></a><code>tf.ReLU</code></h4><h4 id="tf-Convolution2D"><a href="#tf-Convolution2D" class="headerlink" title="tf.Convolution2D"></a><code>tf.Convolution2D</code></h4><h4 id="tf-MaxPool"><a href="#tf-MaxPool" class="headerlink" title="tf.MaxPool"></a><code>tf.MaxPool</code></h4><h3 id="Checkpointing"><a href="#Checkpointing" class="headerlink" title="Checkpointing"></a>Checkpointing</h3><h4 id="tf-Save"><a href="#tf-Save" class="headerlink" title="tf.Save"></a><code>tf.Save</code></h4><h4 id="tf-Restore"><a href="#tf-Restore" class="headerlink" title="tf.Restore"></a><code>tf.Restore</code></h4><h3 id="Queue-and-Synchronization"><a href="#Queue-and-Synchronization" class="headerlink" title="Queue and Synchronization"></a>Queue and Synchronization</h3><h4 id="tf-Enqueue"><a href="#tf-Enqueue" class="headerlink" title="tf.Enqueue"></a><code>tf.Enqueue</code></h4><h4 id="tf-Dequeue"><a href="#tf-Dequeue" class="headerlink" title="tf.Dequeue"></a><code>tf.Dequeue</code></h4><h4 id="tf-MutexAcquire"><a href="#tf-MutexAcquire" class="headerlink" title="tf.MutexAcquire"></a><code>tf.MutexAcquire</code></h4><h4 id="tf-MutexRelease"><a href="#tf-MutexRelease" class="headerlink" title="tf.MutexRelease"></a><code>tf.MutexRelease</code></h4><h3 id="Control-Flow"><a href="#Control-Flow" class="headerlink" title="Control Flow"></a>Control Flow</h3><h4 id="tf-count-up-to"><a href="#tf-count-up-to" class="headerlink" title="tf.count_up_to"></a><code>tf.count_up_to</code></h4><h4 id="tf-cond"><a href="#tf-cond" class="headerlink" title="tf.cond"></a><code>tf.cond</code></h4><p><code>pred</code>为<code>True</code>，执行<code>true_fn</code>，否则执行<code>false_fn</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tf.cond(</span><br><span class="line">	pred,</span><br><span class="line">	true_fn=<span class="literal">None</span>,</span><br><span class="line">	false_fn =<span class="literal">None</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="tf-case"><a href="#tf-case" class="headerlink" title="tf.case"></a><code>tf.case</code></h4><h4 id="tf-while-loop"><a href="#tf-while-loop" class="headerlink" title="tf.while_loop"></a><code>tf.while_loop</code></h4><h4 id="tf-group"><a href="#tf-group" class="headerlink" title="tf.group"></a><code>tf.group</code></h4><h4 id="tf-Merge"><a href="#tf-Merge" class="headerlink" title="tf.Merge"></a><code>tf.Merge</code></h4><h4 id="tf-Switch"><a href="#tf-Switch" class="headerlink" title="tf.Switch"></a><code>tf.Switch</code></h4><h4 id="tf-Enter"><a href="#tf-Enter" class="headerlink" title="tf.Enter"></a><code>tf.Enter</code></h4><h4 id="tf-Leave"><a href="#tf-Leave" class="headerlink" title="tf.Leave"></a><code>tf.Leave</code></h4><h4 id="tf-NextIteration"><a href="#tf-NextIteration" class="headerlink" title="tf.NextIteration"></a><code>tf.NextIteration</code></h4></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-19T09:13:00.000Z" title="8/19/2019, 5:13:00 PM">2019-08-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-02T07:08:09.000Z" title="8/2/2021, 3:08:09 PM">2021-08-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/TensorFlow/">TensorFlow</a></span><span class="level-item">10 minutes read (About 1531 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/TensorFlow/tf_operators.html">TensorFlow操作符</a></h1><div class="content"><h2 id="Tensor"><a href="#Tensor" class="headerlink" title="Tensor"></a>Tensor</h2><p>张量：n-dimensional array，类型化的多维数组</p>
<ul>
<li>TF使用Tensor表示所有的数据</li>
<li>Tensor包含一个静态类型rank、一个shape</li>
<li>TF会将python原生类型转换为相应的Tensor<ul>
<li>0-d tensor：scalar</li>
<li>1-d tensor：vector，1d-array</li>
<li>2-d tensor：matrix，2d-array</li>
</ul>
</li>
</ul>
<h3 id="Data-Type"><a href="#Data-Type" class="headerlink" title="Data Type"></a>Data Type</h3><ul>
<li><p>TF被设计为和numpy可以无缝结合</p>
<ul>
<li>TF的变量类型基于numpy变量类型：<code>tf.int32==np.int32</code></li>
<li>bool、numeric等大部分类型可以不加转换的使用TF、np
变量类型</li>
<li>TF、np中string类型不完全一样，但TF仍然可以从numpy
中导入string数组，但是不能在numpy中指定类型</li>
</ul>
</li>
<li><p>但尽量使用TF变量类型</p>
<ul>
<li>python原生类型：没有<strong>细分</strong>类型，TF需要推断类型</li>
<li>numpy类型：numpy不兼容GPU，也不能自动计算衍生类型</li>
</ul>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tf.float16</code></td>
<td>16-bit half-precision floating-point</td>
</tr>
<tr>
<td><code>tf.float32</code></td>
<td>32-bit single-presicion floating-point</td>
</tr>
<tr>
<td><code>tf.float64</code></td>
<td>64-bit double-presicion floating-point</td>
</tr>
<tr>
<td><code>tf.bfloat16</code></td>
<td>16-bit truncated floating-point</td>
</tr>
<tr>
<td><code>tf.complex64</code></td>
<td>64-bit single-presicion complex</td>
</tr>
<tr>
<td><code>tf.complex128</code></td>
<td>128-bit double-presicion complex</td>
</tr>
<tr>
<td><code>tf.int8</code></td>
<td>8-bit signed integer</td>
</tr>
<tr>
<td><code>tf.uint8</code></td>
<td>8-bit unsigned integer</td>
</tr>
<tr>
<td><code>tf.int16</code></td>
<td></td>
</tr>
<tr>
<td><code>tf.uint16</code></td>
<td></td>
</tr>
<tr>
<td><code>tf.int32</code></td>
<td></td>
</tr>
<tr>
<td><code>tf.int64</code></td>
<td></td>
</tr>
<tr>
<td><code>tf.bool</code></td>
<td></td>
</tr>
<tr>
<td><code>tf.string</code></td>
<td></td>
</tr>
<tr>
<td><code>tf.qint8</code></td>
<td>quantized 8-bit signed integer</td>
</tr>
<tr>
<td><code>tf.quint8</code></td>
<td></td>
</tr>
<tr>
<td><code>tf.qint16</code></td>
<td></td>
</tr>
<tr>
<td><code>tf.quint16</code></td>
<td></td>
</tr>
<tr>
<td><code>tf.qint32</code></td>
<td></td>
</tr>
<tr>
<td><code>tf.resource</code></td>
<td>handle to a mutable resource</td>
</tr>
</tbody>
</table>
</div>
<h2 id="Constant-OPs"><a href="#Constant-OPs" class="headerlink" title="Constant OPs"></a>Constant OPs</h2><h3 id="tf-constant"><a href="#tf-constant" class="headerlink" title="tf.constant"></a><code>tf.constant</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">constant</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	value,</span></span></span><br><span class="line"><span class="params"><span class="function">	dtype=none,</span></span></span><br><span class="line"><span class="params"><span class="function">	shape=none,</span></span></span><br><span class="line"><span class="params"><span class="function">	name=<span class="string">&quot;Const&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	verify_shape=<span class="literal">False</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>)</span></span><br></pre></td></tr></table></figure>
<h3 id="同值常量OPs"><a href="#同值常量OPs" class="headerlink" title="同值常量OPs"></a>同值常量OPs</h3><ul>
<li><p><em>zeros</em>：类似np中相应函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># `np.zeros`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">zeros</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	shape,</span></span></span><br><span class="line"><span class="params"><span class="function">	dtype=tf.float32,</span></span></span><br><span class="line"><span class="params"><span class="function">	name=<span class="literal">None</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># `<span class="title">np</span>.<span class="title">zores_like</span>`</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">zeros_like</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	input_tensor,</span></span></span><br><span class="line"><span class="params"><span class="function">	dtype=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	name=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	optimizeTrue</span></span></span><br><span class="line"><span class="params"><span class="function"></span>)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>若没有指明<code>dtype</code>，根据<code>input_tensor</code>确定其中值<ul>
<li>对数值型为<code>0.0</code></li>
<li>对bool型为<code>False</code></li>
<li>对字符串为<code>b&#39;&#39;</code></li>
</ul>
</li>
</ul>
</li>
<li><p><em>ones</em>：类似np中相应函数</p>
</li>
</ul>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># `np.ones`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">ones</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	shape,</span></span></span><br><span class="line"><span class="params"><span class="function">	dtype=tf.float32,</span></span></span><br><span class="line"><span class="params"><span class="function">	name=<span class="literal">None</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># `<span class="title">np</span>.<span class="title">ones_like</span>`</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">ones_like</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	input_tensor,</span></span></span><br><span class="line"><span class="params"><span class="function">	dtype=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	name=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	optimize=<span class="literal">True</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>)</span></span><br></pre></td></tr></table></figure>

-    若没有指明`dtype`，根据`input_tensor`确定
    -    对数值型为`0.0`
    -    对bool型为`True`
    -    对字符串报错
</code></pre><ul>
<li><p><em>fill</em>：以<code>value</code>填充<code>dims</code>给定形状</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># `np.fill`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">fill</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	dims,</span></span></span><br><span class="line"><span class="params"><span class="function">	value,</span></span></span><br><span class="line"><span class="params"><span class="function">	name=<span class="literal">None</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="列表常量OPs"><a href="#列表常量OPs" class="headerlink" title="列表常量OPs"></a>列表常量OPs</h3><blockquote>
<ul>
<li>tensor列表不能直接<code>for</code>语句等迭代</li>
</ul>
</blockquote>
<ul>
<li><p><code>tf.lin_space</code>：<code>start</code>、<code>stop</code>直接均分为<code>num</code>部分</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># `np.linspace`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lin_space</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	start,</span></span></span><br><span class="line"><span class="params"><span class="function">	stop,</span></span></span><br><span class="line"><span class="params"><span class="function">	num,</span></span></span><br><span class="line"><span class="params"><span class="function">	name=<span class="literal">None</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>tf.range</code>：<code>start</code>、<code>stop</code>间等间隔<code>delta</code>取值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># `np.arange`</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">range</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	start,</span></span></span><br><span class="line"><span class="params"><span class="function">	limit=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	delta=<span class="number">1</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	dtype=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	name=<span class="string">&quot;range&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="随机常量OPs"><a href="#随机常量OPs" class="headerlink" title="随机常量OPs"></a>随机常量OPs</h3><ul>
<li><p><em>seed</em>：设置随机数种子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># np.random.seed</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">set_random_seed</span>(<span class="params">seed</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><em>random</em>：随机生成函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">random_normal</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">truncated_normal</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	?avg=<span class="number">0</span>/<span class="built_in">int</span>/(<span class="params"><span class="built_in">int</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="function">	stddev=<span class="number">1.0</span>/<span class="built_in">float</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	seed=<span class="literal">None</span>/<span class="built_in">int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	name=<span class="literal">None</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">random_uniform</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	shape(<span class="params">1d-arr</span>),</span></span></span><br><span class="line"><span class="params"><span class="function">	minval=<span class="number">0</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	maxval=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	dtype=tf.float32,</span></span></span><br><span class="line"><span class="params"><span class="function">	seed=<span class="literal">None</span>/<span class="built_in">int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	name=<span class="literal">None</span>/<span class="built_in">str</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">random_crop</span>()</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">multinomial</span>()</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">random_gamma</span>()</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><em>shuffle</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">random_shuffle</span>()</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="运算OPs"><a href="#运算OPs" class="headerlink" title="运算OPs"></a>运算OPs</h2><h3 id="元素OPs"><a href="#元素OPs" class="headerlink" title="元素OPs"></a>元素OPs</h3><h4 id="四则运算"><a href="#四则运算" class="headerlink" title="四则运算"></a>四则运算</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">subtract</span>(<span class="params">x, y, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">sub</span>(<span class="params">x, y, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">multiply</span>(<span class="params">x, y, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">mul</span>(<span class="params">x, y, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function">	# 加、减、乘</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">floordiv</span>(<span class="params">x, y, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">floor_div</span>(<span class="params">x, y, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">div</span>(<span class="params">x, y, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">truncatediv</span>(<span class="params">x, y, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function">	# 地板除</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">divide</span>(<span class="params">x, y, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">truediv</span>(<span class="params">x, y, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function">	# 浮点除</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">realdiv</span>(<span class="params">x, y, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function">	# 实数除法，只能用于实数？</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">add_n</span>(<span class="params"><span class="built_in">input</span>, name=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function">	# `<span class="title">input</span>`：<span class="title">list</span>-<span class="title">like</span>，元素<span class="title">shape</span>、<span class="title">type</span>相同</span></span><br><span class="line"><span class="function">	# 累加`<span class="title">input</span>`中元素的值</span></span><br></pre></td></tr></table></figure>
<h4 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greater</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">less</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">equal</span>()</span></span><br></pre></td></tr></table></figure>
<h4 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">log</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">square</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">round</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">sqrt</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">rsqrt</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">pow</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">abs</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">negative</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">sign</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">reciprocal</span>()		# 倒数</span></span><br></pre></td></tr></table></figure>
<h3 id="列表运算OPs"><a href="#列表运算OPs" class="headerlink" title="列表运算OPs"></a>列表运算OPs</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">Concat</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">Slice</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">Split</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">Rank</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">Shape</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">Shuffle</span>()</span></span><br></pre></td></tr></table></figure>
<h3 id="矩阵OPs"><a href="#矩阵OPs" class="headerlink" title="矩阵OPs"></a>矩阵OPs</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">MatMul</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">MatrixInverse</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">MatrixDeterminant</span>()</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">tf</span>.<span class="title">tensordot</span>()				# 矩阵点乘</span></span><br></pre></td></tr></table></figure>
<h3 id="梯度OPs"><a href="#梯度OPs" class="headerlink" title="梯度OPs"></a>梯度OPs</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def tf.gradients(				# 求`y`对`[xs]`个元素偏导</span><br><span class="line">	ys: tf.OPs,</span><br><span class="line">	xs: tf.OPs/[tf.OPs],</span><br><span class="line">	grad_ys=None,</span><br><span class="line">	name=None</span><br><span class="line">)</span><br><span class="line">def tf.stop_gradient(</span><br><span class="line">	input,</span><br><span class="line">	name=None</span><br><span class="line">)</span><br><span class="line"><span class="function">def <span class="title">clip_by_value</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	t,</span></span></span><br><span class="line"><span class="params"><span class="function">	clip_value_min,</span></span></span><br><span class="line"><span class="params"><span class="function">	clip_value_max,</span></span></span><br><span class="line"><span class="params"><span class="function">	name=None</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function">def tf.<span class="title">clip_by_norm</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	t,</span></span></span><br><span class="line"><span class="params"><span class="function">	clip_norm,</span></span></span><br><span class="line"><span class="params"><span class="function">	axes=None,</span></span></span><br><span class="line"><span class="params"><span class="function">	name=None</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br></pre></td></tr></table></figure>
<h2 id="Variable"><a href="#Variable" class="headerlink" title="Variable"></a>Variable</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Variable</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		init_value=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		trainable=<span class="literal">True</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		collections=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		validata_shape=<span class="literal">True</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		caching_device=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		name=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		variable_def=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		dtype=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		expected_shape=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		import_scope=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		constraint=<span class="literal">None</span></span></span></span><br><span class="line"><span class="params"><span class="function">	</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	# 初始化变量</span></span><br><span class="line"><span class="function">	# `<span class="title">sess</span>.<span class="title">run</span>`其即初始化变量</span></span><br><span class="line"><span class="function">	<span class="title">def</span> <span class="title">intializer</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 读取变量值</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">value</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 获取变量初始化值，其他变量调用、声明依赖该变量</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">initilized_value</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 计算、获取变量值，类似`sess.run(OP)`</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">eval</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 给变量赋值</span></span><br><span class="line">	<span class="comment"># `assgin`内部有初始化Variable，所以有时可以不用初始化</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">assign</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="comment">#`assgin_add`等依赖于原始值，不会初始化变量</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">assign_add</span>(<span class="params">self, ?dec</span>)</span></span><br><span class="line"><span class="function">	<span class="title">def</span> <span class="title">assign_divide</span>(<span class="params">self, ?dec</span>)</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>Variable</code>是包含很多方法的类</p>
<ul>
<li>其中<strong>方法OPs</strong>和一般的OP一样，也需要在Session中执行
才能生效</li>
<li><code>Variable</code>必须在会话中<strong>初始化</strong>后，才能使用</li>
<li>会话维护自身独立<code>Variable</code>副本，不相互影响</li>
</ul>
</li>
<li><p><code>Variable</code>和图分开存储，甚至是存储在独立参数服务器上</p>
<ul>
<li>存储大量数据也不会拖慢图载入速度</li>
<li>通常用于存储训练过程中weight、bias、维护图执行过程
中状态信息</li>
</ul>
</li>
<li><p>constants是常数OPs</p>
<ul>
<li>存储在图中：每次载入图会同时被载入，过大的constants
会使得载入图非常慢</li>
<li>所以最好只对原生类型使用constants</li>
</ul>
</li>
</ul>
<h3 id="Variable创建"><a href="#Variable创建" class="headerlink" title="Variable创建"></a>Variable创建</h3><h4 id="tf-get-variable"><a href="#tf-get-variable" class="headerlink" title="tf.get_variable"></a><code>tf.get_variable</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_variable</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	name,</span></span></span><br><span class="line"><span class="params"><span class="function">	shape=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	dtype=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	initializer=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	regularizer=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	trainable=<span class="literal">True</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	collections=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	caching_device=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	partitioner=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	validate_shape=<span class="literal">True</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	use_resource=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	custom_getter=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	constraint=<span class="literal">None</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>此封装工厂方法相较于直接通过<code>tf.Variable</code>更好<ul>
<li>若变量已设置，可通过变量名获取变量，方便变量共享</li>
<li>可以提供更多的参数定制变量值</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment"># `tf.Variable`创建变量</span></span><br><span class="line">s = tf.Variable(<span class="number">2</span>, name=<span class="string">&quot;scalar&quot;</span>)</span><br><span class="line">m = tf.Variable([[<span class="number">0</span>,<span class="number">1</span>], [<span class="number">2</span>,<span class="number">3</span>]], name=<span class="string">&quot;matrix&quot;</span>)</span><br><span class="line">w = tf.Variable(tf.zeros([<span class="number">784</span>, <span class="number">10</span>]))</span><br><span class="line">	<span class="comment"># `tf.get_variable`创建、获取变量</span></span><br><span class="line">s = tf.get_variable(<span class="string">&quot;scalar&quot;</span>, initializer=tf.constant(<span class="number">2</span>))</span><br><span class="line">m = tf.get_variable(<span class="string">&quot;matrix&quot;</span>, initializer=tf.constant([[<span class="number">0</span>,<span class="number">1</span>], [<span class="number">2</span>,<span class="number">3</span>]])</span><br><span class="line">W = tf.get_variable(<span class="string">&quot;big_matrix&quot;</span>,</span><br><span class="line">	shape=(<span class="number">784</span>, <span class="number">10</span>),</span><br><span class="line">	initializer=tf.zeros_initializer()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="Variable初始化"><a href="#Variable初始化" class="headerlink" title="Variable初始化"></a>Variable初始化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">	<span class="comment"># 初始化所有Variables</span></span><br><span class="line">	sess.run(tf.global_variable_initialier())</span><br><span class="line">	<span class="comment"># 初始化变量子集</span></span><br><span class="line">	sess.run(tf.variable_initializer([s, m])</span><br><span class="line">	<span class="comment"># 初始化指定单个变量</span></span><br><span class="line">	sess.run(s.initializer)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>若某Variable依赖其他Variable，需要使用
<code>initialized_value</code>指明依赖，确保依赖线性初始化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">W = tr.Variable(tf.truncated_normal([<span class="number">700</span>, <span class="number">100</span>])</span><br><span class="line"><span class="comment"># 指明依赖，保证依赖线性初始化</span></span><br><span class="line">U = tf.Variable(W.initialized_value() * <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-19T09:13:00.000Z" title="8/19/2019, 5:13:00 PM">2019-08-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-08-19T09:13:00.000Z" title="8/19/2019, 5:13:00 PM">2019-08-19</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/TensorFlow/">TensorFlow</a></span><span class="level-item">5 minutes read (About 714 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/TensorFlow/tf_persistence.html">TensorFlow 持久化</a></h1><div class="content"><h2 id="Session-Checkpoint"><a href="#Session-Checkpoint" class="headerlink" title="Session Checkpoint"></a>Session Checkpoint</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">train</span>.<span class="title">Saver</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		var_list=<span class="literal">None</span>/<span class="built_in">list</span>/<span class="built_in">dict</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		reshape=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		sharded=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		max_to_keep=<span class="number">5</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		keep_checkpoint_every_n_hours=<span class="number">10000.0</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		name=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		restore_sequentially=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		saver_def=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		builder=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		defer_build=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		allow_empty=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		write_version=tf.train.SaverDef.V2,</span></span></span><br><span class="line"><span class="params"><span class="function">		pad_step_number=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		save_relative_paths=<span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		filename=<span class="literal">None</span></span></span></span><br><span class="line"><span class="params"><span class="function">	</span>):</span></span><br><span class="line">		self.last_checkpoints</span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：保存Session中变量（张量值），将变量名映射至张量值</p>
</li>
<li><p>参数</p>
<ul>
<li><code>var_list</code>：待保存、恢复变量，缺省所有<ul>
<li>变量需在<code>tf.train.Saver</code>实例化前创建</li>
</ul>
</li>
<li><code>reshape</code>：允许恢复并重新设定张量形状</li>
<li><code>sharded</code>：碎片化保存至多个设备</li>
<li><code>max_to_keep</code>：最多保存checkpoint数目</li>
<li><code>keep_checkpoint_every_n_hours</code>：checkpoint有效时间</li>
<li><code>restore_sequentially</code>：各设备中顺序恢复变量，可以
减少内存消耗</li>
</ul>
</li>
<li><p>成员</p>
<ul>
<li><code>last_checkpoints</code>：最近保存checkpoints</li>
</ul>
</li>
</ul>
<h3 id="保存Session"><a href="#保存Session" class="headerlink" title="保存Session"></a>保存Session</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Saver</span>.<span class="title">save</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">	sess,</span></span></span><br><span class="line"><span class="params"><span class="function">	save_path,</span></span></span><br><span class="line"><span class="params"><span class="function">	global_step=<span class="literal">None</span>/<span class="built_in">str</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	latest_filename=<span class="literal">None</span>(<span class="params"><span class="string">&quot;checkpoint&quot;</span></span>)/<span class="built_in">str</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	meta_graph_suffix=<span class="string">&quot;meta&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	write_meta_graph=<span class="literal">True</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	write_state=<span class="literal">True</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) -&gt; <span class="built_in">str</span>(path):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：保存Session，要求变量已初始化</p>
</li>
<li><p>参数</p>
<ul>
<li><code>global_step</code>：添加至<code>save_path</code>以区别不同步骤</li>
<li><code>latest_filename</code>：checkpoint文件名</li>
<li><code>meta_graph_suffix</code>：MetaGraphDef文件名后缀</li>
</ul>
</li>
</ul>
<h3 id="恢复Session"><a href="#恢复Session" class="headerlink" title="恢复Session"></a>恢复Session</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Saver</span>.<span class="title">restore</span>(<span class="params">sess, save_path(<span class="params"><span class="built_in">str</span></span>)</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li>用途：从<code>save_path</code>指明的路径中恢复模型</li>
</ul>
<blockquote>
<ul>
<li>模型路径可以通过<code>Saver.last_checkpoints</code>属性、
  <code>tf.train.get_checkpoint_state()</code>函数获得</li>
</ul>
</blockquote>
<h3 id="tf-train-get-checkpoint-state"><a href="#tf-train-get-checkpoint-state" class="headerlink" title="tf.train.get_checkpoint_state"></a><code>tf.train.get_checkpoint_state</code></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def tf.train.get_checkpoint_state(</span><br><span class="line">	checkpoint_dir(str),</span><br><span class="line">	latest_filename=None</span><br><span class="line">):</span><br><span class="line">	pass</span><br></pre></td></tr></table></figure>
<ul>
<li>用途：获取指定checkpoint目录下checkpoint状态<ul>
<li>需要图结构已经建好、Session开启</li>
<li>恢复模型得到的变量无需初始化</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ckpt = tf.train.get_checkpoint_state(checkpoint_dir)</span><br><span class="line">saver.restore(ckpt.model_checkpoint_path)</span><br><span class="line">saver.restore(ckpt.all_model_checkpoint_paths[-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<h2 id="Graph-Saver"><a href="#Graph-Saver" class="headerlink" title="Graph Saver"></a>Graph Saver</h2><h3 id="tf-train-write-graph"><a href="#tf-train-write-graph" class="headerlink" title="tf.train.write_graph"></a><code>tf.train.write_graph</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">train</span>.<span class="title">write_graph</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	graph_or_graph_def: tf.Graph,</span></span></span><br><span class="line"><span class="params"><span class="function">	logdir: <span class="built_in">str</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	name: <span class="built_in">str</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	as_text=<span class="literal">True</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>)</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：存储图至文件中</p>
</li>
<li><p>参数</p>
<ul>
<li><code>as_text</code>：以ASCII方式写入文件</li>
</ul>
</li>
</ul>
<h2 id="Summary-Saver"><a href="#Summary-Saver" class="headerlink" title="Summary Saver"></a>Summary Saver</h2><h3 id="tf-summary-FileWriter"><a href="#tf-summary-FileWriter" class="headerlink" title="tf.summary.FileWriter"></a><code>tf.summary.FileWriter</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">summary</span>.<span class="title">FileWriter</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		?path=<span class="built_in">str</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		graph=tf.Graph</span></span></span><br><span class="line"><span class="params"><span class="function">	</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	# 添加<span class="title">summary</span>记录</span></span><br><span class="line"><span class="function">	<span class="title">def</span> <span class="title">add_summary</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		summary: OP,</span></span></span><br><span class="line"><span class="params"><span class="function">		global_step</span></span></span><br><span class="line"><span class="params"><span class="function">	</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 关闭`log`记录</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">close</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>用途：创建<code>FileWriter</code>对象用于记录log</p>
<ul>
<li>存储图到<strong>文件夹</strong>中，文件名由TF自行生成</li>
<li>可通过TensorBoard组件查看生成的event log文件</li>
</ul>
</li>
<li><p>说明</p>
<ul>
<li>一般在图定义完成后、Session执行前创建<code>FileWriter</code>
对象，Session结束后关闭</li>
</ul>
</li>
</ul>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 创建自定义summary</span></span><br><span class="line"><span class="keyword">with</span> tf.name_scope(<span class="string">&quot;summaries&quot;</span>):</span><br><span class="line">	tf.summary.scalar(<span class="string">&quot;loss&quot;</span>, self.loss)</span><br><span class="line">	tf.summary.scalar(<span class="string">&quot;accuracy&quot;</span>, self.accuracy)</span><br><span class="line">	tf.summary.histogram(<span class="string">&quot;histogram loss&quot;</span>, self.loss)</span><br><span class="line">	summary_op = tf.summary.merge_all()</span><br><span class="line"></span><br><span class="line">saver = tf.train.Saver()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">	sess.run(tf.global_variables_initializer())</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 从checkpoint中恢复Session</span></span><br><span class="line">	ckpt = tf.train.get_check_state(os.path.dirname(<span class="string">&quot;checkpoint_dir&quot;</span>))</span><br><span class="line">	<span class="keyword">if</span> ckpt <span class="keyword">and</span> ckpt.model_check_path:</span><br><span class="line">		saver.restore(sess, ckpt.mode_checkpoint_path)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># summary存储图</span></span><br><span class="line">	writer = tf.summary.FileWriter(<span class="string">&quot;./graphs&quot;</span>, sess.graph)</span><br><span class="line">	<span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">		loas_batch, _, summary = session.run([loss, optimizer, summary_op])</span><br><span class="line">		writer.add_summary(summary, global_step=index)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (index + <span class="number">1</span>) % <span class="number">1000</span> = <span class="number">0</span>:</span><br><span class="line">			saver.save(sess, <span class="string">&quot;checkpoint_dir&quot;</span>, index)</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 关闭`FileWriter`，生成event log文件</span></span><br><span class="line">write.close()</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-19T09:13:00.000Z" title="8/19/2019, 5:13:00 PM">2019-08-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-08-19T09:13:00.000Z" title="8/19/2019, 5:13:00 PM">2019-08-19</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/TensorFlow/">TensorFlow</a></span><span class="level-item">a few seconds read (About 26 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/TensorFlow/tf_train.html">TensorFlow训练</a></h1><div class="content"><h2 id="Optimizer"><a href="#Optimizer" class="headerlink" title="Optimizer"></a>Optimizer</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">train</span>.<span class="title">GradientDescentOptimizer</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">train</span>.<span class="title">AdagradOptimizer</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">train</span>.<span class="title">MomentumOptimizer</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">train</span>.<span class="title">AdamOptimizer</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">train</span>.<span class="title">FtrlOptimizer</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tf</span>.<span class="title">train</span>.<span class="title">RMSPropOptmizer</span>:</span></span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-19T09:09:00.000Z" title="8/19/2019, 5:09:00 PM">2019-08-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-02T07:07:32.000Z" title="8/2/2021, 3:07:32 PM">2021-08-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/TensorFlow/">TensorFlow</a></span><span class="level-item">14 minutes read (About 2161 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/TensorFlow/tf_execution.html">TensorFlow执行</a></h1><div class="content"><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p><em>Session</em>：TF中OPs对象执行、Tensor对象计算的封装环境</p>
<ul>
<li><p>Session管理图、OPs</p>
<ul>
<li>所有图必须Session中执行</li>
<li>将图中OPs、其执行方法分发到CPU、GPU、TPU等设备上</li>
<li>为当前变量值分配内存</li>
</ul>
</li>
<li><p>Session只执行<em>Data/Tensor Flow</em>中OPs，忽略不相关节点</p>
<ul>
<li>即通往<code>fetches</code>的flow中的<strong>OPs构成子图</strong>才会被计算</li>
</ul>
</li>
<li><p>各Session中各值独立维护，不会相互影响</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		target=<span class="built_in">str</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		graph=<span class="literal">None</span>/tf.Graph,</span></span></span><br><span class="line"><span class="params"><span class="function">		config=<span class="literal">None</span>/tf.ConfigProto</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">		# 获取<span class="title">Session</span>中载入图</span></span><br><span class="line"><span class="function">		<span class="title">self</span>.<span class="title">graph</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	# 关闭会话，释放资源</span></span><br><span class="line"><span class="function">	<span class="title">def</span> <span class="title">close</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 支持上下文语法</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 执行TensorFlow中节点，获取`fetches`中节点值</span></span><br><span class="line">	<span class="comment"># 返回值若为Tensor</span></span><br><span class="line">		<span class="comment"># python中：以`np.ndarray`返回</span></span><br><span class="line">		<span class="comment"># C++/C中：以`tensorflow:Tensor`返回</span></span><br><span class="line">	<span class="comment"># 可直接调用`.eval()`获得单个OP值</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		fetches=tf.OPs/[tf.OPs],</span></span></span><br><span class="line"><span class="params"><span class="function">		feed_dict=<span class="literal">None</span>/<span class="built_in">dict</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		options=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">		run_metadata=<span class="literal">None</span></span>)</span></span><br></pre></td></tr></table></figure>
<h3 id="tf-InteractiveSession"><a href="#tf-InteractiveSession" class="headerlink" title="tf.InteractiveSession"></a><code>tf.InteractiveSession</code></h3><p><code>tf.InteractiveSession</code>：开启交互式会话</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 开启交互式Session</span></span><br><span class="line">sess = tf.InteractiveSession()</span><br><span class="line">a = tf.constant(<span class="number">5.0</span>)</span><br><span class="line">b = tf.constant(<span class="number">6.0</span>)</span><br><span class="line">c = a * b</span><br><span class="line">x = tf.Variable([<span class="number">1.0</span>, <span class="number">2.0</span>])</span><br><span class="line"> <span class="comment"># 无需显式在`sess.run`中执行</span></span><br><span class="line"> <span class="comment"># 直接调用`OPs.eval/run()`方法得到结果</span></span><br><span class="line">x.initializer.run()</span><br><span class="line"><span class="built_in">print</span>(c.<span class="built_in">eval</span>())</span><br><span class="line">sess.close()</span><br></pre></td></tr></table></figure>
<h3 id="Session执行"><a href="#Session执行" class="headerlink" title="Session执行"></a>Session执行</h3><ul>
<li><p>Fetch机制：<code>sess.run()</code>执行图时，传入需<strong>取回</strong>的结果，
取回操作输出内容</p>
</li>
<li><p>Feed机制：通过<code>feed_dict</code>参数，使用自定义tensor值替代图
中任意feeable OPs的输出</p>
<ul>
<li><code>tf.placeholder()</code>表示创建占位符，执行Graph时必须
使用tensor替代</li>
<li><code>feed_dict</code>只是函数参数，只在调用它的方法内有效，
方法执行完毕则消失</li>
</ul>
</li>
<li><p>可以通过<code>feed_dict</code> feed所有feedable tensor，placeholder
只是指明必须给某些提供值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = tf.add(<span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line">b = tf.multiply(a, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">	sess.run(b, feed_dict=&#123;a: <span class="number">15</span>&#125;)			<span class="comment"># 45</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="config参数选项"><a href="#config参数选项" class="headerlink" title="config参数选项"></a><code>config</code>参数选项</h3><ul>
<li><code>log_device_placement</code>：打印每个操作所用设备</li>
<li><code>allow_soft_placement</code>：允许不在GPU上执行操作自动迁移到
CPU上执行</li>
<li><code>gpu_options</code><ul>
<li><code>allow_growth</code>：按需分配显存</li>
<li><code>per_process_gpu_memory_fraction</code>：指定每个GPU进程
使用显存比例（无法对单个GPU分别设置）</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>具体配置参见<code>tf.ConfigProto</code></li>
</ul>
</blockquote>
<h2 id="Graph"><a href="#Graph" class="headerlink" title="Graph"></a>Graph</h2><p><em>Graph</em>：表示TF中计算任务，</p>
<ul>
<li><p><em>operation/node</em>：Graph中节点，包括：<em>operator</em>、
<em>variable</em>、<em>constant</em></p>
<ul>
<li>获取一个、多个Tensor执行计算、产生、返回tensor</li>
<li>不能无法对其值直接进行访问、比较、操作</li>
<li>图中节点可以命名，TF会自动给未命名节点命名</li>
</ul>
</li>
<li><p><em>tensor</em>：Graph中边，n维数组</p>
<ul>
<li>TF中所有对象都是Operators</li>
<li>tensor是OPs执行结果，在图中传递/流动</li>
</ul>
</li>
<li><p>图计算模型优势</p>
<ul>
<li>优化能力强、节省计算资源<ul>
<li>缓冲自动重用</li>
<li>常量折叠，只计算取得目标值过程中必须计算的值</li>
<li>方便并行化</li>
<li>自动权衡计算、存储效率</li>
</ul>
</li>
<li>易于部署<ul>
<li>可被割成子图（即极大连通分量），便于自动区分</li>
<li>子图可以分发到不同的设备上分布式执行，即模型并行</li>
<li>许多通用ML模型是通过有向图教学、可视化的</li>
</ul>
</li>
</ul>
</li>
<li><p>图计算模型劣势</p>
<ul>
<li>难以debug<ul>
<li>图定义之后执行才会报错</li>
<li>无法通过pdb、打印状态debug</li>
</ul>
</li>
<li>语法繁复</li>
</ul>
</li>
</ul>
<h3 id="构建图"><a href="#构建图" class="headerlink" title="构建图"></a>构建图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Graph</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 将当前图作为默认图</span></span><br><span class="line">	<span class="comment"># 支持上下文语法</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">as_default</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 强制OPs依赖关系（图中未反映），即优先执行指定OPs</span></span><br><span class="line">	<span class="comment"># 支持上下文语法</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">as_default</span>(<span class="params">self</span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">control_dependencies</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		?ops=[tf.OPs]</span>)</span></span><br><span class="line"><span class="function">		<span class="title">pass</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	# 以<span class="title">ProtoBuf</span>格式展示<span class="title">Graph</span></span></span><br><span class="line"><span class="function">	<span class="title">def</span> <span class="title">as_graph_def</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 判断图中节点是否可以被feed</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">is_feedable</span>(<span class="params">self,</span></span></span><br><span class="line"><span class="params"><span class="function">		?op=tf.OPs</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>可以通过<code>tf.Graph</code>创建新图，但最好在是在一张图中使用多个
不相连的子图，而不是多张图</p>
<ul>
<li>充分性：Session执行图时忽略不必要的OPs</li>
<li>必要性<ul>
<li>多张图需要多个会话，每张图执行时默认尝试使用所有
可能资源</li>
<li>不能通过python/numpy在图间传递数据（分布式系统）</li>
</ul>
</li>
</ul>
</li>
<li><p>初始化即包含默认图，OP构造器默认为其增加节点</p>
<ul>
<li>通过<code>tf.get_default_graph()</code>获取</li>
</ul>
</li>
</ul>
<h3 id="图相关方法"><a href="#图相关方法" class="headerlink" title="图相关方法"></a>图相关方法</h3><ul>
<li><p>获取TF初始化的默认图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">get_default_graph</span>():</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 均支持、利用上下文语法，将OPs定义于其下</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">name_scope</span>(<span class="params">name(<span class="params"><span class="built_in">str</span></span>)</span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf</span>.<span class="title">variable_scope</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">	name(<span class="params"><span class="built_in">str</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="function">	reuse=tf.AUTO_REUSE</span></span></span><br><span class="line"><span class="params"><span class="function"></span>):</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>tf.name_scope</code>：将变量分组<ul>
<li>只是将变量打包，不影响变量的重用、可见性等</li>
<li>方便管理、查看graph</li>
</ul>
</li>
<li><code>tf.variable_scope</code>：<ul>
<li>对变量有控制能力<ul>
<li>可设置变量重用性</li>
<li>变量可见性局限于该<em>variable scope</em>内，即不同
variable scope间可以有完全同名变量
（未被TF添加顺序后缀）</li>
</ul>
</li>
<li>会隐式创建<em>name scope</em></li>
<li>大部分情况是用于实现变量共享</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fully_connected</span>(<span class="params">x, output_dim, scope</span>):</span></span><br><span class="line">	<span class="comment"># 设置variable scope中变量自动重用</span></span><br><span class="line">	<span class="comment"># 或者调用`scope.reuse_variables()`声明变量可重用</span></span><br><span class="line">	<span class="keyword">with</span> tf.variable_scope(scope, reuse=tf.AUTO_REUSE) <span class="keyword">as</span> scope:</span><br><span class="line">		<span class="comment"># 在当前variable scope中获取、创建变量</span></span><br><span class="line">		w = tf.get_variable(<span class="string">&quot;weights&quot;</span>, [x.shape[<span class="number">1</span>]], output_dim,</span><br><span class="line">							initializer=tf.random_normal_initializer())</span><br><span class="line">		b = tf.get_variable(<span class="string">&quot;biases&quot;</span>, [output_dim],</span><br><span class="line">							initializer=tf.constant_initizer(<span class="number">0.0</span>))</span><br><span class="line">		<span class="keyword">return</span> tf.matmul(x, w) + b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">two_hidden_layers</span>(<span class="params">x</span>):</span></span><br><span class="line">	h1 = fully_connected(x, <span class="number">50</span>, <span class="string">&quot;h1&quot;</span>)</span><br><span class="line">	h2 =-fully_connected(h1, <span class="number">10</span>, <span class="string">&quot;h2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">&quot;two_layers&quot;</span>) <span class="keyword">as</span> scope:</span><br><span class="line">	logits1 = two_hidden_layers(x1)</span><br><span class="line">	logits2 = two_hidden_layers(x2)</span><br></pre></td></tr></table></figure>
<h3 id="Lazy-Loading"><a href="#Lazy-Loading" class="headerlink" title="Lazy Loading"></a>Lazy Loading</h3><p><em>Lazy Loading</em>：推迟声明/初始化OP对象至载入图时
（不是指TF的延迟计算，是个人代码结构问题，虽然是TF延迟图计算
模型的结果）</p>
<ul>
<li><p>延迟加载容易导致向图中添加大量重复节点，影响图的载入、
传递</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x = tf.Variable(<span class="number">10</span>, name=<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">y = tf.Variable(<span class="number">20</span>, name=<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">	sess.run(tf.global_variables_initializer())</span><br><span class="line">	writer = tf.summary.FileWriter(<span class="string">&#x27;graphs/lazy_loading&#x27;</span>, sess.graph)</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">		<span class="comment"># 延迟加载节点，每次执行都会添加`tf.add`OP</span></span><br><span class="line">		sess.run(tf.add(x, y))</span><br><span class="line">	<span class="built_in">print</span>(tf.get_default_graph().as_graph_def())</span><br><span class="line">	writer.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>解决方案</p>
<ul>
<li>总是把（图的搭建）OPs的定义、执行分开</li>
<li>python利用<code>@property</code>装饰器，使用<strong>单例模式函数</strong>
封装变量控制，保证仅首次调用函数时才创建OP</li>
</ul>
</li>
</ul>
<h2 id="Eager-Execution"><a href="#Eager-Execution" class="headerlink" title="Eager Execution"></a>Eager Execution</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> tensorflow.contrib.eager <span class="keyword">as</span> tfe</span><br><span class="line"> <span class="comment"># 启用TF eager execution</span></span><br><span class="line">tfe.enable_eager_execution()</span><br></pre></td></tr></table></figure>
<ul>
<li><p>优势</p>
<ul>
<li>支持python debug工具</li>
<li>提供实时报错</li>
<li>支持python数据结构</li>
<li><p>支持pythonic的控制流</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = tf.constant(<span class="number">0</span>)</span><br><span class="line">whlile i &lt; <span class="number">1000</span>:</span><br><span class="line">	i = tf.add(i, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>eager execution开启后</p>
<ul>
<li>tensors行为类似<code>np.ndarray</code></li>
<li>大部分API和未开启同样工作，倾向于使用<ul>
<li><code>tfe.Variable</code></li>
<li><code>tf.contrib.summary</code></li>
<li><code>tfe.Iterator</code></li>
<li><code>tfe.py_func</code></li>
<li>面向对象的layers</li>
<li>需要自行管理变量存储</li>
</ul>
</li>
</ul>
</li>
<li><p>eager execution和graph大部分兼容</p>
<ul>
<li>checkpoint兼容</li>
<li>代码可以同时用于python过程、构建图</li>
<li>可使用<code>@tfe.function</code>将计算编译为图</li>
</ul>
</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><ul>
<li><p>placeholder、sessions</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 普通TF</span></span><br><span class="line">x = tf.placholder(tf.float32, shape=[<span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line">m = tf.matmul(x, x)</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">	m_out = sess.run(m, feed_dict=&#123;x: [[<span class="number">2.</span>]]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Eager Execution</span></span><br><span class="line">x = [[<span class="number">2.</span>]]</span><br><span class="line">m = tf.matmul(x, x)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Lazy loading</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = tf.random_uniform([<span class="number">2</span>, <span class="number">2</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">0</span>]):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">1</span>]):</span><br><span class="line">		<span class="comment"># 不会添加多个节点</span></span><br><span class="line">		<span class="built_in">print</span>(x[i, j])</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Device"><a href="#Device" class="headerlink" title="Device"></a>Device</h2><h3 id="设备标识"><a href="#设备标识" class="headerlink" title="设备标识"></a>设备标识</h3><ul>
<li><p>设备标识：设备使用字符串进行标识</p>
<ul>
<li><code>/cpu:0</code>：所有CPU都以此作为名称</li>
<li><code>/gpu:0</code>：第一个GPU，如果有</li>
<li><code>/gpu:1</code>：第二个GPU</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为计算指定硬件资源</span></span><br><span class="line"><span class="keyword">with</span> tf.device(<span class="string">&quot;/gpu:2&quot;</span>):</span><br><span class="line">	a = tf.constant([<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>], name=<span class="string">&quot;a&quot;</span>)</span><br><span class="line">	b = tf.constant([<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>], name=<span class="string">&quot;b&quot;</span>)</span><br><span class="line">	c = tf.multiply(a, b)</span><br><span class="line">	<span class="comment"># creates a graph</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>环境变量：python中既可以修改<code>os.environ</code>，也可以直接设置
中设置环境变量</p>
<ul>
<li><code>CUDA_VISIBLE_DEVICES</code>：可被使用的GPU id</li>
</ul>
</li>
</ul>
<h3 id="设备执行"><a href="#设备执行" class="headerlink" title="设备执行"></a>设备执行</h3><p>设备执行：TF将图形定义转换成分布式执行的操作以充分利用计算
资源</p>
<ul>
<li><p>TF默认自动检测硬件配置，尽可能使用找到首个GPU执行操作</p>
</li>
<li><p>TF会默认占用所有GPU及每个GPU的所有显存（可配置）</p>
<ul>
<li>但只有一个GPU参与计算，其他GPU默认不参与计算（显存
仍然被占用），需要明确将OPs指派给其执行</li>
<li>指派GPU数量需通过设置环境变量实现</li>
<li>控制显存占用需设置Session <code>config</code>参数</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>注意：有些操作不能再GPU上完成，手动指派计算设备需要注意</li>
</ul>
</blockquote>
<h2 id="tf-ConfigProto"><a href="#tf-ConfigProto" class="headerlink" title="tf.ConfigProto"></a><code>tf.ConfigProto</code></h2><ul>
<li><p>Session参数配置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># `tf.ConfigProto`配置方法</span></span><br><span class="line">conf = tf.ConfigProto(log_device_placement=<span class="literal">True</span>)</span><br><span class="line">conf.gpu_options.allow_growth=<span class="literal">True</span></span><br><span class="line">sess = tf.Session(config=conf)</span><br><span class="line">sess.close()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:37.000Z" title="3/21/2019, 5:27:37 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2019-02-17T03:57:07.000Z" title="2/17/2019, 11:57:07 AM">2019-02-17</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/TensorFlow/">TensorFlow</a></span><span class="level-item">10 minutes read (About 1432 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/TensorFlow/README.html">TensorFlow Readme</a></h1><div class="content"><h2 id="常用参数说明"><a href="#常用参数说明" class="headerlink" title="常用参数说明"></a>常用参数说明</h2><ul>
<li><p>函数书写声明同Python全局</p>
</li>
<li><p>以下常用参数如不特殊注明，按照此解释</p>
</li>
</ul>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><ul>
<li><p><code>target = &quot;&quot;/str</code></p>
<ul>
<li>含义：执行引擎</li>
</ul>
</li>
<li><p><code>graph = None/tf.Graph</code></p>
<ul>
<li>含义：Session中加载的图</li>
<li>默认：缺省为当前默认图</li>
</ul>
</li>
<li><p><code>config = None/tf.ConfigProto</code></p>
<ul>
<li>含义：包含Session配置的<em>Protocal Buffer</em></li>
<li>默认：<code>None</code>，默认配置</li>
</ul>
</li>
<li><p><code>fetches = tf.OPs/[tf.OPs]</code></p>
<ul>
<li>含义：需要获得/计算的OPs值列表</li>
<li>默认：无</li>
</ul>
</li>
<li><p><code>feed_dict = None/dict</code></p>
<ul>
<li>含义：替换/赋值Graph中feedable OPs的tensor字典</li>
<li>默认：无</li>
<li>说明<ul>
<li>键为图中节点名称、值为向其赋的值</li>
<li>可向所有可赋值OPs传递值</li>
<li>常配合<code>tf.placeholder</code>（强制要求）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Operators"><a href="#Operators" class="headerlink" title="Operators"></a>Operators</h3><ul>
<li><p><code>name = None/str</code></p>
<ul>
<li>含义：Operations名</li>
<li>默认：<code>None/OP类型</code>，后加上顺序后缀</li>
<li>说明<ul>
<li>重名时TF自动加上<code>_[num]</code>后缀</li>
</ul>
</li>
</ul>
</li>
<li><p><code>axis = None/0/int</code></p>
<ul>
<li>含义：指定张量轴</li>
<li>默认<ul>
<li><code>None</code>：大部分，表示在整个张量上运算</li>
<li><code>0</code>：有些运算难以推广到整个张量，表示在首轴（维）</li>
</ul>
</li>
</ul>
</li>
<li><p><code>keepdims=False/True</code></p>
<ul>
<li>含义：是否保持维度数目</li>
<li>默认：<code>False</code>不保持</li>
</ul>
</li>
<li><p><code>dtype=tf.int32/tf.float32/...</code></p>
<ul>
<li>含义：数据类型</li>
<li>默认：根据其他参数、函数名推断</li>
</ul>
</li>
<li><p><code>shape/dims=(int)/[int]</code></p>
<ul>
<li>含义：各轴维数</li>
<li>默认：<code>None/1</code>???</li>
<li>说明<ul>
<li><code>-1</code>表示该轴维数由TF计算得到</li>
<li>有些情况下，此参数可省略，由TF隐式计算得到，
但显式指明方便debug</li>
</ul>
</li>
</ul>
</li>
<li><p><code>start=int</code></p>
<ul>
<li>含义：起始位置</li>
<li>默认：<code>0</code></li>
</ul>
</li>
<li><p><code>stop=int</code></p>
<ul>
<li>含义：终点位置</li>
<li>默认：一般无</li>
</ul>
</li>
</ul>
<h2 id="TensorFlow基本概念"><a href="#TensorFlow基本概念" class="headerlink" title="TensorFlow基本概念"></a>TensorFlow基本概念</h2><blockquote>
<ul>
<li>TensorFlow将计算的定义、执行分开</li>
</ul>
</blockquote>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><h4 id="组合计算图"><a href="#组合计算图" class="headerlink" title="组合计算图"></a>组合计算图</h4><ul>
<li>为输入、标签创建placeholder</li>
<li>创建weigth、bias</li>
<li>指定模型</li>
<li>指定损失函数</li>
<li>创建Opitmizer</li>
</ul>
<h4 id="在会话中执行图中操作"><a href="#在会话中执行图中操作" class="headerlink" title="在会话中执行图中操作"></a>在会话中执行图中操作</h4><ul>
<li>初始化Variable</li>
<li>运行优化器</li>
<li>使用<code>FileWriter</code>记录log</li>
<li>查看TensorBoard</li>
</ul>
<h2 id="PyTF-模块"><a href="#PyTF-模块" class="headerlink" title="PyTF 模块"></a>PyTF 模块</h2><h3 id="tf-nn"><a href="#tf-nn" class="headerlink" title="tf.nn"></a><code>tf.nn</code></h3><p><code>tf.nn</code>：神经网络功能支持模块</p>
<ul>
<li><code>rnn_cell</code>：构建循环神经网络子模块</li>
</ul>
<h3 id="tf-contrib"><a href="#tf-contrib" class="headerlink" title="tf.contrib"></a><code>tf.contrib</code></h3><p><code>tf.contrib</code>：包含易于变动、实验性质的功能</p>
<ul>
<li><code>bayesflow</code>：包含贝叶斯计算</li>
<li><code>cloud</code>：云操作</li>
<li><code>cluster_resolver</code>：集群求解</li>
<li><code>compiler</code>：控制TF/XLA JIT编译器</li>
<li><code>copy_graph</code>：在不同计算图之间复制元素</li>
<li><code>crf</code>：条件随机场</li>
<li><code>cudnn_rnn</code>：Cudnn层面循环神经网络</li>
<li><code>data</code>：构造输入数据流水线</li>
<li><code>decision_trees</code>：决策树相关模块</li>
<li><code>deprecated</code>：已经、将被替换的summary函数</li>
<li><code>distributions</code>：统计分布相关操作</li>
<li><code>estimator</code>：自定义标签、预测的对错度量方式</li>
<li><code>factorization</code>：聚类、因子分解</li>
<li><code>ffmpeg</code>：使用FFmpeg处理声音文件</li>
<li><code>framework</code>：框架类工具，包含变量操作、命令空间、
checkpoint操作</li>
<li><code>gan</code>：对抗生成相关</li>
<li><code>graph_editor</code>：计算图操作</li>
<li><code>grid_rnn</code>：GridRNN相关</li>
<li><code>image</code>：图像操作</li>
<li><code>input_pipeline</code>：输入流水线</li>
<li><code>integrate</code>：求解常微分方程</li>
<li><code>keras</code>：Keras相关API</li>
<li><code>kernel_methods</code>：核映射相关方法</li>
<li><code>kfac</code>：KFAC优化器</li>
<li><code>labeled_tensor</code>：有标签的Tensor</li>
<li><code>layers</code>：类似nn里面的函数，经典CNN方法重构</li>
<li><code>learn</code>：类似ski-learn的高级API</li>
<li><code>legacy_seq2seq</code>：经典seq2seq模型</li>
<li><code>linalg</code>：线性代数</li>
<li><code>linear_optimizer</code>：训练线性模型、线性优化器</li>
<li><code>lookup</code>：构建快速查找表</li>
<li><code>losses</code>：loss相关</li>
<li><code>memory_stats</code>：设备内存使用情况</li>
<li><code>meta_graph_transform</code>：计算图转换</li>
<li><code>metrics</code>：各种度量模型表现的方法</li>
<li><code>nccl</code>：收集结果的操作</li>
<li><code>ndlstm</code>：ndlstm相关</li>
<li><code>nn</code>：<code>tf.nn</code>某些方法的其他版本</li>
<li><code>opt</code>：某些优化器的其他版本</li>
<li><code>predictor</code>：构建预测器</li>
<li><code>reduce_slice_ops</code>：切片规约</li>
<li><code>remote_fused_graph</code></li>
<li><code>resampler</code>：重抽样</li>
<li><code>rnn</code>：某些循环神经网络其他版本</li>
<li><code>saved_model</code>：更加易用的模型保存、继续训练、模型转换</li>
<li><code>seq2seq</code>：seq2seq相关模型</li>
<li><code>session_bundle</code></li>
<li><code>signal</code>：信号处理相关</li>
<li><code>slim</code>：contrib主模块交互方式、主要入口</li>
<li><code>solvers</code>：贝叶斯计算</li>
<li><code>sparsemax</code>：稀疏概率激活函数、相关loss</li>
<li><code>specs</code></li>
<li><code>staging</code>：分段输入</li>
<li><code>stat_summarizer</code>：查看运行状态</li>
<li><code>statless</code>：伪随机数</li>
<li><code>tensor_forest</code>：可视化工具</li>
<li><code>testing</code>：单元测试工具</li>
<li><code>tfprof</code>：查看模型细节工具</li>
<li><code>timeseries</code>：时间序列工具</li>
<li><code>tpu</code>：TPU配置</li>
<li><code>training</code>：训练及输入相关工具</li>
<li><code>util</code>：Tensors处理相关工具</li>
</ul>
<h3 id="tf-train"><a href="#tf-train" class="headerlink" title="tf.train"></a><code>tf.train</code></h3><p><code>tf.train</code>：训练模型支持</p>
<ul>
<li><p>优化器</p>
<ul>
<li><code>AdadeltaOptimizer</code>：Adadelta优化器</li>
<li><code>AdamOptimizer</code>：Adam优化器</li>
<li><code>GradientDescentOptimizer</code>：SGD优化器</li>
<li><code>MomentumOptimizer</code>：动量优化器</li>
<li><code>RMSPropOptimizer</code>：RMSProp优化器</li>
</ul>
</li>
<li><p>数据处理</p>
<ul>
<li><code>Coordinator</code>：线程管理器</li>
<li><code>QueueRunner</code>：管理读写队列线程</li>
<li><code>NanTensorHook</code>：loss是否为NaN的捕获器</li>
<li><code>create_global_step</code>：创建global step</li>
<li><code>match_filenames_once</code>：寻找符合规则文件名称</li>
<li><code>start_queue_runners</code>：启动计算图中所有队列</li>
</ul>
</li>
<li><p>tfrecord数据</p>
<ul>
<li><code>Example</code>：tfrecord生成模板</li>
<li><code>batch</code>：生成tensor batch</li>
<li><code>shuffle_batch</code>：创建随机tensor batch</li>
</ul>
</li>
<li><p>模型保存、读取</p>
<ul>
<li><code>Saver</code>：保存模型、变量类</li>
<li><code>NewCheckpointReader</code>：checkpoint文件读取</li>
<li><code>get_checkpoint_state</code>：从checkpoint文件返回模型状态</li>
<li><code>init_from_checkpoint</code>：从checkpoint文件初始化变量</li>
<li><code>latest_checkpoint</code>：寻找最后checkpoint文件</li>
<li><code>list_variable</code>：返回checkpoint文件变量为列表</li>
<li><code>load_variable</code>：返回checkpoint文件某个变量值</li>
</ul>
</li>
</ul>
<h3 id="tf-summary"><a href="#tf-summary" class="headerlink" title="tf.summary"></a><code>tf.summary</code></h3><p><code>tf.summary</code>：配合tensorboard展示模型信息</p>
<ul>
<li><code>FileWriter</code>：文件生成类</li>
<li><code>Summary</code></li>
<li><code>get_summary_description</code>：获取计算节点信息</li>
<li><code>histogram</code>：展示变量分布信息</li>
<li><code>image</code>：展示图片信息</li>
<li><code>merge</code>：合并某个summary信息</li>
<li><code>merge_all</code>：合并所有summary信息至默认计算图</li>
<li><code>scalar</code>：展示标量值</li>
<li><code>text</code>：展示文本信息</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-21T09:27:37.000Z" title="3/21/2019, 5:27:37 PM">2019-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-04T11:38:46.000Z" title="8/4/2021, 7:38:46 PM">2021-08-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/TensorFlow/">TensorFlow</a></span><span class="level-item">2 minutes read (About 317 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Python/TensorFlow/tf_config.html">TensorFlow 安装配置</a></h1><div class="content"><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="CUDA、CUDNN、CUDAtookit、NVCC"><a href="#CUDA、CUDNN、CUDAtookit、NVCC" class="headerlink" title="CUDA、CUDNN、CUDAtookit、NVCC"></a>CUDA、CUDNN、CUDAtookit、NVCC</h3><ul>
<li>CUDA：compute unified device architecture，通用并行计算
平台和编程模型，方便使用GPU进行通用计算</li>
<li>cuDNN：深度学习加速库，计算设计的库、中间件<ul>
<li>C++STL的thrust的实现</li>
<li>cublas：GPU版本blas</li>
<li>cuSparse：稀疏矩阵运算</li>
<li>cuFFT：快速傅里叶变换</li>
<li>cuDNN：深度学习网络加速</li>
</ul>
</li>
<li>CUDA Toolkit：包括以下组件<ul>
<li>编译器<code>nvcc</code>：CUDA-C、CUDA-C++编译器，依赖<code>nvvm</code>
优化器
（<code>nvvm</code>本身依赖<code>llvm</code>编译器）</li>
<li>·<code>debuggers</code>、<code>profiler</code>等工具</li>
<li>科学库、实用程序库<ul>
<li>cudart</li>
<li>cudadevrt</li>
<li>cupti</li>
<li>nvml</li>
<li>nvrtc</li>
<li>cublas</li>
<li>cublas_device</li>
</ul>
</li>
<li>示例</li>
<li>驱动：</li>
</ul>
</li>
</ul>
<h2 id="TensorBoard"><a href="#TensorBoard" class="headerlink" title="TensorBoard"></a>TensorBoard</h2><p>TensorBoard是包括在TensorFlow中可视化组件</p>
<ul>
<li>运行启动了TB的TF项目时，操作都会输出为事件日志文件</li>
<li>TB能够把这些日志文件以可视化的方式展示出来<ul>
<li>模型图</li>
<li>运行时行为、状态</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tensorboard --logdir=/path/to/logdir --port XXXX</span><br></pre></td></tr></table></figure>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="指令集"><a href="#指令集" class="headerlink" title="指令集"></a>指令集</h3><blockquote>
<p>   Your CPU supports instructions that this TensorFlow binary was not cmpiled to use: SSE1.4, SSE4.2, AVX AVX2 FMA</p>
</blockquote>
<ul>
<li>没从源代码安装以获取这些指令集的支持<ul>
<li>从源代码编译安装</li>
<li>或者设置log级别<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">&quot;TF_CPP_MIN_LOG_LEVEL&quot;</span>] = <span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithm/"><span class="level-start"><span class="level-item">Algorithm</span></span><span class="level-end"><span class="level-item tag">36</span></span></a><ul><li><a class="level is-mobile" href="/categories/Algorithm/Data-Structure/"><span class="level-start"><span class="level-item">Data Structure</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Heuristic/"><span class="level-start"><span class="level-item">Heuristic</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Issue/"><span class="level-start"><span class="level-item">Issue</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Problem/"><span class="level-start"><span class="level-item">Problem</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Specification/"><span class="level-start"><span class="level-item">Specification</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/C-C/"><span class="level-start"><span class="level-item">C/C++</span></span><span class="level-end"><span class="level-item tag">34</span></span></a><ul><li><a class="level is-mobile" href="/categories/C-C/Cppref/"><span class="level-start"><span class="level-item">Cppref</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/Cstd/"><span class="level-start"><span class="level-item">Cstd</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/MPI/"><span class="level-start"><span class="level-item">MPI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/C-C/STL/"><span class="level-start"><span class="level-item">STL</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/CS/"><span class="level-start"><span class="level-item">CS</span></span><span class="level-end"><span class="level-item tag">14</span></span></a><ul><li><a class="level is-mobile" href="/categories/CS/Character/"><span class="level-start"><span class="level-item">Character</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Parallel/"><span class="level-start"><span class="level-item">Parallel</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Program-Design/"><span class="level-start"><span class="level-item">Program Design</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/CS/Storage/"><span class="level-start"><span class="level-item">Storage</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Daily-Life/"><span class="level-start"><span class="level-item">Daily Life</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/Daily-Life/Maxism/"><span class="level-start"><span class="level-item">Maxism</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">27</span></span></a><ul><li><a class="level is-mobile" href="/categories/Database/Hadoop/"><span class="level-start"><span class="level-item">Hadoop</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/SQL-DB/"><span class="level-start"><span class="level-item">SQL DB</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/Spark/"><span class="level-start"><span class="level-item">Spark</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/Java/Scala/"><span class="level-start"><span class="level-item">Scala</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">42</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Bash-Programming/"><span class="level-start"><span class="level-item">Bash Programming</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Configuration/"><span class="level-start"><span class="level-item">Configuration</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/File-System/"><span class="level-start"><span class="level-item">File System</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/IPC/"><span class="level-start"><span class="level-item">IPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Process-Schedual/"><span class="level-start"><span class="level-item">Process Schedual</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Shell/"><span class="level-start"><span class="level-item">Shell</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Tool/"><span class="level-start"><span class="level-item">Tool</span></span><span class="level-end"><span class="level-item tag">14</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Tool/Vi/"><span class="level-start"><span class="level-item">Vi</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Model/"><span class="level-start"><span class="level-item">ML Model</span></span><span class="level-end"><span class="level-item tag">21</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Model/Linear-Model/"><span class="level-start"><span class="level-item">Linear Model</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Model-Component/"><span class="level-start"><span class="level-item">Model Component</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Nolinear-Model/"><span class="level-start"><span class="level-item">Nolinear Model</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Model/Unsupervised-Model/"><span class="level-start"><span class="level-item">Unsupervised Model</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/"><span class="level-start"><span class="level-item">ML Specification</span></span><span class="level-end"><span class="level-item tag">17</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/Click-Through-Rate/"><span class="level-start"><span class="level-item">Click Through Rate</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/Click-Through-Rate/Recommandation-System/"><span class="level-start"><span class="level-item">Recommandation System</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/Computer-Vision/"><span class="level-start"><span class="level-item">Computer Vision</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Specification/FinTech/"><span class="level-start"><span class="level-item">FinTech</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Specification/FinTech/Risk-Control/"><span class="level-start"><span class="level-item">Risk Control</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Specification/Graph-Analysis/"><span class="level-start"><span class="level-item">Graph Analysis</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Specification/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Technique/"><span class="level-start"><span class="level-item">ML Technique</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Technique/Feature-Engineering/"><span class="level-start"><span class="level-item">Feature Engineering</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Technique/Neural-Network/"><span class="level-start"><span class="level-item">Neural Network</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/ML-Theory/"><span class="level-start"><span class="level-item">ML Theory</span></span><span class="level-end"><span class="level-item tag">11</span></span></a><ul><li><a class="level is-mobile" href="/categories/ML-Theory/Loss/"><span class="level-start"><span class="level-item">Loss</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Theory/Model-Enhencement/"><span class="level-start"><span class="level-item">Model Enhencement</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/ML-Theory/Optimization/"><span class="level-start"><span class="level-item">Optimization</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Algebra/"><span class="level-start"><span class="level-item">Math Algebra</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Algebra/Linear-Algebra/"><span class="level-start"><span class="level-item">Linear Algebra</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Algebra/Universal-Algebra/"><span class="level-start"><span class="level-item">Universal Algebra</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Analysis/"><span class="level-start"><span class="level-item">Math Analysis</span></span><span class="level-end"><span class="level-item tag">23</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Analysis/Fourier-Analysis/"><span class="level-start"><span class="level-item">Fourier Analysis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Functional-Analysis/"><span class="level-start"><span class="level-item">Functional Analysis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Optimization/"><span class="level-start"><span class="level-item">Optimization</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Analysis/Real-Analysis/"><span class="level-start"><span class="level-item">Real Analysis</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Math-Mixin/"><span class="level-start"><span class="level-item">Math Mixin</span></span><span class="level-end"><span class="level-item tag">18</span></span></a><ul><li><a class="level is-mobile" href="/categories/Math-Mixin/Statistics/"><span class="level-start"><span class="level-item">Statistics</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Math-Mixin/Time-Series/"><span class="level-start"><span class="level-item">Time Series</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Probability/"><span class="level-start"><span class="level-item">Probability</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">89</span></span></a><ul><li><a class="level is-mobile" href="/categories/Python/Cookbook/"><span class="level-start"><span class="level-item">Cookbook</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Jupyter/"><span class="level-start"><span class="level-item">Jupyter</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Keras/"><span class="level-start"><span class="level-item">Keras</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Matplotlib/"><span class="level-start"><span class="level-item">Matplotlib</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Numpy/"><span class="level-start"><span class="level-item">Numpy</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Pandas/"><span class="level-start"><span class="level-item">Pandas</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Py3Ref/"><span class="level-start"><span class="level-item">Py3Ref</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Py3std/"><span class="level-start"><span class="level-item">Py3std</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Pywin32/"><span class="level-start"><span class="level-item">Pywin32</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Readme/"><span class="level-start"><span class="level-item">Readme</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/TensorFlow/"><span class="level-start"><span class="level-item">TensorFlow</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/Twists/"><span class="level-start"><span class="level-item">Twists</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/RLang/"><span class="level-start"><span class="level-item">RLang</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Rust/"><span class="level-start"><span class="level-item">Rust</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Set/"><span class="level-start"><span class="level-item">Set</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/"><span class="level-start"><span class="level-item">Tool</span></span><span class="level-end"><span class="level-item tag">13</span></span></a><ul><li><a class="level is-mobile" href="/categories/Tool/Editor/"><span class="level-start"><span class="level-item">Editor</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Markup-Language/"><span class="level-start"><span class="level-item">Markup Language</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Web-Browser/"><span class="level-start"><span class="level-item">Web Browser</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tool/Windows/"><span class="level-start"><span class="level-item">Windows</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Web/"><span class="level-start"><span class="level-item">Web</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/Web/CSS/"><span class="level-start"><span class="level-item">CSS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/NPM/"><span class="level-start"><span class="level-item">NPM</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/Proxy/"><span class="level-start"><span class="level-item">Proxy</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/Thrift/"><span class="level-start"><span class="level-item">Thrift</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="UBeaRLy"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">UBeaRLy</p><p class="is-size-6 is-block">Protector of Proxy</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Earth, Solar System</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">392</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">93</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">522</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/xyy15926" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/xyy15926"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-04T15:07:54.896Z">2021-08-04</time></p><p class="title"><a href="/uncategorized/README.html"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T07:46:51.000Z">2021-08-03</time></p><p class="title"><a href="/Web/NPM/hexo_config.html">Hexo 建站</a></p><p class="categories"><a href="/categories/Web/">Web</a> / <a href="/categories/Web/NPM/">NPM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T02:32:45.000Z">2021-08-03</time></p><p class="title"><a href="/Web/NPM/config.html">NPM 总述</a></p><p class="categories"><a href="/categories/Web/">Web</a> / <a href="/categories/Web/NPM/">NPM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-02T08:11:11.000Z">2021-08-02</time></p><p class="title"><a href="/Python/Py3std/internet_data.html">互联网数据</a></p><p class="categories"><a href="/categories/Python/">Python</a> / <a href="/categories/Python/Py3std/">Py3std</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-29T13:55:00.000Z">2021-07-29</time></p><p class="title"><a href="/Linux/Shell/sh_apps.html">Shell 应用程序</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Shell/">Shell</a></p></div></article></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="pub-5385776267343559" data-ad-slot="6995841235" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="https://api.follow.it/subscription-form/WWxwMVBsOUtoNTdMSlJ4Z1lWVnRISERsd2t6ek9MeVpEUWs0YldlZGxUdXlKdDNmMEZVV1hWaFZFYWFSNmFKL25penZodWx3UzRiaVkxcnREWCtOYUJhZWhNbWpzaUdyc1hPangycUh5RTVjRXFnZnFGdVdSTzZvVzJBcTJHKzl8aXpDK1ROWWl4N080YkFEK3QvbEVWNEJuQjFqdWdxODZQcGNoM1NqbERXST0=/8" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="UBeaRLy" height="28"></a><p class="is-size-7"><span>&copy; 2021 UBeaRLy</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/xyy15926/proxy"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>